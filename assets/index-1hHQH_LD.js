import{_ as Se}from"./index.vuevuetypescriptsetuptruelang-BZ8LCPIw.js";import{_ as Ce}from"./index.vuevuetypestyleindex0lang-CcFzt3O-.js";import{k as we,_ as re}from"./index-C9NrBMJ6.js";import{_ as Ee}from"./index-BUSQFeK2.js";import{_ as Re,a as je}from"./index.vuevuetypescriptsetuptruelang-DlliyulR.js";import{_ as ye}from"./index.vuevuetypescriptsetuptruelang-DAISk7I9.js";import{b as te,a as Ne}from"./index.esm-CLFC3Zjv.js";import{G as de,n as ce,p as X,u as $e,x as Ue,s as Pe,t as be,I as Ve,v as Oe,V as Me,y as ge,r as Fe,F as he,a0 as ze}from"./antd-CeareF1k.js";import{F as Le}from"./index-bARVdIfQ.js";import{d as me,r as le,f as V,c as _e,W as k,_ as H,$ as a,Y as r,k as e,u as t,al as qe,H as Ae,o as xe,ap as Ie,X as E,G as i,F as ne,ab as I,a4 as W,a7 as ie,a6 as D}from"./vue-BtcszhJV.js";import{u as pe,S as ve}from"./customer-DYALn1iR.js";import{b as ue}from"./tools-DInPKiE1.js";import"./context-GnZ2cGI_.js";import"./index.vuevuetypestyleindex0lang-l354ccN2.js";import"./index.vuevuetypescriptsetuptruelang-BxQ8nJie.js";import"./request-DWpYk0EE.js";const Ke={class:"px-24px"},Te=me({name:"BizDBCustomerModal",__name:"bizdb-customer",emits:["importBizData"],setup(fe,{expose:J,emit:K}){const T=K,{getAllBizdbCustomers:z,bizPagination:h,bizdbCustomerData:ae}=pe(),R=le({selectedRowKeys:[],selectedRows:[],loading:!1}),L=[{title:"公司名稱",dataIndex:"companyName",key:"companyName",defaultSortOrder:"descend",sorter:!0,width:"190px"},{title:"統一編號",dataIndex:"unifiedNumber",key:"unifiedNumber",sorter:!0,width:"120px"},{title:"公司帳號",dataIndex:"companyAccount",key:"companyAccount",sorter:!0,width:"130px"}],w=V({keyword:"",sortField:"companyName",sortOrder:"descend"}),G=_e(()=>{const y=(h.value.current-1)*h.value.pageSize;return ae.value.slice(y,h.value.current*h.value.pageSize)});async function U(y,P){h.value={...h.value,current:y,pageSize:P}}async function n(y=1,P=10){const B={current:y,pageSize:P,...t(w)};await z(B)}function M(y,P){console.log("selectedRowKeys changed: ",y),R.selectedRowKeys=y,R.selectedRows=P}const A=V(!1);async function j(y){y&&(R.selectedRowKeys=[y]),n(),A.value=!0}function Y(){A.value=!1,T("importBizData",R.selectedRows[0])}return J({show:j}),(y,P)=>{const B=Le,Q=Ce,Z=de;return k(),H(Z,{open:t(A),"onUpdate:open":P[2]||(P[2]=q=>Ae(A)?A.value=q:null),title:"匯入客戶資料",centered:"","cancel-text":"取消","ok-text":"確定",width:"600px",onOk:Y},{default:a(()=>[r("div",Ke,[e(B,{modelValue:t(w).keyword,"onUpdate:modelValue":P[0]||(P[0]=q=>t(w).keyword=q),"show-filter-btn":!1,placeholder:"搜尋公司名稱、公司帳號",class:"mb-2",onKeydown:P[1]||(P[1]=qe(q=>n(1,t(h).pageSize),["enter"]))},null,8,["modelValue"]),e(Q,{class:"modal-table","data-source":t(G),columns:L,"show-sorter-tooltip":!1,"row-selection":{columnTitle:"單選",columnWidth:"50px",type:"radio",selectedRowKeys:t(R).selectedRowKeys,onChange:M,preserveSelectedRowKeys:!0},pagination:{...t(h)},onChangePagination:U},null,8,["data-source","row-selection","pagination"])])]),_:1},8,["open"])}}}),Be=r("div",{class:"text-sms-grayscale-100 text-base font-500 mb-4"}," 一、基本資料 ",-1),We={class:"flex items-center w-full gap-6"},De={class:"flex flex-col gap-y-4 px-1 justify-center items-center mt-4"},Ge={key:0,class:"text-sms-status-alert-red ms-2"},He=r("div",{class:"text-sms-grayscale-100 text-base font-500 my-4"}," 二、服務設定 ",-1),Je={class:"flex gap-4"},Xe={class:"flex items-center w-1/4"},Ye={class:"flex items-center w-1/4"},Qe={class:"flex gap-4"},Ze={class:"flex gap-4"},et={class:"flex items-center w-1/4"},tt={class:"flex items-center w-30%"},at={class:"flex justify-center gap-4"},nt=me({__name:"customer-management-form",emits:["openMainAccountModal"],setup(fe,{expose:J,emit:K}){const T=K,z=V(!1),h=V(!0),{createCustomer:ae,updateCustomer:R,getCompanyAttrOption:L,companyAttrOption:w}=pe(),G=le({sms:"1.00",mms:"3.00",aiCopywriting:"5.00",aiMaterialGeneration:"20.00"}),n=le(ce({companyAttr:void 0,bizcustomerKey:void 0,companyAccount:"",companyName:"",unifiedNumber:"",companyAddress:"",contactPersonList:[{contactName:"",countryCode:"+886",phone:"",companyNumber:"",companyExtension:"",email:"",billingAddress:"",note:""}],services:[]})),M=V(!0),A=le({companyAttr:[{message:"請選擇公司屬性",required:!0,trigger:"blur"}],companyAccount:[{message:"請匯入客戶資料",required:!0,trigger:"blur"}],companyName:[{message:"請匯入客戶資料",required:!0,trigger:"blur"}],unifiedNumber:[{message:"請匯入客戶資料",required:!0,trigger:"blur"}],companyAddress:[{message:"請匯入客戶資料",required:!0,trigger:"blur"}],contactPersonList:[{validator:async(s,o)=>{M.value=!0;let f=0;for(const _ of o){const O=_.countryCode,x=_.phone;!X(x)&&!X(O)&&f++}return f===0?(M.value=!1,Promise.reject("至少需有一位聯絡人資訊")):Promise.resolve()},trigger:"blur"}]});function j(s){return{[`contactPersonList.${s}.phone`]:[{validator:async(o,f)=>(M.value&&(X(n.contactPersonList[s].phone)||await te().required("請輸入手機號碼").test("checkPhone","格式有誤",async O=>await Ne().isValid(O,{strict:!1})?n.contactPersonList[s].countryCode==="+886"?await te().matches(/9\d{8}/).isValid(O,{strict:!1}):!0:!1).validate(f)),Promise.resolve()),trigger:"blur"}],[`contactPersonList.${s}.email`]:[{validator:async(o,f)=>(X(f)||await te().email("格式有誤").validate(f),Promise.resolve()),trigger:"blur"}]}}xe(()=>{L()});const Y=V(),{validateInfos:y,resetFields:P,validate:B}=$e(n,A);function Q(s){Object.keys(A).forEach(o=>{o.startsWith("contactPersonList.")&&delete A[o]}),s?(P({companyAttr:s.companyAttr,bizcustomerKey:s.bizcustomerKey,companyAccount:s.companyAccount,companyName:s.companyName,unifiedNumber:s.unifiedNumber,companyAddress:s.companyAddress,contactPersonList:s.contactPersonList,services:s.services}),Y.value=s,h.value=!1):(P(),h.value=!0),n.contactPersonList.forEach((o,f)=>{Object.assign(A,j(f))}),z.value=!0}const Z=we();async function q(s){B().then(async()=>{const o=t(h)?await ae(n):await R(n,Y.value.key);o.data&&o.data.status==="success"&&(t(h)&&(s||Z.success({message:"公司/單位新增成功",placement:"top"})),T("openMainAccountModal",h.value,{...n,key:o.data.id}),z.value=!1)}).catch(o=>{console.log(o)})}const b=Ie((s,o)=>{const _=s.target.value;/09\d{2}/.test(_)&&(n.contactPersonList[o].phone=_.replace("0",""))},1e3);function c(){const s=ce(n.contactPersonList);s.push({contactName:"",countryCode:"+886",phone:"",companyNumber:"",companyExtension:"",email:"",billingAddress:"",note:""}),n.contactPersonList=s,n.contactPersonList.forEach((o,f)=>{Object.assign(A,j(f))})}function S(s){Object.keys(A).forEach(o=>{o.startsWith("contactPersonList.")&&delete A[o]}),n.contactPersonList.splice(s,1),n.contactPersonList.forEach((o,f)=>{Object.assign(A,j(f))})}const p=V(null);function v(s){Object.assign(n,{bizcustomerKey:s.key,companyAccount:s.companyAccount,companyName:s.companyName,unifiedNumber:s.unifiedNumber,companyAddress:s.companyAddress})}function m(s){const o=ce(n.services);if(o.includes(s)){o.splice(o.indexOf(s),1);return}o.push(s),Object.assign(n,{services:o})}return J({show:Q}),(s,o)=>{const f=Ue,_=Pe,O=ye,x=be,N=Ve,se=re,oe=Oe,ee=Me,u=ge,d=Fe,g=he,C=de;return k(),E(ne,null,[e(C,{open:t(z),"onUpdate:open":o[19]||(o[19]=l=>Ae(z)?z.value=l:null),title:t(h)?"新增公司/單位":"編輯公司/單位",width:"960px","ok-text":"確定","cancel-text":"取消"},{footer:a(()=>[r("div",at,[e(O,{status:"small2",onClick:o[15]||(o[15]=l=>z.value=!1)},{default:a(()=>[i(" 取消 ")]),_:1}),t(h)?(k(),E(ne,{key:0},[e(O,{status:"small2",onClick:o[16]||(o[16]=l=>q(!1))},{default:a(()=>[i(" 確定 ")]),_:1}),e(O,{status:"small1",onClick:o[17]||(o[17]=l=>q(!0))},{default:a(()=>[i(" 繼續新增主帳號 ")]),_:1})],64)):(k(),H(O,{key:1,status:"small2",onClick:o[18]||(o[18]=l=>q(!0))},{default:a(()=>[i(" 確定 ")]),_:1}))])]),default:a(()=>[e(g,{class:"px-24px py-20px",layout:"vertical",autocomplete:"off"},{default:a(()=>[r("div",null,[Be,e(u,{gutter:[16,4],class:"bg-sms-bg-light-mode-gray !rounded-3 p-6",justify:"center",align:"middle"},{default:a(()=>[e(x,{span:24},{default:a(()=>[r("div",We,[e(_,I({label:"公司屬性"},t(y).companyAttr,{required:"",class:"w-full"}),{default:a(()=>[e(f,{value:t(n).companyAttr,"onUpdate:value":o[0]||(o[0]=l=>t(n).companyAttr=l),options:t(w),placeholder:"請選擇"},null,8,["value","options"])]),_:1},16),t(h)?(k(),H(O,{key:0,class:"mt-5",onClick:o[1]||(o[1]=l=>{var F;return(F=t(p))==null?void 0:F.show(t(n).bizcustomerKey??"")})},{default:a(()=>[i(" 匯入客戶資料 ")]),_:1})):W("",!0)])]),_:1}),e(x,{span:12},{default:a(()=>[e(_,I({label:"公司帳號"},t(y).companyAccount,{required:""}),{default:a(()=>[e(N,{value:t(n).companyAccount,"onUpdate:value":o[2]||(o[2]=l=>t(n).companyAccount=l),placeholder:"-",disabled:""},null,8,["value"])]),_:1},16)]),_:1}),e(x,{span:12},{default:a(()=>[e(_,I({label:"公司名稱"},t(y).companyName,{required:""}),{default:a(()=>[e(N,{value:t(n).companyName,"onUpdate:value":o[3]||(o[3]=l=>t(n).companyName=l),placeholder:"-",disabled:""},null,8,["value"])]),_:1},16)]),_:1}),e(x,{span:12},{default:a(()=>[e(_,I({label:"統一編號"},t(y).unifiedNumber,{required:""}),{default:a(()=>[e(N,{value:t(n).unifiedNumber,"onUpdate:value":o[4]||(o[4]=l=>t(n).unifiedNumber=l),placeholder:"-",disabled:""},null,8,["value"])]),_:1},16)]),_:1}),e(x,{span:12},{default:a(()=>[e(_,I({label:"公司地址"},t(y).companyAddress,{required:""}),{default:a(()=>[e(N,{value:t(n).companyAddress,"onUpdate:value":o[5]||(o[5]=l=>t(n).companyAddress=l),placeholder:"-",disabled:""},null,8,["value"])]),_:1},16)]),_:1}),r("div",De,[(k(!0),E(ne,null,ie(t(n).contactPersonList,(l,F)=>(k(),H(u,{key:F,gutter:[16,4],class:"p-4 pb-6 bg-sms-grayscale-20 rounded-3 w-full"},{default:a(()=>[t(n).contactPersonList.length>1?(k(),H(x,{key:0,span:24,class:"text-end"},{default:a(()=>[e(se,{name:"close",class:"cursor-pointer",onClick:$=>S(F)},null,8,["onClick"])]),_:2},1024)):W("",!0),e(x,{span:8},{default:a(()=>[e(_,{label:"聯絡人"},{default:a(()=>[e(N,{value:l.contactName,"onUpdate:value":$=>l.contactName=$,name:`contactPersonList.${F}.contactName`,placeholder:"請輸入聯絡人"},null,8,["value","onUpdate:value","name"])]),_:2},1024)]),_:2},1024),e(x,{span:8},{default:a(()=>[e(_,I({label:"手機門號",ref_for:!0},t(y)[`contactPersonList.${F}.phone`],{extra:l.countryCode==="+886"?"請輸入數字，9 碼數字以內":"請輸入數字",required:""}),{default:a(()=>[e(oe,{compact:""},{default:a(()=>[e(N,{value:l.countryCode,"onUpdate:value":$=>l.countryCode=$,style:{width:"30%"}},null,8,["value","onUpdate:value"]),e(N,{value:l.phone,"onUpdate:value":$=>l.phone=$,style:{width:"70%"},placeholder:"請輸入手機門號",maxlength:l.countryCode==="+886"?9:void 0,onChange:$=>t(b)($,F)},null,8,["value","onUpdate:value","maxlength","onChange"])]),_:2},1024)]),_:2},1040,["extra"])]),_:2},1024),e(x,{span:5},{default:a(()=>[e(_,{label:"公司電話"},{default:a(()=>[e(N,{value:l.companyNumber,"onUpdate:value":$=>l.companyNumber=$,placeholder:"請輸入公司電話"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(x,{span:3},{default:a(()=>[e(_,{label:"  "},{default:a(()=>[e(N,{value:l.companyExtension,"onUpdate:value":$=>l.companyExtension=$,placeholder:"分機"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(x,{span:12},{default:a(()=>[e(_,{label:"Email",extra:"50 字以內"},{default:a(()=>[e(N,{value:l.email,"onUpdate:value":$=>l.email=$,placeholder:"請輸入Email",maxlength:50},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(x,{span:12},{default:a(()=>[e(_,{label:"帳單地址"},{default:a(()=>[e(N,{value:l.billingAddress,"onUpdate:value":$=>l.billingAddress=$,placeholder:"請輸入帳單地址"},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024),e(x,{span:24},{default:a(()=>[e(_,{label:"備註",extra:"150 字以內，文字格式不拘"},{default:a(()=>[e(ee,{value:l.note,"onUpdate:value":$=>l.note=$,placeholder:"請輸入文字",maxlength:150,rows:4},null,8,["value","onUpdate:value"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),e(x,{span:24,"mt-4":""},{default:a(()=>{var l,F,$,ke;return[e(O,{status:"small2",onClick:c},{default:a(()=>[i(" 增加聯絡人 ")]),_:1}),(F=(l=t(y))==null?void 0:l.contactPersonList)!=null&&F.help?(k(),E("span",Ge,D((ke=($=t(y))==null?void 0:$.contactPersonList)==null?void 0:ke.help[0][0]),1)):W("",!0)]}),_:1})]),_:1})]),r("div",null,[He,e(u,{gutter:[16,4],class:"bg-sms-bg-light-mode-gray !rounded-3 p-6"},{default:a(()=>[e(x,{span:24},{default:a(()=>[e(_,{label:"訊息發送",required:"","html-for":""},{default:a(()=>[r("div",Je,[r("div",Xe,[e(d,{checked:t(n).services.includes("sms"),onClick:o[6]||(o[6]=l=>m("sms"))},{default:a(()=>[i(" SMS ")]),_:1},8,["checked"]),e(N,{"addon-before":"NT$",disabled:"",value:t(G).sms,class:"!text-sms-grayscale-80"},null,8,["value"])]),r("div",Ye,[e(d,{checked:t(n).services.includes("mms"),onClick:o[7]||(o[7]=l=>m("mms"))},{default:a(()=>[i(" MMS ")]),_:1},8,["checked"]),e(N,{"addon-before":"NT$",disabled:"",value:t(G).mms,class:"!text-sms-grayscale-80"},null,8,["value"])])])]),_:1})]),_:1}),e(x,{span:24},{default:a(()=>[e(_,{label:"一般功能","html-for":""},{default:a(()=>[r("div",Qe,[e(d,{checked:t(n).services.includes("trackActivity"),onClick:o[8]||(o[8]=l=>m("trackActivity"))},{default:a(()=>[i(" 追蹤活動管理 ")]),_:1},8,["checked"]),e(d,{checked:t(n).services.includes("subAccount"),onClick:o[9]||(o[9]=l=>m("subAccount"))},{default:a(()=>[i(" 子帳號管理 ")]),_:1},8,["checked"]),e(d,{checked:t(n).services.includes("parameterMessage"),onClick:o[10]||(o[10]=l=>m("parameterMessage"))},{default:a(()=>[i(" 參數訊息 ")]),_:1},8,["checked"]),e(d,{checked:t(n).services.includes("chatMessage"),onClick:o[11]||(o[11]=l=>m("chatMessage"))},{default:a(()=>[i(" 雙向訊息 ")]),_:1},8,["checked"]),e(d,{checked:t(n).services.includes("autoReply"),onClick:o[12]||(o[12]=l=>m("autoReply"))},{default:a(()=>[i(" 自動回覆 ")]),_:1},8,["checked"])])]),_:1})]),_:1}),e(x,{span:24},{default:a(()=>[e(_,{label:"加值功能","html-for":""},{default:a(()=>[r("div",Ze,[r("div",et,[e(d,{checked:t(n).services.includes("aiCopywriting"),class:"w-4/5",onClick:o[13]||(o[13]=l=>m("aiCopywriting"))},{default:a(()=>[i(" 文案生成 ")]),_:1},8,["checked"]),e(N,{"addon-before":"NT$",disabled:"",value:t(G).aiCopywriting,class:"!text-sms-grayscale-80"},null,8,["value"])]),r("div",tt,[e(d,{checked:t(n).services.includes("aiMaterialGeneration"),class:"w-4/5",onClick:o[14]||(o[14]=l=>m("aiMaterialGeneration"))},{default:a(()=>[i(" AI 素材生成 ")]),_:1},8,["checked"]),e(N,{"addon-before":"NT$",disabled:"",value:t(G).aiMaterialGeneration,class:"!text-sms-grayscale-80"},null,8,["value"])])])]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1},8,["open","title"]),e(Te,{ref_key:"bizDBCustomerModalRef",ref:p,onImportBizData:v},null,512)],64)}}}),ot={class:"flex gap-4 mb-4 justify-around"},lt={class:"flex flex-col gap-1"},st=r("span",null,"公司帳號",-1),ut={class:"flex flex-col gap-1"},ct=r("span",null,"公司名稱",-1),rt={class:"flex flex-col gap-1"},it=r("span",null,"公司屬性",-1),dt={key:0,class:"text-sms-status-alert-red ms-2"},mt={class:"flex justify-center gap-4"},pt=me({__name:"main-account-form",setup(fe,{expose:J}){const K=V(!1),{getCompanyAttrOption:T,companyAttrOption:z,createMainAccountByCustomerKey:h,updateMainAccountByCustomerKey:ae}=pe();xe(()=>T());const R=V(!0),L=V(!1),w=V(),U=le(ce({mainAccount:[{mainAccount:"",department:"",contactPerson:"",countryCode:"+886",phone:"",email:"",note:""}]})),n=V(!1),M=le({mainAccount:[{validator:async(p,v)=>{n.value=!0;let m=0;for(const s of v){const o=s.countryCode,f=s.phone,_=s.mainAccount,O=s.contactPerson,x=s.email;!X(f)&&!X(o)&&!X(_)&&!X(O)&&!X(x)&&m++}return m===0?(n.value=!1,Promise.reject("至少需有一位主帳號資訊")):Promise.resolve()},trigger:"blur"}]}),{validateInfos:A,resetFields:j,validate:Y}=$e(U,M);function y(p){return{[`mainAccount.${p}.mainAccount`]:[{validator:async(v,m)=>(n.value||await te().required("請輸入主帳號").validate(m),Promise.resolve()),trigger:"blur"}],[`mainAccount.${p}.contactPerson`]:[{validator:async(v,m)=>(n.value||await te().required("請輸入聯絡人姓名").validate(m),Promise.resolve()),trigger:"blur"}],[`mainAccount.${p}.phone`]:[{validator:async(v,m)=>(n.value||await te().required("請輸入手機號碼").test("checkPhone","格式有誤",async o=>await Ne().isValid(o,{strict:!1})?U.mainAccount[p].countryCode==="+886"?await te().matches(/9\d{8}/).isValid(o,{strict:!1}):!0:!1).validate(m),Promise.resolve()),trigger:"blur"}],[`mainAccount.${p}.email`]:[{validator:async(v,m)=>(n.value||await te().required("請輸入Email").email("格式有誤").validate(m),Promise.resolve()),trigger:"blur"}]}}function P(p,v=!1,m){Object.keys(M).forEach(s=>{s.startsWith("mainAccount.")&&delete M[s]}),m?(j({mainAccount:m}),R.value=!1):(R.value=!0,j()),L.value=!0,w.value=p,K.value=v,U.mainAccount.forEach((s,o)=>{Object.assign(M,y(o))})}const B=we();function Q(){Y().then(async()=>{var p;w.value&&((p=(R.value?await h(w.value.key,U.mainAccount):await ae(w.value.key,U.mainAccount)).data)==null?void 0:p.status)==="success"&&(B.success({message:K.value?"公司/單位和主帳號新增成功":"公司/單位和主帳號編輯成功",placement:"top"}),L.value=!1)}).catch(p=>{console.error(p)})}function Z(p,v){const s=p.target.value;/09\d{2}/.test(s)&&(U.mainAccount[v].phone=s.replace("0",""))}function q(p){var v;if(p)return((v=z.value.find(m=>m.value===p))==null?void 0:v.label)??""}function b(){const p=ce(U.mainAccount);p.push({mainAccount:"",department:"",contactPerson:"",countryCode:"+886",phone:"",email:"",note:""}),U.mainAccount=p,U.mainAccount.forEach((v,m)=>{Object.assign(M,y(m))})}function c(p){Object.keys(M).forEach(v=>{v.startsWith("mainAccount.")&&delete M[v]}),U.mainAccount.splice(p,1),U.mainAccount.forEach((v,m)=>{Object.assign(M,y(m))})}function S(){B.success({message:K.value?"公司/單位新增成功":"公司/單位編輯成功",placement:"top"}),L.value=!1}return J({show:P}),(p,v)=>{const m=re,s=be,o=Ve,f=Pe,_=ge,O=Oe,x=Me,N=ye,se=he,oe=de;return k(),H(oe,{open:t(L),"onUpdate:open":v[0]||(v[0]=ee=>Ae(L)?L.value=ee:null),centered:"",width:"600px","ok-text":"確定","cancel-text":"取消"},{title:a(()=>[i(" 新增主帳號 ")]),footer:a(()=>[r("div",mt,[e(N,{status:"small2",onClick:S},{default:a(()=>[i(" 取消 ")]),_:1}),e(N,{status:"small2",onClick:Q},{default:a(()=>[i(" 確定 ")]),_:1})])]),default:a(()=>[e(se,{model:t(U),class:"px-24px py-20px",layout:"vertical",autocomplete:"off"},{default:a(()=>{var ee,u,d;return[r("div",ot,[r("div",lt,[st,r("span",null,D((ee=t(w))==null?void 0:ee.companyAccount),1)]),r("div",ut,[ct,r("span",null,D((u=t(w))==null?void 0:u.companyName),1)]),r("div",rt,[it,r("span",null,D(q((d=t(w))==null?void 0:d.companyAttr)),1)])]),(k(!0),E(ne,null,ie(t(U).mainAccount,(g,C)=>(k(),E("div",{key:C,class:"p-4 pb-6 bg-sms-bg-light-mode-gray rounded-3 w-full mb-4"},[e(_,{gutter:16},{default:a(()=>[t(U).mainAccount.length>1?(k(),H(s,{key:0,span:24,class:"text-end"},{default:a(()=>[e(m,{name:"close",class:"cursor-pointer",onClick:l=>c(C)},null,8,["onClick"])]),_:2},1024)):W("",!0),e(s,{span:12},{default:a(()=>[e(f,I({label:"主帳號",ref_for:!0},t(A)[`mainAccount.${C}.mainAccount`],{required:""}),{default:a(()=>[e(o,{value:g.mainAccount,"onUpdate:value":l=>g.mainAccount=l,placeholder:"請輸入主帳號"},null,8,["value","onUpdate:value"])]),_:2},1040)]),_:2},1024),e(s,{span:12},{default:a(()=>[e(f,I({label:"單位",ref_for:!0},t(A)[`mainAccount.${C}.department`]),{default:a(()=>[e(o,{value:g.department,"onUpdate:value":l=>g.department=l,placeholder:"請輸入單位"},null,8,["value","onUpdate:value"])]),_:2},1040)]),_:2},1024)]),_:2},1024),e(_,{gutter:16},{default:a(()=>[e(s,{span:12},{default:a(()=>[e(f,I({label:"聯絡人姓名",ref_for:!0},t(A)[`mainAccount.${C}.contactPerson`],{required:""}),{default:a(()=>[e(o,{value:g.contactPerson,"onUpdate:value":l=>g.contactPerson=l,placeholder:"請輸入聯絡人姓名"},null,8,["value","onUpdate:value"])]),_:2},1040)]),_:2},1024),e(s,{span:12},{default:a(()=>[e(f,I({label:"手機門號",ref_for:!0},t(A)[`mainAccount.${C}.phone`],{extra:g.countryCode==="+886"?"請輸入數字，9 碼數字以內":"請輸入數字",required:""}),{default:a(()=>[e(O,{compact:""},{default:a(()=>[e(o,{value:g.countryCode,"onUpdate:value":l=>g.countryCode=l,style:{width:"30%"}},null,8,["value","onUpdate:value"]),e(o,{value:g.phone,"onUpdate:value":l=>g.phone=l,style:{width:"70%"},placeholder:"請輸入手機門號",maxlength:g.countryCode==="+886"?9:void 0,onChange:l=>Z(l,C)},null,8,["value","onUpdate:value","maxlength","onChange"])]),_:2},1024)]),_:2},1040,["extra"])]),_:2},1024)]),_:2},1024),e(f,I({label:"Email",ref_for:!0},t(A)[`mainAccount.${C}.email`],{extra:"50 字以內",required:""}),{default:a(()=>[e(o,{value:g.email,"onUpdate:value":l=>g.email=l,maxlength:50,placeholder:"請輸入Email"},null,8,["value","onUpdate:value"])]),_:2},1040),e(f,I({label:"備註",ref_for:!0},t(A)[`mainAccount.${C}.note`],{extra:"150 字以內，文字格式不拘"}),{default:a(()=>[e(x,{value:g.note,"onUpdate:value":l=>g.note=l,rows:4,maxlength:150,placeholder:"請輸入"},null,8,["value","onUpdate:value"])]),_:2},1040)]))),128)),e(s,{span:24,"mt-4":""},{default:a(()=>{var g,C,l,F;return[e(N,{status:"small2",onClick:b},{default:a(()=>[i(" 增加主帳號 ")]),_:1}),(C=(g=t(A))==null?void 0:g.mainAccount)!=null&&C.help?(k(),E("span",dt,D((F=(l=t(A))==null?void 0:l.mainAccount)==null?void 0:F.help[0][0]),1)):W("",!0)]}),_:1})]}),_:1},8,["model"])]),_:1},8,["open"])}}}),ft={class:"flex justify-end px-2 items-center py-4 bg-sms-grayscale-0 rounded-t-12px"},vt=["onClick"],_t={class:"px-60px py-20px w-300px mx-auto"},yt={key:0,class:"list-decimal-inside cursor-pointer"},bt=r("div",{class:"px-60px py-20px text-center"},[i(" 0922113849"),r("br"),i(" 0945324523"),r("br"),i(" 0956277445"),r("br"),i(" 0945883212"),r("br"),i(" 0903910387"),r("br"),i(" 0946357466"),r("br"),i(" 0943681827"),r("br"),i(" 0966817279"),r("br"),i(" 0946340568"),r("br"),i(" 0936780477"),r("br"),i(" 0956369571"),r("br"),i(" 0947848565"),r("br"),i(" 0927211384"),r("br"),i(" 0922113849"),r("br"),i(" 0945324523"),r("br"),i(" 0956277445"),r("br"),i(" 0945883212"),r("br"),i(" 0903910387"),r("br"),i(" 0946357466"),r("br"),i(" 0943681827"),r("br"),i(" 0966817279"),r("br"),i(" 0946340568"),r("br"),i(" 0936780477"),r("br"),i(" 0956369571"),r("br"),i(" 0947848565"),r("br"),i(" 0927211384"),r("br")],-1),Et=me({__name:"index",setup(fe){const J=V(null),K=V(null),{customerList:T,getCustomerList:z,pagination:h,getCompanyAttrOption:ae,companyAttrOption:R}=pe();ae();const L=V({open:!1}),w=V({open:!1,record:null}),G=[{value:"ACTIVE",label:"開啟"},{value:"UNACTIVE",label:"關閉"}],U=[{title:"公司帳號",dataIndex:"companyAccount",key:"companyAccount",maxWidth:115},{title:"公司名稱",dataIndex:"companyName",key:"companyName",maxWidth:200},{title:"公司屬性",dataIndex:"companyAttrName",key:"companyAttrName",maxWidth:120},{title:"服務內容",dataIndex:"services",key:"services",minWidth:190},{title:"門號數量",dataIndex:"phoneNumberCount",key:"phoneNumberCount",minWidth:74,align:"center",customHeaderCell:()=>({class:"[&>*]:!justify-center"})},{title:"主帳號數量",dataIndex:"mainAccountCount",key:"mainAccountCount",minWidth:74,align:"center",customHeaderCell:()=>({class:"[&>*]:!justify-center"})},{title:"子帳號數量",dataIndex:"subAccountCount",key:"subAccountCount",minWidth:74,align:"center",customHeaderCell:()=>({class:"[&>*]:!justify-center"})},{title:"剩餘金額",dataIndex:"balance",key:"balance",maxWidth:120,align:"right",customHeaderCell:()=>({class:"[&>*]:!justify-end"})},{title:"公司狀態",dataIndex:"status",key:"status",width:"90px"},{title:"操作",dataIndex:"action",key:"action",width:"50px",fixed:"right"}];xe(()=>{j(1)});const n=V({keyword:"",sortField:"createTime",sortOrder:"descend",status:[],companyAccount:[],companyName:[],companyAttr:[],services:[]});async function M(b,c,S){console.log("sorter:",S),n.value=Object.assign(n.value,{sortField:S.field,sortOrder:S.order}),await j(h.value.current,h.value.pageSize)}async function A(b,c){await j(b,c)}async function j(b=1,c=10){const S={current:b,pageSize:c,...t(n)};await z(S)}async function Y(b){T.value=T.value.map(c=>b.key===c.key?{...b,status:b.status==="UNACTIVE"?"ACTIVE":"UNACTIVE"}:c)}const y=V(null);function P(){var b;j(1),(b=y.value)==null||b.hide()}const B=_e(()=>T.value.map(b=>({label:b.companyAccount,value:b.companyAccount}))),Q=_e(()=>T.value.map(b=>({label:b.companyName,value:b.companyName}))),Z=Object.entries(ve).map(([b,c])=>({label:c,value:b}));function q(b,c){var S,p;if(b)(S=K.value)==null||S.show(c,b);else{const v=[{mainAccount:"VCSJ001024",department:"業務部",contactPerson:"陳小雲",countryCode:"+886",phone:"911248081",email:"clouds@gmail.com",note:""}];(p=K.value)==null||p.show(c,b,v)}j(h.value.current,h.value.pageSize)}return(b,c)=>{const S=re,p=ye,v=Re,m=je,s=Ue,o=Ee,f=be,_=ge,O=he,x=ze,N=re,se=Ce,oe=de,ee=Se;return k(),H(ee,{title:"客戶管理"},{extraContent:a(()=>[e(p,{status:"small2",onClick:()=>{}},{icon:a(()=>[e(S,{name:"download",width:"16px"})]),default:a(()=>[i(" 匯出CSV ")]),_:1}),e(p,{class:"ms-2",status:"small1",onClick:c[0]||(c[0]=()=>{var u;return(u=t(J))==null?void 0:u.show()})},{icon:a(()=>[e(S,{name:"plus",width:"16px"})]),default:a(()=>[i(" 新增帳號 ")]),_:1})]),default:a(()=>[r("div",ft,[e(Le,{ref_key:"filterKeywordInputRef",ref:y,modelValue:t(n).keyword,"onUpdate:modelValue":c[12]||(c[12]=u=>t(n).keyword=u),class:"w-562px h-40px",placeholder:"搜尋公司帳號、公司名稱、 統一編號、聯絡人E-Mail、連絡人電話 ",onClearFilter:c[13]||(c[13]=()=>{n.value={...t(n),keyword:"",status:[],companyAccount:[],companyName:[],companyAttr:[],services:[]}})},{filterForm:a(()=>[e(O,{layout:"vertical",model:t(n),autocomplete:"off"},{default:a(()=>[e(_,{gutter:[16,12]},{default:a(()=>[e(f,{span:24},{default:a(()=>[e(o,{label:"公司屬性",valueed:t(ue)(t(n).companyAttr)},{default:a(()=>[e(s,{value:t(n).companyAttr,"onUpdate:value":c[2]||(c[2]=u=>t(n).companyAttr=u),options:t(R),"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" "},{dropdownRender:a(({menuNode:u})=>[e(v,{modelValue:t(n).companyAttr,"onUpdate:modelValue":c[1]||(c[1]=d=>t(n).companyAttr=d),menu:u,options:t(R)},null,8,["modelValue","menu","options"])]),option:a(({value:u,label:d})=>[e(m,{values:t(n).companyAttr,value:u,label:d},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),e(f,{span:24},{default:a(()=>[e(o,{label:"公司帳號",valueed:t(ue)(t(n).companyAccount)},{default:a(()=>[e(s,{value:t(n).companyAccount,"onUpdate:value":c[4]||(c[4]=u=>t(n).companyAccount=u),options:t(B),"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" "},{dropdownRender:a(({menuNode:u})=>[e(v,{modelValue:t(n).companyAccount,"onUpdate:modelValue":c[3]||(c[3]=d=>t(n).companyAccount=d),menu:u,options:t(B)},null,8,["modelValue","menu","options"])]),option:a(({value:u,label:d})=>[e(m,{values:t(n).companyAccount,value:u,label:d},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),e(f,{span:24},{default:a(()=>[e(o,{label:"公司姓名",valueed:t(ue)(t(n).companyName)},{default:a(()=>[e(s,{value:t(n).companyName,"onUpdate:value":c[6]||(c[6]=u=>t(n).companyName=u),options:t(Q),"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" "},{dropdownRender:a(({menuNode:u})=>[e(v,{modelValue:t(n).companyName,"onUpdate:modelValue":c[5]||(c[5]=d=>t(n).companyName=d),menu:u,options:t(Q)},null,8,["modelValue","menu","options"])]),option:a(({value:u,label:d})=>[e(m,{values:t(n).companyName,value:u,label:d},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),e(f,{span:24},{default:a(()=>[e(o,{label:"公司狀態",valueed:t(ue)(t(n).status)},{default:a(()=>[e(s,{value:t(n).status,"onUpdate:value":c[8]||(c[8]=u=>t(n).status=u),options:G,"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" "},{dropdownRender:a(({menuNode:u})=>[e(v,{modelValue:t(n).status,"onUpdate:modelValue":c[7]||(c[7]=d=>t(n).status=d),menu:u,options:G},null,8,["modelValue","menu"])]),option:a(({value:u,label:d})=>[e(m,{values:t(n).status,value:u,label:d},null,8,["values","value","label"])]),_:1},8,["value"])]),_:1},8,["valueed"])]),_:1}),e(f,{span:24},{default:a(()=>[e(o,{label:"服務內容",valueed:t(ue)(t(n).services)},{default:a(()=>[e(s,{value:t(n).services,"onUpdate:value":c[10]||(c[10]=u=>t(n).services=u),options:t(Z),"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" "},{dropdownRender:a(({menuNode:u})=>[e(v,{modelValue:t(n).services,"onUpdate:modelValue":c[9]||(c[9]=d=>t(n).services=d),menu:u,options:t(Z)},null,8,["modelValue","menu","options"])]),option:a(({value:u,label:d})=>[e(m,{values:t(n).services,value:u,label:d},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),e(f,{span:24,class:"text-center"},{default:a(()=>[e(p,{status:"small2",class:"me-5",onClick:c[11]||(c[11]=u=>{var d;return(d=t(y))==null?void 0:d.hide()})},{default:a(()=>[i(" 取消 ")]),_:1}),e(p,{status:"small1",onClick:P},{default:a(()=>[i(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),e(se,{"data-source":t(T),scroll:{x:"max-content"},columns:U,size:"small","show-sorter-tooltip":!1,pagination:{...t(h)},onChange:M,onChangePagination:A},{bodyCell:a(({column:u,record:d,text:g})=>[u.dataIndex==="services"?(k(),E("ul",{key:0,class:"list-decimal-inside text-sms-primary-blue-80 underline cursor-pointer",onClick:()=>{w.value={open:!0,record:d}}},[(k(!0),E(ne,null,ie(d.services.slice(0,3),C=>(k(),E("li",{key:C},D(t(ve)[C])+D(C==="sms"||C==="mms"?`(${d.companyAccount})`:""),1))),128))],8,vt)):W("",!0),u.dataIndex==="balance"?(k(),E(ne,{key:1},[i(" NT$"+D(g==null?void 0:g.toLocaleString(void 0,{minimumFractionDigits:2})),1)],64)):W("",!0),u.dataIndex==="status"?(k(),H(x,{key:2,checked:g==="ACTIVE",onClick:C=>Y(d)},null,8,["checked","onClick"])):W("",!0),u.dataIndex==="phoneNumberCount"?(k(),E("span",{key:3,class:"text-sms-primary-blue-80 underline cursor-pointer",onClick:c[14]||(c[14]=C=>t(L).open=!0)},D(g),1)):W("",!0),u.dataIndex==="action"?(k(),H(p,{key:4,status:"small3",class:"!px-0",onClick:C=>{var l;return(l=t(J))==null?void 0:l.show(d)}},{default:a(()=>[e(N,{class:"text-sms-primary-blue-80",name:"edit"})]),_:2},1032,["onClick"])):W("",!0)]),_:1},8,["data-source","pagination"]),e(oe,{open:t(w).open,"onUpdate:open":c[15]||(c[15]=u=>t(w).open=u),title:"服務內容",width:"440px","cancel-button-props":{class:"hidden"},onOk:c[16]||(c[16]=u=>t(w).open=!1)},{default:a(()=>[r("div",_t,[t(w).record?(k(),E("ul",yt,[(k(!0),E(ne,null,ie(t(w).record.services??[],u=>(k(),E("li",{key:u},D(t(ve)[u])+" "+D(u==="sms"||u==="mms"?`(${t(w).record.companyAccount})`:""),1))),128))])):W("",!0)])]),_:1},8,["open"]),e(oe,{open:t(L).open,"onUpdate:open":c[17]||(c[17]=u=>t(L).open=u),title:"發送門號列表",width:"440px","cancel-button-props":{class:"hidden"},onOk:c[18]||(c[18]=u=>t(L).open=!1)},{default:a(()=>[bt]),_:1},8,["open"]),e(nt,{ref_key:"customerManagementFormRef",ref:J,onOpenMainAccountModal:q},null,512),e(pt,{ref_key:"mainAccountFormRef",ref:K},null,512)]),_:1})}}});export{Et as default};

import{_ as Re}from"./index.vuevuetypescriptsetuptruelang-2A3sfcd1.js";import{i as Ce,_ as Ie}from"./isSameOrBefore-Ba97nkxb.js";import{_ as te,a as Ve}from"./MessageTypeEnum-Cact4JeP.js";import{_ as Oe,a as Ne}from"./request-CdXHKby5.js";import{j as Ue,_ as Fe}from"./index-DiogPAzz.js";import{_ as $e}from"./index.vuevuetypescriptsetuptruelang-JVP7TRv3.js";import{_ as Ye,a as De}from"./index.vuevuetypescriptsetuptruelang-B10Rmm3B.js";import{_ as Ae}from"./index-BTSAuDsF.js";import{i as Be}from"./isToday-7FapjAh8.js";import{z as le,E as V,q as je,p as Pe,I as Le,G as ze,s as Ge,F as He,H as Xe,x as Ke,J as qe,o as Je}from"./antd-BeRLmHJE.js";import{_ as We,u as Qe,M as Ze}from"./create-or-update-form.vuevuetypescriptsetuptruelang-mmbPj0jc.js";import{d as ie,f as g,ag as de,W as p,X as f,k as t,$ as s,u as e,H as j,F as T,Y as o,D as et,w as tt,b as st,_ as at,G as c,a9 as se,a5 as ae,a3 as m,a4 as O,y as ne}from"./vue-BvWPEeCa.js";import{g as nt,a as oe,b as B}from"./tools-DuR4KSGu.js";import"./context-QlU3Sn5R.js";import"./index.vuevuetypescriptsetuptruelang-mDdRgW1s.js";import"./route-leave-BLsxijqv.js";import"./index.esm-D-iyuww3.js";import"./index.vuevuetypestyleindex0lang-C1xmgeFk.js";import"./custom-message-BwKx7yft.js";import"./contact-person-BduAP5rq.js";import"./group-label-DJmh7jJl.js";import"./index.vuevuetypescriptsetuptruelang-BrhuMK2h.js";const ot=o("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 編輯的內容將不會儲存 ",-1),lt=ie({__name:"message-sending-edit-modal",setup(v,{expose:i}){const x=g(!1),h=g();function N(y){h.value=y,x.value=!0}const{post:U}=de({name:"in-message-sending-page"}),b=g(!1);function F(y,_){y?(x.value=!1,_&&U(_)):b.value=!0}return i({show:N}),(y,_)=>{const I=le;return p(),f(T,null,[t(I,{open:e(x),"onUpdate:open":_[0]||(_[0]=l=>j(x)?x.value=l:null),title:"編輯訊息行銷活動",width:"960px","destroy-on-close":!0,footer:null,"mask-closable":!1},{default:s(()=>[t(We,{id:e(h),"is-create":!1,"edit-callback":F,"show-preview":!1},null,8,["id"])]),_:1},8,["open"]),t(I,{open:e(b),"onUpdate:open":_[1]||(_[1]=l=>j(b)?b.value=l:null),title:"是否取消編輯？",width:"400px",centered:"","z-index":2e3,onOk:_[2]||(_[2]=()=>{x.value=!1,b.value=!1})},{default:s(()=>[ot]),_:1},8,["open"])],64)}}});var P=(v=>(v.RESERVATION="預約中",v.EXECUTING="執行中",v.IS_SENT="已發送",v.RESERVATION_FAILED="預約失敗",v))(P||{});const it={class:"pt-4 flex items-center pb-3"},dt=["onClick"],ut={class:"flex flex-col gap-4"},ct={class:"flex justify-between items-center mb-2"},rt={class:"font-600 text-sm pe-2"},mt={class:"flex flex-col gap-1 justify-end items-end"},pt={class:"text-sms-grayscale-60 font-500 text-xs"},_t={class:"font-400 text-sm text-sms-grayscale-80 tracking-[0.02em] whitespace-pre-wrap line-clamp-2"},ft={class:"text-end py-4"},gt=o("br",null,null,-1),xt={key:0,class:"flex items-center pb-4"},vt={key:0,id:"chat-message-content"},bt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 活動名稱 ",-1),ht={class:"text-base font-400 text-sms-grayscale-100"},yt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 帳號 ",-1),wt={class:"text-base font-400 text-sms-grayscale-100 break-words"},kt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送時間 ",-1),St={class:"text-base font-400 text-sms-grayscale-100"},Tt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送編號 ",-1),Mt={class:"text-base font-400 text-sms-grayscale-100 break-words"},Et=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息類型 ",-1),Rt={class:"text-base font-400 text-sms-grayscale-100"},Ct=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送門號 ",-1),It={class:"text-base font-400 text-sms-grayscale-100"},Vt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 接收門號明細 ",-1),Ot={class:"flex flex-col"},Nt={class:"border-t-solid border-t border-t-sms-border-light-mode-light-gary p-4 mb-2"},Ut=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息內容 ",-1),Ft=["innerHTML"],$t={key:0,class:"px-4 pb-0 h-full"},Yt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 多媒體檔案 ",-1),Dt={class:"flex gap-2"},At={class:"max-h-60px mb-2"},Bt={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},jt={class:"mt-4 p-4 border-t-solid border-t border-t-sms-border-light-mode-light-gary"},Pt={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},Lt={href:"javascript:;"},zt=o("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 刪除的訊息將無法復原 ",-1),Gt={class:"px-30px py-20px w-328px text-base mx-auto"},Ht=o("span",{class:"me-2"},"訊息類型",-1),Xt={href:"javascript:;"},Kt=o("br",null,null,-1),xs=ie({__name:"index",setup(v){V.extend(Be),V.extend(Ce);const i=g(),x=g(),h=g(),N=Ue(),{getMessageSendings:U,messageSendings:b,pagination:F,getActiveStatusLabel:y,getMessageSending:_,messageSending:I}=Qe(),l=g({keyword:"",name:"",phone:void 0,sendStatus:[],messageStatus:[],sendTime:void 0});async function ue(d){i.value=d,await ne();const a=document.getElementById("message-content");a&&(a.scrollTop=0)}et(()=>{$()});async function $(d=1,a=10){const R={current:d,pageSize:a,...e(l)};await U(R)}function ce(d,a){$(d,a??10)}function re(){var d;$(1),(d=h.value)==null||d.hide()}const me={RESERVATION:"text-sms-yellow-60 bg-#F7F2E8",EXECUTING:"text-sms-primary-blue-80 bg-sms-primary-blue-30",IS_SENT:"text-sms-green-80 bg-sms-green-30",RESERVATION_FAILED:"text-sms-status-alert-red bg-sms-light-red-40"},M=g([]);async function pe(d,a){await ne(),M.value&&M.value[a]&&(d?M.value[a].playVideo():M.value[a].pauseVideo())}const E=g(!1);function _e(){E.value=!0}function fe(){i.value=void 0,E.value=!1,N.success({message:"訊息刪除成功",placement:"top"})}const L=[{label:"0935-111-111",value:"0935-111-111"},{label:"0947-127-998",value:"0947-127-998"},{label:"0958-892-006",value:"0958-892-006"}],z=Object.entries(P).map(([d,a])=>({label:a,value:d})),G=Object.entries(Ze).map(([d,a])=>({label:a,value:d})),w=g({open:!1,isParameter:!1}),H=g(null);function ge(){var d;i.value&&((d=H.value)==null||d.show(i.value.key))}const{data:xe,close:ve}=de({name:"in-message-sending-page"});return tt(xe,async d=>{await _(d),i.value=I.value}),st(()=>{ve()}),(d,a)=>{const R=je,C=Ae,r=Pe,X=Ye,K=De,be=Le,he=ze,k=$e,q=Ge,J=He,ye=Oe,S=Fe,we=Ne,Y=Xe,ke=Ve,Se=Ie,W=le,Q=Ke,Te=qe,Me=Je,Ee=Re;return p(),at(Ee,{title:"訊息發送"},{default:s(()=>[t(Se,{"show-right-empty":!e(i)},{leftTop:s(()=>[o("div",it,[t(ye,{ref_key:"filterKeywordInputRef",ref:h,modelValue:e(l).keyword,"onUpdate:modelValue":a[8]||(a[8]=n=>e(l).keyword=n),height:"40px",class:"flex-1 me-2",placeholder:"搜尋活動名稱、訊息內容",onClearFilter:a[9]||(a[9]=()=>{l.value={...e(l),keyword:"",name:"",phone:void 0,sendStatus:[],messageStatus:[],sendTime:void 0}})},{filterForm:s(()=>[t(J,{ref_key:"formRef",ref:x,layout:"vertical",model:e(l),autocomplete:"off"},{default:s(()=>[t(q,{gutter:[16,12]},{default:s(()=>[t(r,{span:24},{default:s(()=>[t(C,{label:"發送門號",valueed:e(nt)(e(l).phone,L)},{default:s(()=>[t(R,{value:e(l).phone,"onUpdate:value":a[0]||(a[0]=n=>e(l).phone=n),options:L,"allow-clear":"",class:"w-full"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(r,{span:24},{default:s(()=>[t(C,{label:"活動狀態",valueed:e(oe)(e(l).sendStatus)},{default:s(()=>[t(R,{value:e(l).sendStatus,"onUpdate:value":a[2]||(a[2]=n=>e(l).sendStatus=n),options:e(z),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full","menu-item-selected-icon":" "},{dropdownRender:s(({menuNode:n})=>[t(X,{modelValue:e(l).sendStatus,"onUpdate:modelValue":a[1]||(a[1]=u=>e(l).sendStatus=u),menu:n,options:e(z)},null,8,["modelValue","menu","options"])]),option:s(({value:n,label:u})=>[t(K,{values:e(l).sendStatus,value:n,label:u},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),t(r,{span:24},{default:s(()=>[t(C,{label:"活動名稱",valueed:e(l).name},{default:s(()=>[t(be,{value:e(l).name,"onUpdate:value":a[3]||(a[3]=n=>e(l).name=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(r,{span:24},{default:s(()=>[t(C,{label:"訊息類型",valueed:e(oe)(e(l).messageStatus)},{default:s(()=>[t(R,{value:e(l).messageStatus,"onUpdate:value":a[5]||(a[5]=n=>e(l).messageStatus=n),options:e(G),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full","menu-item-selected-icon":" "},{dropdownRender:s(({menuNode:n})=>[t(X,{modelValue:e(l).messageStatus,"onUpdate:modelValue":a[4]||(a[4]=u=>e(l).messageStatus=u),menu:n,options:e(G)},null,8,["modelValue","menu","options"])]),option:s(({value:n,label:u})=>[t(K,{values:e(l).messageStatus,value:n,label:u},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),t(r,{span:24},{default:s(()=>[t(C,{label:"發送時間",valueed:e(l).sendTime},{default:s(()=>[t(he,{value:e(l).sendTime,"onUpdate:value":a[6]||(a[6]=n=>e(l).sendTime=n),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(r,{span:24,class:"text-center"},{default:s(()=>[t(k,{status:"small2",class:"me-5",onClick:a[7]||(a[7]=n=>{var u;return(u=e(h))==null?void 0:u.hide()})},{default:s(()=>[c(" 取消 ")]),_:1}),t(k,{status:"small1",onClick:re},{default:s(()=>[c(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(k,{status:"small1",onClick:a[10]||(a[10]=()=>{w.value={open:!0,isParameter:!1}})},{icon:s(()=>[t(S,{name:"plus",width:"16px"})]),default:s(()=>[c(" 新增訊息行銷活動 ")]),_:1})])]),left:s(()=>[o("ul",null,[(p(!0),f(T,null,se(e(b),n=>{var u;return p(),f("li",{key:n.key,class:ae(["p-4 border-b-solid border-b-1 border-b-sms-light-gray-60 last:mb-2 cursor-pointer",{"bg-sms-bg-light-mode-gray":n.key===((u=e(i))==null?void 0:u.key)}]),onClick:D=>ue(n)},[o("div",ut,[o("div",ct,[o("span",rt,m(n.name),1),o("div",mt,[o("span",{class:ae(["rounded-2 text-center py-1 px-2 text-xs font-500",{[me[n.sendStatus]]:!0}])},m(e(P)[n.sendStatus]),3),o("span",pt,m(e(V)(n.sendTime).isToday()?"今天":e(V)(n.sendTime).format("YYYY/MM/DD")),1)])]),o("div",_t,m(n.content),1)])],10,dt)}),128))])]),leftBottom:s(()=>[o("div",ft,[t(we,{pagination:e(F),onChange:ce},null,8,["pagination"])])]),rightEmptyMessage:s(()=>[c(" 點擊左側行銷活動"),gt,c("檢視行銷活動資訊 ")]),rightTop:s(()=>[e(i)?(p(),f("div",xt,[t(k,{status:"small2",class:"me-2",disabled:e(i).sendStatus!=="RESERVATION",onClick:ge},{icon:s(()=>[t(S,{name:"edit",width:"16px"})]),default:s(()=>[c(" 編輯 ")]),_:1},8,["disabled"]),t(k,{status:"small2",class:"me-2",disabled:e(i).sendStatus!=="RESERVATION",onClick:_e},{icon:s(()=>[t(S,{name:"delete",width:"16px"})]),default:s(()=>[c(" 刪除預約 ")]),_:1},8,["disabled"])])):O("",!0)]),right:s(()=>[e(i)?(p(),f("div",vt,[t(q,{gutter:[16,16],class:"mb-4 px-4"},{default:s(()=>[t(r,{span:24},{default:s(()=>[bt,o("div",ht,m(e(i).name),1)]),_:1}),t(r,{span:8},{default:s(()=>[yt,o("div",wt,m(e(i).account),1)]),_:1}),t(r,{span:8},{default:s(()=>[kt,o("div",St,m(e(i).sendTime),1)]),_:1}),t(r,{span:8},{default:s(()=>[Tt,o("div",Mt,m(e(i).sendNumber),1)]),_:1}),t(r,{span:8},{default:s(()=>[Et,o("div",Rt,m(e(y)(e(i).messageType,e(i).isParameter)),1)]),_:1}),t(r,{span:8},{default:s(()=>[Ct,o("div",It,m(e(i).phone),1)]),_:1}),t(r,{span:8},{default:s(()=>[Vt,o("div",null,[t(k,{status:"small2",class:"me-2"},{icon:s(()=>[t(S,{name:"download",width:"16px"})]),default:s(()=>[c(" 匯出 ")]),_:1})])]),_:1})]),_:1}),o("div",Ot,[o("div",Nt,[Ut,o("div",{class:"break-words text-base",innerHTML:e(i).content},null,8,Ft)]),e(i).multimediaFile&&e(i).messageType==="MMS"&&e(i).multimediaFile.length>0?(p(),f("div",$t,[Yt,o("div",Dt,[(p(!0),f(T,null,se(e(i).multimediaFile,(n,u)=>{var D,Z,ee;return p(),f("div",{key:n.url,class:"w-120px"},[t(Y,{placement:(D=e(i))!=null&&D.multimediaFile&&u===((ee=(Z=e(i))==null?void 0:Z.multimediaFile)==null?void 0:ee.length)-1?"topRight":"top","get-popup-container":e(B),"overlay-inner-style":{width:"384px",height:"304px"},arrow:"center",onOpenChange:A=>pe(A,u)},{title:s(()=>[t(te,{ref_for:!0,ref:A=>e(M)[u]=A,source:n,size:"small","show-del-btn":!1,"show-file-name":!1,"image-class":"object-cover w-80% h-full mx-auto block"},null,8,["source"])]),default:s(()=>[o("div",At,[t(te,{source:n,size:"small","show-del-btn":!1,"can-play":!1,"show-file-name":!1,"image-class":"object-cover w-80% h-full mx-auto block"},null,8,["source"])]),o("div",Bt,m(n.fileName),1)]),_:2},1032,["placement","get-popup-container","onOpenChange"])])}),128))])])):O("",!0),o("div",jt,[o("div",Pt,[c(" 發送統計 "),t(Y,{placement:"top","get-popup-container":e(B)},{title:s(()=>[c(" 發送失敗的接收門號和原因，可參考報表細節或匯出明細，發送中和發送成功以外皆為發送失敗，例如: 發送過期、主帳號有設定黑名單等狀況 ")]),default:s(()=>[o("a",Lt,[t(S,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),t(ke,{columns:[{title:"發送總數",dataIndex:"total",key:"total",width:"89px",align:"center"},{title:"發送中",dataIndex:"sending",key:"sending",width:"89px",align:"center"},{title:"發送成功",dataIndex:"success",key:"success",width:"89px",align:"center"},{title:"發送失敗",dataIndex:"fail",key:"fail",width:"89px",align:"center"},{title:"成功率",dataIndex:"successRate",key:"successRate",width:"89px",align:"center"}],"data-source":[e(i).statistics]},{bodyCell:s(({column:n,text:u})=>[e(i).sendStatus==="RESERVATION"&&n.dataIndex!=="total"?(p(),f(T,{key:0},[c(" - ")],64)):(p(),f(T,{key:1},[n.dataIndex==="successRate"?(p(),f(T,{key:0},[c(m(u)+"% ",1)],64)):O("",!0)],64))]),_:1},8,["data-source"])])])])):O("",!0)]),_:1},8,["show-right-empty"]),t(W,{open:e(E),"onUpdate:open":a[11]||(a[11]=n=>j(E)?E.value=n:null),title:"是否刪除已預約的訊息？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:fe},{default:s(()=>[zt]),_:1},8,["open"]),t(W,{open:e(w).open,"onUpdate:open":a[13]||(a[13]=n=>e(w).open=n),title:"選擇訊息類型",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:a[14]||(a[14]=()=>{d.$router.push({name:e(w).isParameter?"MessageSendingParameterCreate":"MessageSendingGeneralCreate"})})},{default:s(()=>[o("div",Gt,[t(J,{layout:"vertical",autocomplete:"off"},{default:s(()=>[t(Me,{"html-for":""},{label:s(()=>[Ht,t(Y,{placement:"top","get-popup-container":e(B)},{title:s(()=>[c(" 一般訊息支援 SMS 和 MMS，"),Kt,c(" 若想批次使用參數發送訊息，請選擇參數訊息 ")]),default:s(()=>[o("a",Xt,[t(S,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(Te,{value:e(w).isParameter,"onUpdate:value":a[12]||(a[12]=n=>e(w).isParameter=n)},{default:s(()=>[t(Q,{value:!1},{default:s(()=>[c(" 一般訊息 ")]),_:1}),t(Q,{value:!0},{default:s(()=>[c(" 參數訊息 ")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])]),_:1},8,["open"]),t(lt,{ref_key:"messageSendingEditModal",ref:H},null,512)]),_:1})}}});export{xs as default};

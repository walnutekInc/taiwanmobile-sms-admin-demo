import{_ as yt,a as bt}from"./index.vuevuetypescriptsetuptruelang-BRBDRwqm.js";import{u as wt,_ as kt,a as Ct,b as Mt,c as Tt,d as St}from"./route-leave-CBLvrXWa.js";import{_ as xt}from"./index.vuevuetypescriptsetuptruelang-CICFdqya.js";import{j as $t,k as Rt,_ as st}from"./index-D5CWLnaZ.js";import{d as Le,f as x,W as p,_ as B,$ as s,u as e,H as Ie,Y as n,r as De,c as Ce,k as t,ah as Ft,X as b,F as V,G as l,a3 as f,a4 as X,ac as as,ad as Pt,z as nt,o as jt,w as It,m as ee,ab as G,B as os,a9 as me,A as te,a7 as Dt,a5 as le,y as _t,ag as vt,l as Lt}from"./vue-BvWPEeCa.js";import{z as Ue,E as Q,K as tt,N as M,O as Ut,P as Ot,Q as ls,U as at,V as ot,H as At,I as Et,o as Nt,p as Bt,q as Vt,y as is,W as rs,T as cs,x as Yt,J as Kt,r as Ht,s as qt,F as Gt,X as ht,B as ds}from"./antd-Dpsol0oo.js";import{i as zt}from"./isToday-CxuES7r1.js";import{M as us,a as Wt,_ as Xt}from"./MessageTypeEnum-6t9eF3Fo.js";import{_ as Jt}from"./index.vuevuetypestyleindex0lang-Dl2df6kz.js";import{_ as Qt}from"./request-BZM3Cngs.js";import{u as ps}from"./contact-person-Brr0K4GR.js";import{u as Zt}from"./group-label-LaevKN5i.js";import{u as es,r as je}from"./custom-message-DoPeYD_t.js";import{u as ts,_ as ms}from"./message-sending-D_xQdZ45.js";import{b as N}from"./tools-DuR4KSGu.js";const fs=n("div",{class:"text-center px-24px py-20px w-328px text-base mx-auto"}," 刪除的檔案將無法復原 ",-1),ss=Le({name:"DelMultimediaFileModal",__name:"del-multimedia-file-modal",setup(E,{expose:F}){const O=x(!1),z=x();function J(D){z.value=D,O.value=!0}function T(){var D;(D=z.value)==null||D.call(z),O.value=!1}return F({show:J}),(D,P)=>{const m=Ue;return p(),B(m,{open:e(O),"onUpdate:open":P[0]||(P[0]=L=>Ie(O)?O.value=L:null),title:"是否刪除已上傳的檔案？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onOk:T},{default:s(()=>[fs]),_:1},8,["open"])}}}),_s={class:"px-24px"},xs=Le({__name:"select-contact",props:{formState:{}},emits:["updateFormState"],setup(E,{expose:F,emit:O}){const z=E,J=O,T=De({selectedRowKeys:[],selectedRows:[],loading:!1}),{contactPerson:D,getAllContactPerson:P,pagination:m}=ps(),L=[{title:"手機門號",dataIndex:"phone",key:"phone",width:"110px"},{title:"姓名",dataIndex:"name",key:"name",width:"110px"},{title:"黑名單",dataIndex:"isBlackList",key:"isBlackList",width:"110px"},{title:"備註",dataIndex:"note",key:"note",width:"110px"}],k=x({keyword:"",sortField:"createTime",sortOrder:"descend"}),A=Ce(()=>{const C=(m.value.current-1)*m.value.pageSize;return D.value.slice(C,m.value.current*m.value.pageSize)});async function fe(C,S){m.value={...m.value,current:C,pageSize:S}}async function ie(C=1,S=10){const q={current:C,pageSize:S,...e(k)};await P(q,T.selectedRowKeys)}function _e(C){console.log("selectedRowKeys changed: ",C),T.selectedRowKeys=C}const H=x(!1);async function xe(C){T.selectedRowKeys=C,ie(),H.value=!0}function ge(){H.value=!1,J("updateFormState",{recipients:{...z.formState.recipients,contactPerson:T.selectedRowKeys}})}return F({show:xe}),(C,S)=>{const q=Qt,re=Jt,U=Ue;return p(),B(U,{open:e(H),"onUpdate:open":S[2]||(S[2]=w=>Ie(H)?H.value=w:null),title:"選擇聯絡人",centered:"","cancel-text":"取消","ok-text":"確定",width:"600px",onOk:ge},{default:s(()=>[n("div",_s,[t(q,{modelValue:e(k).keyword,"onUpdate:modelValue":S[0]||(S[0]=w=>e(k).keyword=w),"show-filter-btn":!1,placeholder:"搜尋聯絡人",class:"mb-2",onKeydown:S[1]||(S[1]=Ft(w=>ie(1,e(m).pageSize),["enter"]))},null,8,["modelValue"]),t(re,{class:"modal-table","data-source":e(A),columns:L,"show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(T).selectedRowKeys,onChange:_e,preserveSelectedRowKeys:!0},pagination:{...e(m)},onChangePagination:fe},{bodyCell:s(({column:w,text:Me})=>[w.dataIndex==="isBlackList"?(p(),b(V,{key:0},[l(f(Me?"黑名單":""),1)],64)):X("",!0)]),_:1},8,["data-source","row-selection","pagination"])])]),_:1},8,["open"])}}}),gs={class:"px-24px"},vs=Le({__name:"select-group",props:{formState:{}},emits:["updateFormState"],setup(E,{expose:F,emit:O}){const z=E,J=O,T=De({selectedRowKeys:[],selectedRows:[],loading:!1}),{groupLabels:D,getAllGroupLabel:P,pagination:m}=Zt(),L=[{title:"群組標籤名稱",dataIndex:"name",key:"name",width:"145px"},{title:"門號數量",dataIndex:"phoneCount",key:"phoneCount",width:"145px"},{title:"黑名單數量",dataIndex:"blackListCount",key:"blackListCount",width:"145px"}],k=x({keyword:"",sortField:"createTime",sortOrder:"descend"}),A=Ce(()=>{const C=(m.value.current-1)*m.value.pageSize;return D.value.slice(C,m.value.current*m.value.pageSize)});async function fe(C,S){m.value={...m.value,current:C,pageSize:S}}async function ie(C=1,S=10){const q={current:C,pageSize:S,...e(k)};await P(q,T.selectedRowKeys)}function _e(C,S){console.log("selectedRowKeys changed: ",C),T.selectedRowKeys=C,T.selectedRows=S}const H=x(!1);async function xe(C){T.selectedRowKeys=C.map(S=>S.id),ie(),H.value=!0}function ge(){H.value=!1,J("updateFormState",{recipients:{...z.formState.recipients,group:T.selectedRows.map(C=>({id:C.key,label:C.name}))}})}return F({show:xe}),(C,S)=>{const q=Qt,re=Jt,U=Ue;return p(),B(U,{open:e(H),"onUpdate:open":S[2]||(S[2]=w=>Ie(H)?H.value=w:null),title:"選擇群組標籤",centered:"","cancel-text":"取消","ok-text":"確定",width:"600px",onOk:ge},{default:s(()=>[n("div",gs,[t(q,{modelValue:e(k).keyword,"onUpdate:modelValue":S[0]||(S[0]=w=>e(k).keyword=w),"show-filter-btn":!1,placeholder:"搜尋群組標籤",class:"mb-2",onKeydown:S[1]||(S[1]=Ft(w=>ie(1,e(m).pageSize),["enter"]))},null,8,["modelValue"]),t(re,{class:"modal-table","data-source":e(A),columns:L,"show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(T).selectedRowKeys,onChange:_e,preserveSelectedRowKeys:!0},pagination:{...e(m)},onChangePagination:fe},null,8,["data-source","row-selection","pagination"])])]),_:1},8,["open"])}}});var gt=(E=>(E.NOW="現在",E.RESERVATION="預約",E))(gt||{});const hs=n("span",{class:"pe-.5"},"活動名稱",-1),ys=n("span",{class:"text-red-500 pe-2"},"*",-1),bs={href:"javascript:;"},ws=n("span",{class:"pe-.5"},"接收門號",-1),ks=n("span",{class:"text-red-500 pe-2"},"*",-1),Cs={href:"javascript:;"},Ms=n("br",null,null,-1),Ts=n("br",null,null,-1),Ss=n("br",null,null,-1),$s=n("br",null,null,-1),Rs=n("br",null,null,-1),Fs={class:"text-sm text-sms-secondary-dark-blue-100 font-400"},Ps=n("div",{class:"ant-form-item-extra"}," 若有多筆門號，使用 “ , ” 隔開，例如：0911111222,0922123456,0933987654 ",-1),js={href:"javascript:;",class:"underline underline-offset-2 text-sms-primary-blue-80 text-sm line-height-14px py-1"},Is={href:"javascript:;",class:"underline underline-offset-2 text-sms-primary-blue-80 text-sm line-height-14px py-1"},Ds=n("span",{class:"pe-.5"},"訊息類型",-1),Ls=n("span",{class:"text-red-500 pe-2"},"*",-1),Us={href:"javascript:;"},Os=n("br",null,null,-1),As={class:"flex gap-2 overflow-y-auto h-95px"},Es={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},Ns=n("span",{class:"pe-.5"},"發送時間",-1),Bs=n("span",{class:"text-red-500 pe-2"},"*",-1),Vs={href:"javascript:;"},Ys=n("span",{class:"pe-.5"},"有效時間",-1),Ks=n("span",{class:"text-red-500 pe-2"},"*",-1),Hs={href:"javascript:;"},qs={key:0,id:"confirmDetail",class:"px-32px"},Gs=n("div",{class:"mb-4"},[n("h2",{class:"font-500 text-22px text-sms-secondary-dark-blue-100"}," 內容確認 "),n("p",{class:"text-sm text-sms-grayscale-80"}," 若有使用縮網址功能，請在發送訊息前再次確認短網址有效性，平台不會檢驗短網址有效性 ")],-1),zs={class:"border border-solid border-sms-light-gray-60 p-16px pb-24px rounded-12px mb-2"},Ws=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 活動名稱 ",-1),Xs={class:"text-base font-400 text-sms-grayscale-100"},Js=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送時間 ",-1),Qs={key:0,class:"text-base font-400 text-sms-grayscale-100"},Zs=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息類型 ",-1),en={class:"text-base font-400 text-sms-grayscale-100"},tn=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送門號 ",-1),sn={class:"text-base font-400 text-sms-grayscale-100"},nn=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息總數 (長訊息) ",-1),an={class:"text-base font-400 text-sms-grayscale-100"},on=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 單價 ",-1),ln={class:"text-base font-400 text-sms-grayscale-100"},rn={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},cn={href:"javascript:;"},dn={class:"text-base font-400 text-sms-grayscale-100"},un=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),pn={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},mn={href:"javascript:;"},fn={class:"text-base font-400 text-sms-grayscale-100"},_n=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),xn={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},gn={href:"javascript:;"},vn=n("br",null,null,-1),hn={class:"text-base font-400 text-sms-grayscale-100"},yn={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},bn={href:"javascript:;"},wn=n("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"},[l(" 您編輯過的內容將全部清空 "),n("br"),n("p",null,[l(" 提醒您，SMS支援的字數較MMS少，"),n("br"),l(" 且不能上傳多媒體附件 ")])],-1),kn={class:"text-center px-30px py-20px w-328px text-base mx-auto"},Cn={class:"text-base text-center text-sms-gary-80"},Mn=["href"],bo=Le({__name:"create-or-update-form",props:{isCreate:{type:Boolean,default:!1},id:{},editCallback:{},showPreview:{type:Boolean,default:!0}},setup(E){const F=E;Q.extend(zt);const{setHideAlert:O,setShowAlert:z}=wt(),J=$t(),T=as(),D=Pt(),P=nt(F,"isCreate"),m=nt(F,"id"),{replaceFieldToHtml:L}=es(),k=x(),{updateGeneralMessageSending:A,getGeneralMessageSendingById:fe,createGeneralMessageSending:ie,uploadBatchRecipientsExcel:_e,effectiveTimeOption:H,getActiveStatusLabel:xe,checkMessageSendingDetail:ge,checkMessageSendingNameExist:C,renderGeneralMessagePreviewArray:S}=ts(),{getGroupLabelOption:q,groupOptions:re}=Zt(),U=x("");let w={name:"",phone:void 0,recipients:{contactPerson:[],group:[],manual:"",file:void 0},messageType:"SMS",subject:"",multimediaFile:[],sendTimeType:"NOW",content:"",effectiveTime:"",reservationTime:""};const Me=[{label:"0935-111-111",value:"0935-111-111"},{label:"0947-127-998",value:"0947-127-998"},{label:"0958-892-006",value:"0958-892-006"}],se=x("ContactPerson"),i=x(!1),c=De(tt(w)),Te=Ce(()=>c.messageType==="SMS"?335:1e3),Z=De({name:[{async validator(o,a){return M(a)?Promise.reject("請輸入活動名稱"):await C(a,m.value)?Promise.reject("此活動名稱已存在，請重新命名 "):Promise.resolve()},trigger:"blur"}],phone:[{required:!0,message:"請選擇發送門號",trigger:"blur"}],subject:[{async validator(o,a){return c.messageType==="MMS"&&M(a)?Promise.reject("請輸入訊息主旨"):Promise.resolve()},trigger:"blur"}],recipients:[{async validator(o){if(M(c.recipients.contactPerson)&&M(c.recipients.group)&&M(c.recipients.manual)&&Ut(c.recipients.file))return Promise.reject("至少 1 個接收門號");if(M(c.recipients.manual)){const a=c.recipients.manual.split(",").length,u=c.recipients.contactPerson.length,v=c.recipients.group.length;if(a+u+v>5e4)return Promise.reject("總接收門號數不可超過 5萬筆")}else if(!/^09[0-9]{8}(,09[0-9]{8})*$/.test(c.recipients.manual))return se.value="ManualInput",Promise.reject("格式錯誤");return Promise.resolve()},trigger:"blur"}],content:[{async validator(o,a){var u;return M(a)?Promise.reject("請輸入訊息內容"):!M(a)&&((u=c.content)==null?void 0:u.replace(je,"").length)>Te.value?Promise.reject(`限制輸入 ${Te.value} 字以內`):Promise.resolve()},trigger:"blur"}],reservationTime:[{async validator(o,a){if(c.sendTimeType==="RESERVATION"){if(M(a))return Promise.reject("請選擇預約日期或現在發送");if(Q().diff(Q(a),"minute")>0)return Promise.reject("閒置過久，請重新選擇預約時間")}return Promise.resolve()},trigger:"blur"}]}),{validateInfos:ne,validate:lt,resetFields:$}=Ot(c,Z);jt(async()=>{var o,a,u,v,j,_,y,K,Y,ae,W,be,de,we,Re,Fe,ue,pe,Pe,ke;if(await q(),U.value=Q().format("YYYY/MM/DD_HH:mm"),!P.value&&m.value){const oe=await fe(m.value);oe.data&&(k.value=oe.data,w={name:((o=k.value)==null?void 0:o.name)??e(U),phone:((a=k.value)==null?void 0:a.phone)??void 0,recipients:{contactPerson:((v=(u=k.value)==null?void 0:u.recipients)==null?void 0:v.contactPerson)??[],group:((_=(j=k.value)==null?void 0:j.recipients)==null?void 0:_.group)??[],manual:((K=(y=k.value)==null?void 0:y.recipients)==null?void 0:K.manual)??"",file:((ae=(Y=k.value)==null?void 0:Y.recipients)==null?void 0:ae.file)??void 0},messageType:((W=k.value)==null?void 0:W.messageType)??"SMS",subject:((be=k.value)==null?void 0:be.subject)??"",multimediaFile:((de=k.value)==null?void 0:de.multimediaFile)??[],sendTimeType:((we=k.value)==null?void 0:we.sendTimeType)??"NOW",content:((Re=k.value)==null?void 0:Re.content)??"",effectiveTime:((Fe=k.value)==null?void 0:Fe.effectiveTime)??"",reservationTime:((ue=k.value)==null?void 0:ue.reservationTime)??""})}else{if((pe=T.query)!=null&&pe.isRe){U.value=`RE_${U.value}`;const oe=(Pe=T.query)!=null&&Pe.rePhone?T.query.rePhone:void 0,r=(ke=T.query)!=null&&ke.recipientsPhone?T.query.recipientsPhone:void 0;oe&&(w.phone=oe),r&&(ls(Me,{value:r})?w.recipients.contactPerson=[r]:(se.value="ManualInput",w.recipients.manual=r))}w.name=e(U)}$(w)}),It(()=>c,o=>{const a=at(o,w);P.value&&!m.value&&(a?O():z())},{deep:!0});const I=x(null);function it(){lt().then(async()=>{const o=await ge(c);if(o.data){I.value=o.data,i.value=!0,await _t();const a=document.getElementById("app");a&&(a.scrollTop=0)}}).catch(o=>{console.log(o)})}async function He(){var u,v,j,_;const a=await(e(P)?ie:A)(c,m.value);if(((u=a.data)==null?void 0:u.status)==="success")if(P.value&&!m.value)if(O(),(v=T.query)!=null&&v.isRe&&((j=T.query)!=null&&j.rePhone)&&((_=T.query)!=null&&_.recipientsPhone)){const{post:y,close:K}=vt({name:"in-chat-message-page"});y(a.data.id),K(),window.close()}else J.success({message:"訊息新增成功",placement:"top"}),D.push("/sms-marketing/message-sending").then(()=>{setTimeout(()=>{var Y;const{post:y,close:K}=vt({name:"in-message-sending-page"});y((Y=a.data)==null?void 0:Y.id),K()},800)});else F.editCallback&&F.editCallback(!0,m.value),J.success({message:"訊息編輯成功",placement:"top"}),F.editCallback||D.push("/sms-marketing/appointment")}const Oe=x(null);function Ae(o){c.content=L(o)}const rt=x(null);function qe(o){for(const a of o)c.content=`${c.content}<span>${a}</span>`}const Ge=x(null);function ze(o){c.content=`${c.content}<a href="${o}">${o}</a>`}const We=x(null),Ee=Ce(()=>S(c)),Ne=x(null);function Xe(o){c.multimediaFile=o}const Je=x(null);function Be(o){c.multimediaFile=c.multimediaFile.filter(a=>a.url!==o.url)}const ve=x(!1);function ct(){c.messageType==="SMS"?!M(c.content)||!M(c.multimediaFile)?ve.value=!0:c.messageType="SMS":c.messageType="MMS"}const Ve=x(null),Qe=x(null);function Ze(o){Object.assign(c,o)}const he=x({open:!1,url:""}),Se=x();async function ce(o){const u=o.target.files;try{if(u.length>0){const v=await _e(u[0]);c.recipients.file=v.data,he.value={open:!0,url:""}}}catch(v){console.log(v)}finally{Se.value&&(Se.value.value="")}}const dt=Rt();function et(){dt.confirm({title:"是否取消上傳檔案？",icon:t("span"),content:Lt("div",{innerHTML:"該檔案將取消上傳",class:"text-center px-30px py-20px w-328px text-base mx-auto"}),width:"400px",centered:!0,closable:!0,async onOk(){c.recipients.file=void 0}})}const ye=Q();function $e(o){const a=ye.add(1,"year");return o&&(o<ye||o>=a)}function ut(o){if(o&&o.isToday()){const a=Q().add(5,"minute"),u=a.hour(),v=a.minute();return{disabledHours:()=>ot(0,24).slice(0,u),disabledMinutes:()=>ot(0,60).slice(0,v)}}return{}}function pt(){const o=at(c,w);F.editCallback&&F.editCallback(o)}function mt(){P.value&&!m.value?D.push("/sms-marketing/message-sending"):pt()}const Ye=x("responsive");function ft(o){c.recipients.group=c.recipients.group.filter(a=>a.id!==o)}async function d(o){const v=o.target.value.replace(/[^\d|,]/g,"");await _t(),c.recipients.manual=v}return(o,a)=>{const u=st,v=At,j=Et,_=Nt,y=Bt,K=Vt,Y=xt,ae=is,W=rs,be=cs,de=Yt,we=Kt,Re=yt,Fe=St,ue=Ht,pe=qt,Pe=Gt,ke=bt,oe=Ue;return p(),b(V,null,[t(pe,{class:le(["bg-sms-grayscale-0 rounded-4",{"p-10 pl-1":o.showPreview}]),wrap:!1},{default:s(()=>[t(y,{flex:"auto"},{default:s(()=>[ee(t(Pe,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:it},{default:s(()=>[t(pe,{gutter:[16,14]},{default:s(()=>[t(y,{span:24},{default:s(()=>[t(_,G(e(ne).name,{"html-for":""}),{label:s(()=>[hs,ys,t(v,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 活動名稱可使用系統預設或自行輸入，但不可重複 ")]),default:s(()=>[n("a",bs,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(j,{value:e(c).name,"onUpdate:value":a[0]||(a[0]=r=>e(c).name=r),placeholder:"請輸入文字",maxlength:30,onFocus:a[1]||(a[1]=()=>{e(c).name===e(U)&&(e(c).name="")}),onBlur:a[2]||(a[2]=()=>{e(c).name===""&&(e(c).name=e(U))})},null,8,["value"])]),_:1},16)]),_:1}),t(y,{span:24},{default:s(()=>[t(_,G(e(ne).phone,{label:"發送門號",required:""}),{default:s(()=>[t(K,{value:e(c).phone,"onUpdate:value":a[3]||(a[3]=r=>e(c).phone=r),options:Me,"allow-clear":"",placeholder:"請選擇發送門號"},null,8,["value"])]),_:1},16)]),_:1}),t(y,{span:24},{default:s(()=>[t(_,G({"html-for":""},e(ne).recipients),{label:s(()=>[ws,ks,t(v,{"overlay-inner-style":{width:"315px"},placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 4 種方式增加接收門號 ，且可混合使用(總上限5萬筆)："),Ms,l(" 1. 從名單管理匯入聯絡人"),Ts,l(" 2. 從名單管理匯入群組標籤"),Ss,l(" 3. 直接輸入接收門號"),$s,l(" 4. Excel 快速上傳門號"),Rs]),default:s(()=>[n("a",Cs,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(be,{activeKey:e(se),"onUpdate:activeKey":a[10]||(a[10]=r=>Ie(se)?se.value=r:null),size:"small",class:"full-border-tab",type:"card","destroy-inactive-tab-pane":!0},{default:s(()=>[t(ae,{key:"ContactPerson",tab:"聯絡人"},{default:s(()=>[t(Y,{status:"small2",class:"me-2",onClick:a[4]||(a[4]=r=>{var h,g;return(g=e(Ve))==null?void 0:g.show(((h=e(c).recipients)==null?void 0:h.contactPerson)??[])})},{icon:s(()=>[t(u,{name:"plus",width:"16px"})]),default:s(()=>[l(" 選擇聯絡人 ")]),_:1}),n("span",Fs,"已選擇 "+f(e(c).recipients.contactPerson.length.toLocaleString())+" 筆",1)]),_:1},8,["tab"]),t(ae,{key:"GroupLabel",tab:"群組標籤"},{default:s(()=>[e(c).recipients.group.length>0?(p(),B(K,{key:0,class:"mb-2",open:!1,options:e(re),value:e(c).recipients.group.map(r=>r.id),mode:"tags","max-tag-count":e(Ye),onDeselect:ft,onBlur:a[6]||(a[6]=r=>Ye.value="responsive")},{maxTagPlaceholder:s(r=>[n("span",{href:"javascript:;",onClick:a[5]||(a[5]=os(h=>Ye.value=void 0,["prevent"]))},[t(u,{name:"plus",width:"12px"}),l(f(r.length)+"...",1)])]),_:1},8,["options","value","max-tag-count"])):X("",!0),t(Y,{status:"small2",class:"me-2",onClick:a[7]||(a[7]=r=>{var h;return(h=e(Qe))==null?void 0:h.show(e(c).recipients.group??[])})},{icon:s(()=>[t(u,{name:"plus",width:"16px"})]),default:s(()=>[l(" 選擇群組標籤 ")]),_:1})]),_:1},8,["tab"]),t(ae,{key:"ManualInput",tab:"手動輸入"},{default:s(()=>[t(W,{value:e(c).recipients.manual,"onUpdate:value":a[8]||(a[8]=r=>e(c).recipients.manual=r),placeholder:"請輸入接收門號",rows:6,onInput:d},null,8,["value"]),Ps]),_:1},8,["tab"]),t(ae,{key:"FileUpload",tab:"上傳檔案"},{default:s(()=>[e(c).recipients.file?(p(),b(V,{key:1},[n("a",Is,f(e(c).recipients.file.fileName),1),t(u,{name:"download-circle",width:"16px",class:"mx-2 cursor-pointer"}),t(u,{name:"delete-circle",width:"16px",class:"cursor-pointer",onClick:et})],64)):(p(),b(V,{key:0},[n("input",{ref_key:"uploadBatchRecipientsFile",ref:Se,type:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",class:"!hidden",onChange:ce},null,544),t(Y,{status:"small2",class:"me-2",onClick:a[9]||(a[9]=r=>{var h;return(h=e(Se))==null?void 0:h.click()})},{icon:s(()=>[t(u,{name:"plus",width:"16px"})]),default:s(()=>[l(" 上傳EXCEL ")]),_:1}),n("a",js,[t(u,{name:"download",width:"16px"}),l(" 匯出範例 ")])],64))]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),_:1},16)]),_:1}),t(y,{span:24},{default:s(()=>[t(_,G({"html-for":""},e(ne).messageType),{label:s(()=>[Ds,Ls,t(v,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" SMS：上限 335 字"),Os,l(" MMS：上限 1,000 字，可上傳多媒體 ")]),default:s(()=>[n("a",Us,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(we,{value:e(c).messageType,"onUpdate:value":a[11]||(a[11]=r=>e(c).messageType=r),onChange:ct},{default:s(()=>[(p(!0),b(V,null,me(Object.entries(e(us)),([r,h])=>(p(),B(de,{key:r,value:r},{default:s(()=>[l(f(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16)]),_:1}),ee(t(y,{span:24},{default:s(()=>[t(_,G({label:"訊息主旨"},e(ne).subject,{required:"",extra:"15 字以內"}),{default:s(()=>[t(j,{value:e(c).subject,"onUpdate:value":a[12]||(a[12]=r=>e(c).subject=r),placeholder:"請輸入訊息主旨",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[te,e(c).messageType==="MMS"]]),t(y,{span:24},{default:s(()=>{var r;return[t(_,G({"html-for":"",label:"訊息內容"},e(ne).content,{class:"relative",extra:`${e(c).messageType} 上限 ${e(Te).toLocaleString()} 字，目前 ${e(M)(e(c).content)?"--":(r=e(c).content)==null?void 0:r.replace(e(je),"").length} 字`}),{default:s(()=>{var h;return[t(Fe,{modelValue:e(c).content,"onUpdate:modelValue":a[17]||(a[17]=g=>e(c).content=g),contenteditable:"true",style:{height:"292px"},"content-len":(h=e(c).content)==null?void 0:h.replace(e(je),"").length,"max-len":e(Te),placeholder:"請輸入文字"},Dt({default:s(()=>[t(v,null,{title:s(()=>[l(" 載入現有的自訂訊息 ")]),default:s(()=>[t(u,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:a[13]||(a[13]=g=>{var R;return(R=e(Oe))==null?void 0:R.show()})})]),_:1}),t(v,null,{title:s(()=>[l(" 增加縮網址 ")]),default:s(()=>[t(u,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:a[14]||(a[14]=g=>{var R;return(R=e(Ge))==null?void 0:R.show()})})]),_:1}),t(v,null,{title:s(()=>[l(" 多媒體附件上傳 ")]),default:s(()=>[ee(t(u,{name:"cloud-upload",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:a[15]||(a[15]=g=>{var R;return(R=e(Ne))==null?void 0:R.show(e(c).multimediaFile)})},null,512),[[te,e(c).messageType==="MMS"]])]),_:1}),t(v,null,{title:s(()=>[l(" AI 文字生成訊息 ")]),default:s(()=>[t(u,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:a[16]||(a[16]=g=>{var R;return(R=e(We))==null?void 0:R.show()})})]),_:1})]),_:2},[e(c).multimediaFile.length>0?{name:"multimediaBlock",fn:s(()=>[n("div",As,[(p(!0),b(V,null,me(e(c).multimediaFile,g=>(p(),b("div",{key:g.url,class:"w-90px max-h-60px"},[t(Re,{source:{url:g.url,type:g.type},"show-file-name":!1,"can-play":!1,size:"small","image-class":"object-cover w-full h-full",onDeleteVideo:R=>{var Ke;return(Ke=e(Je))==null?void 0:Ke.show(()=>Be(g))}},null,8,["source","onDeleteVideo"]),n("div",Es,f(g.fileName),1)]))),128))])]),key:"0"}:void 0]),1032,["modelValue","content-len","max-len"])]}),_:1},16,["extra"])]}),_:1}),t(y,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-20px"},{default:s(()=>[t(_,G(e(ne).reservationTime,{"html-for":"",class:"mb-4"}),{label:s(()=>[Ns,Bs,t(v,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 最快可預約5分鐘之後以及系統當下 1 年內時間，惟實際發送時間以系統排程為主 ")]),default:s(()=>[n("a",Vs,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(we,{value:e(c).sendTimeType,"onUpdate:value":a[18]||(a[18]=r=>e(c).sendTimeType=r)},{default:s(()=>[(p(!0),b(V,null,me(Object.entries(e(gt)),([r,h])=>(p(),B(de,{key:r,value:r},{default:s(()=>[l(f(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),ee(t(ue,{value:e(c).reservationTime,"onUpdate:value":a[19]||(a[19]=r=>e(c).reservationTime=r),format:"YYYY/MM/DD HH:mm","value-format":"YYYY/MM/DD HH:mm","disabled-date":$e,"disabled-time":ut,"show-time":!0,"show-now":!1},null,8,["value"]),[[te,e(c).sendTimeType==="RESERVATION"]])]),_:1},16),t(_,G(e(ne).sendTimeType,{"html-for":""}),{label:s(()=>[Ys,Ks,t(v,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 因接收門號而無法成功送達訊息，會在此設定有效時間內重複嘗試發送 ")]),default:s(()=>[n("a",Hs,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(K,{value:e(c).effectiveTime,"onUpdate:value":a[20]||(a[20]=r=>e(c).effectiveTime=r),options:e(H),"list-height":300,placeholder:"請選擇有效時間"},null,8,["value","options"])]),_:1},16)]),_:1}),t(y,{span:24,class:le({"text-end":e(P)&&!e(m),"text-center py-6 ":!e(P)&&e(m)})},{default:s(()=>[t(Y,{status:"small2",class:"me-2",onClick:mt},{default:s(()=>[l(" 取消 ")]),_:1}),t(Y,{status:"small1","html-type":"submit"},{default:s(()=>[l(" 確定 ")]),_:1})]),_:1},8,["class"])]),_:1})]),_:1},512),[[te,!e(i)]]),e(i)&&e(I)?(p(),b("div",qs,[Gs,n("div",zs,[t(pe,{gutter:[16,16]},{default:s(()=>[t(y,{span:24,class:"mb-"},{default:s(()=>[Ws,n("div",Xs,f(e(I).name),1)]),_:1}),t(y,{span:8},{default:s(()=>[Js,e(I).sendTimeType==="RESERVATION"?(p(),b("div",Qs,f(e(I).reservationTime),1)):(p(),b("div",{key:1,class:le(["text-base font-400 text-sms-grayscale-100",{"text-sms-status-alert-red":Math.sign(e(I).estimatedRemainingAmount)===-1}])}," 現在 ",2))]),_:1}),t(y,{span:8},{default:s(()=>[Zs,n("div",en,f(e(xe)(e(I).messageType,e(I).isParameter)),1)]),_:1}),t(y,{span:8},{default:s(()=>[tn,n("div",sn,f(e(I).phone),1)]),_:1}),e(I).messageType==="SMS"?(p(),B(y,{key:0,span:8},{default:s(()=>[nn,n("div",an,f(e(I).totalLongMessages),1)]),_:1})):X("",!0),t(y,{span:8},{default:s(()=>[on,n("div",ln," NT$ "+f(e(I).price),1)]),_:1}),t(y,{span:8},{default:s(()=>[n("div",rn,[l(" 接收門號總數 "),t(v,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 未過濾所有黑名單，發送時會再檢核，最終接收門號數量可能變動 ")]),default:s(()=>[n("a",cn,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",dn,[l(f(e(I).recipientsCount.toLocaleString())+" ",1),un])]),_:1}),t(y,{span:8},{default:s(()=>[n("div",pn,[l(" 黑名單門號總數 "),t(v,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 目前已篩選掉該黑名單數量，發送時會再檢核最新黑名單，最終黑名單門號總數可能變動 ")]),default:s(()=>[n("a",mn,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",fn,[l(f(e(I).isBlackListCount.toLocaleString())+" ",1),_n])]),_:1}),t(y,{span:8},{default:s(()=>[n("div",xn,[l(" 預估發送總金額 "),t(v,{placement:"top","get-popup-container":e(N),"overlay-inner-style":{width:"397px"}},{title:s(()=>[l(" 發送總金額 = 訊息總數 x ( 接收門號總數 - 黑名單門號總數 ) x 單價"),vn,l(" 參數訊息之訊息總數以一則計算，實際計價以發送字數等於幾則來計價 ")]),default:s(()=>[n("a",gn,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",hn," NT$ "+f(e(I).estimatedTotalAmount.toLocaleString()),1)]),_:1}),t(y,{span:8},{default:s(()=>[n("div",yn,[l(" 預估剩餘金額 "),t(v,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 餘額不足仍可預約，請注意於預約時間前進行儲值才可成功發送訊息 ")]),default:s(()=>[n("a",bn,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",{class:le(["text-base font-400 text-sms-grayscale-100",{"text-sms-status-alert-red":Math.sign(e(I).estimatedRemainingAmount)===-1}])}," NT$ "+f(e(I).estimatedRemainingAmount.toLocaleString()),3)]),_:1})]),_:1})]),n("div",{class:le(["flex items-center justify-end",{"py-4":!e(P)&&e(m)}])},[ee(n("div",{class:"text-sms-status-alert-red text-base me-4"},f(e(I).sendTimeType==="RESERVATION"?"可預約，請於發送時間之前儲值完畢，以免發送失敗":"剩餘金額不足，建議回上一步改成預約發送後再盡快儲值"),513),[[te,Math.sign(e(I).estimatedRemainingAmount)===-1]]),t(Y,{status:"small2",class:"me-2",onClick:a[21]||(a[21]=()=>{i.value=!1,I.value=null})},{default:s(()=>[l(" 上一步 ")]),_:1}),t(Y,{onClick:He},{default:s(()=>[l(" 確定 ")]),_:1})],2)])):X("",!0)]),_:1}),o.showPreview?(p(),B(y,{key:0,flex:"428px",class:"relative"},{default:s(()=>[t(ke,{message:e(Ee)},null,8,["message"])]),_:1})):X("",!0)]),_:1},8,["class"]),t(kt,{ref_key:"importCustomMessageRef",ref:Oe,content:e(c).content,onUpdateContent:Ae},null,8,["content"]),t(Ct,{ref_key:"addFieldRef",ref:rt,onAddFieldToContent:qe},null,512),t(Mt,{ref_key:"addLinkRef",ref:Ge,onAddLinkToContent:ze},null,512),t(Tt,{ref_key:"aiTextGenerationRef",ref:We,content:e(c).content,onUpdateContent:Ae},null,8,["content"]),t(Wt,{ref_key:"multimediaUploadRef",ref:Ne,onUpdateMultimediaFile:Xe},null,512),t(ss,{ref_key:"delMultimediaFileRef",ref:Je},null,512),t(oe,{open:e(ve),"onUpdate:open":a[22]||(a[22]=r=>Ie(ve)?ve.value=r:null),title:"是否放棄目前編輯的內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onCancel:a[23]||(a[23]=r=>e(c).messageType="MMS"),onOk:a[24]||(a[24]=()=>{e(c).content="",e(c).multimediaFile=[],e(c).subject="",ve.value=!1})},{default:s(()=>[wn]),_:1},8,["open"]),t(xs,{ref_key:"selectContactRef",ref:Ve,"form-state":e(c),onUpdateFormState:Ze},null,8,["form-state"]),t(vs,{ref_key:"selectGroupRef",ref:Qe,"form-state":e(c),onUpdateFormState:Ze},null,8,["form-state"]),t(oe,{open:e(he).open,"onUpdate:open":a[26]||(a[26]=r=>e(he).open=r),title:"資料格式有誤，請重新確認上傳",width:"400px",centered:""},{footer:s(()=>[t(Y,{onClick:a[25]||(a[25]=r=>e(he).open=!1)},{default:s(()=>[l(" 確定 ")]),_:1})]),default:s(()=>[n("div",kn,[n("p",Cn,[l(" 正確的格式範例 "),n("a",{class:"text-sms-primary-blue-80 ms-1 underline underline-offset-2",href:e(he).url,download:""},"點擊此處下載",8,Mn)])])]),_:1},8,["open"])],64)}}}),Tn={class:"px-20px pb-24px font-400 text-base text-sms-grayscale-80"},Sn=n("p",{class:"mb-4"},[l(" SMS：上限 335 字"),n("br"),l(" MMS：上限 1,000 字，可上傳多媒體 ")],-1),$n=n("p",{class:"font-700 mb-4"}," 方式一：接收門號不同，且訊息內容不同 (支援SMS/MMS) ",-1),Rn={class:"list-decimal pl-20px m-0"},Fn=n("li",null,"若選擇 MMS 訊息，必須輸入訊息主旨與上傳多媒體檔案，請留意多媒體組別",-1),Pn=n("li",null," 系統將直接發送訊息內容到相應的手機號碼，請確保欄位為有效門號和訊息內容，不允許有空白欄位 ",-1),jn=n("p",{class:"font-700 mb-4"}," 方式二：接收門號不同，訊息內容可使用 5 個參數 (支援SMS/MMS) ",-1),In={class:"list-decimal pl-20px m-0"},Dn=n("li",null,"承上，請注意每個參數欄位上限 50 字",-1),Ln=n("li",null,"上傳檔案進行發送參數訊息，系統將自動將訊息內容中的參數替換為參數檔案門號列",-1),Un={class:"text-xs"},On=n("li",{class:"mb-4"},[l(" 訊息內容輸入： "),n("div",{class:"py-12.5px px-12px mt-4 rounded-12px border-sms-border-light-mode-light-gary border-solid -ms-20px"},[l(" %field1% 您好，您所填入的資料如下"),n("br"),l(" 會員編號： %field2% "),n("br"),l(" 性別： %field3% "),n("br"),l(" 生日： %field4% "),n("br"),l(" 年齡： %field5% ")])],-1),An=n("li",null,[l(" 兩門號收到的訊息分別如下： "),n("div",{class:"py-12.5px px-12px mt-4 rounded-12px border-sms-border-light-mode-light-gary border-solid -ms-20px"},[l(" 珊珊您好，您所填入的資料如下"),n("br"),l(" 會員編號： 9412918"),n("br"),l(" 性別： 女"),n("br"),l(" 生日： 08/22"),n("br"),l(" 年齡： 25"),n("br")]),n("div",{class:"py-12.5px px-12px mt-4 rounded-12px border-sms-border-light-mode-light-gary border-solid -ms-20px"},[l(" 馬可您好，您所填入的資料如下"),n("br"),l(" 會員編號： 5439577"),n("br"),l(" 性別： 男"),n("br"),l(" 生日： 08/29"),n("br"),l(" 年齡： 17"),n("br")])],-1),En=Le({__name:"instructions-modal",setup(E,{expose:F}){const O=x(!1);function z(){O.value=!0}return F({show:z}),(J,T)=>{const D=st,P=xt,m=Xt,L=Ue;return p(),B(L,{open:e(O),"onUpdate:open":T[0]||(T[0]=k=>Ie(O)?O.value=k:null),"ok-text":"確定","cancel-text":"取消",title:"操作說明",width:"600px"},{default:s(()=>[n("div",Tn,[Sn,$n,n("ul",Rn,[n("li",null,[l(" 請下載Excel範例並填寫後上傳 "),t(P,{status:"small3",class:"!px-0 !py-0 !text-sms-primary-blue-80"},{icon:s(()=>[t(D,{name:"download"})]),default:s(()=>[l(" SMS匯出範例 ")]),_:1}),t(P,{status:"small3",class:"!pl-2 !py-0 !text-sms-primary-blue-80"},{icon:s(()=>[t(D,{name:"download"})]),default:s(()=>[l(" MMS匯出範例 ")]),_:1})]),Fn,Pn,n("li",null,[l(" SMS 範例如下，兩個門號將收到不同內容的訊息： "),t(m,{class:"!-ms-20px mb-4",columns:[{key:"phone",dataIndex:"phone",title:"接收門號"},{key:"content",dataIndex:"content",title:"訊息內容"}],"data-source":[{phone:"0922333111",content:"VIP會員你好，邀請你參加會員專屬活動"},{phone:"0908111111",content:"你好，歡迎加入 ooo 專屬品牌會員"}]})]),n("li",null,[l(" MMS 範例如下，每個門號將收到不同文字內容和多媒體的訊息： "),t(m,{class:"!-ms-20px mb-4",columns:[{key:"phone",dataIndex:"phone",title:"接收門號"},{key:"content",dataIndex:"content",title:"訊息內容"},{key:"group",dataIndex:"group",title:"對應組別"}],"data-source":[{phone:"0922333111",content:"VIP會員你好，邀請你參加會員專屬活動...",group:"第一組"},{phone:"0908111111",content:"邀請你參加會員專屬活動，點擊下方連結...",group:"第二組"},{phone:"0908111111",content:"邀請你參加會員專屬活動，點擊下方連結...",group:"第二組"}]})])]),jn,n("ul",In,[n("li",null,[l(" 請下載Excel範例並填寫後上傳 "),t(P,{status:"small3",class:"!px-0 !py-0 !text-sms-primary-blue-80"},{icon:s(()=>[t(D,{name:"download"})]),default:s(()=>[l(" SMS匯出範例 ")]),_:1}),t(P,{status:"small3",class:"!pl-2 !py-0 !text-sms-primary-blue-80"},{icon:s(()=>[t(D,{name:"download"})]),default:s(()=>[l(" MMS匯出範例 ")]),_:1})]),Dn,n("li",null,[l("訊息輸入內容中使用 "),t(D,{name:"link"}),l(" 插入參數（%field1% 至 %field5%），系統將自動替換為檔案中的欄位參數內容")]),Ln,n("li",null,[l(" 若上傳檔案的內容如下： "),t(m,{class:"!-ms-20px mb-4 max-w-none instruction-table2",columns:[{key:"phone",dataIndex:"phone",title:"接收門號",width:"104px"},{key:"field1",dataIndex:"field1",title:"參數1",width:"74px"},{key:"field2",dataIndex:"field2",title:"參數2",width:"74px"},{key:"field3",dataIndex:"field3",title:"參數3",width:"74px"},{key:"field4",dataIndex:"field4",title:"參數4",width:"74px"},{key:"field5",dataIndex:"field5",title:"參數5",width:"74px"}],"data-source":[{phone:"0922333111",field1:"珊珊",field2:"9412918",field3:"女",field4:"08/22",field5:"25"},{phone:"0946184761",field1:"馬克",field2:"5439577",field3:"男",field4:"08/29",field5:"17"}]},{headerCell:s(({column:k})=>[k.key!=="phone"?(p(),b(V,{key:0},[l(f(k.title)+" ",1),n("span",Un,"(%"+f(k.key)+"%)",1)],64)):(p(),b(V,{key:1},[l(f(k.title),1)],64))]),_:1})]),On,An])])]),_:1},8,["open"])}}}),Nn=n("span",{class:"pe-.5"},"活動名稱",-1),Bn=n("span",{class:"text-red-500 pe-2"},"*",-1),Vn={href:"javascript:;"},Yn=n("span",{class:"pe-.5"},"參數訊息類型",-1),Kn=n("span",{class:"text-red-500"},"*",-1),Hn=n("span",{class:"pe-.5"},"訊息主旨與上傳多媒體",-1),qn=n("span",{class:"text-red-500 pe-2"},"*",-1),Gn={href:"javascript:;"},zn={key:0,class:"text-red-500 ps-2"},Wn={class:"mb-2"},Xn=n("div",null,"訊息主旨",-1),Jn={key:0,class:"flex gap-2 overflow-y-auto h-95px my-2"},Qn={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},Zn=n("span",{class:"pe-.5"},"上傳參數檔案",-1),ea=n("span",{class:"text-red-500 pe-2"},"*",-1),ta={href:"javascript:;"},sa=n("br",null,null,-1),na={href:"javascript:;",class:"underline underline-offset-2 text-sms-primary-blue-80 text-sm line-height-14px py-1"},aa=n("span",{class:"pe-.5"},"預覽參數檔案",-1),oa=n("span",{class:"text-red-500"},"*",-1),la={key:0,class:"bg-sms-bg-light-mode-gray rounded-12px border border-solid border-sms-grayscale-40 flex flex-col justify-center items-center h-106px"},ia=n("span",{class:"text-sms-grayscale-60"},"請先上傳參數檔案",-1),ra={class:"text-xs"},ca={class:"flex gap-2 overflow-y-auto h-95px"},da={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},ua=n("span",{class:"pe-.5"},"發送時間",-1),pa=n("span",{class:"text-red-500 pe-2"},"*",-1),ma={href:"javascript:;"},fa=n("span",{class:"pe-.5"},"有效時間",-1),_a=n("span",{class:"text-red-500 pe-2"},"*",-1),xa={href:"javascript:;"},ga={key:0,id:"confirmDetail",class:"px-32px"},va={class:"mb-4"},ha=n("h2",{class:"font-500 text-22px text-sms-secondary-dark-blue-100"}," 內容確認 ",-1),ya={key:0,class:"text-sm text-sms-grayscale-80"},ba={key:1,class:"list-disc m-0 text-sm pl-20px"},wa=n("li",null,"若有使用縮網址功能，請在發送訊息前再次確認短網址有效性，平台不會檢驗短網址有效性",-1),ka={key:0},Ca={class:"border border-solid border-sms-light-gray-60 p-16px pb-24px rounded-12px mb-2"},Ma=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 活動名稱 ",-1),Ta={class:"text-base font-400 text-sms-grayscale-100"},Sa=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送時間 ",-1),$a={key:0,class:"text-base font-400 text-sms-grayscale-100"},Ra=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息類型 ",-1),Fa={class:"text-base font-400 text-sms-grayscale-100"},Pa=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送門號 ",-1),ja={class:"text-base font-400 text-sms-grayscale-100"},Ia=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息總數 (長訊息) ",-1),Da={class:"text-base font-400 text-sms-grayscale-100"},La={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},Ua={href:"javascript:;"},Oa={class:"text-base font-400 text-sms-grayscale-100"},Aa=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),Ea=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 單價 ",-1),Na={class:"text-base font-400 text-sms-grayscale-100"},Ba={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},Va={href:"javascript:;"},Ya={class:"text-base font-400 text-sms-grayscale-100"},Ka=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),Ha={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},qa={href:"javascript:;"},Ga={class:"text-base font-400 text-sms-grayscale-100"},za=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),Wa={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},Xa={href:"javascript:;"},Ja=n("br",null,null,-1),Qa={class:"text-base font-400 text-sms-grayscale-100"},Za={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},eo={href:"javascript:;"},to=n("div",{class:"text-center px-24px py-20px w-328px text-base mx-auto"},[l(" 您編輯過的訊息內容將全部清空 "),n("br"),n("br"),n("p",{class:"mb-0"}," 提醒您，您已上傳的檔案也會全部清除 ")],-1),so={class:"text-center px-30px py-20px w-328px text-base mx-auto"},no={class:"text-base text-center text-sms-gary-80"},ao=["href"];var ns=(E=>(E.smsDiffContent="接收門號不同，且訊息內容不同 (SMS)",E.mmsDiffContent="接收門號不同，且訊息內容不同 (MMS)",E.smsCommonContent="接收門號不同，訊息內容可使用 5 個參數 (SMS)",E.mmsCommonContent="接收門號不同，訊息內容可使用 5 個參數 (MMS)",E))(ns||{});const wo=Le({__name:"create-or-update-form",props:{isCreate:{type:Boolean,default:!1},id:{},editCallback:{},showPreview:{type:Boolean,default:!0}},setup(E){const F=E;Q.extend(zt);const{setHideAlert:O,setShowAlert:z}=wt(),J=x(null),T=x(null),D=$t(),P=Pt(),m=nt(F,"isCreate"),L=nt(F,"id"),{replaceFieldToHtml:k}=es(),A=x(),{updateParameterMessageSending:fe,getParameterMessageSendingById:ie,createParameterMessageSending:_e,effectiveTimeOption:H,getActiveStatusLabel:xe,checkMessageSendingNameExist:ge,checkMessageSendingDetail:C,renderParameterMessagePreviewArray:S}=ts(),q=x(""),re=[{key:"第一組",subject:"",multimediaFile:[]},{key:"第二組",subject:"",multimediaFile:[]},{key:"第三組",subject:"",multimediaFile:[]}],U=x("smsDiffContent");let w={name:"",phone:void 0,isCommonContent:!1,messageType:"SMS",subject:"",multimediaFile:[],sendTimeType:"NOW",content:"",effectiveTime:"",reservationTime:"",multimediaFileWithSubject:tt(re),recipients:[]};const Me=[{label:"0935-111-111",value:"0935-111-111"},{label:"0947-127-998",value:"0947-127-998"},{label:"0958-892-006",value:"0958-892-006"}],se=x(!1),i=De(tt(w)),c=Ce(()=>i.messageType==="SMS"?335:1e3),Te=De({name:[{async validator(d,o){return M(o)?Promise.reject("請輸入活動名稱"):await ge(o,L.value)?Promise.reject("此活動名稱已存在，請重新命名 "):Promise.resolve()},trigger:"blur"}],phone:[{required:!0,message:"請選擇發送門號",trigger:"blur"}],subject:[{async validator(d,o){return i.messageType==="MMS"&&i.isCommonContent&&M(o)?Promise.reject("請輸入訊息主旨"):Promise.resolve()},trigger:"blur"}],file:[{async validator(d,o){return ht(o)||Ut(o)?Promise.reject("請上傳參數檔案"):Promise.resolve()},trigger:"blur"}],content:[{async validator(d,o){var a;if(i.isCommonContent){if(M(o))return Promise.reject("請輸入訊息內容");if(!M(o)&&((a=i.content)==null?void 0:a.replace(je,"").length)>c.value)return Promise.reject(`限制輸入 ${c.value} 字以內`)}return Promise.resolve()},trigger:"blur"}],reservationTime:[{async validator(d,o){if(i.sendTimeType==="RESERVATION"){if(M(o))return Promise.reject("請選擇預約日期或現在發送");if(Q().diff(Q(o),"minute")>0)return Promise.reject("閒置過久，請重新選擇預約時間")}return Promise.resolve()},trigger:"blur"}],multimediaFileWithSubject:[{async validator(d,o){if(U.value==="mmsDiffContent"){if(M(o))return Promise.reject("MMS 參數訊息請至少上傳一組訊息主旨與多媒體");if(o.filter(u=>M(u.multimediaFile)&&M(u.subject)).length===3)return Promise.reject("MMS 參數訊息請至少上傳一組訊息主旨與多媒體")}return Promise.resolve()},trigger:"blur"}]}),{validateInfos:Z,validate:ne,resetFields:lt}=Ot(i,Te);jt(async()=>{var d,o,a,u,v,j,_,y;if(q.value=Q().format("YYYY/MM/DD_HH:mm"),!m.value&&L.value){const K=await ie(L.value);K.data&&(A.value=K.data,w={name:((d=A.value)==null?void 0:d.name)??e(q),phone:((o=A.value)==null?void 0:o.phone)??void 0,isCommonContent:((a=A.value)==null?void 0:a.isCommonContent)??!1,messageType:((u=A.value)==null?void 0:u.messageType)??"SMS",subject:((v=A.value)==null?void 0:v.subject)??"",multimediaFile:((j=A.value)==null?void 0:j.multimediaFile)??[],sendTimeType:((_=A.value)==null?void 0:_.sendTimeType)??"NOW",content:A.value.content??"",effectiveTime:A.value.effectiveTime??"",reservationTime:A.value.reservationTime??"",recipients:A.value.recipients??[],multimediaFileWithSubject:((y=A.value)==null?void 0:y.multimediaFileWithSubject)??[],file:A.value.file??void 0}),w.messageType==="MMS"?w.isCommonContent?U.value="mmsCommonContent":U.value="mmsDiffContent":w.isCommonContent?U.value="smsCommonContent":U.value="smsDiffContent"}else w.name=e(q),w.file=void 0;lt(w)}),It(()=>i,d=>{const o=at(d,w);m.value&&!L.value&&(o?O():z())},{deep:!0});const $=x(null);function I(){ne().then(async()=>{const d=await C(i,!0);if(d.data){$.value=d.data,se.value=!0,await _t();const o=document.getElementById("app");o&&(o.scrollTop=0)}}).catch(d=>{console.log(d)})}async function it(){var a;((a=(await(e(m)?_e:fe)(i,L.value)).data)==null?void 0:a.status)==="success"&&(m.value&&!L.value?O():(F.editCallback&&F.editCallback(!0,L.value),D.success({message:"訊息編輯成功",placement:"top"}),F.editCallback||P.push("/sms-marketing/appointment")))}const He=x(null);function Oe(d){i.content=k(d)}const Ae=x(null);function rt(d){for(const o of d)i.content=`${i.content}<span>${o}</span>`}const qe=x(null);function Ge(d){i.content=`${i.content}<a href="${d}">${d}</a>`}const ze=x(null),We=Ce(()=>S(i)),Ee=x(null),Ne=x(null);function Xe(d,o=null){var a;(a=Ne.value)==null||a.show(d),Ee.value=o}function Je(d){ht(Ee.value)?i.multimediaFile=d:i.multimediaFileWithSubject[Ee.value].multimediaFile=d}const Be=x(null);function ve(d){i.multimediaFile=i.multimediaFile.filter(o=>o.url!==d.url)}function ct(d,o){i.multimediaFileWithSubject[d].multimediaFile=i.multimediaFileWithSubject[d].multimediaFile.filter(a=>a.url!==o.url)}const Ve=Q();function Qe(d){const o=Ve.add(1,"year");return d&&(d<Ve||d>=o)}function Ze(d){if(d&&d.isToday()){const o=Q().add(5,"minute"),a=o.hour(),u=o.minute();return{disabledHours:()=>ot(0,24).slice(0,a),disabledMinutes:()=>ot(0,60).slice(0,u)}}return{}}function he(){const d=at(i,w);F.editCallback&&F.editCallback(d)}function Se(){m.value&&!L.value?P.push("/sms-marketing/message-sending"):he()}const ce=x({open:!1,parameterMessageType:"smsCommonContent"});function dt(d){const o=i.multimediaFileWithSubject.filter(a=>!M(a.multimediaFile)||!M(a.subject));i.file||!M(i.recipients)||!M(i.content)||!M(i.subject)||!M(i.multimediaFile)||!M(o)?ce.value={open:!0,parameterMessageType:d.target.value}:et(d.target.value)}function et(d){switch(U.value=d,e(d)){case"smsCommonContent":i.messageType="SMS",i.isCommonContent=!0;break;case"mmsCommonContent":i.messageType="MMS",i.isCommonContent=!0;break;case"mmsDiffContent":i.messageType="MMS",i.isCommonContent=!1;break;default:i.messageType="SMS",i.isCommonContent=!1;break}i.file&&(i.file=void 0),ce.value.open&&(ce.value.open=!1,i.content="",i.subject="",i.recipients=[],i.multimediaFile=[],i.multimediaFileWithSubject=tt(re))}const ye=x({open:!1,url:""}),$e=x(null);function ut(d){const a=d.target.files;if(a&&a.length>0&&$e.value){switch(e(U)){case"smsDiffContent":i.recipients=[{number:"1",phone:"0937118365",content:"親愛的黃先生您好，邀請您參加季末促銷活動！在這個特別的時刻"},{number:"2",phone:"0934837779",content:"親愛的邱會員，感謝您一直以來對我們的支持！為了回饋您的"},{number:"3",phone:"0973789398",content:"哈囉！您的專屬會員優惠已經準備就緒，等待您的立即領取！"},{number:"4",phone:"0911848298",content:"黃金會員專屬優惠啟動！您的獨享超級禮遇即將開始，千萬別"},{number:"5",phone:"0948393711",content:"親愛的會員，您是我們最珍貴的財富！為了感謝您長久以來的"}];break;case"mmsDiffContent":i.recipients=[{number:"1",phone:"0937118365",content:"親愛的黃先生您好，邀請您參加季末促銷活動！在這個特別的時刻",group:"第二組"},{number:"2",phone:"0934837779",content:"親愛的邱會員，感謝您一直以來對我們的支持！為了回饋您的",group:"第二組"},{number:"3",phone:"0973789398",content:"哈囉！您的專屬會員優惠已經準備就緒，等待您的立即領取！",group:"第二組"},{number:"4",phone:"0911848298",content:"黃金會員專屬優惠啟動！您的獨享超級禮遇即將開始，千萬別",group:"第一組"},{number:"5",phone:"0948393711",content:"親愛的會員，您是我們最珍貴的財富！為了感謝您長久以來的",group:"第一組"}];break;case"smsCommonContent":case"mmsCommonContent":i.recipients=[{number:"1",phone:"0938118293",field1:"小馬",field2:"9412918",field3:"-",field4:"-",field5:"-"},{number:"2",phone:"0946184761",field1:"安潔",field2:"5439577",field3:"-",field4:"-",field5:"-"},{number:"3",phone:"0966092938",field1:"Lucy",field2:"5634840",field3:"-",field4:"-",field5:"-"},{number:"4",phone:"0956482371",field1:"Sam",field2:"3437402",field3:"-",field4:"-",field5:"-"},{number:"5",phone:"0978049940",field1:"Tim",field2:"8480277",field3:"-",field4:"-",field5:"-"}];break}i.file={fileName:a[0].name,url:window.URL.createObjectURL(a[0])},$e.value.value=""}}const pt=Ce(()=>{let d=[];switch(e(U)){case"mmsDiffContent":d=[{title:"編號",key:"number",dataIndex:"number",width:"57px",align:"center"},{title:"接收門號",key:"phone",dataIndex:"phone",width:"100px"},{title:"訊息內容",key:"content",dataIndex:"content",width:"278.5px",ellipsis:!0},{title:"對應組別",key:"group",dataIndex:"group",width:"107.5px"}];break;case"smsDiffContent":d=[{title:"編號",key:"number",dataIndex:"number",width:"57px",align:"center"},{title:"接收門號",key:"phone",dataIndex:"phone",width:"100px"},{title:"訊息內容",key:"content",dataIndex:"content",width:"278.5px",ellipsis:!0}];break;case"smsCommonContent":case"mmsCommonContent":d=[{title:"編號",key:"number",dataIndex:"number",width:"57px",align:"center"},{title:"接收門號",key:"phone",dataIndex:"phone",width:"100px"},{key:"field1",dataIndex:"field1",title:"參數1",width:"74px"},{key:"field2",dataIndex:"field2",title:"參數2",width:"74px"},{key:"field3",dataIndex:"field3",title:"參數3",width:"74px"},{key:"field4",dataIndex:"field4",title:"參數4",width:"74px"},{key:"field5",dataIndex:"field5",title:"參數5",width:"74px"}];break;default:d=[];break}return d}),mt=Rt();function Ye(){mt.confirm({title:"是否取消上傳檔案？",icon:t("span"),content:Lt("div",{innerHTML:"該檔案將取消上傳",class:"text-center px-30px py-20px w-328px text-base mx-auto"}),width:"400px",centered:!0,closable:!0,async onOk(){i.file=void 0,i.recipients=[]}})}function ft(d){var a;const o=[];if(M(d.subject)||o.push({phone:"",content:"",subject:d.subject,messageType:"SENT",contentType:"text"}),!M(d.multimediaFile))for(const u of d.multimediaFile)o.push({phone:"",content:u.url,messageType:"SENT",contentType:u.type});(a=J.value)==null||a.show(o)}return(d,o)=>{const a=st,u=At,v=Et,j=Nt,_=Bt,y=Vt,K=ds,Y=Yt,ae=Kt,W=xt,be=yt,de=st,we=Xt,Re=St,Fe=Ht,ue=qt,pe=Gt,Pe=bt,ke=Ue,oe=ms;return p(),b(V,null,[t(ue,{class:le(["bg-sms-grayscale-0 rounded-4",{"p-10 pl-1":d.showPreview}]),wrap:!1},{default:s(()=>[t(_,{flex:"auto"},{default:s(()=>[ee(t(pe,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:I},{default:s(()=>[t(ue,{gutter:[16,14]},{default:s(()=>[t(_,{span:24},{default:s(()=>[t(j,G(e(Z).name,{"html-for":""}),{label:s(()=>[Nn,Bn,t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 活動名稱可使用系統預設或自行輸入，但不可重複 ")]),default:s(()=>[n("a",Vn,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(v,{value:e(i).name,"onUpdate:value":o[0]||(o[0]=r=>e(i).name=r),placeholder:"請輸入文字",maxlength:30,onFocus:o[1]||(o[1]=()=>{e(i).name===e(q)&&(e(i).name="")}),onBlur:o[2]||(o[2]=()=>{e(i).name===""&&(e(i).name=e(q))})},null,8,["value"])]),_:1},16)]),_:1}),t(_,{span:24},{default:s(()=>[t(j,G(e(Z).phone,{label:"發送門號",required:""}),{default:s(()=>[t(y,{value:e(i).phone,"onUpdate:value":o[3]||(o[3]=r=>e(i).phone=r),options:Me,"allow-clear":"",placeholder:"請選擇發送門號"},null,8,["value"])]),_:1},16)]),_:1}),t(_,{span:24},{default:s(()=>[t(j,{"html-for":""},{label:s(()=>[Yn,Kn,t(K,{type:"link",status:"small3",onClick:o[4]||(o[4]=r=>{var h;return(h=e(T))==null?void 0:h.show()})},{icon:s(()=>[t(a,{name:"doc",width:"16px"})]),default:s(()=>[l(" 操作說明 ")]),_:1})]),default:s(()=>[t(ae,{value:e(U),onChange:dt},{default:s(()=>[(p(!0),b(V,null,me(Object.entries(ns),([r,h])=>(p(),B(Y,{key:r,style:{display:"flex",alignItems:"center",marginBottom:"10.5px"},value:r},{default:s(()=>[l(f(h)+" ",1),t(K,{type:"link",class:"!py-4px !px-0"},{icon:s(()=>[t(a,{name:"download"})]),default:s(()=>[l(" 匯出範例 ")]),_:1})]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),!e(i).isCommonContent&&e(i).messageType==="MMS"?(p(),B(_,{key:0,span:24},{default:s(()=>[t(j,{"html-for":""},{label:s(()=>{var r;return[Hn,qn,t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 多上傳三組多媒體檔案，並請依匯出範例欄位填入對應多媒體組別 ")]),default:s(()=>[n("a",Gn,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"]),e(Z).multimediaFileWithSubject.validateStatus==="error"?(p(),b("span",zn,f((r=e(Z).multimediaFileWithSubject)==null?void 0:r.help.join(" ")),1)):X("",!0)]}),default:s(()=>[(p(!0),b(V,null,me(e(i).multimediaFileWithSubject,(r,h)=>(p(),B(_,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-20px mb-2",key:r.key},{default:s(()=>[n("div",Wn,[l(f(r.key)+" ",1),t(W,{class:"text-sms-primary-blue-80 !px-0",status:"small3",onClick:g=>ft(r)},{icon:s(()=>[t(a,{name:"preview-blue",width:"16px"})]),_:2},1032,["onClick"])]),t(j,{"html-for":"",name:["multimediaFileWithSubject",h,"subject"],extra:"15 字以內"},{label:s(()=>[Xn]),default:s(()=>[t(v,{value:r.subject,"onUpdate:value":g=>r.subject=g,placeholder:"請輸入訊息主旨",maxlength:15},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),r.multimediaFile.length>0?(p(),b("div",Jn,[(p(!0),b(V,null,me(r.multimediaFile,g=>(p(),b("div",{key:g.url,class:"w-90px max-h-60px"},[t(be,{source:{url:g.url,type:g.type},"show-file-name":!1,"can-play":!1,size:"small","image-class":"object-cover w-full h-full",onDeleteVideo:()=>{var R;return(R=e(Be))==null?void 0:R.show(()=>ct(h,g))}},null,8,["source","onDeleteVideo"]),n("div",Qn,f(g.fileName),1)]))),128))])):X("",!0),t(W,{status:"small2",onClick:g=>Xe(r.multimediaFile,h)},{icon:s(()=>[t(a,{name:"upload"})]),default:s(()=>[l(" 上傳多媒體 ")]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})):X("",!0),t(_,{span:24},{default:s(()=>[t(j,G({"html-for":""},e(Z).file),{label:s(()=>[Zn,ea,t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 1.每則訊息字數(含參數)不能超過限制。SMS 上限 335 字，MMS 上限1,000 字。"),sa,l(" 2.每個參數欄位上限 50 字 ")]),default:s(()=>[n("a",ta,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[n("input",{ref_key:"uploadFileRef",ref:$e,type:"file",class:"!hidden",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:ut},null,544),e(i).file?(p(),b(V,{key:1},[n("a",na,f(e(i).file.fileName),1),t(a,{name:"download-circle",width:"16px",class:"mx-2 cursor-pointer"}),t(a,{name:"delete-circle",width:"16px",class:"cursor-pointer",onClick:Ye})],64)):(p(),B(W,{key:0,status:"small2",onClick:o[5]||(o[5]=r=>{var h;return(h=e($e))==null?void 0:h.click()})},{icon:s(()=>[t(de,{name:"upload"})]),default:s(()=>[l(" 上傳EXCEL ")]),_:1}))]),_:1},16)]),_:1}),t(_,{span:24},{default:s(()=>[t(j,{"html-for":""},{label:s(()=>[aa,oa]),default:s(()=>[e(i).file?(p(),B(we,{key:1,columns:e(pt),"data-source":e(i).recipients},{headerCell:s(({column:r})=>[r.key.includes("field")?(p(),b(V,{key:0},[l(f(r.title)+" ",1),n("span",ra,"(%"+f(r.key)+"%)",1)],64)):(p(),b(V,{key:1},[l(f(r.title),1)],64))]),_:1},8,["columns","data-source"])):(p(),b("div",la,[t(de,{name:"upload-circle-2",width:"40px",class:"text-sms-grayscale-40 mb-2"}),ia]))]),_:1})]),_:1}),ee(t(_,{span:24},{default:s(()=>[t(j,G({label:"訊息主旨"},e(Z).subject,{extra:"15 字以內"}),{default:s(()=>[t(v,{value:e(i).subject,"onUpdate:value":o[6]||(o[6]=r=>e(i).subject=r),placeholder:"請輸入訊息主旨",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[te,e(i).messageType==="MMS"&&e(i).isCommonContent]]),ee(t(_,{span:24},{default:s(()=>{var r;return[t(j,G({"html-for":"",label:"訊息內容"},e(Z).content,{class:"relative",extra:`${e(i).messageType} 上限 ${e(c).toLocaleString()} 字，目前 ${e(M)(e(i).content)?"--":(r=e(i).content)==null?void 0:r.replace(e(je),"").length} 字`}),{default:s(()=>{var h;return[t(Re,{modelValue:e(i).content,"onUpdate:modelValue":o[12]||(o[12]=g=>e(i).content=g),contenteditable:"true",style:{height:"292px"},"content-len":(h=e(i).content)==null?void 0:h.replace(e(je),"").length,"max-len":e(c),placeholder:"請輸入文字"},Dt({default:s(()=>[t(u,null,{title:s(()=>[l(" 載入現有的自訂訊息 ")]),default:s(()=>[t(a,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[7]||(o[7]=g=>{var R;return(R=e(He))==null?void 0:R.show()})})]),_:1}),t(u,null,{title:s(()=>[l(" 加入參數 ")]),default:s(()=>[t(a,{name:"code",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[8]||(o[8]=g=>{var R;return(R=e(Ae))==null?void 0:R.show()})})]),_:1}),t(u,null,{title:s(()=>[l(" 增加縮網址 ")]),default:s(()=>[t(a,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[9]||(o[9]=g=>{var R;return(R=e(qe))==null?void 0:R.show()})})]),_:1}),t(u,null,{title:s(()=>[l(" 多媒體附件上傳 ")]),default:s(()=>[ee(t(a,{name:"cloud-upload",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[10]||(o[10]=g=>Xe(e(i).multimediaFile))},null,512),[[te,e(i).messageType==="MMS"]])]),_:1}),t(u,null,{title:s(()=>[l(" AI 文字生成訊息 ")]),default:s(()=>[t(a,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[11]||(o[11]=g=>{var R;return(R=e(ze))==null?void 0:R.show()})})]),_:1})]),_:2},[e(i).multimediaFile.length>0?{name:"multimediaBlock",fn:s(()=>[n("div",ca,[(p(!0),b(V,null,me(e(i).multimediaFile,g=>(p(),b("div",{key:g.url,class:"w-90px max-h-60px"},[t(be,{source:{url:g.url,type:g.type},"show-file-name":!1,"can-play":!1,size:"small","image-class":"object-cover w-full h-full",onDeleteVideo:R=>{var Ke;return(Ke=e(Be))==null?void 0:Ke.show(()=>ve(g))}},null,8,["source","onDeleteVideo"]),n("div",da,f(g.fileName),1)]))),128))])]),key:"0"}:void 0]),1032,["modelValue","content-len","max-len"])]}),_:1},16,["extra"])]}),_:1},512),[[te,e(i).isCommonContent]]),t(_,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-20px"},{default:s(()=>[t(j,G(e(Z).reservationTime,{"html-for":"",class:"mb-4"}),{label:s(()=>[ua,pa,t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 最快可預約5分鐘之後以及系統當下 1 年內時間，惟實際發送時間以系統排程為主 ")]),default:s(()=>[n("a",ma,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(ae,{value:e(i).sendTimeType,"onUpdate:value":o[13]||(o[13]=r=>e(i).sendTimeType=r)},{default:s(()=>[(p(!0),b(V,null,me(Object.entries(e(gt)),([r,h])=>(p(),B(Y,{key:r,value:r},{default:s(()=>[l(f(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),ee(t(Fe,{value:e(i).reservationTime,"onUpdate:value":o[14]||(o[14]=r=>e(i).reservationTime=r),format:"YYYY/MM/DD HH:mm","value-format":"YYYY/MM/DD HH:mm","disabled-date":Qe,"disabled-time":Ze,"show-time":!0,"show-now":!1},null,8,["value"]),[[te,e(i).sendTimeType==="RESERVATION"]])]),_:1},16),t(j,G(e(Z).sendTimeType,{"html-for":""}),{label:s(()=>[fa,_a,t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 因接收門號而無法成功送達訊息，會在此設定有效時間內重複嘗試發送 ")]),default:s(()=>[n("a",xa,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(y,{value:e(i).effectiveTime,"onUpdate:value":o[15]||(o[15]=r=>e(i).effectiveTime=r),options:e(H),"list-height":300,placeholder:"請選擇有效時間"},null,8,["value","options"])]),_:1},16)]),_:1}),t(_,{span:24,class:le({"text-end":e(m)&&!e(L),"text-center py-6 ":!e(m)&&e(L)})},{default:s(()=>[t(W,{status:"small2",class:"me-2",onClick:Se},{default:s(()=>[l(" 取消 ")]),_:1}),t(W,{status:"small1","html-type":"submit"},{default:s(()=>[l(" 確定 ")]),_:1})]),_:1},8,["class"])]),_:1})]),_:1},512),[[te,!e(se)]]),e(se)&&e($)?(p(),b("div",ga,[n("div",va,[ha,e($).isParameter?(p(),b("ul",ba,[wa,e($).messageType==="SMS"?(p(),b("li",ka," 當參數檔案中的欄位字數不一致時，每個參數都會單獨計算字數。若任何一個參數訊息超過70字，將會以長簡訊方式發送。")):X("",!0)])):(p(),b("p",ya," 若有使用縮網址功能，請在發送訊息前再次確認短網址有效性，平台不會檢驗短網址有效性 "))]),n("div",Ca,[t(ue,{gutter:[16,16]},{default:s(()=>[t(_,{span:24,class:"mb-"},{default:s(()=>[Ma,n("div",Ta,f(e($).name),1)]),_:1}),t(_,{span:8},{default:s(()=>[Sa,e($).sendTimeType==="RESERVATION"?(p(),b("div",$a,f(e($).reservationTime),1)):(p(),b("div",{key:1,class:le(["text-base font-400 text-sms-grayscale-100",{"text-sms-status-alert-red":Math.sign(e($).estimatedRemainingAmount)===-1}])}," 現在 ",2))]),_:1}),t(_,{span:8},{default:s(()=>[Ra,n("div",Fa,f(e(xe)(e($).messageType,e($).isParameter)),1)]),_:1}),t(_,{span:8},{default:s(()=>[Pa,n("div",ja,f(e($).phone),1)]),_:1}),e($).messageType==="SMS"&&!e($).isParameter?(p(),B(_,{key:0,span:8},{default:s(()=>[Ia,n("div",Da,f(e($).totalLongMessages),1)]),_:1})):X("",!0),e($).messageType==="SMS"&&e($).isParameter?(p(),B(_,{key:1,span:8},{default:s(()=>[n("div",La,[l(" 預估訊息總數 "),t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 參數訊息類型一的字數以「一則訊息」估算。參數訊息類型二以「訊息內容字數進行估算(不含參數字數)」，惟實際發送時依參數檔案欄位字數計算 ")]),default:s(()=>[n("a",Ua,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",Oa,[l(f(e($).estimatedTotalMessages)+" ",1),Aa])]),_:1})):X("",!0),t(_,{span:8},{default:s(()=>[Ea,n("div",Na," NT$ "+f(e($).price),1)]),_:1}),t(_,{span:8},{default:s(()=>[n("div",Ba,[l(" 接收門號總數 "),t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 未過濾所有黑名單，發送時會再檢核，最終接收門號數量可能變動 ")]),default:s(()=>[n("a",Va,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",Ya,[l(f(e($).recipientsCount.toLocaleString())+" ",1),Ka])]),_:1}),t(_,{span:8},{default:s(()=>[n("div",Ha,[l(" 黑名單門號總數 "),t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 目前已篩選掉該黑名單數量，發送時會再檢核最新黑名單，最終黑名單門號總數可能變動 ")]),default:s(()=>[n("a",qa,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",Ga,[l(f(e($).isBlackListCount.toLocaleString())+" ",1),za])]),_:1}),t(_,{span:8},{default:s(()=>[n("div",Wa,[l(" 預估發送總金額 "),t(u,{placement:"top","get-popup-container":e(N),"overlay-inner-style":{width:"397px"}},{title:s(()=>[l(" 發送總金額 = 訊息總數 x ( 接收門號總數 - 黑名單門號總數 ) x 單價"),Ja,l(" 參數訊息之訊息總數以一則計算，實際計價以發送字數等於幾則來計價 ")]),default:s(()=>[n("a",Xa,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",Qa," NT$ "+f(e($).estimatedTotalAmount.toLocaleString()),1)]),_:1}),t(_,{span:8},{default:s(()=>[n("div",Za,[l(" 預估剩餘金額 "),t(u,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 餘額不足仍可預約，請注意於預約時間前進行儲值才可成功發送訊息 ")]),default:s(()=>[n("a",eo,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",{class:le(["text-base font-400 text-sms-grayscale-100",{"text-sms-status-alert-red":Math.sign(e($).estimatedRemainingAmount)===-1}])}," NT$ "+f(e($).estimatedRemainingAmount.toLocaleString()),3)]),_:1})]),_:1})]),n("div",{class:le(["flex items-center justify-end",{"py-4":!e(m)&&e(L)}])},[ee(n("div",{class:"text-sms-status-alert-red text-base me-4"},f(e($).sendTimeType==="RESERVATION"?"可預約，請於發送時間之前儲值完畢，以免發送失敗":"剩餘金額不足，建議回上一步改成預約發送後再盡快儲值"),513),[[te,Math.sign(e($).estimatedRemainingAmount)===-1]]),t(W,{status:"small2",class:"me-2",onClick:o[16]||(o[16]=()=>{se.value=!1,$.value=null})},{default:s(()=>[l(" 上一步 ")]),_:1}),t(W,{onClick:it},{default:s(()=>[l(" 確定 ")]),_:1})],2)])):X("",!0)]),_:1}),d.showPreview?(p(),B(_,{key:0,flex:"428px",class:"relative"},{default:s(()=>[t(Pe,{message:e(We)},null,8,["message"])]),_:1})):X("",!0)]),_:1},8,["class"]),t(kt,{ref_key:"importCustomMessageRef",ref:He,content:e(i).content,onUpdateContent:Oe},null,8,["content"]),t(Ct,{ref_key:"addFieldRef",ref:Ae,onAddFieldToContent:rt},null,512),t(Mt,{ref_key:"addLinkRef",ref:qe,onAddLinkToContent:Ge},null,512),t(Tt,{ref_key:"aiTextGenerationRef",ref:ze,content:e(i).content,onUpdateContent:Oe},null,8,["content"]),t(Wt,{ref_key:"multimediaUploadRef",ref:Ne,onUpdateMultimediaFile:Je},null,512),t(ss,{ref_key:"delMultimediaFileRef",ref:Be},null,512),t(ke,{open:e(ce).open,"onUpdate:open":o[17]||(o[17]=r=>e(ce).open=r),title:"是否放棄目前編輯的訊息內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onOk:o[18]||(o[18]=r=>et(e(ce).parameterMessageType))},{default:s(()=>[to]),_:1},8,["open"]),t(ke,{open:e(ye).open,"onUpdate:open":o[20]||(o[20]=r=>e(ye).open=r),title:"資料格式有誤，請重新確認上傳",width:"400px",centered:""},{footer:s(()=>[t(W,{onClick:o[19]||(o[19]=r=>e(ye).open=!1)},{default:s(()=>[l(" 確定 ")]),_:1})]),default:s(()=>[n("div",so,[n("p",no,[l(" 正確的格式範例 "),n("a",{class:"text-sms-primary-blue-80 ms-1 underline underline-offset-2",href:e(ye).url,download:""},"點擊此處下載",8,ao)])])]),_:1},8,["open"]),t(En,{ref_key:"instructionsModalRef",ref:T},null,512),t(oe,{ref_key:"previewGroupMultimediaRef",ref:J},null,512)],64)}}});export{bo as _,wo as a};

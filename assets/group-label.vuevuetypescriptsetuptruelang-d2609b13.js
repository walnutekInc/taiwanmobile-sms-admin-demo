import{F as xe,_ as we}from"./request-3552e6c3.js";import{_ as he}from"./index-4b80b22a.js";import{g as Ce,_ as Te,b as Le}from"./index.vuevuetypescriptsetuptruelang-8068f11a.js";import{_ as Z}from"./index.vuevuetypescriptsetuptruelang-374ce0ee.js";import{k as ee,_ as Re}from"./index-b55f1cdf.js";import{d as te,r as $,f as g,W as p,_ as z,$ as s,k as t,ab as Fe,u as e,H as ae,D as Ie,o as Ye,a0 as De,X as k,G as m,E as Se,a4 as M,Y as v,a3 as x,F as A,m as Me,A as $e}from"./vue-b9a22f97.js";import{u as se}from"./group-label-31b72c82.js";import{H as oe,E as H,J as Oe,I as ne,q as Ke,r as le,u as re,F as ie,G as ue,s as Pe,U as Ue,P as Ve}from"./antd-16a0cd46.js";const Ge=te({__name:"group-label-create",props:{saveCallbck:{type:Function,required:!0}},setup(J,{expose:O}){const w=ee(),{checkGroupLabelExist:K,createGroupLabel:P}=se(),U=J,C={name:""},b=$(oe(C)),T=$({name:[{validator:async function(n,c){if(H(c))return Promise.reject("請輸入群組標籤");const _=await K(c);return console.log(_),_?Promise.reject(`系統中已有「${c}」，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:i,resetFields:L,validate:V}=Oe(b,T),u=g(!1),G=async()=>{L(C),u.value=!0},R=()=>{V().then(async()=>{var c;((c=(await P(b.name)).data)==null?void 0:c.status)==="success"&&(w.success({message:"群組標籤新增成功",placement:"top"}),U.saveCallbck(),u.value=!1)})};return O({show:G}),(n,c)=>{const _=ne,E=Ke,F=le,j=Z,h=re,N=ie,I=ue;return p(),z(I,{open:e(u),"onUpdate:open":c[1]||(c[1]=f=>ae(u)?u.value=f:null),title:"新增群組標籤",centered:"",width:"440px",cancelText:"取消",okText:"確定",onOk:R},{default:s(()=>[t(N,{ref:"formRef",class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:R},{default:s(()=>[t(h,{gutter:[16,0]},{default:s(()=>[t(F,{span:24},{default:s(()=>[t(E,Fe({label:"群組標籤名稱"},e(i).name,{required:"",extra:"15字以內"}),{default:s(()=>[t(_,{value:e(b).name,"onUpdate:value":c[0]||(c[0]=f=>e(b).name=f),placeholder:"請輸入群組標籤名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),t(j,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512)]),_:1},8,["open"])}}}),Ee={class:"flex justify-between px-2 items-center mb-2"},je={class:"me-1"},Ne={href:"javascript:;"},Be=v("span",null,"全域黑名單功能: 主帳號將特定手機門號加入黑名單，主帳號和子帳號皆無法發送該門號任何訊息",-1),qe={key:1},Ae={key:1},ze={key:0},He={class:"editable-cell-wrapper"},Je={class:"text-sms-status-alert-red text-xs"},We={key:1,class:"editable-cell-wrapper"},Xe=v("div",{class:"text-center px-24px py-20px w-376px text-base mx-auto"},[m(" 您選擇的群組標籤將永久刪除。"),v("br"),m(" 屬於該群組標籤的聯絡人，若沒有隸屬於其他群組標籤，將貼上「未分類」標籤。 ")],-1),lt=te({__name:"group-label",setup(J){const{getGroupLabels:O,groupLabels:w,pagination:K,updateGroupLabel:P,deleteGroupLabel:U,checkGroupLabelExist:C,getGroupLabelOption:b,groupOptions:T}=se(),i=$({}),L=g(!1);Ie(async()=>{_(),b()}),Ye(()=>{L.value=!0});const V=[{title:"群組標籤名稱",dataIndex:"name",key:"name",sorter:!0,width:"180px"},{title:"門號數量",dataIndex:"phoneCount",key:"phoneCount",sorter:!0,width:"140px",align:"right"},{title:"黑名單數量",dataIndex:"blackListCount",key:"blackListCount",sorter:!0,width:"151px",align:"right"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"160px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0}],u=$({selectedRowKeys:[],selectedRows:[],loading:!1}),G=(o,a)=>{console.log("selectedRowKeys changed: ",o,a),u.selectedRowKeys=o,u.selectedRows=a},R=o=>({disabled:o.key==0}),n=g({sortField:"createTime",sortOrder:"descend",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:"",keys:[]}),c=g(),_=async(o=1,a=10)=>{let d={current:o,pageSize:a,...e(n)};await O(d)},E=o=>{i[o]={...oe(w.value.filter(a=>o===a.key)[0]),msg:""}},F=async o=>{var y;const a=i[o];if(H(a.name)){i[o].msg="請輸入群組標籤";return}await C(a.name,a.key)?i[o].msg=`系統中已有「${i[o].name}」，請勿重複新增`:((y=(await P(a.key,a.name)).data)==null?void 0:y.status)==="success"&&(Object.assign(w.value.filter(B=>o===B.key)[0],a),delete i[o],I.success({message:"群組標籤編輯成功",placement:"top"}))},j=async(o,a,d)=>{console.log("pagination:",o,"sorter:",d),n.value=Object.assign(n.value,{sortField:d.field,sortOrder:d.order}),await _(o.current,o.pageSize)},h=g(null),N=()=>{var o;_(1),(o=h.value)==null||o.hide()},I=ee(),f=g(!1),ce=()=>{f.value=!0},de=async()=>{var a;((a=(await U(u.selectedRowKeys)).data)==null?void 0:a.status)==="success"&&(I.success({message:"群組標籤刪除成功",placement:"top"}),f.value=!1,u.selectedRowKeys=[],u.selectedRows=[])},pe=()=>document.body,W=g(null);return(o,a)=>{const d=Re,y=Z,X=Te,B=Le,me=Pe,q=he,Y=le,Q=Ue,_e=re,fe=ie,ve=Ve,ye=De("RouterLink"),ke=ne,ge=we,be=ue;return p(),k(A,null,[e(L)?(p(),z(Se,{key:0,to:"#extraContent"},[t(y,{status:"small1",onClick:a[0]||(a[0]=l=>{var r;return(r=e(W))==null?void 0:r.show()})},{icon:s(()=>[t(d,{name:"plus",width:"16px"})]),default:s(()=>[m("新增群組標籤 ")]),_:1})])):M("",!0),v("div",Ee,[v("div",null,[t(y,{status:"small2",class:"me-2",disabled:e(u).selectedRowKeys.length===0},{icon:s(()=>[t(d,{name:"download",width:"16px"})]),default:s(()=>[m("匯出CSV ")]),_:1},8,["disabled"]),t(y,{status:"small2",class:"me-2",onClick:ce,disabled:e(u).selectedRowKeys.length===0},{icon:s(()=>[t(d,{name:"delete",width:"16px"})]),default:s(()=>[m("刪除 ")]),_:1},8,["disabled"])]),t(xe,{ref_key:"filterKeywordInputRef",ref:h,class:"w-440px h-40px",modelValue:e(n).keyword,"onUpdate:modelValue":a[6]||(a[6]=l=>e(n).keyword=l),placeholder:"搜尋群組標籤名稱",onClearFilter:a[7]||(a[7]=()=>{n.value={...e(n),keyword:"",keys:[],createTime:[void 0,void 0],updateTime:[void 0,void 0]}})},{filterForm:s(()=>[t(fe,{ref_key:"formRef",ref:c,layout:"vertical",model:e(n),autocomplete:"off"},{default:s(()=>[t(_e,{gutter:[16,12]},{default:s(()=>[t(Y,{span:24},{default:s(()=>[t(q,{label:"群組標籤",valueed:e(Ce)(e(n).keys)},{default:s(()=>[t(me,{options:e(T),maxTagCount:2,showArrow:!0,showSearch:!1,mode:"multiple",value:e(n).keys,"onUpdate:value":a[2]||(a[2]=l=>e(n).keys=l),class:"w-full"},{dropdownRender:s(({menuNode:l})=>[t(X,{menu:l,modelValue:e(n).keys,"onUpdate:modelValue":a[1]||(a[1]=r=>e(n).keys=r),options:e(T)},null,8,["menu","modelValue","options"])]),option:s(({value:l,label:r})=>[t(B,{values:e(n).keys,value:l,label:r},null,8,["values","value","label"])]),menuItemSelectedIcon:s(()=>[m(x(""))]),_:1},8,["options","value"])]),_:1},8,["valueed"])]),_:1}),t(Y,{span:24},{default:s(()=>[t(q,{label:"建立時間",valueed:e(n).createTime},{default:s(()=>[t(Q,{class:"w-full",value:e(n).createTime,"onUpdate:value":a[3]||(a[3]=l=>e(n).createTime=l),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(Y,{span:24},{default:s(()=>[t(q,{label:"修改時間",valueed:e(n).updateTime},{default:s(()=>[t(Q,{class:"w-full",value:e(n).updateTime,"onUpdate:value":a[4]||(a[4]=l=>e(n).updateTime=l),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(Y,{span:24,class:"text-center"},{default:s(()=>[t(y,{status:"small2",class:"me-5",onClick:a[5]||(a[5]=l=>{var r;return(r=e(h))==null?void 0:r.hide()})},{default:s(()=>[m("取消")]),_:1}),t(y,{status:"small1",onClick:N},{default:s(()=>[m("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(ge,{dataSource:e(w),columns:V,size:"small",showSorterTooltip:!1,"row-selection":{selectedRowKeys:e(u).selectedRowKeys,onChange:G,getCheckboxProps:R},onChange:j,pagination:{...e(K)}},{headerCell:s(({column:l})=>[l.key==="blackListCount"?(p(),k(A,{key:0},[v("span",je,x(l.title),1),t(ve,{placement:"top","get-popup-container":pe},{title:s(()=>[Be]),default:s(()=>[v("a",Ne,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1})],64)):M("",!0)]),bodyCell:s(({column:l,record:r,text:D})=>[l.dataIndex==="phoneCount"||l.dataIndex==="blackListCount"?(p(),k(A,{key:0},[D>0?(p(),z(ye,{key:0,href:"javascript:;",class:"text-sm text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80 font-400",hover:"text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80",to:{name:"ListManagement",query:{tabActived:"contactPerson",group:[r.key],...l.dataIndex==="blackListCount"&&{blackList:"true"}}}},{default:s(()=>[m(x(D),1)]),_:2},1032,["to"])):(p(),k("span",qe,x(D),1))],64)):M("",!0),l.dataIndex==="name"?(p(),k("div",Ae,[e(i)[r.key]?(p(),k("div",ze,[v("div",He,[t(ke,{value:e(i)[r.key].name,"onUpdate:value":S=>e(i)[r.key].name=S,onPressEnter:S=>F(r.key),maxLength:15,status:e(i)[r.key].msg&&!e(H)(e(i)[r.key].msg)?"error":""},null,8,["value","onUpdate:value","onPressEnter","status"]),t(d,{name:"save",onClick:S=>F(r.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"])]),v("span",Je,x(e(i)[r.key].msg),1)])):(p(),k("div",We,[m(x(D||" ")+" ",1),Me(t(d,{name:"edit",onClick:S=>E(r.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"]),[[$e,r.key!=0]])]))])):M("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),t(Ge,{ref_key:"groupLabelCreateRef",ref:W,"save-callbck":()=>_(1)},null,8,["save-callbck"]),t(be,{open:e(f),"onUpdate:open":a[8]||(a[8]=l=>ae(f)?f.value=l:null),title:"是否刪除選取的群組標籤？",centered:"",cancelText:"取消",okText:"確定",onOk:de,width:"440px"},{default:s(()=>[Xe]),_:1},8,["open"])],64)}}});export{lt as _};

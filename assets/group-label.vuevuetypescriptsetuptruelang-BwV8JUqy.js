import{_ as we}from"./index.vuevuetypestyleindex0lang-BO6dExgl.js";import{_ as he}from"./index-CdZ-22Wt.js";import{_ as Ce,a as Le}from"./index.vuevuetypescriptsetuptruelang-C-Xp12f7.js";import{_ as ee}from"./index.vuevuetypescriptsetuptruelang-CL8f4-88.js";import{j as te,_ as Re}from"./index-X9R5oT3v.js";import{d as ae,r as V,f as k,W as d,_ as H,$ as o,k as a,ab as Te,u as e,H as ne,D as Ye,o as De,a0 as Fe,X as y,G as p,E as Ie,a4 as S,Y as m,F as A,a3 as R,m as Me,A as $e}from"./vue-BTNAaAVH.js";import{G as oe,n as J,J as Oe,I as se,o as Ke,y as le,E as ie,F as re,p as ue,x as Pe,z as Se,t as Ve}from"./antd-DnZDPeHZ.js";import{u as ce}from"./group-label-BJ_2ruxT.js";import{b as Ge}from"./tools-DInPKiE1.js";import{F as Ue}from"./index-CY-31O8s.js";const je=ae({__name:"group-label-create",props:{saveCallbck:{type:Function,required:!0}},setup(W,{expose:G}){const x=W,w=te(),{checkGroupLabelExist:U,createGroupLabel:j}=ce(),T={name:""},g=V(oe(T)),Y=V({name:[{async validator(M,n){if(J(n))return Promise.reject("請輸入群組標籤");const b=await U(n);return console.log(b),b?Promise.reject(`系統中已有「${n}」，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:r,resetFields:D,validate:F}=Oe(g,Y),f=k(!1);async function c(){D(T),f.value=!0}function I(){F().then(async()=>{var n;((n=(await j(g.name)).data)==null?void 0:n.status)==="success"&&(w.success({message:"群組標籤新增成功",placement:"top"}),x.saveCallbck(),f.value=!1)})}return G({show:c}),(M,n)=>{const b=se,v=Ke,E=le,$=ee,N=ie,B=re,h=ue;return d(),H(h,{open:e(f),"onUpdate:open":n[1]||(n[1]=C=>ne(f)?f.value=C:null),title:"新增群組標籤",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:I},{default:o(()=>[a(B,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:I},{default:o(()=>[a(N,{gutter:[16,0]},{default:o(()=>[a(E,{span:24},{default:o(()=>[a(v,Te({label:"群組標籤名稱"},e(r).name,{required:"",extra:"15字以內"}),{default:o(()=>[a(b,{value:e(g).name,"onUpdate:value":n[0]||(n[0]=C=>e(g).name=C),placeholder:"請輸入群組標籤名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),a($,{class:"hidden","html-type":"submit"})]),_:1})]),_:1})]),_:1},8,["open"])}}}),Ee={class:"flex justify-between px-2 items-center mb-2"},Ne={class:"me-1"},Be={href:"javascript:;"},qe=m("span",null,"全域黑名單功能: 主帳號將特定手機門號加入黑名單，主帳號和子帳號皆無法發送該門號任何訊息",-1),ze={key:1},Ae={key:1},He={key:0},Je={class:"editable-cell-wrapper"},We={class:"text-sms-status-alert-red text-xs"},Xe={key:1,class:"editable-cell-wrapper"},Qe=m("div",{class:"text-center px-24px py-20px w-376px text-base mx-auto"},[p(" 您選擇的群組標籤將永久刪除。"),m("br"),p(" 屬於該群組標籤的聯絡人，若沒有隸屬於其他群組標籤，將貼上「未分類」標籤。 ")],-1),ut=ae({__name:"group-label",setup(W){const{getGroupLabels:G,groupLabels:x,pagination:w,updateGroupLabel:U,deleteGroupLabel:j,checkGroupLabelExist:T,getGroupLabelOption:g,groupOptions:Y}=ce(),r=V({}),D=k(!1);Ye(async()=>{v(),g()}),De(()=>{D.value=!0});const F=te(),f=[{title:"群組標籤名稱",dataIndex:"name",key:"name",sorter:!0,width:"180px"},{title:"門號數量",dataIndex:"phoneCount",key:"phoneCount",sorter:!0,width:"140px",align:"right"},{title:"黑名單數量",dataIndex:"blackListCount",key:"blackListCount",sorter:!0,width:"151px",align:"right"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"160px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0}],c=V({selectedRowKeys:[],selectedRows:[],loading:!1});function I(s,t){console.log("selectedRowKeys changed: ",s,t),c.selectedRowKeys=s,c.selectedRows=t}function M(s){return{disabled:s.key==="0"}}const n=k({sortField:"createTime",sortOrder:"descend",createTime:void 0,updateTime:void 0,keyword:"",keys:[]}),b=k();async function v(s=1,t=10){const u={current:s,pageSize:t,...e(n)};await G(u)}function E(s){r[s]={...oe(x.value.filter(t=>s===t.key)[0]),msg:""}}async function $(s){var _;const t=r[s];if(J(t.name)){r[s].msg="請輸入群組標籤";return}await T(t.name,t.key)?r[s].msg=`系統中已有「${r[s].name}」，請勿重複新增`:((_=(await U(t.key,t.name)).data)==null?void 0:_.status)==="success"&&(Object.assign(x.value.filter(q=>s===q.key)[0],t),delete r[s],F.success({message:"群組標籤編輯成功",placement:"top"}))}async function N(s,t,u){console.log("sorter:",u),n.value=Object.assign(n.value,{sortField:u.field,sortOrder:u.order}),await v(w.value.current,w.value.pageSize)}async function B(s,t){await v(s,t)}const h=k(null);function C(){var s;v(1),(s=h.value)==null||s.hide()}const L=k(!1);function de(){L.value=!0}async function pe(){var t;((t=(await j(c.selectedRowKeys)).data)==null?void 0:t.status)==="success"&&(F.success({message:"群組標籤刪除成功",placement:"top"}),L.value=!1,c.selectedRowKeys=[],c.selectedRows=[])}function me(){return document.body}const X=k(null);return(s,t)=>{const u=Re,_=ee,Q=Ce,q=Le,_e=Pe,z=he,O=le,Z=Se,fe=ie,ve=re,ye=Ve,ke=Fe("RouterLink"),ge=se,be=we,xe=ue;return d(),y(A,null,[e(D)?(d(),H(Ie,{key:0,to:"#extraContent"},[a(_,{status:"small1",onClick:t[0]||(t[0]=l=>{var i;return(i=e(X))==null?void 0:i.show()})},{icon:o(()=>[a(u,{name:"plus",width:"16px"})]),default:o(()=>[p(" 新增群組標籤 ")]),_:1})])):S("",!0),m("div",Ee,[m("div",null,[a(_,{status:"small2",class:"me-2",disabled:e(c).selectedRowKeys.length===0},{icon:o(()=>[a(u,{name:"download",width:"16px"})]),default:o(()=>[p(" 匯出CSV ")]),_:1},8,["disabled"]),a(_,{status:"small2",class:"me-2",disabled:e(c).selectedRowKeys.length===0,onClick:de},{icon:o(()=>[a(u,{name:"delete",width:"16px"})]),default:o(()=>[p(" 刪除 ")]),_:1},8,["disabled"])]),a(Ue,{ref_key:"filterKeywordInputRef",ref:h,modelValue:e(n).keyword,"onUpdate:modelValue":t[6]||(t[6]=l=>e(n).keyword=l),class:"w-440px h-40px",placeholder:"搜尋群組標籤名稱",onClearFilter:t[7]||(t[7]=()=>{n.value={...e(n),keyword:"",keys:[],createTime:void 0,updateTime:void 0}})},{filterForm:o(()=>[a(ve,{ref_key:"formRef",ref:b,layout:"vertical",model:e(n),autocomplete:"off"},{default:o(()=>[a(fe,{gutter:[16,12]},{default:o(()=>[a(O,{span:24},{default:o(()=>[a(z,{label:"群組標籤",valueed:e(Ge)(e(n).keys)},{default:o(()=>[a(_e,{value:e(n).keys,"onUpdate:value":t[2]||(t[2]=l=>e(n).keys=l),options:e(Y),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full"},{dropdownRender:o(({menuNode:l})=>[a(Q,{modelValue:e(n).keys,"onUpdate:modelValue":t[1]||(t[1]=i=>e(n).keys=i),menu:l,options:e(Y)},null,8,["modelValue","menu","options"])]),option:o(({value:l,label:i})=>[a(q,{values:e(n).keys,value:l,label:i},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),a(O,{span:24},{default:o(()=>[a(z,{label:"建立時間",valueed:e(n).createTime},{default:o(()=>[a(Z,{value:e(n).createTime,"onUpdate:value":t[3]||(t[3]=l=>e(n).createTime=l),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(O,{span:24},{default:o(()=>[a(z,{label:"修改時間",valueed:e(n).updateTime},{default:o(()=>[a(Z,{value:e(n).updateTime,"onUpdate:value":t[4]||(t[4]=l=>e(n).updateTime=l),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(O,{span:24,class:"text-center"},{default:o(()=>[a(_,{status:"small2",class:"me-5",onClick:t[5]||(t[5]=l=>{var i;return(i=e(h))==null?void 0:i.hide()})},{default:o(()=>[p(" 取消 ")]),_:1}),a(_,{status:"small1",onClick:C},{default:o(()=>[p(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(be,{"data-source":e(x),columns:f,size:"small","show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(c).selectedRowKeys,onChange:I,getCheckboxProps:M},pagination:{...e(w)},onChange:N,onChangePagination:B},{headerCell:o(({column:l})=>[l.key==="blackListCount"?(d(),y(A,{key:0},[m("span",Ne,R(l.title),1),a(ye,{placement:"top","get-popup-container":me},{title:o(()=>[qe]),default:o(()=>[m("a",Be,[a(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1})],64)):S("",!0)]),bodyCell:o(({column:l,record:i,text:K})=>[l.dataIndex==="phoneCount"||l.dataIndex==="blackListCount"?(d(),y(A,{key:0},[K>0?(d(),H(ke,{key:0,href:"javascript:;",class:"text-sm text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80 font-400",hover:"text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80",to:{name:"ListManagement",query:{tabActived:"contactPerson",group:[i.key],...l.dataIndex==="blackListCount"&&{blackList:"true"}}}},{default:o(()=>[p(R(K),1)]),_:2},1032,["to"])):(d(),y("span",ze,R(K),1))],64)):S("",!0),l.dataIndex==="name"?(d(),y("div",Ae,[e(r)[i.key]?(d(),y("div",He,[m("div",Je,[a(ge,{value:e(r)[i.key].name,"onUpdate:value":P=>e(r)[i.key].name=P,maxlength:15,status:e(r)[i.key].msg&&!e(J)(e(r)[i.key].msg)?"error":"",onPressEnter:P=>$(i.key)},null,8,["value","onUpdate:value","status","onPressEnter"]),a(u,{name:"save",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:P=>$(i.key)},null,8,["onClick"])]),m("span",We,R(e(r)[i.key].msg),1)])):(d(),y("div",Xe,[p(R(K||" ")+" ",1),Me(a(u,{name:"edit",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:P=>E(i.key)},null,8,["onClick"]),[[$e,i.key!=="0"]])]))])):S("",!0)]),_:1},8,["data-source","row-selection","pagination"]),a(je,{ref_key:"groupLabelCreateRef",ref:X,"save-callbck":()=>v(1)},null,8,["save-callbck"]),a(xe,{open:e(L),"onUpdate:open":t[8]||(t[8]=l=>ne(L)?L.value=l:null),title:"是否刪除選取的群組標籤？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:pe},{default:o(()=>[Qe]),_:1},8,["open"])],64)}}});export{ut as _};

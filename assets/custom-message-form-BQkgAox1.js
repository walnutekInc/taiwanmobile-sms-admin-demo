import{_ as pe}from"./index.vuevuetypescriptsetuptruelang-BMFucJOA.js";import{_ as _e,a as fe,b as ge,c as ve,d as xe}from"./import-custom-message.vuevuetypescriptsetuptruelang-BjRp1mZa.js";import{_ as we}from"./index.vuevuetypescriptsetuptruelang-DAISk7I9.js";import{e as ye,k as be,_ as Ce}from"./index-8mjf59gM.js";import{d as ke,af as he,ae as Se,c as N,r as P,D as Me,f as c,w as $e,W as D,_ as H,$ as a,k as s,ab as y,u as t,Y as d,B as Fe,G as m,a4 as Re,m as j,A as E}from"./vue-BtcszhJV.js";import{n as Te,p as b,u as Ae,Q as Ie,B as Le,x as Ve,s as qe,t as Be,I as Ue,K as Ne,y as Pe,F as De}from"./antd-CeareF1k.js";import{u as He,r as M,a as je}from"./custom-message-YuL_id1R.js";import{u as Ee}from"./sms-category-B19-OEr3.js";import{u as Ge}from"./route-leave-BRmEWCXZ.js";import"./context-CcXFEK-B.js";import"./index.esm-CLFC3Zjv.js";import"./index.vuevuetypestyleindex0lang-CcFzt3O-.js";import"./index.vuevuetypestyleindex0lang-l354ccN2.js";import"./index-Csb8cSqh.js";import"./request-Pk-1cfXb.js";const We="/taiwanmobile-sms-admin-demo/assets/phone-DdWahJd9.png",Ke={class:"flex justify-between w-full items-center"},Oe=d("span",{class:""},"訊息類別",-1),Je=d("span",null,"新增訊息類別",-1),Qe=["src"],Ye={class:"max-h-450px overflow-auto absolute top-[150px] left-[30px] w-[calc(100%-50px)]"},ze=["innerHTML"],_t=ke({__name:"custom-message-form",setup(Xe){const{setHideAlert:$,setShowAlert:G}=Ge(),W=he(),K=ye(),C=Se(),O=be(),{getSmsCategoryOption:J,smsCategoryOption:Q,checkSmsCategoryExist:Y}=Ee(),{customMeesage:k,getCustomMessage:z,updateCustomMessage:X,createCustomMessage:Z,replaceFieldToHtml:F}=He(),f=N(()=>C.name==="CustomMessageCreate");let g={categoryId:void 0,newSmsCategory:"",name:"",content:""};const o=P(Te(g)),ee=P({name:[{required:!0,message:"請輸入訊息名稱",trigger:"blur"}],content:[{required:!0,message:"請輸入訊息內容",trigger:"blur"},{async validator(n,e){var l;return!b(e)&&((l=o.content)==null?void 0:l.replace(M,"").length)>1e3?Promise.reject("限制輸入 1,000 字以內"):Promise.resolve()},trigger:"blur"}],newSmsCategory:[{async validator(n,e){return!b(e)&&await Y(e)?Promise.reject(`系統中已有「${e}」 ，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:v,validate:te,clearValidate:se,resetFields:ae,initialModel:oe}=Ae(o,ee);Me(async()=>{var n,e,l;f.value||(await z(C.params.id),g={categoryId:(n=k.value)==null?void 0:n.categoryId,newSmsCategory:"",name:((e=k.value)==null?void 0:e.name)??"",content:F((l=k.value)==null?void 0:l.content)},ae(g)),K.handleSelectedKeys(["/sms-marketing/custom-message"]),J()});const p=c(!0),R=N(()=>f.value?"新增自訂訊息":"編輯自訂訊息");$e(()=>o,n=>{Ie(n,g)?$():G()},{deep:!0});function ne(){console.log(oe),te().then(async()=>{var l;((l=(await(t(f)?Z:X)(o,C.params.id)).data)==null?void 0:l.status)==="success"&&(O.success({message:t(f)?"自訂訊息新增成功":"自訂訊息編輯成功",placement:"top"}),$(),W.push("/sms-marketing/custom-message?tabActived=customMessage"))}).catch(n=>{console.log(n)})}const T=c(null);function A(n){o.content=F(n)}const h=c(null),I=c(null);function le(n){var e;for(const l of n)(e=h.value)==null||e.insertFun(`<span>${l}</span>`)}const L=c(null);function re(n){var e;(e=h.value)==null||e.insertFun(`<a href="${n}">${n}</a>`)}const V=c(null);return(n,e)=>{const l=Ce,ue=Le,ie=Ve,x=qe,i=Be,S=we,q=Ue,w=Ne,me=xe,B=Pe,ce=De,de=pe;return D(),H(de,{title:t(R),"custom-breadcrumb":[{title:"訊息行銷活動"},{path:"/sms-marketing/custom-message?tabActived=customMessage",title:"自訂訊息"},{title:t(R)}]},{default:a(()=>[s(B,{class:"bg-sms-grayscale-0 rounded-4 p-10",wrap:!1},{default:a(()=>[s(i,{flex:"auto"},{default:a(()=>[s(ce,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:ne},{default:a(()=>[s(B,{gutter:[16,16]},{default:a(()=>[s(i,{span:24},{default:a(()=>[s(x,y({"html-for":""},t(v).categoryId,{extra:"15 字以內。若無選擇/新增，將自動歸類為「未分類」。","label-col":{style:{width:"100%"}}}),{label:a(()=>[d("div",Ke,[Oe,t(p)?(D(),H(ue,{key:0,type:"link",class:"m-0 p-0",onClick:e[0]||(e[0]=Fe(()=>p.value=!1,["prevent"]))},{icon:a(()=>[s(l,{name:"plus"})]),default:a(()=>[m(" 新增訊息類別 ")]),_:1})):Re("",!0)])]),default:a(()=>[s(ie,{value:t(o).categoryId,"onUpdate:value":e[1]||(e[1]=r=>t(o).categoryId=r),options:t(Q),"allow-clear":"",disabled:!t(p),placeholder:"請選擇訊息類別"},null,8,["value","options","disabled"])]),_:1},16)]),_:1}),j(s(i,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-2 !px-3"},{default:a(()=>[s(x,y({"html-for":"",extra:"15 字以內。若同時選擇和新增訊息類別，系統只會紀錄「新增訊息類別」。"},t(v).newSmsCategory,{"label-col":{style:{width:"100%"}}}),{label:a(()=>[Je,s(S,{status:"small3",class:"m-0 p-0 ms-auto",onClick:e[2]||(e[2]=()=>{t(se)("newSmsCategory"),p.value=!0})},{icon:a(()=>[s(l,{name:"close"})]),_:1})]),default:a(()=>[s(q,{value:t(o).newSmsCategory,"onUpdate:value":e[3]||(e[3]=r=>t(o).newSmsCategory=r),placeholder:"請輸入訊息類別",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[E,!t(p)]]),s(i,{span:24},{default:a(()=>[s(x,y({label:"訊息名稱"},t(v).name,{extra:"15 字以內",required:""}),{default:a(()=>[s(q,{value:t(o).name,"onUpdate:value":e[4]||(e[4]=r=>t(o).name=r),placeholder:"請輸入訊息名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),s(i,{span:24},{default:a(()=>{var r;return[s(x,y({label:"訊息內容"},t(v).content,{class:"relative",extra:`MMS 上限 1,000 字，SMS 上限 335 字，目前 ${t(b)(t(o).content)?"--":(r=t(o).content)==null?void 0:r.replace(t(M),"").length} 字(不含參數字數)`,required:""}),{default:a(()=>{var U;return[s(me,{ref_key:"tagTextareaRef",ref:h,modelValue:t(o).content,"onUpdate:modelValue":e[9]||(e[9]=_=>t(o).content=_),contenteditable:"true","content-len":(U=t(o).content)==null?void 0:U.replace(t(M),"").length,"max-len":1e3,placeholder:"請輸入訊息名稱"},{default:a(()=>[s(w,null,{title:a(()=>[m(" 載入現有的自訂訊息 ")]),default:a(()=>[s(l,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[5]||(e[5]=_=>{var u;return(u=t(T))==null?void 0:u.show()})})]),_:1}),s(w,null,{title:a(()=>[m(" 加入參數 ")]),default:a(()=>[s(l,{name:"code",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[6]||(e[6]=_=>{var u;return(u=t(I))==null?void 0:u.show()})})]),_:1}),s(w,null,{title:a(()=>[m(" 增加縮網址 ")]),default:a(()=>[s(l,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[7]||(e[7]=_=>{var u;return(u=t(L))==null?void 0:u.show()})})]),_:1}),s(w,null,{title:a(()=>[m(" AI 文字生成訊息 ")]),default:a(()=>[s(l,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[8]||(e[8]=_=>{var u;return(u=t(V))==null?void 0:u.show()})})]),_:1})]),_:1},8,["modelValue","content-len"])]}),_:1},16,["extra"])]}),_:1}),s(i,{span:24,class:"text-end"},{default:a(()=>[s(S,{status:"small2",class:"me-2",onClick:e[10]||(e[10]=r=>n.$router.push("/sms-marketing/custom-message?tabActived=customMessage"))},{default:a(()=>[m(" 取消 ")]),_:1}),s(S,{status:"small1","html-type":"submit"},{default:a(()=>[m(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(i,{flex:"428px",class:"relative"},{default:a(()=>{var r;return[d("img",{src:t(We),class:"w-428px"},null,8,Qe),d("div",Ye,[j(d("div",{class:"bg-sms-grayscale-20 p-2 rounded-2 whitespace-pre-wrap max-w-[215px] inline-block break-words",innerHTML:(r=t(o).content)==null?void 0:r.replace(t(je),"")},null,8,ze),[[E,!t(b)(t(o).content)]])])]}),_:1})]),_:1}),s(_e,{ref_key:"importCustomMessageRef",ref:T,content:t(o).content,onUpdateContent:A},null,8,["content"]),s(fe,{ref_key:"addFieldRef",ref:I,onAddFieldToContent:le},null,512),s(ge,{ref_key:"addLinkRef",ref:L,onAddLinkToContent:re},null,512),s(ve,{ref_key:"aiTextGenerationRef",ref:V,content:t(o).content,onUpdateContent:A},null,8,["content"])]),_:1},8,["title","custom-breadcrumb"])}}});export{_t as default};

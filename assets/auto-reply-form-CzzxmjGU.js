import{_ as Ee}from"./index.vuevuetypescriptsetuptruelang-Co1Xu5B8.js";import{_ as Pe,a as Ke}from"./index.vuevuetypescriptsetuptruelang-BRBDRwqm.js";import{u as Ne,_ as Ge,a as Le,b as Be,c as Oe,d as Ve}from"./route-leave-CBLvrXWa.js";import{_ as Ye}from"./index.vuevuetypescriptsetuptruelang-CICFdqya.js";import{h as qe,j as Ie,_ as He}from"./index-D5CWLnaZ.js";import{d as ze,ad as We,ac as Je,c as C,r as P,D as Xe,f as x,w as Qe,W as M,_ as K,$ as o,k as n,ab as b,u as t,G as u,Y as l,a4 as Ze,m as N,B as et,A as G,X as L,F as te,a9 as ae,a3 as ne,a7 as tt,H as at}from"./vue-BvWPEeCa.js";import{E as B,K as nt,N as d,P as ot,O as st,U as lt,q as rt,o as ut,p as it,H as pt,I as ct,B as dt,G as mt,x as ft,J as _t,s as gt,F as vt,z as yt}from"./antd-Dpsol0oo.js";import{i as xt}from"./isToday-CxuES7r1.js";import{M as bt,a as ht}from"./MessageTypeEnum-6t9eF3Fo.js";import{u as wt,r as O}from"./custom-message-DoPeYD_t.js";import{u as kt}from"./auto-reply-RPuRIhJd.js";import{b as A}from"./tools-DuR4KSGu.js";import{u as Mt}from"./group-label-LaevKN5i.js";import"./context-fkMRc5e1.js";import"./index.esm-CgYeVutO.js";import"./index.vuevuetypestyleindex0lang-Dl2df6kz.js";import"./request-BZM3Cngs.js";const St=l("span",{class:"pe-.5"},"接收關鍵字",-1),Tt=l("span",{class:"text-red-500 pe-2"},"*",-1),Ft={href:"javascript:;"},Ct=l("br",null,null,-1),$t=l("br",null,null,-1),jt=l("br",null,null,-1),Rt={class:"flex justify-between w-full items-center"},Dt=l("span",{class:"pe-1"},"群組標籤設定",-1),Ut={href:"javascript:;"},At=l("span",null,"新增群組標籤",-1),Et=l("span",{class:"pe-.5"},"訊息類型",-1),Pt=l("span",{class:"text-red-500 pe-2"},"*",-1),Kt={href:"javascript:;"},Nt=l("br",null,null,-1),Gt=l("span",{class:"pe-.5"},"自動回覆訊息內容",-1),Lt=l("span",{class:"text-red-500 pe-2"},"*",-1),Bt={href:"javascript:;"},Ot=l("br",null,null,-1),Vt=l("br",null,null,-1),Yt={class:"flex gap-2 overflow-y-auto h-95px"},qt={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},It=l("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 刪除的檔案將無法復原 ",-1),Ht=l("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"},[u(" 您編輯過的內容將全部清空 "),l("br"),l("p",null,[u(" 提醒您，SMS支援的字數較MMS少，"),l("br"),u(" 且不能上傳多媒體附件 ")])],-1),da=ze({__name:"auto-reply-form",setup(zt){B.extend(xt);const{getGroupLabelOption:oe,groupOptions:V}=Mt(),{setHideAlert:Y,setShowAlert:se}=Ne(),le=We(),re=qe(),E=Je(),ue=Ie(),{replaceFieldToHtml:q}=wt(),{autoReply:m,getAutoReply:ie,updateAutoReply:pe,createAutoReply:ce,checkAcceptKeywordExist:de}=kt(),$=C(()=>E.name==="AutoReplyCreate");let j={phone:void 0,acceptKeyword:"",subject:"",messageType:"SMS",multimediaFile:[],group:void 0,newGroupName:"",takeEffectDates:void 0,content:""};const a=P(nt(j)),R=C(()=>a.messageType==="SMS"?335:1e3),me=P({phone:[{required:!0,message:"請選擇發送門號",trigger:"blur"}],acceptKeyword:[{async validator(s,e){return d(e)?Promise.reject("請輸入接收關鍵字"):!d(e)&&await de(e)?Promise.reject(`生效開始與結束日期已存在接收關鍵字「 ${e} 」的設定，請勿重複新增`):Promise.resolve()},trigger:"blur"}],takeEffectDates:[{required:!0,message:"請選擇生效起迄日",trigger:"blur"}],subject:[{async validator(s,e){return a.messageType==="MMS"&&d(e)?Promise.reject("請輸入訊息主旨"):Promise.resolve()},trigger:"blur"}],content:[{async validator(s,e){var i;return d(e)?Promise.reject("請輸入自動回覆訊息內容"):!d(e)&&((i=a.content)==null?void 0:i.replace(O,"").length)>R.value?Promise.reject(`限制輸入 ${R.value} 字以內`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:y,validate:fe,clearValidate:_e,resetFields:ge}=ot(a,me);Xe(async()=>{var s,e,i,_,p,c,g,w,D,k,U;$.value||(await ie(E.params.id),j={phone:(s=m.value)==null?void 0:s.phone,acceptKeyword:((e=m.value)==null?void 0:e.acceptKeyword)??"",subject:((i=m.value)==null?void 0:i.subject)??"",messageType:((_=m.value)==null?void 0:_.messageType)??"SMS",multimediaFile:((p=m.value)==null?void 0:p.multimediaFile)??[],group:(g=(c=m.value)==null?void 0:c.group)!=null&&g.id?[(w=m.value)==null?void 0:w.group.id]:void 0,newGroupName:"",takeEffectDates:(D=m.value)!=null&&D.startDate&&((k=m.value)!=null&&k.endDate)?[m.value.startDate,m.value.endDate]:void 0,content:q((U=m.value)==null?void 0:U.content)},ge(j)),re.handleSelectedKeys(["/sms-marketing/auto-reploy"]),oe()});const I=x(),ve=C(()=>st(a.group)||d(a.group)?V.value:V.value.map(s=>({...s,class:"pointer-events-none"}))),S=x(!0),H=C(()=>$.value?"新增自動回覆":"編輯自動回覆");Qe(()=>a,s=>{lt(s,j)?Y():se()},{deep:!0});function ye(){fe().then(async()=>{var i;((i=(await(t($)?ce:pe)(a,E.params.id)).data)==null?void 0:i.status)==="success"&&(ue.success({message:t($)?"自動回覆新增成功":"自動回覆編輯成功",placement:"top"}),Y(),le.push("/sms-marketing/auto-reply"))}).catch(s=>{console.log(s)})}const z=x(null);function W(s){a.content=q(s)}const xe=x(null);function be(s){for(const e of s)a.content=`${a.content}<span>${e}</span>`}const J=x(null);function he(s){a.content=`${a.content}<a href="${s}">${s}</a>`}const X=x(null);function we(s){const e=B().add(1,"year"),i=B().subtract(1,"d");return s<i||s>=e}const ke=C(()=>{const s=[];if(d(a.acceptKeyword)||s.push({content:a.acceptKeyword,messageType:"GET",contentType:"text"}),(!d(a.content)||!d(a.subject))&&s.push({phone:a.phone,content:a.content,...a.messageType==="MMS"&&{subject:a.subject},messageType:"SENT",contentType:"text"}),!d(a.multimediaFile))for(const e of a.multimediaFile)s.push({phone:a.phone,content:e.url,messageType:"SENT",contentType:e.type});return s.map((e,i)=>({...e,key:i}))}),Q=x(null);function Me(s){a.multimediaFile=s}const T=P({open:!1});function Se(s){Object.assign(T,{open:!0,delFile:s})}function Te(){a.multimediaFile=a.multimediaFile.filter(s=>{var e;return s.url!==((e=T.delFile)==null?void 0:e.url)}),Object.assign(T,{open:!1,delFile:void 0})}const F=x(!1);function Fe(){a.messageType==="SMS"?!d(a.content)||!d(a.multimediaFile)?F.value=!0:a.messageType="SMS":a.messageType="MMS"}return(s,e)=>{const i=rt,_=ut,p=it,c=He,g=pt,w=ct,D=dt,k=Ye,U=mt,Ce=ft,$e=_t,je=Pe,Re=Ve,Z=gt,De=vt,Ue=Ke,ee=yt,Ae=Ee;return M(),K(Ae,{title:t(H),"custom-breadcrumb":[{title:"訊息行銷活動"},{path:"/sms-marketing/auto-reply",title:"自動回覆"},{title:t(H)}]},{default:o(()=>[n(Z,{class:"bg-sms-grayscale-0 rounded-4 p-10 pl-1",wrap:!1},{default:o(()=>[n(p,{flex:"auto"},{default:o(()=>[n(De,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:ye},{default:o(()=>[n(Z,{gutter:[16,14]},{default:o(()=>[n(p,{span:24},{default:o(()=>[n(_,b(t(y).phone,{label:"發送門號",required:""}),{default:o(()=>[n(i,{value:t(a).phone,"onUpdate:value":e[0]||(e[0]=r=>t(a).phone=r),options:[{label:"0935-111-111",value:"0935-111-111"},{label:"0947-127-998",value:"0947-127-998"},{label:"0958-892-006",value:"0958-892-006"}],"allow-clear":"",placeholder:"請選擇發送門號"},null,8,["value"])]),_:1},16)]),_:1}),n(p,{span:24},{default:o(()=>[n(_,b(t(y).acceptKeyword,{extra:"最少 1 個字"}),{label:o(()=>[St,Tt,n(g,{placement:"top","get-popup-container":t(A)},{title:o(()=>[u(" 假設情境："),Ct,u(" Step1. 於此處設定接收關鍵字為「1」"),$t,u(" Step2. 傳送訊息，請客戶回覆「1」"),jt,u(" Step3. 若客戶回覆「1」，立即觸發自動回覆功能 ")]),default:o(()=>[l("a",Ft,[n(c,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:o(()=>[n(w,{value:t(a).acceptKeyword,"onUpdate:value":e[1]||(e[1]=r=>t(a).acceptKeyword=r),placeholder:"請輸入接收關鍵字"},null,8,["value"])]),_:1},16)]),_:1}),n(p,{span:24},{default:o(()=>[n(_,b(t(y).group,{"html-for":"","label-col":{style:{width:"100%"}},extra:"可選擇或新增 1 個標籤"}),{label:o(()=>[l("div",Rt,[l("div",null,[Dt,n(g,{placement:"top","get-popup-container":t(A)},{title:o(()=>[u(" 將回傳該「接收關鍵字」的多筆門號打包至單一群組標籤，後續可進行再行銷 ")]),default:o(()=>[l("a",Ut,[n(c,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),t(S)?(M(),K(D,{key:0,type:"link",class:"m-0 p-0",onClickCapture:e[2]||(e[2]=()=>S.value=!1)},{icon:o(()=>[n(c,{name:"plus"})]),default:o(()=>[u(" 新增群組標籤 ")]),_:1})):Ze("",!0)])]),default:o(()=>[n(i,{ref_key:"groupRef",ref:I,value:t(a).group,"onUpdate:value":e[3]||(e[3]=r=>t(a).group=r),options:t(ve),"allow-clear":"","show-arrow":"",disabled:!t(S),placeholder:"請輸入",mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" ",onSelect:e[4]||(e[4]=r=>{var h;return(h=t(I))==null?void 0:h.blur()})},null,8,["value","options","disabled"])]),_:1},16)]),_:1}),N(n(p,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-2 !px-3"},{default:o(()=>[n(_,b({"html-for":"",extra:"只能新增 1 個群組標籤，15 字以內。"},t(y).newSmsCategory,{"label-col":{style:{width:"100%"}}}),{label:o(()=>[At,n(k,{status:"small3",class:"m-0 p-0 ms-auto",onClick:e[5]||(e[5]=et(()=>{t(_e)("newSmsCategory"),S.value=!0},["prevent"]))},{icon:o(()=>[n(c,{name:"close"})]),_:1})]),default:o(()=>[n(w,{value:t(a).newGroupName,"onUpdate:value":e[6]||(e[6]=r=>t(a).newGroupName=r),placeholder:"請輸入新群組標籤",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[G,!t(S)]]),n(p,{span:24},{default:o(()=>[n(_,b(t(y).takeEffectDates,{label:"生效開始與結束日期",extra:"最多可設定 1 年"}),{default:o(()=>[n(U,{value:t(a).takeEffectDates,"onUpdate:value":e[7]||(e[7]=r=>t(a).takeEffectDates=r),format:"YYYY/MM/DD","value-format":"YYYY/MM/DD",placeholder:["請選擇生效開始結束日期",""],class:"w-full",separator:"～","disabled-date":we},null,8,["value"])]),_:1},16)]),_:1}),n(p,{span:24},{default:o(()=>[n(_,b({"html-for":""},t(y).messageType),{label:o(()=>[Et,Pt,n(g,{placement:"top","get-popup-container":t(A)},{title:o(()=>[u(" SMS：上限 335 字"),Nt,u(" MMS：上限 1,000 字，可上傳多媒體 ")]),default:o(()=>[l("a",Kt,[n(c,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:o(()=>[n($e,{value:t(a).messageType,"onUpdate:value":e[8]||(e[8]=r=>t(a).messageType=r),onChange:Fe},{default:o(()=>[(M(!0),L(te,null,ae(Object.entries(t(bt)),([r,h])=>(M(),K(Ce,{key:r,value:r},{default:o(()=>[u(ne(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16)]),_:1}),N(n(p,{span:24},{default:o(()=>[n(_,b({label:"訊息主旨"},t(y).subject,{required:"",extra:"15 字以內"}),{default:o(()=>[n(w,{value:t(a).subject,"onUpdate:value":e[9]||(e[9]=r=>t(a).subject=r),placeholder:"請輸入訊息主旨",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[G,t(a).messageType==="MMS"]]),n(p,{span:24},{default:o(()=>{var r;return[n(_,b({"html-for":""},t(y).content,{class:"relative",extra:`${t(a).messageType} 上限 ${t(R).toLocaleString()} 字，目前 ${t(d)(t(a).content)?"--":(r=t(a).content)==null?void 0:r.replace(t(O),"").length} 字`}),{label:o(()=>[Gt,Lt,n(g,{placement:"top","get-popup-container":t(A)},{title:o(()=>[u(" 假設情境："),Ot,u(" Step1. 客戶回覆包含「接收關鍵字」的訊息"),Vt,u(" Step2. 系統自動回覆此欄位內的內容 ")]),default:o(()=>[l("a",Bt,[n(c,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:o(()=>{var h;return[n(Re,{modelValue:t(a).content,"onUpdate:modelValue":e[14]||(e[14]=v=>t(a).content=v),contenteditable:"true",style:{height:"292px"},"content-len":(h=t(a).content)==null?void 0:h.replace(t(O),"").length,"max-len":t(R),placeholder:"請輸入文字"},tt({default:o(()=>[n(g,null,{title:o(()=>[u(" 載入現有的自訂訊息 ")]),default:o(()=>[n(c,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[10]||(e[10]=v=>{var f;return(f=t(z))==null?void 0:f.show()})})]),_:1}),n(g,null,{title:o(()=>[u(" 增加縮網址 ")]),default:o(()=>[n(c,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[11]||(e[11]=v=>{var f;return(f=t(J))==null?void 0:f.show()})})]),_:1}),n(g,null,{title:o(()=>[u(" 多媒體附件上傳 ")]),default:o(()=>[N(n(c,{name:"cloud-upload",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[12]||(e[12]=v=>{var f;return(f=t(Q))==null?void 0:f.show(t(a).multimediaFile)})},null,512),[[G,t(a).messageType==="MMS"]])]),_:1}),n(g,null,{title:o(()=>[u(" AI 文字生成訊息 ")]),default:o(()=>[n(c,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[13]||(e[13]=v=>{var f;return(f=t(X))==null?void 0:f.show()})})]),_:1})]),_:2},[t(a).multimediaFile.length>0?{name:"multimediaBlock",fn:o(()=>[l("div",Yt,[(M(!0),L(te,null,ae(t(a).multimediaFile,v=>(M(),L("div",{key:v.url,class:"w-90px max-h-60px"},[n(je,{source:{url:v.url,type:v.type},"show-file-name":!1,"can-play":!1,size:"small","image-class":"object-cover w-full h-full",onDeleteVideo:f=>Se(v)},null,8,["source","onDeleteVideo"]),l("div",qt,ne(v.fileName),1)]))),128))])]),key:"0"}:void 0]),1032,["modelValue","content-len","max-len"])]}),_:1},16,["extra"])]}),_:1}),n(p,{span:24,class:"text-end"},{default:o(()=>[n(k,{status:"small2",class:"me-2",onClick:e[15]||(e[15]=r=>s.$router.push("/sms-marketing/custom-message?tabActived=customMessage"))},{default:o(()=>[u(" 取消 ")]),_:1}),n(k,{status:"small1","html-type":"submit"},{default:o(()=>[u(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(p,{flex:"428px",class:"relative"},{default:o(()=>[n(Ue,{message:t(ke)},null,8,["message"])]),_:1})]),_:1}),n(Ge,{ref_key:"importCustomMessageRef",ref:z,content:t(a).content,onUpdateContent:W},null,8,["content"]),n(Le,{ref_key:"addFieldRef",ref:xe,onAddFieldToContent:be},null,512),n(Be,{ref_key:"addLinkRef",ref:J,onAddLinkToContent:he},null,512),n(Oe,{ref_key:"aiTextGenerationRef",ref:X,content:t(a).content,onUpdateContent:W},null,8,["content"]),n(ht,{ref_key:"multimediaUploadRef",ref:Q,onUpdateMultimediaFile:Me},null,512),n(ee,{open:t(T).open,"onUpdate:open":e[16]||(e[16]=r=>t(T).open=r),title:"是否刪除已上傳的檔案？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onOk:Te},{default:o(()=>[It]),_:1},8,["open"]),n(ee,{open:t(F),"onUpdate:open":e[17]||(e[17]=r=>at(F)?F.value=r:null),title:"是否放棄目前編輯的內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onCancel:e[18]||(e[18]=r=>t(a).messageType="MMS"),onOk:e[19]||(e[19]=()=>{t(a).content="",t(a).multimediaFile=[],t(a).subject="",F.value=!1})},{default:o(()=>[Ht]),_:1},8,["open"])]),_:1},8,["title","custom-breadcrumb"])}}});export{da as default};

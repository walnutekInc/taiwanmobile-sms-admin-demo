import{_ as we}from"./index.vuevuetypestyleindex0lang-DKN-lS5R.js";import{_ as he}from"./index-PrIDS96T.js";import{_ as Ce,a as Le}from"./index.vuevuetypescriptsetuptruelang-DeIfKSvi.js";import{_ as ee}from"./index.vuevuetypescriptsetuptruelang-CXg0iFgk.js";import{j as te,_ as Re}from"./index-w5Nq7MAI.js";import{d as ae,r as G,f as k,W as p,_ as H,$ as o,k as a,ab as Te,u as e,H as ne,D as Ye,o as De,a0 as Ie,X as y,G as d,E as Me,a4 as V,Y as m,F as A,a3 as R,m as Fe,A as Oe}from"./vue-BvWPEeCa.js";import{O as oe,P as Q,Q as $e,I as se,o as Pe,p as le,s as ie,F as ue,z as re,q as Se,G as Ve,H as Ge}from"./antd-DfxlYADO.js";import{u as ce}from"./group-label-BXA-iE9z.js";import{a as Ke}from"./tools-DuR4KSGu.js";import{_ as Ue}from"./request-BP-Pqw2g.js";const je=ae({__name:"group-label-create",props:{saveCallbck:{type:Function,required:!0}},setup(W,{expose:K}){const x=W,w=te(),{checkGroupLabelExist:U,createGroupLabel:j}=ce(),T={name:""},g=G(oe(T)),Y=G({name:[{async validator(F,n){if(Q(n))return Promise.reject("請輸入群組標籤");const b=await U(n);return console.log(b),b?Promise.reject(`系統中已有「${n}」，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:u,resetFields:D,validate:I}=$e(g,Y),f=k(!1);async function c(){D(T),f.value=!0}function M(){I().then(async()=>{var n;((n=(await j(g.name)).data)==null?void 0:n.status)==="success"&&(w.success({message:"群組標籤新增成功",placement:"top"}),x.saveCallbck(),f.value=!1)})}return K({show:c}),(F,n)=>{const b=se,v=Pe,E=le,O=ee,N=ie,B=ue,h=re;return p(),H(h,{open:e(f),"onUpdate:open":n[1]||(n[1]=C=>ne(f)?f.value=C:null),title:"新增群組標籤",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:M},{default:o(()=>[a(B,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:M},{default:o(()=>[a(N,{gutter:[16,0]},{default:o(()=>[a(E,{span:24},{default:o(()=>[a(v,Te({label:"群組標籤名稱"},e(u).name,{required:"",extra:"15字以內"}),{default:o(()=>[a(b,{value:e(g).name,"onUpdate:value":n[0]||(n[0]=C=>e(g).name=C),placeholder:"請輸入群組標籤名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),a(O,{class:"hidden","html-type":"submit"})]),_:1})]),_:1})]),_:1},8,["open"])}}}),Ee={class:"flex justify-between px-2 items-center mb-2"},Ne={class:"me-1"},Be={href:"javascript:;"},qe=m("span",null,"全域黑名單功能: 主帳號將特定手機門號加入黑名單，主帳號和子帳號皆無法發送該門號任何訊息",-1),ze={key:1},Ae={key:1},He={key:0},Qe={class:"editable-cell-wrapper"},We={class:"text-sms-status-alert-red text-xs"},Xe={key:1,class:"editable-cell-wrapper"},Je=m("div",{class:"text-center px-24px py-20px w-376px text-base mx-auto"},[d(" 您選擇的群組標籤將永久刪除。"),m("br"),d(" 屬於該群組標籤的聯絡人，若沒有隸屬於其他群組標籤，將貼上「未分類」標籤。 ")],-1),rt=ae({__name:"group-label",setup(W){const{getGroupLabels:K,groupLabels:x,pagination:w,updateGroupLabel:U,deleteGroupLabel:j,checkGroupLabelExist:T,getGroupLabelOption:g,groupOptions:Y}=ce(),u=G({}),D=k(!1);Ye(async()=>{v(),g()}),De(()=>{D.value=!0});const I=te(),f=[{title:"群組標籤名稱",dataIndex:"name",key:"name",sorter:!0,width:"180px"},{title:"門號數量",dataIndex:"phoneCount",key:"phoneCount",sorter:!0,width:"140px",align:"right"},{title:"黑名單數量",dataIndex:"blackListCount",key:"blackListCount",sorter:!0,width:"151px",align:"right"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"160px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0}],c=G({selectedRowKeys:[],selectedRows:[],loading:!1});function M(s,t){console.log("selectedRowKeys changed: ",s,t),c.selectedRowKeys=s,c.selectedRows=t}function F(s){return{disabled:s.key==="0"}}const n=k({sortField:"createTime",sortOrder:"descend",createTime:void 0,updateTime:void 0,keyword:"",keys:[]}),b=k();async function v(s=1,t=10){const r={current:s,pageSize:t,...e(n)};await K(r)}function E(s){u[s]={...oe(x.value.filter(t=>s===t.key)[0]),msg:""}}async function O(s){var _;const t=u[s];if(Q(t.name)){u[s].msg="請輸入群組標籤";return}await T(t.name,t.key)?u[s].msg=`系統中已有「${u[s].name}」，請勿重複新增`:((_=(await U(t.key,t.name)).data)==null?void 0:_.status)==="success"&&(Object.assign(x.value.filter(q=>s===q.key)[0],t),delete u[s],I.success({message:"群組標籤編輯成功",placement:"top"}))}async function N(s,t,r){console.log("sorter:",r),n.value=Object.assign(n.value,{sortField:r.field,sortOrder:r.order}),await v(w.value.current,w.value.pageSize)}async function B(s,t){await v(s,t)}const h=k(null);function C(){var s;v(1),(s=h.value)==null||s.hide()}const L=k(!1);function pe(){L.value=!0}async function de(){var t;((t=(await j(c.selectedRowKeys)).data)==null?void 0:t.status)==="success"&&(I.success({message:"群組標籤刪除成功",placement:"top"}),L.value=!1,c.selectedRowKeys=[],c.selectedRows=[])}function me(){return document.body}const X=k(null);return(s,t)=>{const r=Re,_=ee,J=Ce,q=Le,_e=Se,z=he,$=le,Z=Ve,fe=ie,ve=ue,ye=Ge,ke=Ie("RouterLink"),ge=se,be=we,xe=re;return p(),y(A,null,[e(D)?(p(),H(Me,{key:0,to:"#extraContent"},[a(_,{status:"small1",onClick:t[0]||(t[0]=l=>{var i;return(i=e(X))==null?void 0:i.show()})},{icon:o(()=>[a(r,{name:"plus",width:"16px"})]),default:o(()=>[d(" 新增群組標籤 ")]),_:1})])):V("",!0),m("div",Ee,[m("div",null,[a(_,{status:"small2",class:"me-2",disabled:e(c).selectedRowKeys.length===0},{icon:o(()=>[a(r,{name:"download",width:"16px"})]),default:o(()=>[d(" 匯出CSV ")]),_:1},8,["disabled"]),a(_,{status:"small2",class:"me-2",disabled:e(c).selectedRowKeys.length===0,onClick:pe},{icon:o(()=>[a(r,{name:"delete",width:"16px"})]),default:o(()=>[d(" 刪除 ")]),_:1},8,["disabled"])]),a(Ue,{ref_key:"filterKeywordInputRef",ref:h,modelValue:e(n).keyword,"onUpdate:modelValue":t[6]||(t[6]=l=>e(n).keyword=l),class:"w-440px h-40px",placeholder:"搜尋群組標籤名稱",onClearFilter:t[7]||(t[7]=()=>{n.value={...e(n),keyword:"",keys:[],createTime:void 0,updateTime:void 0}})},{filterForm:o(()=>[a(ve,{ref_key:"formRef",ref:b,layout:"vertical",model:e(n),autocomplete:"off"},{default:o(()=>[a(fe,{gutter:[16,12]},{default:o(()=>[a($,{span:24},{default:o(()=>[a(z,{label:"群組標籤",valueed:e(Ke)(e(n).keys)},{default:o(()=>[a(_e,{value:e(n).keys,"onUpdate:value":t[2]||(t[2]=l=>e(n).keys=l),options:e(Y),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full"},{dropdownRender:o(({menuNode:l})=>[a(J,{modelValue:e(n).keys,"onUpdate:modelValue":t[1]||(t[1]=i=>e(n).keys=i),menu:l,options:e(Y)},null,8,["modelValue","menu","options"])]),option:o(({value:l,label:i})=>[a(q,{values:e(n).keys,value:l,label:i},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),a($,{span:24},{default:o(()=>[a(z,{label:"建立時間",valueed:e(n).createTime},{default:o(()=>[a(Z,{value:e(n).createTime,"onUpdate:value":t[3]||(t[3]=l=>e(n).createTime=l),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a($,{span:24},{default:o(()=>[a(z,{label:"修改時間",valueed:e(n).updateTime},{default:o(()=>[a(Z,{value:e(n).updateTime,"onUpdate:value":t[4]||(t[4]=l=>e(n).updateTime=l),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a($,{span:24,class:"text-center"},{default:o(()=>[a(_,{status:"small2",class:"me-5",onClick:t[5]||(t[5]=l=>{var i;return(i=e(h))==null?void 0:i.hide()})},{default:o(()=>[d(" 取消 ")]),_:1}),a(_,{status:"small1",onClick:C},{default:o(()=>[d(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(be,{"data-source":e(x),columns:f,size:"small","show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(c).selectedRowKeys,onChange:M,getCheckboxProps:F},pagination:{...e(w)},onChange:N,onChangePagination:B},{headerCell:o(({column:l})=>[l.key==="blackListCount"?(p(),y(A,{key:0},[m("span",Ne,R(l.title),1),a(ye,{placement:"top","get-popup-container":me},{title:o(()=>[qe]),default:o(()=>[m("a",Be,[a(r,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1})],64)):V("",!0)]),bodyCell:o(({column:l,record:i,text:P})=>[l.dataIndex==="phoneCount"||l.dataIndex==="blackListCount"?(p(),y(A,{key:0},[P>0?(p(),H(ke,{key:0,href:"javascript:;",class:"text-sm text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80 font-400",hover:"text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80",to:{name:"ListManagement",query:{tabActived:"contactPerson",group:[i.key],...l.dataIndex==="blackListCount"&&{blackList:"true"}}}},{default:o(()=>[d(R(P),1)]),_:2},1032,["to"])):(p(),y("span",ze,R(P),1))],64)):V("",!0),l.dataIndex==="name"?(p(),y("div",Ae,[e(u)[i.key]?(p(),y("div",He,[m("div",Qe,[a(ge,{value:e(u)[i.key].name,"onUpdate:value":S=>e(u)[i.key].name=S,maxlength:15,status:e(u)[i.key].msg&&!e(Q)(e(u)[i.key].msg)?"error":"",onPressEnter:S=>O(i.key)},null,8,["value","onUpdate:value","status","onPressEnter"]),a(r,{name:"save",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:S=>O(i.key)},null,8,["onClick"])]),m("span",We,R(e(u)[i.key].msg),1)])):(p(),y("div",Xe,[d(R(P||" ")+" ",1),Fe(a(r,{name:"edit",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:S=>E(i.key)},null,8,["onClick"]),[[Oe,i.key!=="0"]])]))])):V("",!0)]),_:1},8,["data-source","row-selection","pagination"]),a(je,{ref_key:"groupLabelCreateRef",ref:X,"save-callbck":()=>v(1)},null,8,["save-callbck"]),a(xe,{open:e(L),"onUpdate:open":t[8]||(t[8]=l=>ne(L)?L.value=l:null),title:"是否刪除選取的群組標籤？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:de},{default:o(()=>[Je]),_:1},8,["open"])],64)}}});export{rt as _};

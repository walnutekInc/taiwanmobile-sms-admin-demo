import{_ as de}from"./index.vuevuetypescriptsetuptruelang-DFR_D-F5.js";import{_ as ae}from"./index.vuevuetypestyleindex0lang-CcFzt3O-.js";import{k as me,_ as oe}from"./index-CVEM0gwZ.js";import{_ as _e}from"./index.vuevuetypescriptsetuptruelang-DAISk7I9.js";import{_ as fe}from"./index-BLTwKazw.js";import{_ as ye,a as ge}from"./index.vuevuetypescriptsetuptruelang-DlliyulR.js";import{d as Q,r as B,f as C,c as H,W as S,_ as Y,$ as o,Y as d,k as a,u as e,H as ne,X as G,G as O,a6 as I,ab as L,F as X,a7 as ve,m as Z,A as ee,o as be,a4 as te}from"./vue-BtcszhJV.js";import{O as Ne,G as le,n as xe,u as we,o as Ae,N as ke,z as he,s as Ce,t as se,I as Re,r as Se,V as Ve,y as ce,F as re,x as Te}from"./antd-CeareF1k.js";import{b as De}from"./index.esm-CLFC3Zjv.js";import{u as ue}from"./request-DRo2j7AZ.js";import{F as Ie}from"./index-Cwco8wzr.js";import{b as P}from"./tools-DInPKiE1.js";import{u as Oe}from"./customer-IWND1eSw.js";import"./context-B_CLxcrw.js";import"./index.vuevuetypestyleindex0lang-l354ccN2.js";import"./index.vuevuetypescriptsetuptruelang-BxQ8nJie.js";const j=[{key:"0",date:"2024/10/27",orderNumber:"order20241027001",accountName:"Nellsonma",topUpMethod:"刷卡",price:7e3},{key:"1",date:"2024/09/12",orderNumber:"order20240912001",accountName:"Kevin",topUpMethod:"刷卡",price:3e3},{key:"2",date:"2024/09/10",orderNumber:"order20240910001",accountName:"-",topUpMethod:"其他",price:6e3},{key:"3",date:"2024/08/26",orderNumber:"order20240826001",accountName:"Rose",topUpMethod:"刷卡",price:1e3},{key:"4",date:"2024/08/03",orderNumber:"order20240803001",accountName:"-",topUpMethod:"其他",price:8e3}];function Ue(){const{list:b,pagination:N,setResponseList:w}=ue();return{getAllOrderList:async u=>{const p=Math.ceil(j.length/u.pageSize);w({total:j.length,pages:p,current:u.current,pageSize:u.pageSize,records:j})},allOrderList:b,pagination:N}}const Fe={class:"px-24px"},Me=Q({name:"SelectOrder",__name:"select-order",emits:["selectOrderData"],setup(b,{expose:N,emit:w}){const _=w,{pagination:u,allOrderList:p,getAllOrderList:s}=Ue(),f=B({selectedRowKeys:[],selectedRows:[],loading:!1}),n=[{title:"日期",dataIndex:"date",key:"date",maxWidth:190},{title:"訂單單號",dataIndex:"orderNumber",key:"orderNumber",maxWidth:160},{title:"帳號名稱",dataIndex:"accountName",key:"accountName",maxWidth:160},{title:"儲值方式",dataIndex:"topUpMethod",key:"topUpMethod",maxWidth:160},{title:"儲值金額",dataIndex:"price",key:"price",maxWidth:160,align:"right",customHeaderCell:()=>({class:"[&>*]:!justify-center"}),customRender:({text:t})=>`NT$${t==null?void 0:t.toLocaleString()}`}],A=C({dateRage:void 0,sortField:"date",sortOrder:"descend"}),U=H(()=>{const t=(u.value.current-1)*u.value.pageSize;return p.value.slice(t,u.value.current*u.value.pageSize)});async function h(t,r){u.value={...u.value,current:t,pageSize:r}}async function R(t=1,r=10){const k={current:t,pageSize:r,...e(A)};await s(k)}function F(t,r){console.log("selectedRowKeys changed: ",t),f.selectedRowKeys=t,f.selectedRows=r}const y=C(!1);async function V(t){t&&(f.selectedRowKeys=[t]),R(),y.value=!0}function c(){y.value=!1,_("selectOrderData",f.selectedRows[0])}return N({show:V}),(t,r)=>{const k=Ne,g=ae,v=le;return S(),Y(v,{open:e(y),"onUpdate:open":r[1]||(r[1]=x=>ne(y)?y.value=x:null),title:"訂單列表",centered:"","cancel-text":"取消","ok-text":"確定",width:"960px",onOk:c},{default:o(()=>[d("div",Fe,[a(k,{value:e(A).dateRage,"onUpdate:value":r[0]||(r[0]=x=>e(A).dateRage=x),class:"w-full",format:"YYYY/MM/DD",placeholder:["YYYY/MM/DD","YYYY/MM/DD"]},null,8,["value"]),a(g,{class:"modal-table","data-source":e(U),columns:n,"show-sorter-tooltip":!1,"row-selection":{columnTitle:"單選",columnWidth:"50px",type:"radio",selectedRowKeys:e(f).selectedRowKeys,onChange:F,preserveSelectedRowKeys:!0},pagination:{...e(u)},onChangePagination:h},null,8,["data-source","row-selection","pagination"])])]),_:1},8,["open"])}}}),q=[{key:"1",companyAccount:"VCSJ000100",companyName:"台灣大哥大-行動商務處",accountType:"內部服務",balance:3e4,status:"ACTIVE"},{key:"2",companyAccount:"VCSJ000200",companyName:"三竹資訊股份有限公司",accountType:"ADP 經銷商",balance:7e3,status:"ACTIVE"},{key:"3",companyAccount:"VCSJ000300",companyName:"富邦媒體科技股份有限公司",accountType:"一般公司/單位",balance:2e3,status:"ACTIVE"},{key:"4",companyAccount:"VCSJ000400",companyName:"新光三越百貨公司",accountType:"一般公司/單位",balance:1e3,status:"ACTIVE"},{key:"5",companyAccount:"VCSJ000500",companyName:"全國電子股份有限公司",accountType:"一般公司/單位",balance:2e4,status:"ACTIVE"},{key:"6",companyAccount:"VCSJ000600",companyName:"三商巧福",accountType:"一般公司/單位",balance:32e3,status:"ACTIVE"},{key:"7",companyAccount:"VCSJ000700",companyName:"全聯購物中心",accountType:"一般公司/單位",balance:7e4,status:"ACTIVE"},{key:"8",companyAccount:"VCSJ000800",companyName:"燦坤股份有限公司",accountType:"一般公司/單位",balance:3e3,status:"ACTIVE"},{key:"9",companyAccount:"VCSJ000900",companyName:"饗食天堂",accountType:"一般公司/單位",balance:12e3,status:"ACTIVE"},{key:"10",companyAccount:"VCSJ000120",companyName:"緯創資通",accountType:"一般公司/單位",balance:7e4,status:"ACTIVE"}];function ie(){const{list:b,pagination:N,setResponseList:w}=ue();return{getAccountsDataList:async p=>{const s=(p.current-1)*p.pageSize,f=Math.ceil(q.length/p.pageSize),n=q.slice(s,p.current*p.pageSize).map(A=>({...A}));w({total:q.length,pages:f,current:p.current,pageSize:p.pageSize,records:n})},accountsDataList:b,pagination:N,updateAccountsData:async p=>({data:{status:"success",id:"123"}})}}var pe=(b=>(b.NEW_AMOUNT="新增金額",b.REFUND="退款",b))(pe||{});const Le={class:"p-4 bg-sms-bg-light-mode-gray rounded-1.5 w-full mb-4 grid grid-cols-3 gap-4"},$e={class:"flex flex-col gap-1"},Ye=d("span",null,"日期",-1),Ee={class:"flex flex-col gap-1"},ze=d("span",null,"公司帳號",-1),Je={class:"flex flex-col gap-1 min-w-216px"},Ke=d("span",null,"公司名稱",-1),We={class:"flex flex-col gap-1"},Pe=d("span",null,"目前餘額",-1),je=Q({__name:"account-change-form",setup(b,{expose:N}){const{updateAccountsData:w}=ie(),_=C(!1),u=C(),s=B(xe({mode:"NEW_AMOUNT",orderNumber:"",isRefund:!1,price:"",reason:""})),f=B({price:[{message:"請輸入金額",required:!0,trigger:"blur"}],orderNumber:[{validator:async(c,t)=>(s.mode==="REFUND"&&await De().required("請選擇訂單單號").validate(t),Promise.resolve()),trigger:"blur"}]}),{validateInfos:n,resetFields:A,validate:U}=we(s,f);async function h(c){u.value=c,A(),_.value=!0}const R=me();function F(){U().then(async()=>{var t;((t=(await w(s)).data)==null?void 0:t.status)==="success"&&(R.success({message:"帳務異動成功",placement:"top"}),_.value=!1)}).catch(c=>{console.error(c)})}const y=C();function V(c){s.orderNumber=c.orderNumber,s.price=c.price}return N({show:h}),(c,t)=>{const r=ke,k=he,g=Ce,v=se,x=oe,T=Re,E=Se,z=Ve,J=ce,K=re,W=le;return S(),G(X,null,[a(W,{open:e(_),"onUpdate:open":t[6]||(t[6]=l=>ne(_)?_.value=l:null),centered:"",width:"600px","ok-text":"確定","cancel-text":"取消",onOk:F},{title:o(()=>[O(" 帳務異動 ")]),default:o(()=>[a(K,{model:e(s),class:"px-24px py-20px",layout:"vertical",autocomplete:"off"},{default:o(()=>{var l,i,D,M;return[d("div",Le,[d("div",$e,[Ye,d("span",null,I(e(Ae)().format("YYYY/MM/DD")),1)]),d("div",Ee,[ze,d("span",null,I((l=e(u))==null?void 0:l.companyAccount),1)]),d("div",Je,[Ke,d("span",null,I((i=e(u))==null?void 0:i.companyName),1)]),d("div",We,[Pe,d("span",null,"NT$"+I((M=(D=e(u))==null?void 0:D.balance)==null?void 0:M.toLocaleString(void 0,{minimumFractionDigits:2})),1)])]),a(J,{gutter:[16,4]},{default:o(()=>[a(v,{span:24},{default:o(()=>[a(g,L({label:"異動方式"},e(n).mode,{required:""}),{default:o(()=>[a(k,{value:e(s).mode,"onUpdate:value":t[0]||(t[0]=m=>e(s).mode=m)},{default:o(()=>[(S(!0),G(X,null,ve(Object.entries(e(pe)),([m,$])=>(S(),Y(r,{key:m,value:m},{default:o(()=>[O(I($),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16)]),_:1}),Z(a(v,{span:24,onClick:t[2]||(t[2]=m=>{var $;return($=e(y))==null?void 0:$.show()})},{default:o(()=>[a(g,L({label:"訂單單號"},e(n).orderNumber,{required:""}),{default:o(()=>[a(T,{value:e(s).orderNumber,"onUpdate:value":t[1]||(t[1]=m=>e(s).orderNumber=m),placeholder:"請選擇訂單單號",readonly:""},{suffix:o(()=>[a(x,{name:"search",width:"16px",color:"var(--grayscale-40)"})]),_:1},8,["value"])]),_:1},16)]),_:1},512),[[ee,e(s).mode==="REFUND"]]),Z(a(v,{span:24},{default:o(()=>[a(g,L({label:"刷卡退款"},e(n).isRefund),{default:o(()=>[a(E,{value:e(s).isRefund,"onUpdate:value":t[3]||(t[3]=m=>e(s).isRefund=m)},{default:o(()=>[O(" 退款同步刷卡退款 ")]),_:1},8,["value"])]),_:1},16)]),_:1},512),[[ee,e(s).mode==="REFUND"]]),a(v,{span:24},{default:o(()=>[a(g,L({label:e(s).isRefund?"新增金額":"退款金額"},e(n).price,{extra:"限制輸入數字，最多 6 位數(含小數後兩位)"}),{default:o(()=>[a(T,{value:e(s).price,"onUpdate:value":t[4]||(t[4]=m=>e(s).price=m),type:"number","addon-before":"NT$",placeholder:"請輸入金額"},null,8,["value"])]),_:1},16,["label"])]),_:1}),a(v,{span:24},{default:o(()=>[a(g,L({label:"異動原因"},e(n).reason,{extra:"150 字以內"}),{default:o(()=>[a(z,{value:e(s).reason,"onUpdate:value":t[5]||(t[5]=m=>e(s).reason=m),placeholder:"請輸入",maxlength:150,rows:4},null,8,["value"])]),_:1},16)]),_:1})]),_:1})]}),_:1},8,["model"])]),_:1},8,["open"]),a(Me,{ref_key:"selectOrderRef",ref:y,onSelectOrderData:V},null,512)],64)}}}),qe={class:"flex justify-end px-2 items-center py-4 bg-sms-grayscale-0 rounded-t-12px"},it=Q({__name:"index",setup(b){const N=C(),{getCompanyAttrOption:w,companyAttrOption:_}=Oe();w();const{getAccountsDataList:u,pagination:p,accountsDataList:s}=ie(),f=[{title:"公司帳號",dataIndex:"companyAccount",key:"companyAccount",width:257},{title:"公司名稱",dataIndex:"companyName",key:"companyName",width:200},{title:"公司屬性",dataIndex:"accountType",key:"accountType",width:120},{title:"剩餘金額",dataIndex:"balance",key:"balance",width:257,align:"right",customHeaderCell:()=>({class:"[&>*]:!justify-center"})},{title:"操作",dataIndex:"action",key:"action",width:66,fixed:"right"}];be(()=>{h(1)});const n=C({keyword:"",sortField:"updateTime",sortOrder:"descend",companyAccount:[],companyName:[],companyAttr:[]});async function A(c,t,r){console.log("sorter:",r),n.value=Object.assign(n.value,{sortField:r.field,sortOrder:r.order}),await h(p.value.current,p.value.pageSize)}async function U(c,t){await h(c,t)}async function h(c=1,t=10){const r={current:c,pageSize:t,...e(n)};await u(r)}const R=C(null);function F(){var c;h(1),(c=R.value)==null||c.hide()}const y=H(()=>s.value.map(c=>({label:c.companyAccount,value:c.companyAccount}))),V=H(()=>s.value.map(c=>({label:c.companyName,value:c.companyName})));return(c,t)=>{const r=ye,k=ge,g=Te,v=fe,x=se,T=_e,E=ce,z=re,J=oe,K=ae,W=de;return S(),Y(W,{title:"帳務資料管理"},{default:o(()=>[d("div",qe,[a(Ie,{ref_key:"filterKeywordInputRef",ref:R,modelValue:e(n).keyword,"onUpdate:modelValue":t[7]||(t[7]=l=>e(n).keyword=l),class:"w-355px h-40px",placeholder:"搜尋公司帳號、公司名稱",onClearFilter:t[8]||(t[8]=()=>{n.value={...e(n),keyword:"",companyAccount:[],companyName:[],companyAttr:[]}})},{filterForm:o(()=>[a(z,{layout:"vertical",model:e(n),autocomplete:"off"},{default:o(()=>[a(E,{gutter:[16,12]},{default:o(()=>[a(x,{span:24},{default:o(()=>[a(v,{label:"公司帳號",valueed:e(P)(e(n).companyAccount)},{default:o(()=>[a(g,{value:e(n).companyAccount,"onUpdate:value":t[1]||(t[1]=l=>e(n).companyAccount=l),options:e(y),"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" "},{dropdownRender:o(({menuNode:l})=>[a(r,{modelValue:e(n).companyAccount,"onUpdate:modelValue":t[0]||(t[0]=i=>e(n).companyAccount=i),menu:l,options:e(y)},null,8,["modelValue","menu","options"])]),option:o(({value:l,label:i})=>[a(k,{values:e(n).companyAccount,value:l,label:i},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),a(x,{span:24},{default:o(()=>[a(v,{label:"公司姓名",valueed:e(P)(e(n).companyName)},{default:o(()=>[a(g,{value:e(n).companyName,"onUpdate:value":t[3]||(t[3]=l=>e(n).companyName=l),options:e(V),"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" "},{dropdownRender:o(({menuNode:l})=>[a(r,{modelValue:e(n).companyName,"onUpdate:modelValue":t[2]||(t[2]=i=>e(n).companyName=i),menu:l,options:e(V)},null,8,["modelValue","menu","options"])]),option:o(({value:l,label:i})=>[a(k,{values:e(n).companyName,value:l,label:i},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),a(x,{span:24},{default:o(()=>[a(v,{label:"公司屬性",valueed:e(P)(e(n).companyAttr)},{default:o(()=>[a(g,{value:e(n).companyAttr,"onUpdate:value":t[5]||(t[5]=l=>e(n).companyAttr=l),options:e(_),"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label","menu-item-selected-icon":" "},{dropdownRender:o(({menuNode:l})=>[a(r,{modelValue:e(n).companyAttr,"onUpdate:modelValue":t[4]||(t[4]=i=>e(n).companyAttr=i),menu:l,options:e(_)},null,8,["modelValue","menu","options"])]),option:o(({value:l,label:i})=>[a(k,{values:e(n).companyAttr,value:l,label:i},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),a(x,{span:24,class:"text-center"},{default:o(()=>[a(T,{status:"small2",class:"me-5",onClick:t[6]||(t[6]=l=>{var i;return(i=e(R))==null?void 0:i.hide()})},{default:o(()=>[O(" 取消 ")]),_:1}),a(T,{status:"small1",onClick:F},{default:o(()=>[O(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(K,{"data-source":e(s),scroll:{x:"max-content"},columns:f,size:"small","show-sorter-tooltip":!1,pagination:{...e(p)},onChange:A,onChangePagination:U},{bodyCell:o(({column:l,record:i,text:D})=>[l.dataIndex==="balance"?(S(),G(X,{key:0},[O(" NT$"+I(D==null?void 0:D.toLocaleString(void 0,{minimumFractionDigits:2})),1)],64)):te("",!0),l.dataIndex==="action"?(S(),Y(T,{key:1,status:"small3",class:"!px-0",onClick:()=>{var M;(M=e(N))==null||M.show(i)}},{default:o(()=>[a(J,{class:"text-sms-primary-blue-80",name:"edit"})]),_:2},1032,["onClick"])):te("",!0)]),_:1},8,["data-source","pagination"]),a(je,{ref_key:"accountChangeFormRef",ref:N},null,512)]),_:1})}}});export{it as default};

import{_ as Re}from"./index.vuevuetypescriptsetuptruelang-DFR_D-F5.js";import{i as Ie,_ as Oe}from"./isSameOrBefore-2G9KFHvz.js";import{_ as Ve}from"./index.vuevuetypestyleindex0lang-braRYrGJ.js";import{_ as Ne}from"./index.vuevuetypestyleindex0lang-l354ccN2.js";import{k as Fe,_ as $e}from"./index-CVEM0gwZ.js";import{F as Ue}from"./index-Cwco8wzr.js";import{_ as Ye}from"./index.vuevuetypescriptsetuptruelang-DAISk7I9.js";import{_ as Pe,a as Be}from"./index.vuevuetypescriptsetuptruelang-DlliyulR.js";import{_ as De}from"./index-BLTwKazw.js";import{i as je}from"./isToday-CA9Qva4G.js";import{G as ie,o as V,x as Ae,t as Le,I as ze,O as Ge,y as He,F as Ke,K as Xe,N as We,z as qe,s as Je}from"./antd-CeareF1k.js";import{_ as Qe,a as Ze}from"./create-or-update-form.vuevuetypescriptsetuptruelang-Bm-SatO9.js";import{d as de,f,ak as ue,W as m,X as g,k as t,$ as s,u as e,_ as j,H as A,F as S,Y as o,D as et,w as tt,b as st,G as r,a7 as te,a9 as se,a6 as _,a4 as N,y as ae}from"./vue-BtcszhJV.js";import{a as at,b as ne,g as D}from"./tools-DInPKiE1.js";import{u as nt,M as ot}from"./message-sending-D33urHxz.js";import{S as oe}from"./SendStatusEnum-0TbEL80Y.js";import{_ as le}from"./index.vuevuetypescriptsetuptruelang-D5CASC0w.js";import"./context-B_CLxcrw.js";import"./index.vuevuetypescriptsetuptruelang-BxQ8nJie.js";import"./import-custom-message.vuevuetypescriptsetuptruelang-BA3M6Nqj.js";import"./index.esm-CLFC3Zjv.js";import"./index.vuevuetypestyleindex0lang-CcFzt3O-.js";import"./custom-message-CTJxwGfu.js";import"./request-DRo2j7AZ.js";import"./MessageTypeEnum-BTP2Abk2.js";import"./contact-person-D4YAG4qU.js";import"./group-label-BZTUg2X5.js";import"./route-leave-Czz5DaJN.js";const lt=o("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 編輯的內容將不會儲存 ",-1),it=de({__name:"message-sending-edit-modal",setup(re,{expose:l}){const x=f(!1),v=f(),I=f(!1);function F(h,c){v.value=h,I.value=c,x.value=!0}const{post:$}=ue({name:"in-message-sending-page"}),b=f(!1);function O(h,c){h?(x.value=!1,c&&$(c)):b.value=!0}return l({show:F}),(h,c)=>{const i=ie;return m(),g(S,null,[t(i,{open:e(x),"onUpdate:open":c[0]||(c[0]=M=>A(x)?x.value=M:null),title:"編輯訊息行銷活動",width:"960px","destroy-on-close":!0,footer:null,"mask-closable":!1},{default:s(()=>[e(I)?(m(),j(Ze,{key:1,id:e(v),"is-create":!1,"edit-callback":O,"show-preview":!1},null,8,["id"])):(m(),j(Qe,{key:0,id:e(v),"is-create":!1,"edit-callback":O,"show-preview":!1},null,8,["id"]))]),_:1},8,["open"]),t(i,{open:e(b),"onUpdate:open":c[1]||(c[1]=M=>A(b)?b.value=M:null),title:"是否取消編輯？",width:"400px",centered:"","z-index":2e3,onOk:c[2]||(c[2]=()=>{x.value=!1,b.value=!1})},{default:s(()=>[lt]),_:1},8,["open"])],64)}}}),dt={class:"pt-4 flex items-center pb-3"},ut=["onClick"],rt={class:"flex flex-col gap-4"},mt={class:"flex justify-between items-center mb-2"},ct={class:"font-600 text-sm pe-2"},pt={class:"flex flex-col gap-1 justify-end items-end"},_t={class:"text-sms-grayscale-60 font-500 text-xs"},ft={class:"font-400 text-sm text-sms-grayscale-80 tracking-[0.02em] whitespace-pre-wrap line-clamp-2"},gt={class:"text-end py-4"},xt=o("br",null,null,-1),vt={key:0,class:"flex items-center pb-4"},bt={key:0,id:"chat-message-content"},ht=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 活動名稱 ",-1),yt={class:"text-base font-400 text-sms-grayscale-100"},wt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 帳號 ",-1),kt={class:"text-base font-400 text-sms-grayscale-100 break-words"},St=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送時間 ",-1),Mt={class:"text-base font-400 text-sms-grayscale-100"},Tt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送編號 ",-1),Ct={class:"text-base font-400 text-sms-grayscale-100 break-words"},Et=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息類型 ",-1),Rt={class:"text-base font-400 text-sms-grayscale-100"},It=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送門號 ",-1),Ot={class:"text-base font-400 text-sms-grayscale-100"},Vt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 接收門號明細 ",-1),Nt={class:"flex flex-col"},Ft={class:"border-t-solid border-t border-t-sms-border-light-mode-light-gary p-4 mb-2"},$t=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息內容 ",-1),Ut=["innerHTML"],Yt={key:0,class:"px-4 pb-0 h-full"},Pt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 多媒體檔案 ",-1),Bt={class:"flex gap-2"},Dt={class:"max-h-60px mb-2"},jt={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},At={class:"mt-4 p-4 border-t-solid border-t border-t-sms-border-light-mode-light-gary"},Lt={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},zt={href:"javascript:;"},Gt=o("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 刪除的訊息將無法復原 ",-1),Ht={class:"px-30px py-20px w-328px text-base mx-auto"},Kt=o("span",{class:"me-2"},"訊息類型",-1),Xt={href:"javascript:;"},Wt=o("br",null,null,-1),Ss=de({__name:"index",setup(re){V.extend(je),V.extend(Ie);const l=f(),x=f(),v=f(),I=Fe(),{getMessageSendings:F,messageSendings:$,pagination:b,getActiveStatusLabel:O,getMessageSending:h,messageSending:c}=nt(),i=f({keyword:"",name:"",phone:void 0,sendStatus:[],messageStatus:[],sendTime:void 0});async function M(d){l.value=d,await ae();const a=document.getElementById("message-content");a&&(a.scrollTop=0)}et(()=>{U()});async function U(d=1,a=10){const E={current:d,pageSize:a,...e(i)};await F(E)}function me(d,a){U(d,a??10)}function ce(){var d;U(1),(d=v.value)==null||d.hide()}const pe={RESERVATION:"text-sms-yellow-60 bg-#F7F2E8",EXECUTING:"text-sms-primary-blue-80 bg-sms-primary-blue-30",IS_SENT:"text-sms-green-80 bg-sms-green-30",RESERVATION_FAILED:"text-sms-status-alert-red bg-sms-light-red-40"},T=f([]);async function _e(d,a){await ae(),T.value&&T.value[a]&&(d?T.value[a].playVideo():T.value[a].pauseVideo())}const C=f(!1);function fe(){C.value=!0}function ge(){l.value=void 0,C.value=!1,I.success({message:"訊息刪除成功",placement:"top"})}const L=[{label:"0935-111-111",value:"0935-111-111"},{label:"0947-127-998",value:"0947-127-998"},{label:"0958-892-006",value:"0958-892-006"}],z=Object.entries(oe).map(([d,a])=>({label:a,value:d})),G=Object.entries(ot).map(([d,a])=>({label:a,value:d})),y=f({open:!1,isParameter:!1}),H=f(null);function xe(){var d;l.value&&((d=H.value)==null||d.show(l.value.key,l.value.isParameter))}const{data:ve,close:be}=ue({name:"in-message-sending-page"});return tt(ve,async d=>{await h(d),l.value=c.value}),st(()=>{be()}),(d,a)=>{const E=Ae,R=De,p=Le,K=Pe,X=Be,he=ze,ye=Ge,w=Ye,W=He,q=Ke,we=Ue,k=$e,ke=Ne,Y=Xe,Se=Ve,Me=Oe,J=ie,Q=We,Te=qe,Ce=Je,Ee=Re;return m(),j(Ee,{title:"訊息發送"},{default:s(()=>[t(Me,{"show-right-empty":!e(l)},{leftTop:s(()=>[o("div",dt,[t(we,{ref_key:"filterKeywordInputRef",ref:v,modelValue:e(i).keyword,"onUpdate:modelValue":a[8]||(a[8]=n=>e(i).keyword=n),height:"40px",class:"flex-1 me-2",placeholder:"搜尋活動名稱、訊息內容",onClearFilter:a[9]||(a[9]=()=>{i.value={...e(i),keyword:"",name:"",phone:void 0,sendStatus:[],messageStatus:[],sendTime:void 0}})},{filterForm:s(()=>[t(q,{ref_key:"formRef",ref:x,layout:"vertical",model:e(i),autocomplete:"off"},{default:s(()=>[t(W,{gutter:[16,12]},{default:s(()=>[t(p,{span:24},{default:s(()=>[t(R,{label:"發送門號",valueed:e(at)(e(i).phone,L)},{default:s(()=>[t(E,{value:e(i).phone,"onUpdate:value":a[0]||(a[0]=n=>e(i).phone=n),options:L,"allow-clear":"",class:"w-full"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24},{default:s(()=>[t(R,{label:"活動狀態",valueed:e(ne)(e(i).sendStatus)},{default:s(()=>[t(E,{value:e(i).sendStatus,"onUpdate:value":a[2]||(a[2]=n=>e(i).sendStatus=n),options:e(z),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full","menu-item-selected-icon":" "},{dropdownRender:s(({menuNode:n})=>[t(K,{modelValue:e(i).sendStatus,"onUpdate:modelValue":a[1]||(a[1]=u=>e(i).sendStatus=u),menu:n,options:e(z)},null,8,["modelValue","menu","options"])]),option:s(({value:n,label:u})=>[t(X,{values:e(i).sendStatus,value:n,label:u},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24},{default:s(()=>[t(R,{label:"活動名稱",valueed:e(i).name},{default:s(()=>[t(he,{value:e(i).name,"onUpdate:value":a[3]||(a[3]=n=>e(i).name=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24},{default:s(()=>[t(R,{label:"訊息類型",valueed:e(ne)(e(i).messageStatus)},{default:s(()=>[t(E,{value:e(i).messageStatus,"onUpdate:value":a[5]||(a[5]=n=>e(i).messageStatus=n),options:e(G),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full","menu-item-selected-icon":" "},{dropdownRender:s(({menuNode:n})=>[t(K,{modelValue:e(i).messageStatus,"onUpdate:modelValue":a[4]||(a[4]=u=>e(i).messageStatus=u),menu:n,options:e(G)},null,8,["modelValue","menu","options"])]),option:s(({value:n,label:u})=>[t(X,{values:e(i).messageStatus,value:n,label:u},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24},{default:s(()=>[t(R,{label:"發送時間",valueed:e(i).sendTime},{default:s(()=>[t(ye,{value:e(i).sendTime,"onUpdate:value":a[6]||(a[6]=n=>e(i).sendTime=n),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24,class:"text-center"},{default:s(()=>[t(w,{status:"small2",class:"me-5",onClick:a[7]||(a[7]=n=>{var u;return(u=e(v))==null?void 0:u.hide()})},{default:s(()=>[r(" 取消 ")]),_:1}),t(w,{status:"small1",onClick:ce},{default:s(()=>[r(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(w,{status:"small1",onClick:a[10]||(a[10]=()=>{y.value={open:!0,isParameter:!1}})},{icon:s(()=>[t(k,{name:"plus",width:"16px"})]),default:s(()=>[r(" 新增訊息行銷活動 ")]),_:1})])]),left:s(()=>[o("ul",null,[(m(!0),g(S,null,te(e($),n=>{var u;return m(),g("li",{key:n.key,class:se(["p-4 border-b-solid border-b-1 border-b-sms-light-gray-60 last:mb-2 cursor-pointer",{"bg-sms-bg-light-mode-gray":n.key===((u=e(l))==null?void 0:u.key)}]),onClick:P=>M(n)},[o("div",rt,[o("div",mt,[o("span",ct,_(n.name),1),o("div",pt,[o("span",{class:se(["rounded-2 text-center py-1 px-2 text-xs font-500",{[pe[n.sendStatus]]:!0}])},_(e(oe)[n.sendStatus]),3),o("span",_t,_(e(V)(n.sendTime).isToday()?"今天":e(V)(n.sendTime).format("YYYY/MM/DD")),1)])]),o("div",ft,_(n.content),1)])],10,ut)}),128))])]),leftBottom:s(()=>[o("div",gt,[t(ke,{pagination:e(b),onChange:me},null,8,["pagination"])])]),rightEmptyMessage:s(()=>[r(" 點擊左側行銷活動"),xt,r("檢視行銷活動資訊 ")]),rightTop:s(()=>[e(l)?(m(),g("div",vt,[t(w,{status:"small2",class:"me-2",disabled:e(l).sendStatus!=="RESERVATION",onClick:xe},{icon:s(()=>[t(k,{name:"edit",width:"16px"})]),default:s(()=>[r(" 編輯 ")]),_:1},8,["disabled"]),t(w,{status:"small2",class:"me-2",disabled:e(l).sendStatus!=="RESERVATION",onClick:fe},{icon:s(()=>[t(k,{name:"delete",width:"16px"})]),default:s(()=>[r(" 刪除預約 ")]),_:1},8,["disabled"])])):N("",!0)]),right:s(()=>[e(l)?(m(),g("div",bt,[t(W,{gutter:[16,16],class:"mb-4 px-4"},{default:s(()=>[t(p,{span:24},{default:s(()=>[ht,o("div",yt,_(e(l).name),1)]),_:1}),t(p,{span:8},{default:s(()=>[wt,o("div",kt,_(e(l).account),1)]),_:1}),t(p,{span:8},{default:s(()=>[St,o("div",Mt,_(e(l).sendTime),1)]),_:1}),t(p,{span:8},{default:s(()=>[Tt,o("div",Ct,_(e(l).sendNumber),1)]),_:1}),t(p,{span:8},{default:s(()=>[Et,o("div",Rt,_(e(O)(e(l).messageType,e(l).isParameter)),1)]),_:1}),t(p,{span:8},{default:s(()=>[It,o("div",Ot,_(e(l).phone),1)]),_:1}),t(p,{span:8},{default:s(()=>[Vt,o("div",null,[t(w,{status:"small2",class:"me-2"},{icon:s(()=>[t(k,{name:"download",width:"16px"})]),default:s(()=>[r(" 匯出 ")]),_:1})])]),_:1})]),_:1}),o("div",Nt,[o("div",Ft,[$t,o("div",{class:"break-words text-base",innerHTML:e(l).content},null,8,Ut)]),e(l).multimediaFile&&e(l).messageType==="MMS"&&e(l).multimediaFile.length>0?(m(),g("div",Yt,[Pt,o("div",Bt,[(m(!0),g(S,null,te(e(l).multimediaFile,(n,u)=>{var P,Z,ee;return m(),g("div",{key:n.url,class:"w-120px"},[t(Y,{placement:(P=e(l))!=null&&P.multimediaFile&&u===((ee=(Z=e(l))==null?void 0:Z.multimediaFile)==null?void 0:ee.length)-1?"topRight":"top","get-popup-container":e(D),"overlay-inner-style":{width:"384px",height:"304px"},onOpenChange:B=>_e(B,u)},{title:s(()=>[t(le,{ref_for:!0,ref:B=>e(T)[u]=B,source:n,size:"small","show-del-btn":!1,"show-file-name":!1,"image-class":"object-cover w-80% h-full mx-auto block"},null,8,["source"])]),default:s(()=>[o("div",Dt,[t(le,{source:n,size:"small","show-del-btn":!1,"can-play":!1,"show-file-name":!1,"image-class":"object-cover w-80% h-full mx-auto block"},null,8,["source"])]),o("div",jt,_(n.fileName),1)]),_:2},1032,["placement","get-popup-container","onOpenChange"])])}),128))])])):N("",!0),o("div",At,[o("div",Lt,[r(" 發送統計 "),t(Y,{placement:"top","get-popup-container":e(D)},{title:s(()=>[r(" 發送失敗的接收門號和原因，可參考報表細節或匯出明細，發送中和發送成功以外皆為發送失敗，例如: 發送過期、主帳號有設定黑名單等狀況 ")]),default:s(()=>[o("a",zt,[t(k,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),t(Se,{columns:[{title:"發送總數",dataIndex:"total",key:"total",width:"89px",align:"center"},{title:"發送中",dataIndex:"sending",key:"sending",width:"89px",align:"center"},{title:"發送成功",dataIndex:"success",key:"success",width:"89px",align:"center"},{title:"發送失敗",dataIndex:"fail",key:"fail",width:"89px",align:"center"},{title:"成功率",dataIndex:"successRate",key:"successRate",width:"89px",align:"center"}],"data-source":[e(l).statistics]},{bodyCell:s(({column:n,text:u})=>[e(l).sendStatus==="RESERVATION"&&n.dataIndex!=="total"?(m(),g(S,{key:0},[r(" - ")],64)):(m(),g(S,{key:1},[n.dataIndex==="successRate"?(m(),g(S,{key:0},[r(_(u)+"% ",1)],64)):N("",!0)],64))]),_:1},8,["data-source"])])])])):N("",!0)]),_:1},8,["show-right-empty"]),t(J,{open:e(C),"onUpdate:open":a[11]||(a[11]=n=>A(C)?C.value=n:null),title:"是否刪除已預約的訊息？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:ge},{default:s(()=>[Gt]),_:1},8,["open"]),t(J,{open:e(y).open,"onUpdate:open":a[13]||(a[13]=n=>e(y).open=n),title:"選擇訊息類型",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:a[14]||(a[14]=()=>{d.$router.push({name:e(y).isParameter?"MessageSendingParameterCreate":"MessageSendingGeneralCreate"})})},{default:s(()=>[o("div",Ht,[t(q,{layout:"vertical",autocomplete:"off"},{default:s(()=>[t(Ce,{"html-for":""},{label:s(()=>[Kt,t(Y,{placement:"top","get-popup-container":e(D)},{title:s(()=>[r(" 一般訊息支援 SMS 和 MMS，"),Wt,r(" 若想批次使用參數發送訊息，請選擇參數訊息 ")]),default:s(()=>[o("a",Xt,[t(k,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(Te,{value:e(y).isParameter,"onUpdate:value":a[12]||(a[12]=n=>e(y).isParameter=n)},{default:s(()=>[t(Q,{value:!1},{default:s(()=>[r(" 一般訊息 ")]),_:1}),t(Q,{value:!0},{default:s(()=>[r(" 參數訊息 ")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])]),_:1},8,["open"]),t(it,{ref_key:"messageSendingEditModal",ref:H},null,512)]),_:1})}}});export{Ss as default};

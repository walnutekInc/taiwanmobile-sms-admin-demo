import{F as Q,_ as Z}from"./request-3552e6c3.js";import{_ as ee}from"./index-4b80b22a.js";import{g as te,_ as ae,b as oe}from"./index.vuevuetypescriptsetuptruelang-8068f11a.js";import{_ as se}from"./index.vuevuetypescriptsetuptruelang-374ce0ee.js";import{h as ne,k as le,_ as ue}from"./index-b55f1cdf.js";import{u as de}from"./sms-category-88642280.js";import{u as re}from"./custom-message-45117b67.js";import{d as ie,f as g,ad as ce,ac as me,D as pe,o as _e,r as fe,u as e,W as w,X as Y,_ as ge,k as a,$ as o,G as c,E as ve,a4 as K,Y as x,a3 as F,H as ye,F as we}from"./vue-b9a22f97.js";import{s as xe,r as ke,I as Ce,U as Ie,u as Re,F as Te,G as Me}from"./antd-16a0cd46.js";const be={class:"flex justify-between px-2 items-center mb-2"},he={key:0,class:"line-clamp-2"},Ye=x("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 您選擇的自訂訊息將永久刪除。 ",-1),Le=ie({__name:"custom-message",setup(Ke){var M;const{getSmsCategoryOption:S,smsCategoryOption:k}=de(),{customMessages:C,getCustomMessages:D,pagination:m,deleteCustomMessage:O}=re(),I=g(!1),R=ne(),V=ce(),T=me();pe(async()=>{await S(),v(),R.handleOpenKeys(["/sms-marketing"]),R.handleSelectedKeys(["/sms-marketing/custom-message"])}),_e(()=>{I.value=!0});const U=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"160px"},{title:"訊息名稱",dataIndex:"name",key:"name",sorter:!0,width:"160px"},{title:"訊息內容",dataIndex:"content",key:"content",sorter:!0,width:"265px"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"180px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0,width:"180px"}],u=fe({selectedRowKeys:[],selectedRows:[],loading:!1}),N=(l,t)=>{console.log("selectedRowKeys changed: ",l,t),u.selectedRowKeys=l,u.selectedRows=t},s=g({categoryIds:(M=T.query)!=null&&M.categoryId?T.query.categoryId:[],keyword:"",name:"",content:"",createTime:[void 0,void 0],updateTime:[void 0,void 0],sortField:"createTime",sortOrder:"descend"}),$=g(),v=async(l=1,t=10)=>{let d={current:l,pageSize:t,...e(s)};await D(d)},B=async(l,t,d)=>{console.log("pagination:",l,"sorter:",d),s.value=Object.assign(s.value,{sortField:d.field,sortOrder:d.order}),await v(l.current,l.pageSize)},L=()=>{V.push({name:"CustomMessageEdit",params:{id:u.selectedRowKeys[0]}})},y=g(null),E=()=>{var l;v(1),(l=y.value)==null||l.hide()},j=le(),p=g(!1),q=()=>{p.value=!0},z=async()=>{var t;((t=(await O(u.selectedRowKeys)).data)==null?void 0:t.status)==="success"&&(j.success({message:"自訂訊息刪除成功",placement:"top"}),v(m.value.current===1||C.value.length-u.selectedRowKeys.length>1?m.value.current:m.value.current-1,m.value.pageSize),p.value=!1,u.selectedRowKeys=[],u.selectedRows=[])};return(l,t)=>{const d=ue,_=se,G=ae,P=oe,A=xe,f=ee,i=ke,b=Ce,h=Ie,H=Re,W=Te,X=Z,J=Me;return w(),Y(we,null,[e(I)?(w(),ge(ve,{key:0,to:"#extraContent"},[a(_,{status:"small1",onClick:t[0]||(t[0]=()=>l.$router.push({name:"CustomMessageCreate"}))},{icon:o(()=>[a(d,{name:"plus",width:"16px"})]),default:o(()=>[c("新增自訂訊息 ")]),_:1})])):K("",!0),x("div",be,[x("div",null,[a(_,{status:"small2",class:"me-2",disabled:e(u).selectedRowKeys.length===0||e(u).selectedRowKeys.length>1,onClick:L},{icon:o(()=>[a(d,{name:"edit",width:"16px"})]),default:o(()=>[c("編輯 ")]),_:1},8,["disabled"]),a(_,{status:"small2",class:"me-2",onClick:q,disabled:e(u).selectedRowKeys.length===0},{icon:o(()=>[a(d,{name:"delete",width:"16px"})]),default:o(()=>[c("刪除 ")]),_:1},8,["disabled"])]),a(Q,{ref_key:"filterKeywordInputRef",ref:y,class:"w-440px h-40px",modelValue:e(s).keyword,"onUpdate:modelValue":t[8]||(t[8]=n=>e(s).keyword=n),placeholder:"搜尋訊息類別、名稱和內容",onClearFilter:t[9]||(t[9]=()=>{s.value={...e(s),categoryIds:[],keyword:"",name:"",content:"",createTime:[void 0,void 0],updateTime:[void 0,void 0]}})},{filterForm:o(()=>[a(W,{ref_key:"formRef",ref:$,layout:"vertical",model:e(s),autocomplete:"off"},{default:o(()=>[a(H,{gutter:[16,12]},{default:o(()=>[a(i,{span:24},{default:o(()=>[a(f,{id:"group",label:"訊息類別",valueed:e(te)(e(s).categoryIds)},{default:o(()=>[a(A,{options:e(k),maxTagCount:2,showArrow:!0,mode:"multiple",value:e(s).categoryIds,"onUpdate:value":t[2]||(t[2]=n=>e(s).categoryIds=n),class:"w-full",optionFilterProp:"label"},{dropdownRender:o(({menuNode:n})=>[a(G,{menu:n,modelValue:e(s).categoryIds,"onUpdate:modelValue":t[1]||(t[1]=r=>e(s).categoryIds=r),options:e(k)},null,8,["menu","modelValue","options"])]),option:o(({value:n,label:r})=>[a(P,{values:e(s).categoryIds,value:n,label:r},null,8,["values","value","label"])]),menuItemSelectedIcon:o(()=>[c(F(""))]),_:1},8,["options","value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24},{default:o(()=>[a(f,{label:"訊息名稱",valueed:e(s).name},{default:o(()=>[a(b,{value:e(s).name,"onUpdate:value":t[3]||(t[3]=n=>e(s).name=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24},{default:o(()=>[a(f,{label:"訊息內容",valueed:e(s).content},{default:o(()=>[a(b,{value:e(s).content,"onUpdate:value":t[4]||(t[4]=n=>e(s).content=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24},{default:o(()=>[a(f,{label:"建立時間",valueed:e(s).createTime},{default:o(()=>[a(h,{class:"w-full",value:e(s).createTime,"onUpdate:value":t[5]||(t[5]=n=>e(s).createTime=n),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24},{default:o(()=>[a(f,{label:"修改時間",valueed:e(s).updateTime},{default:o(()=>[a(h,{class:"w-full",value:e(s).updateTime,"onUpdate:value":t[6]||(t[6]=n=>e(s).updateTime=n),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24,class:"text-center"},{default:o(()=>[a(_,{status:"small2",class:"me-5",onClick:t[7]||(t[7]=n=>{var r;return(r=e(y))==null?void 0:r.hide()})},{default:o(()=>[c("取消")]),_:1}),a(_,{status:"small1",onClick:E},{default:o(()=>[c("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(X,{dataSource:e(C),columns:U,showSorterTooltip:!1,"row-selection":{selectedRowKeys:e(u).selectedRowKeys,onChange:N},onChange:B,pagination:{...e(m)}},{bodyCell:o(({column:n,text:r})=>[n.dataIndex==="content"?(w(),Y("div",he,F(r),1)):K("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),a(J,{open:e(p),"onUpdate:open":t[10]||(t[10]=n=>ye(p)?p.value=n:null),title:"是否刪除選取的自訂訊息？",centered:"",cancelText:"取消",okText:"確定",onOk:z,width:"440px"},{default:o(()=>[Ye]),_:1},8,["open"])],64)}}});export{Le as _};

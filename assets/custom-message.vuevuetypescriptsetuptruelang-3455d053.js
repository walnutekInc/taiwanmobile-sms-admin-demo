import{F as J,_ as Q}from"./request-3f3ec6f8.js";import{_ as Z}from"./index-42c0980c.js";import{_ as ee}from"./index.vuevuetypescriptsetuptruelang-4fca776e.js";import{h as te,k as ae,_ as oe}from"./index-76f22c88.js";import{u as se}from"./sms-category-4878f09d.js";import{g as ne}from"./tools-a2ffc173.js";import{u as le}from"./custom-message-3c439f37.js";import{d as ue,f as g,ad as de,ac as re,D as ce,o as ie,r as me,u as e,W as w,X as Y,_ as pe,k as t,$ as o,G as r,E as _e,a4 as K,Y as k,a3 as x,H as fe,F as ge}from"./vue-b9a22f97.js";import{C as ve,s as ye,r as we,I as xe,P as ke,u as Ce,F as he,E as Te}from"./antd-b020a38c.js";const Re={class:"flex justify-between px-2 items-center mb-2"},Ie={key:0,class:"line-clamp-2"},Me=k("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 您選擇的自訂訊息將永久刪除。 ",-1),$e=ue({__name:"custom-message",setup(be){var I;const{getSmsCategoryOption:F,smsCategoryOption:S}=se(),{customMessages:C,getCustomMessages:D,pagination:m,deleteCustomMessage:O}=le(),h=g(!1),T=te(),N=de(),R=re();ce(async()=>{await F(),v(),T.handleOpenKeys(["/sms-marketing"]),T.handleSelectedKeys(["/sms-marketing/custom-message"])}),ie(()=>{h.value=!0});const U=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"160px"},{title:"訊息名稱",dataIndex:"name",key:"name",sorter:!0,width:"160px"},{title:"訊息內容",dataIndex:"content",key:"content",sorter:!0,width:"265px"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"180px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0,width:"180px"}],u=me({selectedRowKeys:[],selectedRows:[],loading:!1}),V=(l,a)=>{console.log("selectedRowKeys changed: ",l,a),u.selectedRowKeys=l,u.selectedRows=a},s=g({categoryIds:(I=R.query)!=null&&I.categoryId?[R.query.categoryId]:[],keyword:"",name:"",content:"",createTime:[void 0,void 0],updateTime:[void 0,void 0],sortField:"createTime",sortOrder:"descend"}),$=g(),v=async(l=1,a=10)=>{let d={current:l,pageSize:a,...e(s)};await D(d)},B=async(l,a,d)=>{console.log("pagination:",l,"sorter:",d),s.value=Object.assign(s.value,{sortField:d.field,sortOrder:d.order}),await v(l.current,l.pageSize)},E=()=>{N.push({name:"CustomMessageEdit",params:{id:u.selectedRowKeys[0]}})},y=g(null),L=()=>{var l;v(1),(l=y.value)==null||l.hide()},P=ae(),p=g(!1),j=()=>{p.value=!0},q=async()=>{var a;((a=(await O(u.selectedRowKeys)).data)==null?void 0:a.status)==="success"&&(P.success({message:"自訂訊息刪除成功",placement:"top"}),v(m.value.current===1||C.value.length-u.selectedRowKeys.length>1?m.value.current:m.value.current-1,m.value.pageSize),p.value=!1,u.selectedRowKeys=[],u.selectedRows=[])};return(l,a)=>{const d=oe,_=ee,z=ve,A=ye,f=Z,c=we,M=xe,b=ke,G=Ce,H=he,W=Q,X=Te;return w(),Y(ge,null,[e(h)?(w(),pe(_e,{key:0,to:"#extraContent"},[t(_,{status:"small1",onClick:a[0]||(a[0]=()=>l.$router.push({name:"CustomMessageCreate"}))},{icon:o(()=>[t(d,{name:"plus",width:"16px"})]),default:o(()=>[r("新增自訂訊息 ")]),_:1})])):K("",!0),k("div",Re,[k("div",null,[t(_,{status:"small2",class:"me-2",disabled:e(u).selectedRowKeys.length===0||e(u).selectedRowKeys.length>1,onClick:E},{icon:o(()=>[t(d,{name:"edit",width:"16px"})]),default:o(()=>[r("編輯 ")]),_:1},8,["disabled"]),t(_,{status:"small2",class:"me-2",onClick:j,disabled:e(u).selectedRowKeys.length===0},{icon:o(()=>[t(d,{name:"delete",width:"16px"})]),default:o(()=>[r("刪除 ")]),_:1},8,["disabled"])]),t(J,{ref_key:"filterKeywordInputRef",ref:y,class:"w-440px h-40px",modelValue:e(s).keyword,"onUpdate:modelValue":a[7]||(a[7]=n=>e(s).keyword=n),placeholder:"搜尋訊息類別、名稱和內容",onClearFilter:a[8]||(a[8]=()=>{s.value={...e(s),categoryIds:[],keyword:"",name:"",content:"",createTime:[void 0,void 0],updateTime:[void 0,void 0]}})},{filterForm:o(()=>[t(H,{ref_key:"formRef",ref:$,layout:"vertical",model:e(s),autocomplete:"off"},{default:o(()=>[t(G,{gutter:[16,12]},{default:o(()=>[t(c,{span:24},{default:o(()=>[t(f,{id:"group",label:"訊息類別",valueed:e(ne)(e(s).categoryIds)},{default:o(()=>[t(A,{options:e(S),maxTagCount:2,showArrow:!0,mode:"multiple",value:e(s).categoryIds,"onUpdate:value":a[1]||(a[1]=n=>e(s).categoryIds=n),class:"w-full",optionFilterProp:"label"},{option:o(({value:n,label:i})=>[t(z,{checked:e(s).categoryIds.includes(n)},null,8,["checked"]),r(" "+x(i),1)]),menuItemSelectedIcon:o(()=>[r(x(""))]),_:1},8,["options","value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24},{default:o(()=>[t(f,{label:"訊息名稱",valueed:e(s).name},{default:o(()=>[t(M,{value:e(s).name,"onUpdate:value":a[2]||(a[2]=n=>e(s).name=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24},{default:o(()=>[t(f,{label:"訊息類別",valueed:e(s).content},{default:o(()=>[t(M,{value:e(s).content,"onUpdate:value":a[3]||(a[3]=n=>e(s).content=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24},{default:o(()=>[t(f,{label:"建立時間",valueed:e(s).createTime},{default:o(()=>[t(b,{class:"w-full",value:e(s).createTime,"onUpdate:value":a[4]||(a[4]=n=>e(s).createTime=n),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24},{default:o(()=>[t(f,{label:"修改時間",valueed:e(s).updateTime},{default:o(()=>[t(b,{class:"w-full",value:e(s).updateTime,"onUpdate:value":a[5]||(a[5]=n=>e(s).updateTime=n),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24,class:"text-center"},{default:o(()=>[t(_,{status:"small2",class:"me-5",onClick:a[6]||(a[6]=n=>{var i;return(i=e(y))==null?void 0:i.hide()})},{default:o(()=>[r("取消")]),_:1}),t(_,{status:"small1",onClick:L},{default:o(()=>[r("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(W,{dataSource:e(C),columns:U,showSorterTooltip:!1,scroll:{x:1500},"row-selection":{selectedRowKeys:e(u).selectedRowKeys,onChange:V},onChange:B,pagination:{...e(m)}},{bodyCell:o(({column:n,text:i})=>[n.dataIndex==="content"?(w(),Y("div",Ie,x(i),1)):K("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),t(X,{open:e(p),"onUpdate:open":a[9]||(a[9]=n=>fe(p)?p.value=n:null),title:"是否刪除選取的自訂訊息？",centered:"",cancelText:"取消",okText:"確定",onOk:q,width:"440px"},{default:o(()=>[Me]),_:1},8,["open"])],64)}}});export{$e as _};

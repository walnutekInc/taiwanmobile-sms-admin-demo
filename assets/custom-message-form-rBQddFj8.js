import{_ as Ve}from"./index.vuevuetypescriptsetuptruelang-BHpZE1mE.js";import{d as Z,ag as $e,ah as De,o as Me,j as He,r as G,f as y,w as fe,y as Pe,W as P,X as ae,_ as Y,u as e,a8 as qe,Y as _,Q as Ne,F as ue,k as t,$ as n,a3 as le,a4 as Re,H as B,G as $,ab as A,m as Q,A as J,a9 as je,a5 as Be,ad as Te,l as Ke,ac as Ge,c as Oe,D as ze,B as We}from"./vue-B4jB9Tcu.js";import{_ as ie}from"./index.vuevuetypescriptsetuptruelang-BBQ64wtr.js";import{_ as Ie,j as Qe,h as Je,k as Xe}from"./index-BBYcgvXw.js";import{N as K,O as ce,P as _e,Q as ge,I as ve,n as xe,o as ye,r as he,F as be,U as Ye,p as Le,w as Ze,V as et,W as tt,B as nt,K as ot}from"./antd-DY4CO-8O.js";import{_ as at}from"./index.vuevuetypestyleindex0lang-BAtjMpJ7.js";import{F as lt}from"./request-BYOfeCit.js";import{u as Ue,r as me,a as st}from"./custom-message-gi8YCxGH.js";import{c as pe,a as rt,b as Se}from"./index.esm-BjCJ_GfD.js";import{u as ut}from"./sms-category-lx6Vb9og.js";import"./context-D1KotjcU.js";const it={class:"form-textarea-tools py-2"},ct="div",dt=Z({__name:"index",props:$e({contenteditable:{type:[Boolean,String],default:!0},noHtml:{type:Boolean,default:!1},noNl:{type:Boolean,default:!1},maxLen:{type:Number},contentLen:{type:Number},placeholder:String},{modelValue:{required:!0},modelModifiers:{}}),emits:$e({returned:String},["update:modelValue"]),setup(I,{emit:w}){const m=I,R=w;function x(l,a,M){return l.split(a).join(M)}const r=De(I,"modelValue");Me(()=>{document.addEventListener("selectionchange",O)}),He(()=>{document.removeEventListener("selectionchange",O)});function d(){return`r${new Date().getTime()}d${Math.ceil(Math.random()*1e3)}`}const T=G({contentId:`content${d()}`,isLocked:!1,currentTagId:null,savedRange:{}});function O(){var a;const l=window.getSelection();if(l){const M=l.rangeCount>0?l.getRangeAt(0):null;M&&((a=M.commonAncestorContainer.ownerDocument)!=null&&a.activeElement)&&M.commonAncestorContainer.ownerDocument.activeElement.id===T.contentId&&(T.savedRange=M)}}const h=y();function c(){return m.noHtml?h.value.textContent:h.value.innerHTML}function o(l){m.noHtml?h.value.textContent=e(l):h.value.innerHTML=e(l)}function L(){r.value=c()}function p(l){l.preventDefault();let a=(l.originalEvent||l).clipboardData.getData("text/plain");if(m.noNl&&(a=x(a,`\r
`," "),a=x(a,`
`," "),a=x(a,"\r"," ")),m.contentLen&&m.maxLen&&m.contentLen+a.length>=m.maxLen)return l.keyCode===8,void 0;console.log("paste"),window.document.execCommand("insertText",!1,a)}function C(l){l.key==="Enter"&&m.noNl&&(l.preventDefault(),R("returned",c()))}fe(r,async l=>{await Pe(),l!==c()&&o(l??"")}),fe(()=>m.noHtml,()=>{o(r.value??"")});function f(l){if(m.contentLen&&m.maxLen&&m.contentLen>=m.maxLen){if(l.keyCode===8)return;l.preventDefault()}}return(l,a)=>(P(),ae(ue,null,[(P(),Y(qe(ct),{id:e(T).contentId,ref_key:"element",ref:h,class:"tag-textarea",contenteditable:I.contenteditable,"data-placeholder":I.placeholder,onInput:L,onBlur:L,onPaste:p,onKeypress:C,onKeydown:f},null,40,["id","contenteditable","data-placeholder"])),_("div",it,[Ne(l.$slots,"default")])],64))}}),mt={class:"px-24px"},pt={key:0,class:"line-clamp-2"},ft=_("div",{class:"px-24px text-center"}," 您重新選擇的自訂訊息內容，將會把現在的訊息完全覆蓋。 ",-1),_t=Z({__name:"import-custom-message",props:{content:{type:String,required:!0}},emits:["updateContent"],setup(I,{expose:w,emit:m}){const R=I,x=m,r=G({selectedRowKeys:[],selectedRows:[],loading:!1}),{customMessages:d,getCustomMessages:T,pagination:O}=Ue(),h=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"160px"},{title:"訊息名稱",dataIndex:"name",key:"name",sorter:!0,width:"160px"},{title:"訊息內容",dataIndex:"content",key:"content",sorter:!0}],c=y({categoryIds:[],keyword:"",name:"",content:"",sortField:"createTime",sortOrder:"descend"});async function o(g,b,U){console.log("pagination:",g,"sorter:",U),c.value=Object.assign(c.value,{sortField:U.field,sortOrder:U.order}),await L(g.current,g.pageSize)}async function L(g=1,b=10){const U={current:g,pageSize:b,...e(c)};await T(U)}function p(g,b){console.log("selectedRowKeys changed: ",g,b),r.selectedRowKeys=g,r.selectedRows=b}const C=y(!1);async function f(){r.selectedRowKeys=[],r.selectedRows=[],L(),C.value=!0}const l=y(!1);function a(){K(R.content)?M():l.value=!0}function M(){var g;C.value=!1,l.value=!1,x("updateContent",(g=r.selectedRows[0])==null?void 0:g.content)}return w({show:f}),(g,b)=>{const U=lt,D=at,q=ce;return P(),ae(ue,null,[t(q,{open:e(C),"onUpdate:open":b[1]||(b[1]=S=>B(C)?C.value=S:null),title:"選擇欲載入自訂訊息內容",centered:"","cancel-text":"取消","ok-text":"確定",width:"960px","ok-button-props":{disabled:e(r).selectedRowKeys.length===0},onOk:a},{default:n(()=>[_("div",mt,[t(U,{modelValue:e(c).keyword,"onUpdate:modelValue":b[0]||(b[0]=S=>e(c).keyword=S),"show-filter-btn":!1,placeholder:"搜尋訊息類別、名稱、內容",class:"mb-2"},null,8,["modelValue"]),t(D,{class:"modal-table","data-source":e(d),columns:h,"show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(r).selectedRowKeys,onChange:p,type:"radio"},pagination:{...e(O)},"custom-header-row":()=>({class:"modal-table"}),onChange:o},{bodyCell:n(({column:S,text:N})=>[S.dataIndex==="content"?(P(),ae("div",pt,le(N),1)):Re("",!0)]),_:1},8,["data-source","row-selection","pagination"])])]),_:1},8,["open","ok-button-props"]),t(q,{open:e(l),"onUpdate:open":b[2]||(b[2]=S=>B(l)?l.value=S:null),title:"是否覆蓋現有的自訂訊息內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:M},{default:n(()=>[ft]),_:1},8,["open"])],64)}}}),gt={class:"px-24px"},vt=_("p",{class:"text-center"}," 選擇想加入的參數後，再點擊確定即可。 ",-1),xt={class:"flex justify-between gap-x-2"},yt=_("p",{class:"text-sms-grayscale-60 text-sm mt-10"},[$(" 加入參數功能說明："),_("br"),$(" 此為自訂訊息的插入參數功能，參數訊息發送功能位置為【訊息行銷活動】和【參數訊息】。訊息內容可自由插入參數，至多使用 5 個參數，依照上傳參數檔案而組成訊息內容。 ")],-1),ht=Z({__name:"add-field",emits:["addFieldToContent"],setup(I,{expose:w,emit:m}){const R=m,x=y(!1),r=y([]);function d(h){r.value.includes(h)?r.value=r.value.filter(c=>c!==h):r.value.push(h)}async function T(){r.value=[],x.value=!0}function O(){x.value=!1,R("addFieldToContent",r.value)}return w({show:T}),(h,c)=>{const o=ie,L=ce;return P(),Y(L,{open:e(x),"onUpdate:open":c[5]||(c[5]=p=>B(x)?x.value=p:null),title:"加入參數",centered:"","cancel-text":"取消","ok-text":"確定",width:"600px",onOk:O},{default:n(()=>[_("div",gt,[vt,_("div",xt,[t(o,{status:e(r).includes("%field1%")?"small1":"small2",onClick:c[0]||(c[0]=p=>d("%field1%"))},{default:n(()=>[$(" %field1% ")]),_:1},8,["status"]),t(o,{status:e(r).includes("%field2%")?"small1":"small2",onClick:c[1]||(c[1]=p=>d("%field2%"))},{default:n(()=>[$(" %field2% ")]),_:1},8,["status"]),t(o,{status:e(r).includes("%field3%")?"small1":"small2",onClick:c[2]||(c[2]=p=>d("%field3%"))},{default:n(()=>[$(" %field3% ")]),_:1},8,["status"]),t(o,{status:e(r).includes("%field4%")?"small1":"small2",onClick:c[3]||(c[3]=p=>d("%field4%"))},{default:n(()=>[$(" %field4% ")]),_:1},8,["status"]),t(o,{status:e(r).includes("%field5%")?"small1":"small2",onClick:c[4]||(c[4]=p=>d("%field5%"))},{default:n(()=>[$(" %field5% ")]),_:1},8,["status"])]),yt])]),_:1},8,["open"])}}}),bt=Z({__name:"add-link",emits:["addLinkToContent"],setup(I,{expose:w,emit:m}){const R=m,x={link:""};function r(C){const f="^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$",l=new RegExp(f,"i");return C.length<2083&&l.test(C)}const d=G(_e(x)),T=G({link:[{async validator(C,f){return K(f)?Promise.reject("請輸入縮網址"):r(f)?Promise.resolve():Promise.reject("請輸入有效網址")},trigger:"blur"}]}),{validateInfos:O,resetFields:h,validate:c}=ge(d,T),o=y(!1);async function L(){h(x),o.value=!0}function p(){c().then(async()=>{R("addLinkToContent",d.link),o.value=!1})}return w({show:L}),(C,f)=>{const l=ve,a=xe,M=ye,g=ie,b=he,U=be,D=ce;return P(),Y(D,{open:e(o),"onUpdate:open":f[1]||(f[1]=q=>B(o)?o.value=q:null),title:"加入縮網址",centered:"",width:"600px","cancel-text":"取消","ok-text":"確定",onOk:p},{default:n(()=>[t(U,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:p},{default:n(()=>[t(b,{gutter:[16,0]},{default:n(()=>[t(M,{span:24},{default:n(()=>[t(a,A({label:""},e(O).link),{default:n(()=>[t(l,{value:e(d).link,"onUpdate:value":f[0]||(f[0]=q=>e(d).link=q),valueModifiers:{trim:!0},placeholder:"請輸入原始長網址，範例: https://www.taiwanmobile.com/"},null,8,["value"])]),_:1},16)]),_:1}),t(g,{class:"hidden","html-type":"submit"})]),_:1})]),_:1})]),_:1},8,["open"])}}}),wt={class:"flex items-center justify-center"},Ct=_("span",{"w.5":"","h-18px":""},le(""),-1),kt=_("span",{"w.5":"","h-18px":""},le(""),-1),$t=_("span",{"w.5":"","h-18px":""},le(""),-1),Ot={class:"px-24px"},St={class:"flex justify-between items-center mb-4"},Mt=_("span",{class:"text-base text-sms-grayscale-80"},"選擇下列任一訊息，點擊「確定」。",-1),Rt=_("div",{class:"text-center px-30px py-20px text-base text-sms-grayscale-80 mx-auto"}," ※ 每次生成 3 則訊息，共收費新台幣 5 元 ",-1),Tt=_("div",{class:"text-center px-30px py-20px text-base text-sms-grayscale-80 mx-auto"}," 已生成的訊息將直接刪除 ",-1),It=_("div",{class:"px-24px text-center"}," 您重新選擇的自訂訊息內容，將會把現在的訊息完全覆蓋。 ",-1),Lt=Z({__name:"ai-text-generation",props:{content:{type:String,required:!0}},emits:["updateContent"],setup(I,{expose:w,emit:m}){const R=I,x=m,r=y(""),d=y([]),T=[{value:"singRule",label:"單則訊息 (70 字)"},{value:"longRule",label:"長訊息 (335 字)"},{value:"other",label:"其他"}],O=[{value:"notSpecify",label:"不指定"},{value:"promotions",label:"促銷活動"},{value:"promotions",label:"會員專屬"},{value:"newProductRecommendation",label:"新產品推薦"},{value:"eventInvitation",label:"活動邀請"},{value:"customerNotice",label:"客戶通知"},{value:"other",label:"其他"}],h=[{value:"notSpecify",label:"不指定"},{value:"friendly",label:"親切幽默"},{value:"professional",label:"專業正式"},{value:"warm",label:"溫暖感人"},{value:"other",label:"其他"}],o=G(_e({name:"",messageElement:"",count:void 0,countOtherConfig:"",type:"notSpecify",typeOtherConfig:"",tone:"notSpecify",toneOtherConfig:""})),L=G({messageElement:[{async validator(N,s){return K(s)?Promise.reject("請輸入訊息元素"):Promise.resolve()},trigger:"blur"}],count:[{required:!0,message:"請選擇訊息字數",trigger:"blur"}],countOtherConfig:[{async validator(N,s){return o.count!=="other"?Promise.resolve():await pe().shape({countOtherConfig:rt().typeError("請輸入訊息字數").min(1,"請輸入 1~335 之間任一數字").max(335,"請輸入 1~335 之間任一數字")}).validate({countOtherConfig:s})},trigger:"blur"}],typeOtherConfig:[{async validator(N,s){return o.type!=="other"?Promise.resolve():await pe().shape({typeOtherConfig:Se().required("請輸入訊息種類")}).validate({typeOtherConfig:s})},trigger:"blur"}],toneOtherConfig:[{async validator(N,s){return o.tone!=="other"?Promise.resolve():await pe().shape({toneOtherConfig:Se().required("請輸入訊息語氣")}).validate({toneOtherConfig:s})},trigger:"blur"}]}),{validateInfos:p,validate:C}=ge(o,L),f=y(!1),l=y(!1),a=y(!1);async function M(){f.value=!0}function g(){d.value.length===0?C().then(async()=>{l.value=!0}):q()}function b(){l.value=!1,d.value=[`Hello！親愛的 TAMedia Cafe 會員您好！促銷來囉！
買一送一伯爵鮮奶茶大放送！
只要透過訊息兌換序號，就能立即享受這份優惠！
別忘了帶上您的好友一同來品嚐，嚐一口就愛上的美味鮮奶茶！`,`Hello！親愛的TAMedia Cafe顧客您好！
想和您分享好消息，現在限時促銷！買一送一伯爵鮮奶茶，只需透過訊息兌換序號即可輕鬆獲得！
別忘了告訴您的朋友們，讓大家一同享受這份美味和歡笑！`,`哈囉！TAMedia Cafe 歡迎您！現在限時促銷！
買一送一伯爵鮮奶茶就在這裡！只要您透過訊息兌換序號，即可立即享受這份優惠！
快約上好友，一同來 TAMedia Cafe 享受美味，嘗一口就愛上的鮮奶茶吧！`]}function U(){d.value=[],r.value="",a.value=!1}const D=y(!1);function q(){K(R.content)?S():D.value=!0}function S(){f.value=!1,D.value=!1,x("updateContent",r.value)}return w({show:M}),(N,s)=>{const z=Ie,W=ve,F=xe,E=ye,ee=Ye,te=Le,ne=ie,v=he,u=be,k=Ze,de=et,X=ce;return P(),ae(ue,null,[t(X,{open:e(f),"onUpdate:open":s[13]||(s[13]=i=>B(f)?f.value=i:null),centered:"",width:"600px","cancel-text":e(d).length===0?"取消":"關閉","ok-text":"確定",onOk:g},{title:n(()=>[_("div",wt,[t(z,{name:"AI2",width:"32px",class:"me-2"}),$(" "+le(e(d).length===0?"使用 AI 生成訊息內容":"AI 生成訊息結果"),1)])]),default:n(()=>[Q(t(u,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:g},{default:n(()=>[t(v,{gutter:[16,16]},{default:n(()=>[t(E,{span:24},{default:n(()=>[t(F,A({label:"公司或產品名稱"},e(p).name,{extra:"30 字以內"}),{default:n(()=>[t(W,{value:e(o).name,"onUpdate:value":s[0]||(s[0]=i=>e(o).name=i),placeholder:"請輸入文字","max-length":30},null,8,["value"])]),_:1},16)]),_:1}),t(E,{span:24},{default:n(()=>[t(F,A({label:"訊息元素"},e(p).messageElement,{extra:"給予 AI 生成文案的文字素材，150 字以內",required:""}),{default:n(()=>[t(ee,{value:e(o).messageElement,"onUpdate:value":s[1]||(s[1]=i=>e(o).messageElement=i),rows:4,placeholder:`請輸入必要訊息元素，
必要訊息元素為您希望在訊息內容中一定要出現的資訊，
例如：顧客來店消費即可享有見面禮、提供消費者 DM 資訊`,"max-length":150},null,8,["value"])]),_:1},16)]),_:1}),t(E,{span:e(o).count!=="other"?24:12},{default:n(()=>[t(F,A({label:"訊息字數"},e(p).count,{required:""}),{default:n(()=>[t(te,{value:e(o).count,"onUpdate:value":s[2]||(s[2]=i=>e(o).count=i),options:T,placeholder:"請選擇訊息字數",onChange:s[3]||(s[3]=()=>{e(o).count==="other"&&(e(o).countOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),Q(t(E,{span:12},{default:n(()=>[t(F,A(e(p).countOtherConfig,{extra:"可輸入 1~335 之間任一數字"}),{label:n(()=>[Ct]),default:n(()=>[t(W,{value:e(o).countOtherConfig,"onUpdate:value":s[4]||(s[4]=i=>e(o).countOtherConfig=i),type:"number",placeholder:"請輸入訊息字數",controls:!1},null,8,["value"])]),_:1},16)]),_:1},512),[[J,e(o).count==="other"]]),t(E,{span:e(o).type!=="other"?24:12},{default:n(()=>[t(F,A({label:"訊息種類"},e(p).type),{default:n(()=>[t(te,{value:e(o).type,"onUpdate:value":s[5]||(s[5]=i=>e(o).type=i),options:O,placeholder:"請選擇訊息種類",onChange:s[6]||(s[6]=()=>{e(o).type==="other"&&(e(o).typeOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),Q(t(E,{span:12},{default:n(()=>[t(F,A(e(p).typeOtherConfig,{extra:"15 字以內"}),{label:n(()=>[kt]),default:n(()=>[t(W,{value:e(o).typeOtherConfig,"onUpdate:value":s[7]||(s[7]=i=>e(o).typeOtherConfig=i),"max-length":15,placeholder:"請輸入訊息種類"},null,8,["value"])]),_:1},16)]),_:1},512),[[J,e(o).type==="other"]]),t(E,{span:e(o).tone!=="other"?24:12},{default:n(()=>[t(F,A({label:"訊息語氣"},e(p).tone),{default:n(()=>[t(te,{value:e(o).tone,"onUpdate:value":s[8]||(s[8]=i=>e(o).tone=i),options:h,placeholder:"請選擇訊息語氣",onChange:s[9]||(s[9]=()=>{e(o).tone==="other"&&(e(o).toneOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),Q(t(E,{span:12},{default:n(()=>[t(F,A(e(p).toneOtherConfig,{extra:"15 字以內"}),{label:n(()=>[$t]),default:n(()=>[t(W,{value:e(o).toneOtherConfig,"onUpdate:value":s[10]||(s[10]=i=>e(o).toneOtherConfig=i),"max-length":15,placeholder:"請輸入訊息語氣"},null,8,["value"])]),_:1},16)]),_:1},512),[[J,e(o).tone==="other"]]),t(E,{span:24,class:"text-center text-sm text-sms-grayscale-60"},{default:n(()=>[$(" ※ 每次生成 3 則訊息，共收費新台幣 5 元 ")]),_:1}),t(ne,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512),[[J,e(d).length===0]]),Q(_("div",Ot,[_("div",St,[Mt,t(ne,{status:"small2",onClick:s[11]||(s[11]=i=>a.value=!0)},{default:n(()=>[$(" 重新生成 ")]),_:1})]),t(u,{layout:"vertical",autocomplete:"off"},{default:n(()=>[t(de,{value:e(r),"onUpdate:value":s[12]||(s[12]=i=>B(r)?r.value=i:null)},{default:n(()=>[t(v,{gutter:[16,16]},{default:n(()=>[(P(!0),ae(ue,null,je(e(d),(i,j)=>(P(),Y(E,{key:i,span:24,class:"flex"},{default:n(()=>[t(k,{value:i},null,8,["value"]),t(F,{label:`訊息 Template${j+1}`,class:Be(["flex-1",{selected:e(r)===i}])},{default:n(()=>[t(ee,{value:i,"auto-size":!0,readonly:"",onClick:se=>r.value=i},null,8,["value","onClick"])]),_:2},1032,["label","class"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1})],512),[[J,e(d).length>0]])]),_:1},8,["open","cancel-text"]),t(X,{open:e(l),"onUpdate:open":s[14]||(s[14]=i=>B(l)?l.value=i:null),title:"是否確定使用 AI 生成訊息？",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:b},{default:n(()=>[Rt]),_:1},8,["open"]),t(X,{open:e(a),"onUpdate:open":s[15]||(s[15]=i=>B(a)?a.value=i:null),title:"是否確定重新生成？",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:U},{default:n(()=>[Tt]),_:1},8,["open"]),t(X,{open:e(D),"onUpdate:open":s[16]||(s[16]=i=>B(D)?D.value=i:null),title:"是否覆蓋現有的自訂訊息內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:S},{default:n(()=>[It]),_:1},8,["open"])],64)}}});function Ut(){const I=Te(),w=y(!1),m=()=>w.value=!0,R=()=>w.value=!1,x=Qe();I.beforeResolve((d,T,O)=>{e(w)?x.confirm({closable:!0,width:"440px",icon:()=>"",title:"是否放棄目前編輯的內容？",content:Ke("div",{class:"text-center !w-full !max-w-full py-20px text-base mx-auto",innerHTML:"您將離開現在的頁面，且編輯的內容不會存檔"}),okText:"確定",cancelText:"取消",centered:!0,onOk:()=>{R(),O()},onCancel:()=>{O(!1)}}):O()});const r=d=>{e(w)&&(d.preventDefault(),d.returnValue=!0)};return Me(()=>{window.addEventListener("beforeunload",r)}),{setShowAlert:m,setHideAlert:R}}const At="/taiwanmobile-sms-admin-demo/assets/phone-DdWahJd9.png",Ft={class:"flex justify-between w-full items-center"},Et=_("span",{class:""},"訊息類別",-1),Vt=_("span",null,"新增訊息類別",-1),Dt=["src"],Ht={class:"max-h-450px overflow-auto absolute top-[150px] left-[30px] w-[calc(100%-50px)]"},Pt=["innerHTML"],Yt=Z({__name:"custom-message-form",setup(I){const{setHideAlert:w,setShowAlert:m}=Ut(),R=Te(),x=Je(),r=Ge(),d=Xe(),{getSmsCategoryOption:T,smsCategoryOption:O,checkSmsCategoryExist:h}=ut(),{customMeesage:c,getCustomMessage:o,updateCustomMessage:L,createCustomMessage:p,replaceFieldToHtml:C}=Ue(),f=Oe(()=>r.name==="CustomMessageCreate");let l={categoryId:void 0,newSmsCategory:"",name:"",content:""};const a=G(_e(l)),M=G({name:[{required:!0,message:"請輸入訊息名稱",trigger:"blur"}],content:[{required:!0,message:"請輸入訊息內容",trigger:"blur"},{async validator(v,u){var k;return!K(u)&&((k=a.content)==null?void 0:k.replace(me,"").length)>1e3?Promise.reject("限制輸入 1,000 字以內"):Promise.resolve()},trigger:"blur"}],newSmsCategory:[{async validator(v,u){return!K(u)&&await h(u)?Promise.reject(`系統中已有「${u}」 ，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:g,validate:b,clearValidate:U,resetFields:D,initialModel:q}=ge(a,M);ze(async()=>{var v,u,k;f.value||(await o(r.params.id),l={categoryId:(v=c.value)==null?void 0:v.categoryId,newSmsCategory:"",name:((u=c.value)==null?void 0:u.name)??"",content:C((k=c.value)==null?void 0:k.content)},D(l)),x.handleSelectedKeys(["/sms-marketing/custom-message"]),T()});const S=y(!0),N=Oe(()=>f.value?"新增自訂訊息":"編輯自訂訊息");fe(()=>a,v=>{tt(v,l)?w():m()},{deep:!0});function s(){console.log(q),b().then(async()=>{var k;((k=(await(e(f)?p:L)(a,r.params.id)).data)==null?void 0:k.status)==="success"&&(d.success({message:e(f)?"自訂訊息新增成功":"自訂訊息編輯成功",placement:"top"}),w(),R.push("/sms-marketing/custom-message?tabActived=customMessage"))}).catch(v=>{console.log(v)})}const z=y(null);function W(v){a.content=C(v)}const F=y(null);function E(v){for(const u of v)a.content=`${a.content}<span>${u}</span>`}const ee=y(null);function te(v){a.content=`${a.content}<a href="${v}">${v}</a>`}const ne=y(null);return(v,u)=>{const k=Ie,de=nt,X=Le,i=xe,j=ye,se=ie,we=ve,re=ot,Ae=dt,Ce=he,Fe=be,Ee=Ve;return P(),Y(Ee,{title:e(N),"custom-breadcrumb":[{title:"訊息行銷活動"},{path:"/sms-marketing/custom-message?tabActived=customMessage",title:"自訂訊息"},{title:e(N)}]},{default:n(()=>[t(Ce,{class:"bg-sms-grayscale-0 rounded-4 p-10",wrap:!1},{default:n(()=>[t(j,{flex:"auto"},{default:n(()=>[t(Fe,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:s},{default:n(()=>[t(Ce,{gutter:[16,16]},{default:n(()=>[t(j,{span:24},{default:n(()=>[t(i,A(e(g).categoryId,{extra:"15 字以內。若無選擇/新增，將自動歸類為「未分類」。","label-col":{style:{width:"100%"}}}),{label:n(()=>[_("div",Ft,[Et,e(S)?(P(),Y(de,{key:0,type:"link",class:"m-0 p-0",onClick:u[0]||(u[0]=We(()=>S.value=!1,["prevent"]))},{icon:n(()=>[t(k,{name:"plus"})]),default:n(()=>[$(" 新增訊息類別 ")]),_:1})):Re("",!0)])]),default:n(()=>[t(X,{value:e(a).categoryId,"onUpdate:value":u[1]||(u[1]=V=>e(a).categoryId=V),options:e(O),"allow-clear":"",disabled:!e(S),placeholder:"請選擇訊息類別"},null,8,["value","options","disabled"])]),_:1},16)]),_:1}),Q(t(j,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-2 !px-3"},{default:n(()=>[t(i,A({extra:"15 字以內。若同時選擇和新增訊息類別，系統只會紀錄「新增訊息類別」。"},e(g).newSmsCategory,{"label-col":{style:{width:"100%"}}}),{label:n(()=>[Vt,t(se,{status:"small3",class:"m-0 p-0 ms-auto",onClick:u[2]||(u[2]=()=>{e(U)("newSmsCategory"),S.value=!0})},{icon:n(()=>[t(k,{name:"close"})]),_:1})]),default:n(()=>[t(we,{value:e(a).newSmsCategory,"onUpdate:value":u[3]||(u[3]=V=>e(a).newSmsCategory=V),placeholder:"請輸入訊息類別",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[J,!e(S)]]),t(j,{span:24},{default:n(()=>[t(i,A({label:"訊息名稱"},e(g).name,{extra:"15 字以內",required:""}),{default:n(()=>[t(we,{value:e(a).name,"onUpdate:value":u[4]||(u[4]=V=>e(a).name=V),placeholder:"請輸入訊息名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),t(j,{span:24},{default:n(()=>{var V;return[t(i,A({label:"訊息內容"},e(g).content,{class:"relative",extra:`MMS 上限 1,000 字，SMS 上限 335 字，目前 ${e(K)(e(a).content)?"--":(V=e(a).content)==null?void 0:V.replace(e(me),"").length} 字(不含參數字數)`,required:""}),{default:n(()=>{var ke;return[t(Ae,{modelValue:e(a).content,"onUpdate:modelValue":u[9]||(u[9]=oe=>e(a).content=oe),contenteditable:"true","content-len":(ke=e(a).content)==null?void 0:ke.replace(e(me),"").length,"max-len":1e3,placeholder:"請輸入訊息名稱"},{default:n(()=>[t(re,null,{title:n(()=>[$(" 載入現有的自訂訊息 ")]),default:n(()=>[t(k,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:u[5]||(u[5]=oe=>{var H;return(H=e(z))==null?void 0:H.show()})})]),_:1}),t(re,null,{title:n(()=>[$(" 加入參數 ")]),default:n(()=>[t(k,{name:"code",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:u[6]||(u[6]=oe=>{var H;return(H=e(F))==null?void 0:H.show()})})]),_:1}),t(re,null,{title:n(()=>[$(" 增加縮網址 ")]),default:n(()=>[t(k,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:u[7]||(u[7]=oe=>{var H;return(H=e(ee))==null?void 0:H.show()})})]),_:1}),t(re,null,{title:n(()=>[$(" AI 文字生成訊息 ")]),default:n(()=>[t(k,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:u[8]||(u[8]=oe=>{var H;return(H=e(ne))==null?void 0:H.show()})})]),_:1})]),_:1},8,["modelValue","content-len"])]}),_:1},16,["extra"])]}),_:1}),t(j,{span:24,class:"text-end"},{default:n(()=>[t(se,{status:"small2",class:"me-2",onClick:u[10]||(u[10]=V=>v.$router.push("/sms-marketing/custom-message?tabActived=customMessage"))},{default:n(()=>[$(" 取消 ")]),_:1}),t(se,{status:"small1","html-type":"submit"},{default:n(()=>[$(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(j,{flex:"428px",class:"relative"},{default:n(()=>{var V;return[_("img",{src:e(At),class:"w-428px"},null,8,Dt),_("div",Ht,[Q(_("div",{class:"bg-sms-grayscale-20 p-2 rounded-2 whitespace-pre-wrap max-w-[215px] inline-block break-words",innerHTML:(V=e(a).content)==null?void 0:V.replace(e(st),"")},null,8,Pt),[[J,!e(K)(e(a).content)]])])]}),_:1})]),_:1}),t(_t,{ref_key:"importCustomMessageRef",ref:z,content:e(a).content,onUpdateContent:W},null,8,["content"]),t(ht,{ref_key:"addFieldRef",ref:F,onAddFieldToContent:E},null,512),t(bt,{ref_key:"addLinkRef",ref:ee,onAddLinkToContent:te},null,512),t(Lt,{ref_key:"aiTextGenerationRef",ref:ne,content:e(a).content,onUpdateContent:W},null,8,["content"])]),_:1},8,["title","custom-breadcrumb"])}}});export{Yt as default};

import{F as pe,_ as _e}from"./request-3552e6c3.js";import{_ as fe}from"./index-4b80b22a.js";import{_ as W}from"./index.vuevuetypescriptsetuptruelang-374ce0ee.js";import{k as X,_ as ye}from"./index-b55f1cdf.js";import{d as Q,r as $,f as k,W as d,_ as A,$ as o,k as a,ab as ge,u as t,H as Z,D as ve,o as ke,a0 as xe,X as h,G as p,E as we,a4 as z,Y as x,F as J,a3 as I,m as Ce,A as be}from"./vue-b9a22f97.js";import{u as ee}from"./sms-category-88642280.js";import{H as te,E as G,J as he,I as ae,q as Te,r as se,u as oe,F as ne,G as le,U as Ne}from"./antd-16a0cd46.js";const Re=Q({__name:"sms-category-create",props:{saveCallbck:{type:Function,required:!0}},setup(H,{expose:K}){const w=X(),{checkSmsCategoryExist:O,createSmsCategory:U}=ee(),P=H,r={categoryName:""},f=$(te(r)),E=$({categoryName:[{validator:async function(T,c){if(G(c))return Promise.reject("請輸入訊息類別");const _=await O(c);return console.log(_),_?Promise.reject(`系統中已有「${c}」，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:m,resetFields:V,validate:l}=he(f,E),y=k(!1),C=async()=>{V(r),y.value=!0},R=()=>{l().then(async()=>{var c;((c=(await U(f.categoryName)).data)==null?void 0:c.status)==="success"&&(w.success({message:"訊息類別新增成功",placement:"top"}),P.saveCallbck(),y.value=!1)})};return K({show:C}),(T,c)=>{const _=ae,j=Te,F=se,g=W,L=oe,B=ne,S=le;return d(),A(S,{open:t(y),"onUpdate:open":c[1]||(c[1]=N=>Z(y)?y.value=N:null),title:"新增訊息類別",centered:"",width:"440px",cancelText:"取消",okText:"確定",onOk:R},{default:o(()=>[a(B,{ref:"formRef",class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:R},{default:o(()=>[a(L,{gutter:[16,0]},{default:o(()=>[a(F,{span:24},{default:o(()=>[a(j,ge({label:"訊息類別"},t(m).categoryName,{required:"",extra:"15字以內"}),{default:o(()=>[a(_,{value:t(f).categoryName,"onUpdate:value":c[0]||(c[0]=N=>t(f).categoryName=N),placeholder:"請輸入訊息類別",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),a(g,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512)]),_:1},8,["open"])}}}),Fe={class:"flex justify-between px-2 items-center mb-2"},Se={key:1},Ye={key:1},De={key:0},Me={class:"editable-cell-wrapper"},Ie={class:"text-sms-status-alert-red text-xs"},$e={key:1,class:"editable-cell-wrapper"},Ke=x("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"},[p(" 您選擇的訊息類別將永久刪除。"),x("br"),p(" 原本屬於該訊息類別的自訂訊息，"),x("br"),p(" 將改為未分類狀態。 ")],-1),Be=Q({__name:"sms-category",setup(H){const{getSmsCategory:K,smsCategory:w,pagination:O,updateSmsCategory:U,deleteSmsCategory:P}=ee(),r=$({}),f=k(!1);ve(async()=>{C()}),ke(()=>{f.value=!0});const E=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"320px"},{title:"訊息數量",dataIndex:"smsCount",key:"smsCount",sorter:!0,width:"160px",align:"right"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"160px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0}],m=$({selectedRowKeys:[],selectedRows:[],loading:!1}),V=(s,e)=>{console.log("selectedRowKeys changed: ",s,e),m.selectedRowKeys=s,m.selectedRows=e},l=k({sortField:"createTime",sortOrder:"descend",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:""}),y=k(),C=async(s=1,e=10)=>{let u={current:s,pageSize:e,...t(l)};await K(u)},R=s=>{r[s]={...te(w.value.filter(e=>s===e.key)[0]),msg:""}},T=async s=>{var v;const e=r[s];if(G(e.categoryName)){r[s].msg="請輸入訊息類別";return}w.value.find(b=>e.categoryName===b.categoryName&&e.key!==b.key)?r[s].msg=`系統中已有「${r[s].categoryName}」，請勿重複新增`:((v=(await U(e.key,e.categoryName)).data)==null?void 0:v.status)==="success"&&(Object.assign(w.value.filter(Y=>s===Y.key)[0],e),delete r[s],F.success({message:"訊息類別編輯成功",placement:"top"}))},c=async(s,e,u)=>{console.log("pagination:",s,"sorter:",u),l.value=Object.assign(l.value,{sortField:u.field,sortOrder:u.order}),await C(s.current,s.pageSize)},_=k(null),j=()=>{var s;C(1),(s=_.value)==null||s.hide()},F=X(),g=k(!1),L=()=>{g.value=!0},B=async()=>{var e;((e=(await P(m.selectedRowKeys)).data)==null?void 0:e.status)==="success"&&(F.success({message:"訊息類別刪除成功",placement:"top"}),g.value=!1,m.selectedRowKeys=[],m.selectedRows=[])},S=k(null),N=s=>({disabled:s.key==0});return(s,e)=>{const u=ye,v=W,b=Ne,Y=fe,q=se,re=oe,ce=ne,ie=xe("RouterLink"),ue=ae,me=_e,de=le;return d(),h(J,null,[t(f)?(d(),A(we,{key:0,to:"#extraContent"},[a(v,{status:"small1",onClick:e[0]||(e[0]=i=>{var n;return(n=t(S))==null?void 0:n.show()})},{icon:o(()=>[a(u,{name:"plus",width:"16px"})]),default:o(()=>[p("新增訊息類別 ")]),_:1})])):z("",!0),x("div",Fe,[x("div",null,[a(v,{status:"small2",class:"me-2",onClick:L,disabled:t(m).selectedRowKeys.length===0},{icon:o(()=>[a(u,{name:"delete",width:"16px"})]),default:o(()=>[p("刪除 ")]),_:1},8,["disabled"])]),a(pe,{ref_key:"filterKeywordInputRef",ref:_,class:"w-440px h-40px",modelValue:t(l).keyword,"onUpdate:modelValue":e[4]||(e[4]=i=>t(l).keyword=i),placeholder:"搜尋訊息類別",onClearFilter:e[5]||(e[5]=()=>{l.value={...t(l),keyword:"",createTime:[void 0,void 0],updateTime:[void 0,void 0]}})},{filterForm:o(()=>[a(ce,{ref_key:"formRef",ref:y,layout:"vertical",model:t(l),autocomplete:"off"},{default:o(()=>[a(re,{gutter:[16,12]},{default:o(()=>[a(q,{span:24},{default:o(()=>[a(Y,{label:"建立時間",valueed:t(l).createTime},{default:o(()=>[a(b,{class:"w-full",value:t(l).createTime,"onUpdate:value":e[1]||(e[1]=i=>t(l).createTime=i),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(q,{span:24},{default:o(()=>[a(Y,{label:"修改時間",valueed:t(l).updateTime},{default:o(()=>[a(b,{class:"w-full",value:t(l).updateTime,"onUpdate:value":e[2]||(e[2]=i=>t(l).updateTime=i),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(q,{span:24,class:"text-center"},{default:o(()=>[a(v,{status:"small2",class:"me-5",onClick:e[3]||(e[3]=i=>{var n;return(n=t(_))==null?void 0:n.hide()})},{default:o(()=>[p("取消")]),_:1}),a(v,{status:"small1",onClick:j},{default:o(()=>[p("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(me,{dataSource:t(w),columns:E,size:"small",showSorterTooltip:!1,"row-selection":{selectedRowKeys:t(m).selectedRowKeys,onChange:V,getCheckboxProps:N},onChange:c,pagination:{...t(O)}},{bodyCell:o(({column:i,record:n,text:D})=>[i.dataIndex==="smsCount"?(d(),h(J,{key:0},[D>0?(d(),A(ie,{key:0,href:"javascript:;",class:"text-sm text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80 font-400",hover:"text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80",to:{name:"CustomMessage",query:{tabActived:"customMessage",categoryId:n.key}}},{default:o(()=>[p(I(D),1)]),_:2},1032,["to"])):(d(),h("span",Se,I(D),1))],64)):z("",!0),i.dataIndex==="categoryName"?(d(),h("div",Ye,[t(r)[n.key]?(d(),h("div",De,[x("div",Me,[a(ue,{value:t(r)[n.key].categoryName,"onUpdate:value":M=>t(r)[n.key].categoryName=M,onPressEnter:M=>T(n.key),maxLength:15,status:t(r)[n.key].msg&&!t(G)(t(r)[n.key].msg)?"error":""},null,8,["value","onUpdate:value","onPressEnter","status"]),a(u,{name:"save",onClick:M=>T(n.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"])]),x("span",Ie,I(t(r)[n.key].msg),1)])):(d(),h("div",$e,[p(I(D||" ")+" ",1),Ce(a(u,{name:"edit",onClick:M=>R(n.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"]),[[be,n.key!=0]])]))])):z("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),a(Re,{ref_key:"smsCategoryCreateRef",ref:S,"save-callbck":()=>C(1)},null,8,["save-callbck"]),a(de,{open:t(g),"onUpdate:open":e[6]||(e[6]=i=>Z(g)?g.value=i:null),title:"是否刪除選取的訊息類別？",centered:"",cancelText:"取消",okText:"確定",onOk:B,width:"440px"},{default:o(()=>[Ke]),_:1},8,["open"])],64)}}});export{Be as _};

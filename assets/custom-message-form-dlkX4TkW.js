import{_ as de}from"./index.vuevuetypescriptsetuptruelang-dvYQxbFb.js";import{u as pe,_ as _e,a as fe,b as ge,c as ve,d as we}from"./route-leave-Bcg94BQe.js";import{_ as xe}from"./index.vuevuetypescriptsetuptruelang-JVP7TRv3.js";import{h as ye,j as be,_ as Ce}from"./index-CYqi8OAn.js";import{d as he,ad as ke,ac as Se,c as U,r as P,D as Me,f as _,w as $e,W as H,_ as N,$ as n,k as s,ab as y,u as e,Y as c,B as Fe,G as m,a4 as Re,m as j,A as D}from"./vue-BvWPEeCa.js";import{O as Ae,P as b,Q as Ie,U as Te,B as qe,q as Le,o as Ve,p as Be,I as Ue,H as Pe,s as He,F as Ne}from"./antd-BeRLmHJE.js";import{u as je,r as S,a as De}from"./custom-message-CfgAKLa0.js";import{u as Ee}from"./sms-category-BtsgLh8U.js";import"./context-CNn4_cpS.js";import"./index.esm-D-iyuww3.js";import"./index.vuevuetypestyleindex0lang-Dy5B8DSM.js";import"./request-BPdP2g-k.js";const Ge="/taiwanmobile-sms-admin-demo/assets/phone-DdWahJd9.png",Oe={class:"flex justify-between w-full items-center"},We=c("span",{class:""},"訊息類別",-1),Je=c("span",null,"新增訊息類別",-1),Ke=["src"],Qe={class:"max-h-450px overflow-auto absolute top-[150px] left-[30px] w-[calc(100%-50px)]"},Ye=["innerHTML"],mt=he({__name:"custom-message-form",setup(ze){const{setHideAlert:M,setShowAlert:E}=pe(),G=ke(),O=ye(),C=Se(),W=be(),{getSmsCategoryOption:J,smsCategoryOption:K,checkSmsCategoryExist:Q}=Ee(),{customMeesage:h,getCustomMessage:Y,updateCustomMessage:z,createCustomMessage:X,replaceFieldToHtml:$}=je(),f=U(()=>C.name==="CustomMessageCreate");let g={categoryId:void 0,newSmsCategory:"",name:"",content:""};const o=P(Ae(g)),Z=P({name:[{required:!0,message:"請輸入訊息名稱",trigger:"blur"}],content:[{required:!0,message:"請輸入訊息內容",trigger:"blur"},{async validator(a,t){var l;return!b(t)&&((l=o.content)==null?void 0:l.replace(S,"").length)>1e3?Promise.reject("限制輸入 1,000 字以內"):Promise.resolve()},trigger:"blur"}],newSmsCategory:[{async validator(a,t){return!b(t)&&await Q(t)?Promise.reject(`系統中已有「${t}」 ，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:v,validate:ee,clearValidate:te,resetFields:se,initialModel:ne}=Ie(o,Z);Me(async()=>{var a,t,l;f.value||(await Y(C.params.id),g={categoryId:(a=h.value)==null?void 0:a.categoryId,newSmsCategory:"",name:((t=h.value)==null?void 0:t.name)??"",content:$((l=h.value)==null?void 0:l.content)},se(g)),O.handleSelectedKeys(["/sms-marketing/custom-message"]),J()});const d=_(!0),F=U(()=>f.value?"新增自訂訊息":"編輯自訂訊息");$e(()=>o,a=>{Te(a,g)?M():E()},{deep:!0});function oe(){console.log(ne),ee().then(async()=>{var l;((l=(await(e(f)?X:z)(o,C.params.id)).data)==null?void 0:l.status)==="success"&&(W.success({message:e(f)?"自訂訊息新增成功":"自訂訊息編輯成功",placement:"top"}),M(),G.push("/sms-marketing/custom-message?tabActived=customMessage"))}).catch(a=>{console.log(a)})}const R=_(null);function A(a){o.content=$(a)}const I=_(null);function ae(a){for(const t of a)o.content=`${o.content}<span>${t}</span>`}const T=_(null);function le(a){o.content=`${o.content}<a href="${a}">${a}</a>`}const q=_(null);return(a,t)=>{const l=Ce,re=qe,ue=Le,w=Ve,i=Be,k=xe,L=Ue,x=Pe,ie=we,V=He,me=Ne,ce=de;return H(),N(ce,{title:e(F),"custom-breadcrumb":[{title:"訊息行銷活動"},{path:"/sms-marketing/custom-message?tabActived=customMessage",title:"自訂訊息"},{title:e(F)}]},{default:n(()=>[s(V,{class:"bg-sms-grayscale-0 rounded-4 p-10",wrap:!1},{default:n(()=>[s(i,{flex:"auto"},{default:n(()=>[s(me,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:oe},{default:n(()=>[s(V,{gutter:[16,16]},{default:n(()=>[s(i,{span:24},{default:n(()=>[s(w,y({"html-for":""},e(v).categoryId,{extra:"15 字以內。若無選擇/新增，將自動歸類為「未分類」。","label-col":{style:{width:"100%"}}}),{label:n(()=>[c("div",Oe,[We,e(d)?(H(),N(re,{key:0,type:"link",class:"m-0 p-0",onClick:t[0]||(t[0]=Fe(()=>d.value=!1,["prevent"]))},{icon:n(()=>[s(l,{name:"plus"})]),default:n(()=>[m(" 新增訊息類別 ")]),_:1})):Re("",!0)])]),default:n(()=>[s(ue,{value:e(o).categoryId,"onUpdate:value":t[1]||(t[1]=r=>e(o).categoryId=r),options:e(K),"allow-clear":"",disabled:!e(d),placeholder:"請選擇訊息類別"},null,8,["value","options","disabled"])]),_:1},16)]),_:1}),j(s(i,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-2 !px-3"},{default:n(()=>[s(w,y({"html-for":"",extra:"15 字以內。若同時選擇和新增訊息類別，系統只會紀錄「新增訊息類別」。"},e(v).newSmsCategory,{"label-col":{style:{width:"100%"}}}),{label:n(()=>[Je,s(k,{status:"small3",class:"m-0 p-0 ms-auto",onClick:t[2]||(t[2]=()=>{e(te)("newSmsCategory"),d.value=!0})},{icon:n(()=>[s(l,{name:"close"})]),_:1})]),default:n(()=>[s(L,{value:e(o).newSmsCategory,"onUpdate:value":t[3]||(t[3]=r=>e(o).newSmsCategory=r),placeholder:"請輸入訊息類別",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[D,!e(d)]]),s(i,{span:24},{default:n(()=>[s(w,y({label:"訊息名稱"},e(v).name,{extra:"15 字以內",required:""}),{default:n(()=>[s(L,{value:e(o).name,"onUpdate:value":t[4]||(t[4]=r=>e(o).name=r),placeholder:"請輸入訊息名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),s(i,{span:24},{default:n(()=>{var r;return[s(w,y({label:"訊息內容"},e(v).content,{class:"relative",extra:`MMS 上限 1,000 字，SMS 上限 335 字，目前 ${e(b)(e(o).content)?"--":(r=e(o).content)==null?void 0:r.replace(e(S),"").length} 字(不含參數字數)`,required:""}),{default:n(()=>{var B;return[s(ie,{modelValue:e(o).content,"onUpdate:modelValue":t[9]||(t[9]=p=>e(o).content=p),contenteditable:"true","content-len":(B=e(o).content)==null?void 0:B.replace(e(S),"").length,"max-len":1e3,placeholder:"請輸入訊息名稱"},{default:n(()=>[s(x,null,{title:n(()=>[m(" 載入現有的自訂訊息 ")]),default:n(()=>[s(l,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:t[5]||(t[5]=p=>{var u;return(u=e(R))==null?void 0:u.show()})})]),_:1}),s(x,null,{title:n(()=>[m(" 加入參數 ")]),default:n(()=>[s(l,{name:"code",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:t[6]||(t[6]=p=>{var u;return(u=e(I))==null?void 0:u.show()})})]),_:1}),s(x,null,{title:n(()=>[m(" 增加縮網址 ")]),default:n(()=>[s(l,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:t[7]||(t[7]=p=>{var u;return(u=e(T))==null?void 0:u.show()})})]),_:1}),s(x,null,{title:n(()=>[m(" AI 文字生成訊息 ")]),default:n(()=>[s(l,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:t[8]||(t[8]=p=>{var u;return(u=e(q))==null?void 0:u.show()})})]),_:1})]),_:1},8,["modelValue","content-len"])]}),_:1},16,["extra"])]}),_:1}),s(i,{span:24,class:"text-end"},{default:n(()=>[s(k,{status:"small2",class:"me-2",onClick:t[10]||(t[10]=r=>a.$router.push("/sms-marketing/custom-message?tabActived=customMessage"))},{default:n(()=>[m(" 取消 ")]),_:1}),s(k,{status:"small1","html-type":"submit"},{default:n(()=>[m(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(i,{flex:"428px",class:"relative"},{default:n(()=>{var r;return[c("img",{src:e(Ge),class:"w-428px"},null,8,Ke),c("div",Qe,[j(c("div",{class:"bg-sms-grayscale-20 p-2 rounded-2 whitespace-pre-wrap max-w-[215px] inline-block break-words",innerHTML:(r=e(o).content)==null?void 0:r.replace(e(De),"")},null,8,Ye),[[D,!e(b)(e(o).content)]])])]}),_:1})]),_:1}),s(_e,{ref_key:"importCustomMessageRef",ref:R,content:e(o).content,onUpdateContent:A},null,8,["content"]),s(fe,{ref_key:"addFieldRef",ref:I,onAddFieldToContent:ae},null,512),s(ge,{ref_key:"addLinkRef",ref:T,onAddLinkToContent:le},null,512),s(ve,{ref_key:"aiTextGenerationRef",ref:q,content:e(o).content,onUpdateContent:A},null,8,["content"])]),_:1},8,["title","custom-breadcrumb"])}}});export{mt as default};

import{F as X,_ as q}from"./request-6ddf16f6.js";import{_ as J}from"./index-0ae3ed2a.js";import{_ as Q}from"./index.vuevuetypescriptsetuptruelang-4fca776e.js";import{h as Z,j as ee,_ as te}from"./index-dfeff907.js";import{u as ae}from"./sms-category-9ef8cb4d.js";import{g as oe}from"./tools-a2ffc173.js";import{u as se}from"./custom-message-0445dd34.js";import{d as ne,f as g,ad as le,D as de,o as ue,r as re,u as e,W as w,X as b,_ as ce,k as t,$ as o,G as r,E as ie,a4 as I,Y as k,a3 as x,H as me,F as pe}from"./vue-b9a22f97.js";import{C as _e,s as fe,r as ge,I as ve,P as ye,u as we,F as xe,E as ke}from"./antd-b020a38c.js";const Ce={class:"flex justify-between px-2 items-center mb-2"},he={key:0,class:"line-clamp-2"},Te=k("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 您選擇的自訂訊息將永久刪除。 ",-1),Ne=ne({__name:"custom-message",setup(Me){const{getSmsCategoryOption:Y,smsCategoryOption:K}=ae(),{customMessages:C,getCustomMessages:F,pagination:m,deleteCustomMessage:S}=se(),h=g(!1),T=Z(),D=le();de(async()=>{await Y(),v(),T.handleOpenKeys(["/sms-marketing"]),T.handleSelectedKeys(["/sms-marketing/custom-message"])}),ue(()=>{h.value=!0});const O=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"160px"},{title:"訊息名稱",dataIndex:"name",key:"name",sorter:!0,width:"160px"},{title:"訊息內容",dataIndex:"content",key:"content",sorter:!0,width:"265px"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"180px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0,width:"180px"}],d=re({selectedRowKeys:[],selectedRows:[],loading:!1}),N=(l,a)=>{console.log("selectedRowKeys changed: ",l,a),d.selectedRowKeys=l,d.selectedRows=a},s=g({categoryIds:[],keyword:"",name:"",content:"",createTime:[void 0,void 0],updateTime:[void 0,void 0],sortField:"createTime",sortOrder:"descend"}),U=g(),v=async(l=1,a=10)=>{let u={current:l,pageSize:a,...e(s)};await F(u)},V=async(l,a,u)=>{console.log("pagination:",l,"sorter:",u),s.value=Object.assign(s.value,{sortField:u.field,sortOrder:u.order}),await v(l.current,l.pageSize)},$=()=>{D.push({name:"CustomMessageEdit",params:{id:d.selectedRowKeys[0]}})},y=g(null),B=()=>{var l;v(1),(l=y.value)==null||l.hide()},E=ee(),p=g(!1),L=()=>{p.value=!0},j=async()=>{var a;((a=(await S(d.selectedRowKeys)).data)==null?void 0:a.status)==="success"&&(E.success({message:"自訂訊息刪除成功",placement:"top"}),v(m.value.current===1||C.value.length-d.selectedRowKeys.length>1?m.value.current:m.value.current-1,m.value.pageSize),p.value=!1,d.selectedRowKeys=[],d.selectedRows=[])};return(l,a)=>{const u=te,_=Q,P=_e,z=fe,f=J,c=ge,M=ve,R=ye,A=we,G=xe,H=q,W=ke;return w(),b(pe,null,[e(h)?(w(),ce(ie,{key:0,to:"#extraContent"},[t(_,{status:"small1",onClick:a[0]||(a[0]=()=>l.$router.push({name:"CustomMessageCreate"}))},{icon:o(()=>[t(u,{name:"plus",width:"16px"})]),default:o(()=>[r("新增自訂訊息 ")]),_:1})])):I("",!0),k("div",Ce,[k("div",null,[t(_,{status:"small2",class:"me-2",disabled:e(d).selectedRowKeys.length===0||e(d).selectedRowKeys.length>1,onClick:$},{icon:o(()=>[t(u,{name:"edit",width:"16px"})]),default:o(()=>[r("編輯 ")]),_:1},8,["disabled"]),t(_,{status:"small2",class:"me-2",onClick:L,disabled:e(d).selectedRowKeys.length===0},{icon:o(()=>[t(u,{name:"delete",width:"16px"})]),default:o(()=>[r("刪除 ")]),_:1},8,["disabled"])]),t(X,{ref_key:"filterKeywordInputRef",ref:y,class:"w-440px h-40px",modelValue:e(s).keyword,"onUpdate:modelValue":a[7]||(a[7]=n=>e(s).keyword=n),placeholder:"搜尋訊息類別、名稱和內容",onClearFilter:a[8]||(a[8]=()=>{s.value={...e(s),categoryIds:[],keyword:"",name:"",content:"",createTime:[void 0,void 0],updateTime:[void 0,void 0]}})},{filterForm:o(()=>[t(G,{ref_key:"formRef",ref:U,layout:"vertical",model:e(s),autocomplete:"off"},{default:o(()=>[t(A,{gutter:[16,12]},{default:o(()=>[t(c,{span:24},{default:o(()=>[t(f,{id:"group",label:"訊息類別",valueed:e(oe)(e(s).categoryIds)},{default:o(()=>[t(z,{options:e(K),maxTagCount:2,showArrow:!0,mode:"multiple",value:e(s).categoryIds,"onUpdate:value":a[1]||(a[1]=n=>e(s).categoryIds=n),class:"w-full",optionFilterProp:"label"},{option:o(({value:n,label:i})=>[t(P,{checked:e(s).categoryIds.includes(n)},null,8,["checked"]),r(" "+x(i),1)]),menuItemSelectedIcon:o(()=>[r(x(""))]),_:1},8,["options","value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24},{default:o(()=>[t(f,{label:"訊息名稱",valueed:e(s).name},{default:o(()=>[t(M,{value:e(s).name,"onUpdate:value":a[2]||(a[2]=n=>e(s).name=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24},{default:o(()=>[t(f,{label:"訊息類別",valueed:e(s).content},{default:o(()=>[t(M,{value:e(s).content,"onUpdate:value":a[3]||(a[3]=n=>e(s).content=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24},{default:o(()=>[t(f,{label:"建立時間",valueed:e(s).createTime},{default:o(()=>[t(R,{class:"w-full",value:e(s).createTime,"onUpdate:value":a[4]||(a[4]=n=>e(s).createTime=n),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24},{default:o(()=>[t(f,{label:"修改時間",valueed:e(s).updateTime},{default:o(()=>[t(R,{class:"w-full",value:e(s).updateTime,"onUpdate:value":a[5]||(a[5]=n=>e(s).updateTime=n),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(c,{span:24,class:"text-center"},{default:o(()=>[t(_,{status:"small2",class:"me-5",onClick:a[6]||(a[6]=n=>{var i;return(i=e(y))==null?void 0:i.hide()})},{default:o(()=>[r("取消")]),_:1}),t(_,{status:"small1",onClick:B},{default:o(()=>[r("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(H,{dataSource:e(C),columns:O,showSorterTooltip:!1,scroll:{x:1500},"row-selection":{selectedRowKeys:e(d).selectedRowKeys,onChange:N},onChange:V,pagination:{...e(m)}},{bodyCell:o(({column:n,text:i})=>[n.dataIndex==="content"?(w(),b("div",he,x(i),1)):I("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),t(W,{open:e(p),"onUpdate:open":a[9]||(a[9]=n=>me(p)?p.value=n:null),title:"是否刪除選取的自訂訊息？",centered:"",cancelText:"取消",okText:"確定",onOk:j,width:"440px"},{default:o(()=>[Te]),_:1},8,["open"])],64)}}});export{Ne as _};

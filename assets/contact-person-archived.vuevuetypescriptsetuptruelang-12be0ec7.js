import{F as se,_ as le}from"./request-a5a7c316.js";import{u as de,G as re,_ as ue}from"./GenderEnum-2a799b3d.js";import{_ as ie}from"./index-43c1e15f.js";import{_ as pe}from"./index.vuevuetypescriptsetuptruelang-df03164d.js";import{k as ce,_ as me}from"./index-a81cff35.js";import{g as _e,a as fe}from"./tools-a2ffc173.js";import{u as ve}from"./group-label-1b2c328d.js";import{E as xe,I as ye,r as ge,C as we,s as ke,Q as he,u as be,F as Ce,N as Ie,G as Te}from"./antd-f7215ad7.js";import{d as Re,f as x,D as Ye,o as Le,r as Me,u as e,W as v,X as y,Y as m,k as t,$ as o,G as r,a3 as p,F as g,a4 as w,_ as Se,H as K}from"./vue-b9a22f97.js";const De={class:"flex justify-between px-2 items-center mb-2"},Fe={class:"me-1"},Ke={href:"javascript:;"},Ue=m("span",null,"全域黑名單功能: 主帳號將特定手機門號加入黑名單，主帳號和子帳號皆無法發送該門號任何訊息",-1),Pe=m("div",{class:"h-59px px-20px py-24px"},[m("p",{class:"text-center text-sms-grayscale-80"},"您選擇的聯絡人將直接永久刪除。")],-1),Oe=m("div",{class:"h-59px px-20px py-24px"},[m("p",{class:"text-center text-sms-grayscale-80"},"聯絡人列表中，已經存在相同的聯絡人。")],-1),qe=Re({__name:"contact-person-archived",props:{toContactPerson:{type:Function,required:!0}},setup(U){const P=U,Y=x([{value:!0,label:"是"},{value:!1,label:"否"}]),{contactPerson:L,pagination:h,getContactPersonArchived:O,deleteContactPerson:B,unArchivedContactPerson:V}=de(),{getGroupLabelOption:E,groupOptions:$}=ve(),M=ce(),A=x(!1);Ye(async()=>{C(),await E()}),Le(()=>{A.value=!0});const G=[{title:"手機門號",dataIndex:"phone",key:"phone",sorter:!0,fixed:"left",width:"130px"},{title:"姓名",dataIndex:"name",key:"name",sorter:!0,fixed:"left",width:"80px"},{title:"群組標籤",dataIndex:"group",key:"group",fixed:"left",width:"250px"},{title:"性別",dataIndex:"gender",key:"gender",sorter:!0,width:"70px"},{title:"黑名單",dataIndex:"isBlackList",key:"isBlackList",sorter:!0,width:"100px"},{title:"聯絡電話",dataIndex:"contact",key:"contact",sorter:!0,width:"110px"},{title:"公司名稱",dataIndex:"company",key:"company",sorter:!0,ellipsis:!0,width:"121px"},{title:"Email",dataIndex:"email",key:"email",sorter:!0,ellipsis:!0,width:"184px"},{title:"生日",dataIndex:"birth",key:"birth",sorter:!0,width:"95px"},{title:"通訊地址",dataIndex:"address",key:"address",sorter:!0,ellipsis:!0,width:"108px"},{title:"備註",dataIndex:"note",key:"note",sorter:!0,width:"108px"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"140px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0,width:"140px"}],u=Me({selectedRowKeys:[],selectedRows:[],loading:!1}),N=(l,a)=>{console.log("selectedRowKeys changed: ",l,a),u.selectedRowKeys=l,u.selectedRows=a},s=x({sortField:"createTime",sortOrder:"descend",phone:"",name:"",group:[],company:"",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:"",blackList:void 0}),j=x(),C=async(l=1,a=10)=>{var _,k;let d={current:l,pageSize:a,...e(s),group:((k=(_=s.value)==null?void 0:_.group)==null?void 0:k.map(c=>c.id))??[]};await O(d)},z=async(l,a,d)=>{console.log("pagination:",l,"sorter:",d),s.value=Object.assign(s.value,{sortField:d.field,sortOrder:d.order}),await C(l.current,l.pageSize)},R=x(null),q=()=>{var l;C(1),(l=R.value)==null||l.hide()},b=x(!1),H=async()=>{var a;((a=(await B(u.selectedRows.map(d=>d.key))).data)==null?void 0:a.status)==="success"&&(C(h.value.current===1||L.value.length-u.selectedRowKeys.length>1?h.value.current:h.value.current-1,h.value.pageSize),u.selectedRowKeys=[],u.selectedRows=[],b.value=!1,M.success({message:"聯絡人刪除成功",placement:"top"}))},I=x(!1),Q=()=>{I.value=!0},W=async()=>{var a;((a=(await V(u.selectedRowKeys)).data)==null?void 0:a.status)==="success"&&(M.success({message:"聯絡人回復成功",placement:"top"}),P.toContactPerson())},X=()=>{W()},J=()=>document.body;return(l,a)=>{const d=me,_=pe,k=ye,c=ie,f=ge,Z=we,S=ke,D=he,ee=be,te=Ce,ae=Ie,oe=ue,ne=le,F=Te;return v(),y(g,null,[m("div",De,[m("div",null,[t(_,{status:"small2",class:"me-2",disabled:e(u).selectedRowKeys.length===0,onClick:Q},{icon:o(()=>[t(d,{name:"change",width:"16px"})]),default:o(()=>[r("回復聯絡人 ")]),_:1},8,["disabled"]),t(_,{status:"small2",class:"me-2",disabled:e(u).selectedRowKeys.length===0},{icon:o(()=>[t(d,{name:"download",width:"16px"})]),default:o(()=>[r("匯出CSV ")]),_:1},8,["disabled"]),t(_,{status:"small2",class:"me-2",onClick:a[0]||(a[0]=n=>b.value=!0),disabled:e(u).selectedRowKeys.length===0},{icon:o(()=>[t(d,{name:"delete",width:"16px"})]),default:o(()=>[r("永久刪除 ")]),_:1},8,["disabled"])]),t(se,{ref_key:"filterKeywordInputRef",ref:R,class:"w-440px h-40px",modelValue:e(s).keyword,"onUpdate:modelValue":a[9]||(a[9]=n=>e(s).keyword=n),placeholder:"搜尋門號、姓名、公司、通訊地址、Email、備註",onClearFilter:a[10]||(a[10]=()=>{s.value={...e(s),phone:"",name:"",group:[],company:"",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:"",blackList:void 0}})},{filterForm:o(()=>[t(te,{ref_key:"formRef",ref:j,layout:"vertical",model:e(s),autocomplete:"off"},{default:o(()=>[t(ee,{gutter:[16,12]},{default:o(()=>[t(f,{span:24},{default:o(()=>[t(c,{label:"手機門號",valueed:e(s).phone},{default:o(()=>[t(k,{value:e(s).phone,"onUpdate:value":a[1]||(a[1]=n=>e(s).phone=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(f,{span:24},{default:o(()=>[t(c,{label:"姓名",valueed:e(s).name},{default:o(()=>[t(k,{value:e(s).name,"onUpdate:value":a[2]||(a[2]=n=>e(s).name=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(f,{span:24},{default:o(()=>[t(c,{id:"group",label:"群組標籤",valueed:e(_e)(e(s).group)},{default:o(()=>[t(S,{options:e($),maxTagCount:2,showArrow:!0,showSearch:!1,mode:"multiple",value:e(s).group,"onUpdate:value":a[3]||(a[3]=n=>e(s).group=n),class:"w-full"},{option:o(({value:n,label:i})=>[t(Z,{checked:e(s).group.includes(n)},null,8,["checked"]),r(" "+p(i),1)]),menuItemSelectedIcon:o(()=>[r(p(""))]),_:1},8,["options","value"])]),_:1},8,["valueed"])]),_:1}),t(f,{span:24},{default:o(()=>[t(c,{label:"黑名單",valueed:e(fe)(e(s).blackList,e(Y))},{default:o(()=>[t(S,{options:e(Y),maxTagCount:2,showArrow:!0,showSearch:!1,value:e(s).blackList,"onUpdate:value":a[4]||(a[4]=n=>e(s).blackList=n),class:"w-full"},null,8,["options","value"])]),_:1},8,["valueed"])]),_:1}),t(f,{span:24},{default:o(()=>[t(c,{label:"公司名稱",valueed:e(s).company},{default:o(()=>[t(k,{value:e(s).company,"onUpdate:value":a[5]||(a[5]=n=>e(s).company=n),name:"company"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(f,{span:24},{default:o(()=>[t(c,{label:"建立時間",valueed:e(s).createTime},{default:o(()=>[t(D,{class:"w-full",value:e(s).createTime,"onUpdate:value":a[6]||(a[6]=n=>e(s).createTime=n),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(f,{span:24},{default:o(()=>[t(c,{label:"修改時間",valueed:e(s).updateTime},{default:o(()=>[t(D,{class:"w-full",value:e(s).updateTime,"onUpdate:value":a[7]||(a[7]=n=>e(s).updateTime=n),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(f,{span:24,class:"text-center"},{default:o(()=>[t(_,{status:"small2",class:"me-5",onClick:a[8]||(a[8]=n=>{var i;return(i=e(R))==null?void 0:i.hide()})},{default:o(()=>[r("取消")]),_:1}),t(_,{status:"small1",onClick:q},{default:o(()=>[r("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(ne,{dataSource:e(L),columns:G,scroll:{x:1500},size:"small",showSorterTooltip:!1,"row-selection":{selectedRowKeys:e(u).selectedRowKeys,onChange:N},onChange:z,pagination:{...e(h)}},{headerCell:o(({column:n})=>[n.key==="isBlackList"?(v(),y(g,{key:0},[m("span",Fe,p(n.title),1),t(ae,{placement:"top","get-popup-container":J},{title:o(()=>[Ue]),default:o(()=>[m("a",Ke,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1})],64)):w("",!0)]),bodyCell:o(({column:n,record:i,text:T})=>[n.dataIndex==="group"?(v(),Se(oe,{key:0,chips:i.group,"max-count":3},null,8,["chips"])):w("",!0),n.dataIndex==="phone"?(v(),y(g,{key:1},[r(p(i.countryCode)+p(i.phone),1)],64)):w("",!0),n.dataIndex==="contact"?(v(),y(g,{key:2},[r(p(i.areaCode)+p(i.contact),1)],64)):w("",!0),n.dataIndex==="gender"?(v(),y(g,{key:3},[r(p(e(re)[T]),1)],64)):w("",!0),n.dataIndex==="isBlackList"?(v(),y(g,{key:4},[r(p(T?"黑名單":""),1)],64)):w("",!0),n.dataIndex==="note"?(v(),y(g,{key:5},[r(p(e(xe)(T)?"-":T),1)],64)):w("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),t(F,{open:e(b),"onUpdate:open":a[11]||(a[11]=n=>K(b)?b.value=n:null),centered:"",title:"是否永久刪除選取的聯絡人？",width:"440px",cancelText:"取消",okText:"確定",onOk:H},{default:o(()=>[Pe]),_:1},8,["open"]),t(F,{open:e(I),"onUpdate:open":a[12]||(a[12]=n=>K(I)?I.value=n:null),centered:"",title:"是否覆蓋現有的聯絡人？",width:"440px",cancelText:"取消",okText:"確定",onOk:X},{default:o(()=>[Oe]),_:1},8,["open"])],64)}}});export{qe as _};

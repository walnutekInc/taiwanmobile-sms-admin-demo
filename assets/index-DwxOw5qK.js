import{_ as he}from"./index.vuevuetypescriptsetuptruelang-DfpYyfOk.js";import{M as p,u as xe,_ as Ce}from"./message-sending-T4Eej_vI.js";import{_ as Te}from"./index.vuevuetypestyleindex0lang-BGNd5Gbb.js";import{j as Ne,_ as L}from"./index-CcLunYFo.js";import{_ as Pe,a as Re}from"./index.vuevuetypescriptsetuptruelang-3e_L4r1N.js";import{_ as ze}from"./index-AissqEby.js";import{_ as De}from"./index.vuevuetypescriptsetuptruelang-DpQcR6qX.js";import{Q as Ie,O as Ae,E as x,N as C,K as W,V as q,I as Be,p as Ge,q as Ye,G as je,s as Fe,F as $e,H as Ke,r as Ee,z as Oe}from"./antd-CL-o36kY.js";import{i as Ve}from"./isToday-BnJQkdBi.js";import{F as Ue}from"./index-DLKOsa0a.js";import{a as He,b as Q}from"./tools-DuR4KSGu.js";import{u as Le}from"./request-C_CmeEnJ.js";import{d as We,f as T,ad as qe,D as Qe,r as Xe,u as e,W as v,_ as X,$ as l,Y as f,k as s,G as w,X as y,F as j,a3 as N,a4 as z,H as Je}from"./vue-BMMYOVpY.js";import"./context-1rSUtUWu.js";import"./index.vuevuetypescriptsetuptruelang-Be-U4hx2.js";import"./index.vuevuetypestyleindex0lang-Cj84r4o_.js";import"./index.vuevuetypescriptsetuptruelang-CP3U4HOe.js";const D=[{key:"1",sendNumber:"4238179212",name:"促銷活動",reservationTime:"2024/07/10 12:22",messageStatus:"SMS_General",messageStatusName:p.SMS_General,status:"預約中",reservationCount:"218"},{key:"2",sendNumber:"2047534772",name:"生日活動",reservationTime:"2024/07/22 14:30",messageStatus:"MMS_General",messageStatusName:p.MMS_General,status:"預約中",reservationCount:"1,297"},{key:"3",sendNumber:"6734774231",name:"來店體驗",reservationTime:"2024/08/08 09:00",messageStatus:"MMS_Parameter",messageStatusName:p.MMS_Parameter,status:"預約中",reservationCount:"638"},{key:"4",sendNumber:"6473568820",name:"20241028_14:20",reservationTime:"2024/08/12 00:00",messageStatus:"MMS_Parameter",messageStatusName:p.MMS_Parameter,status:"預約中",reservationCount:"88"},{key:"5",sendNumber:"1241629349",name:"週年大慶典週年大慶典週年大慶典週年大慶典週年大慶典週年大慶典",reservationTime:"2024/09/09 10:00",messageStatus:"SMS_General",messageStatusName:p.SMS_General,status:"預約中",reservationCount:"840"},{key:"6",sendNumber:"6794384937",name:"8月生日",reservationTime:"2024/09/23 17:00",messageStatus:"SMS_Parameter",messageStatusName:p.SMS_Parameter,status:"預約中",reservationCount:"243"},{key:"7",sendNumber:"2043574512",name:"6月生日",reservationTime:"2024/10/01 12:00",messageStatus:"MMS_Parameter",messageStatusName:p.MMS_Parameter,status:"預約中",reservationCount:"2,839"},{key:"8",sendNumber:"7840304979",name:"加倍促銷",reservationTime:"2024/10/10 12:00",messageStatus:"MMS_General",messageStatusName:p.MMS_General,status:"預約中",reservationCount:"674"},{key:"9",sendNumber:"6459293927",name:"限時促銷",reservationTime:"2024/10/31 20:30",messageStatus:"MMS_Parameter",messageStatusName:p.MMS_Parameter,status:"預約中",reservationCount:"674"},{key:"10",sendNumber:"4638049869",name:"獨享好禮",reservationTime:"2024/11/11 11:11",messageStatus:"MMS_Parameter",messageStatusName:p.MMS_Parameter,status:"預約中",reservationCount:"43,048"},{key:"11",sendNumber:"5384279741",name:"端午節南北粽戰爭",reservationTime:"2024/11/25 07:30",messageStatus:"MMS_General",messageStatusName:p.MMS_General,status:"預約中",reservationCount:"8,452"}];function Ze(){const{list:F,pagination:I,setResponseList:S}=Le();return{getAppointments:async d=>{const g=(d.current-1)*d.pageSize,n=Math.ceil(D.length/d.pageSize);S({total:D.length,pages:n,current:d.current,pageSize:d.pageSize,records:D.slice(g,d.current*d.pageSize)})},appointments:F,pagination:I,checkAppointmentNameExist:async(d,g)=>{const n=Ie(D,{name:d});return n?!(!Ae(g)&&n.key===g):!1},updateAppointmentData:async(d,g)=>({data:{status:"success"}}),deleteAppointment:async d=>({data:{status:"success"}})}}const et={class:"flex justify-between px-2 items-center py-4 bg-sms-grayscale-0 rounded-t-12px"},tt={class:"me-1"},st={href:"javascript:;"},at=f("span",null,"為預約當下的接收門號總數扣除黑名單門號總數，實際發送時會重新計算有效發送筆數",-1),nt={key:0},ot={class:"editable-cell-wrapper"},it={class:"text-sms-status-alert-red text-xs"},lt={key:1,class:"editable-cell-wrapper"},rt={key:0},mt={class:"editable-cell-wrapper"},ut={class:"text-sms-status-alert-red text-xs"},dt={key:1,class:"editable-cell-wrapper"},ct=f("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 您選擇的預約訊息將永久刪除。 ",-1),Rt=We({__name:"index",setup(F){x.extend(Ve);const{getAppointments:I,appointments:S,pagination:P,checkAppointmentNameExist:$,updateAppointmentData:A,deleteAppointment:K}=Ze(),{renderGeneralMessagePreviewArray:d,renderParameterMessagePreviewArray:g}=xe(),n=T(),J=qe();Qe(async()=>{R()});const B=Ne(),Z=[{title:"發送編號",dataIndex:"sendNumber",key:"sendNumber",sorter:!0,width:"91px"},{title:"活動名稱",dataIndex:"name",key:"name",sorter:!0,width:"304px"},{title:"預約時間",dataIndex:"reservationTime",key:"reservationTime",sorter:!0,width:"200px"},{title:"訊息類型",dataIndex:"messageStatusName",key:"messageStatusName",sorter:!0,width:"140px"},{title:"狀態",dataIndex:"status",key:"status",width:"98px"},{title:"預約筆數",dataIndex:"reservationCount",key:"reservationCount",sorter:!0,width:"111px"},{title:"預覽",dataIndex:"preview",key:"preview",width:"72px"}],c=Xe({selectedRowKeys:[],selectedRows:[],loading:!1});function ee(o,t){console.log("selectedRowKeys changed: ",o,t),c.selectedRowKeys=o,c.selectedRows=t}const E=Object.entries(p).map(([o,t])=>({label:t,value:o})),m=T({sortField:"createTime",sortOrder:"descend",messageStatus:[],reservationTimes:void 0,name:"",keyword:""});async function R(o=1,t=10){const a={current:o,pageSize:t,...e(m)};await I(a)}async function te(o,t,a){console.log("sorter:",a),m.value=Object.assign(m.value,{sortField:a.field,sortOrder:a.order}),await R(P.value.current,P.value.pageSize)}async function se(o,t){await R(o,t)}function O(o,t){n.value={...W(S.value.filter(a=>o===a.key)[0]),msg:"",editColumn:t}}async function G(o){var t,a;if(n.value){const i=e(n);if((i==null?void 0:i.editColumn)==="name"){if(C(i.name)){n.value.msg="請輸入活動名稱";return}await $(i.name,i.key)?n.value.msg=`系統中已有「${i.name}」，請勿重複新增`:((t=(await A(i.key,{name:i.name})).data)==null?void 0:t.status)==="success"&&(Object.assign(S.value.filter(M=>o===M.key)[0],i),n.value=void 0,B.success({message:"訊息編輯成功",placement:"top"}))}else(i==null?void 0:i.editColumn)==="reservationTime"&&(C(i.reservationTime)?n.value.msg="請選擇預約日期":x().diff(x(i.reservationTime),"minute")>0&&(n.value.msg="閒置過久，請重新選擇預約時間"),C(n.value.msg)&&((a=(await A(i.key,{reservationTime:i.reservationTime})).data)==null?void 0:a.status)==="success"&&(Object.assign(S.value.filter(k=>o===k.key)[0],i),n.value=void 0,B.success({message:"訊息編輯成功",placement:"top"})))}}const Y=T(null);function ae(){var o;R(1),(o=Y.value)==null||o.hide()}function ne(){c.selectedRows.length===1&&J.push({name:c.selectedRows[0].messageStatus==="MMS_General"||c.selectedRows[0].messageStatus==="SMS_General"?"MessageSendingGeneralEdit":"MessageSendingParameterEdit",params:{id:c.selectedRowKeys[0]}})}const b=T(!1);function oe(){b.value=!0}async function ie(){var t;((t=(await K(c.selectedRowKeys)).data)==null?void 0:t.status)==="success"&&(B.success({message:"訊息刪除成功",placement:"top"}),b.value=!1,c.selectedRowKeys=[],c.selectedRows=[])}const V=x();function le(o){const t=V.add(1,"year");return o&&(o<V||o>=t)}function re(o){if(o&&o.isToday()){const t=x().add(5,"minute"),a=t.hour(),i=t.minute();return{disabledHours:()=>q(0,24).slice(0,a),disabledMinutes:()=>q(0,60).slice(0,i)}}return{}}const U=T(null),me={name:"季末大促銷季末大促銷季末大促銷季末大促銷季末大促銷季末大促銷",messageType:"MMS",phone:"0961-238-888",content:"愛戀情人節，獨家驚喜等您發現！ 情人節將至，愛戀之情將再次升華！我們特別為您準備了一場浪漫的情人節限定活動，帶來一系列獨家驚喜等您發現。無論您是想要為您的另一半挑選一份特別的禮物，還是希望一起度過浪漫的夜晚，我們都有豐富的選擇和活動等待著您。讓我們一同創造美好的回憶，共度這個充滿愛意的情人節！",subject:"",sendTimeType:"RESERVATION",effectiveTime:"",reservationTime:""};function ue(o){var i;let t,a={...W(me),name:o.name,reservationTime:o.reservationTime};a&&(o.messageStatus==="MMS_General"?(a={...a,messageType:"MMS",subject:"測試",recipients:{contactPerson:["1","2"],group:[{id:"1",label:"群組A"}],manual:"0912345678,0912345678",file:void 0},multimediaFile:[{url:"https://cdn.pixabay.com/photo/2019/08/09/13/51/boat-4395122_1280.jpg",fileName:"rose_celebrate.png",size:86400,key:"1",fileSize:"",file:void 0,type:"image"},{url:"https://cdn.pixabay.com/photo/2018/06/09/21/37/summer-thunder-storm-3465247_1280.jpg",fileName:"invitation_username.jpg",size:86400,key:"2",fileSize:"",file:void 0,type:"image"},{url:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",fileName:"BigBuckBunny.mp4",size:86400,key:"2",fileSize:"",file:void 0,type:"video"}]},t=d(a)):o.messageStatus==="SMS_General"?(a={...a,messageType:"SMS",recipients:{contactPerson:["1","2"],group:[{id:"1",label:"群組A"}],manual:"0912345678,0912345678",file:void 0},multimediaFile:[]},t=d(a)):(a={...a,messageType:"SMS",file:{fileName:"test.xlsx",url:""},multimediaFile:[{url:"https://cdn.pixabay.com/photo/2019/08/09/13/51/boat-4395122_1280.jpg",fileName:"rose_celebrate.png",size:86400,key:"1",fileSize:"",file:void 0,type:"image"},{url:"https://cdn.pixabay.com/photo/2018/06/09/21/37/summer-thunder-storm-3465247_1280.jpg",fileName:"invitation_username.jpg",size:86400,key:"2",fileSize:"",file:void 0,type:"image"},{url:"http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",fileName:"BigBuckBunny.mp4",size:86400,key:"2",fileSize:"",file:void 0,type:"video"}],isCommonContent:!0,multimediaFileWithSubject:[],recipients:[{number:"1",phone:"0938118293",field1:"小馬",field2:"9412918",field3:"-",field4:"-",field5:"-"},{number:"2",phone:"0946184761",field1:"安潔",field2:"5439577",field3:"-",field4:"-",field5:"-"},{number:"3",phone:"0966092938",field1:"Lucy",field2:"5634840",field3:"-",field4:"-",field5:"-"},{number:"4",phone:"0956482371",field1:"Sam",field2:"3437402",field3:"-",field4:"-",field5:"-"},{number:"5",phone:"0978049940",field1:"Tim",field2:"8480277",field3:"-",field4:"-",field5:"-"}]},t=g(a))),(i=U.value)==null||i.show(t)}return(o,t)=>{const a=L,i=De,h=Be,k=ze,M=Ge,de=Pe,ce=Re,pe=Ye,fe=je,_e=Fe,ve=$e,ge=Ke,ye=Ee,Se=L,ke=Te,Me=Oe,we=Ce,be=he;return v(),X(be,{title:"預約管理"},{default:l(()=>[f("div",et,[f("div",null,[s(i,{status:"small2",class:"me-2",disabled:e(c).selectedRowKeys.length===0||e(c).selectedRowKeys.length>1,onClick:ne},{icon:l(()=>[s(a,{name:"edit",width:"16px"})]),default:l(()=>[w(" 編輯 ")]),_:1},8,["disabled"]),s(i,{status:"small2",class:"me-2",disabled:e(c).selectedRowKeys.length===0,onClick:oe},{icon:l(()=>[s(a,{name:"delete",width:"16px"})]),default:l(()=>[w(" 刪除 ")]),_:1},8,["disabled"])]),s(Ue,{ref_key:"filterKeywordInputRef",ref:Y,modelValue:e(m).keyword,"onUpdate:modelValue":t[5]||(t[5]=r=>e(m).keyword=r),class:"w-440px h-40px",placeholder:"搜尋活動名稱",onClearFilter:t[6]||(t[6]=()=>{m.value={...e(m),keyword:"",name:"",messageStatus:[],reservationTimes:void 0}})},{filterForm:l(()=>[s(ve,{layout:"vertical",model:e(m),autocomplete:"off"},{default:l(()=>[s(_e,{gutter:[16,12]},{default:l(()=>[s(M,{span:24},{default:l(()=>[s(k,{label:"活動名稱",valueed:e(m).name},{default:l(()=>[s(h,{value:e(m).name,"onUpdate:value":t[0]||(t[0]=r=>e(m).name=r)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),s(M,{span:24},{default:l(()=>[s(k,{label:"訊息類型",valueed:e(He)(e(m).messageStatus)},{default:l(()=>[s(pe,{value:e(m).messageStatus,"onUpdate:value":t[2]||(t[2]=r=>e(m).messageStatus=r),options:e(E),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full","menu-item-selected-icon":" "},{dropdownRender:l(({menuNode:r})=>[s(de,{modelValue:e(m).messageStatus,"onUpdate:modelValue":t[1]||(t[1]=u=>e(m).messageStatus=u),menu:r,options:e(E)},null,8,["modelValue","menu","options"])]),option:l(({value:r,label:u})=>[s(ce,{values:e(m).messageStatus,value:r,label:u},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),s(M,{span:24},{default:l(()=>[s(k,{label:"預約時間",valueed:e(m).reservationTimes},{default:l(()=>[s(fe,{value:e(m).reservationTimes,"onUpdate:value":t[3]||(t[3]=r=>e(m).reservationTimes=r),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),s(M,{span:24,class:"text-center"},{default:l(()=>[s(i,{status:"small2",class:"me-5",onClick:t[4]||(t[4]=r=>{var u;return(u=e(Y))==null?void 0:u.hide()})},{default:l(()=>[w(" 取消 ")]),_:1}),s(i,{status:"small1",onClick:ae},{default:l(()=>[w(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),s(ke,{"data-source":e(S),columns:Z,size:"small","show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(c).selectedRowKeys,onChange:ee},pagination:{...e(P)},onChange:te,onChangePagination:se},{headerCell:l(({column:r})=>[r.key==="reservationCount"?(v(),y(j,{key:0},[f("span",tt,N(r.title),1),s(ge,{placement:"top","get-popup-container":e(Q)},{title:l(()=>[at]),default:l(()=>[f("a",st,[s(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])],64)):z("",!0)]),bodyCell:l(({column:r,record:u,text:H})=>[r.dataIndex==="name"?(v(),y(j,{key:0},[e(n)&&e(n).editColumn==="name"&&e(n).key===u.key?(v(),y("div",nt,[f("div",ot,[s(h,{value:e(n).name,"onUpdate:value":t[7]||(t[7]=_=>e(n).name=_),maxlength:30,status:e(n).msg&&!e(C)(e(n).msg)?"error":"",onPressEnter:_=>G(u.key)},null,8,["value","status","onPressEnter"]),s(a,{name:"save",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:_=>G(u.key)},null,8,["onClick"])]),f("span",it,N(e(n).msg),1)])):(v(),y("div",lt,[w(N(H||" ")+" ",1),s(a,{name:"edit",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:_=>O(u.key,r.dataIndex)},null,8,["onClick"])]))],64)):z("",!0),r.dataIndex==="reservationTime"?(v(),y(j,{key:1},[e(n)&&e(n).editColumn==="reservationTime"&&e(n).key===u.key?(v(),y("div",rt,[f("div",mt,[s(ye,{value:e(n).reservationTime,"onUpdate:value":t[8]||(t[8]=_=>e(n).reservationTime=_),format:"YYYY/MM/DD HH:mm","value-format":"YYYY/MM/DD HH:mm","disabled-date":le,"disabled-time":re,"show-time":!0,"show-now":!1,status:e(n).msg&&!e(C)(e(n).msg)?"error":"","get-popup-container":e(Q),placeholder:""},null,8,["value","status","get-popup-container"]),s(a,{name:"save",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:_=>G(u.key)},null,8,["onClick"])]),f("span",ut,N(e(n).msg),1)])):(v(),y("div",dt,[w(N(H||" ")+" ",1),s(a,{name:"edit",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:_=>O(u.key,r.dataIndex)},null,8,["onClick"])]))],64)):z("",!0),r.dataIndex==="preview"?(v(),X(i,{key:2,status:"small3",onClick:_=>ue(u)},{icon:l(()=>[s(Se,{name:"preview-blue"})]),_:2},1032,["onClick"])):z("",!0)]),_:1},8,["data-source","row-selection","pagination"]),s(Me,{open:e(b),"onUpdate:open":t[9]||(t[9]=r=>Je(b)?b.value=r:null),title:"是否刪除選取的預約訊息？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:ie},{default:l(()=>[ct]),_:1},8,["open"]),s(we,{ref_key:"fullPhonePreviewModalRef",ref:U,tooltip:!0},null,512)]),_:1})}}});export{Rt as default};

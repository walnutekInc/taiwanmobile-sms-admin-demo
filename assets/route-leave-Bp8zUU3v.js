import{d as j,aj as le,ak as be,o as ie,j as Ce,r as H,f as w,w as se,y as we,al as ke,W as M,X as P,_ as W,ab as T,u as e,a8 as Oe,Q as ue,a4 as de,Y as g,F as Q,$ as o,k as t,G as I,H as B,a3 as q,m as V,A as N,a9 as $e,a5 as Se,ad as Re,l as Le}from"./vue-Cot4Dobd.js";import{_ as ee}from"./index.vuevuetypescriptsetuptruelang-DtpB6Cde.js";import{z as Y,P as ce,Q as X,U as pe,I as fe,o as me,p as _e,s as ve,F as ge,X as Ue,q as Te,x as Ie,K as Me}from"./antd-C_UvAipJ.js";import{_ as Ee,k as Ae}from"./index-DPDfwRPd.js";import{c as Z,a as Be,b as re}from"./index.esm-BZKKJbd0.js";import{_ as De}from"./index.vuevuetypestyleindex0lang-DRI_kzvm.js";import{_ as Fe}from"./request-v8LTZy6R.js";import{u as He}from"./custom-message-QRXnLG1T.js";const Pe={key:0,class:"form-textarea-multimedia"},Ve={class:"form-textarea-tools py-2"},Ne="div",_t=j({__name:"index",props:le({contenteditable:{type:[Boolean,String],default:!0},noHtml:{type:Boolean,default:!1},noNl:{type:Boolean,default:!1},maxLen:{type:Number},contentLen:{type:Number},placeholder:String},{modelValue:{required:!0},modelModifiers:{}}),emits:le({returned:String},["update:modelValue"]),setup(k,{emit:h}){const c=k,O=h;function v(l,f,d){return l.split(f).join(d)}const s=be(k,"modelValue");ie(()=>{document.addEventListener("selectionchange",b)}),Ce(()=>{document.removeEventListener("selectionchange",b)});function r(){return`r${new Date().getTime()}d${Math.ceil(Math.random()*1e3)}`}const $=H({contentId:`content${r()}`,isLocked:!1,currentTagId:null,savedRange:{}});function b(){var f;const l=window.getSelection();if(l){const d=l.rangeCount>0?l.getRangeAt(0):null;d&&((f=d.commonAncestorContainer.ownerDocument)!=null&&f.activeElement)&&d.commonAncestorContainer.ownerDocument.activeElement.id===$.contentId&&($.savedRange=d)}}const x=w();function i(){return c.noHtml?x.value.textContent:x.value.innerHTML}function n(l){c.noHtml?x.value.textContent=e(l):x.value.innerHTML=e(l)}function S(){s.value=i()}function p(l){l.preventDefault();let f=(l.originalEvent||l).clipboardData.getData("text/plain");if(c.noNl&&(f=v(f,`\r
`," "),f=v(f,`
`," "),f=v(f,"\r"," ")),c.contentLen&&c.maxLen&&c.contentLen+f.length>=c.maxLen)return l.keyCode===8,void 0;console.log("paste"),window.document.execCommand("insertText",!1,f)}function C(l){l.key==="Enter"&&c.noNl&&(l.preventDefault(),O("returned",i()))}se(s,async l=>{await we(),l!==i()&&n(l??"")}),se(()=>c.noHtml,()=>{n(s.value??"")});function m(l){if(c.contentLen&&c.maxLen&&c.contentLen>=c.maxLen){if(l.keyCode===8)return;l.preventDefault()}}const _=ke();return(l,f)=>(M(),P(Q,null,[(M(),W(Oe(Ne),T({id:e($).contentId,ref_key:"element",ref:x,class:"tag-textarea"},l.$attrs,{contenteditable:k.contenteditable,"data-placeholder":k.placeholder,style:{scrollPaddingBottom:`${e(_).multimediaBlock?148:50}px`,paddingBottom:`${e(_).multimediaBlock?148:50}px`},onInput:S,onBlur:S,onPaste:p,onKeypress:C,onKeydown:m}),null,16,["id","contenteditable","data-placeholder","style"])),e(_).multimediaBlock?(M(),P("div",Pe,[ue(l.$slots,"multimediaBlock")])):de("",!0),g("div",Ve,[ue(l.$slots,"default")])],64))}}),je={class:"px-24px"},qe=g("p",{class:"text-center"}," 選擇想加入的參數後，再點擊確定即可。 ",-1),ze={class:"flex justify-between gap-x-2"},Ke=g("p",{class:"text-sms-grayscale-60 text-sm mt-10"},[I(" 加入參數功能說明："),g("br"),I(" 此為自訂訊息的插入參數功能，參數訊息發送功能位置為【訊息行銷活動】和【參數訊息】。訊息內容可自由插入參數，至多使用 5 個參數，依照上傳參數檔案而組成訊息內容。 ")],-1),vt=j({__name:"add-field",emits:["addFieldToContent"],setup(k,{expose:h,emit:c}){const O=c,v=w(!1),s=w([]);function r(x){s.value.includes(x)?s.value=s.value.filter(i=>i!==x):s.value.push(x)}async function $(){s.value=[],v.value=!0}function b(){v.value=!1,O("addFieldToContent",s.value)}return h({show:$}),(x,i)=>{const n=ee,S=Y;return M(),W(S,{open:e(v),"onUpdate:open":i[5]||(i[5]=p=>B(v)?v.value=p:null),title:"加入參數",centered:"","cancel-text":"取消","ok-text":"確定",width:"600px",onOk:b},{default:o(()=>[g("div",je,[qe,g("div",ze,[t(n,{status:e(s).includes("%field1%")?"small1":"small2",onClick:i[0]||(i[0]=p=>r("%field1%"))},{default:o(()=>[I(" %field1% ")]),_:1},8,["status"]),t(n,{status:e(s).includes("%field2%")?"small1":"small2",onClick:i[1]||(i[1]=p=>r("%field2%"))},{default:o(()=>[I(" %field2% ")]),_:1},8,["status"]),t(n,{status:e(s).includes("%field3%")?"small1":"small2",onClick:i[2]||(i[2]=p=>r("%field3%"))},{default:o(()=>[I(" %field3% ")]),_:1},8,["status"]),t(n,{status:e(s).includes("%field4%")?"small1":"small2",onClick:i[3]||(i[3]=p=>r("%field4%"))},{default:o(()=>[I(" %field4% ")]),_:1},8,["status"]),t(n,{status:e(s).includes("%field5%")?"small1":"small2",onClick:i[4]||(i[4]=p=>r("%field5%"))},{default:o(()=>[I(" %field5% ")]),_:1},8,["status"])]),Ke])]),_:1},8,["open"])}}}),gt=j({__name:"add-link",emits:["addLinkToContent"],setup(k,{expose:h,emit:c}){const O=c,v={link:""};function s(C){const m="^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$",_=new RegExp(m,"i");return C.length<2083&&_.test(C)}const r=H(ce(v)),$=H({link:[{async validator(C,m){return X(m)?Promise.reject("請輸入縮網址"):s(m)?Promise.resolve():Promise.reject("請輸入有效網址")},trigger:"blur"}]}),{validateInfos:b,resetFields:x,validate:i}=pe(r,$),n=w(!1);async function S(){x(v),n.value=!0}function p(){i().then(async()=>{O("addLinkToContent",r.link),n.value=!1})}return h({show:S}),(C,m)=>{const _=fe,l=me,f=_e,d=ee,y=ve,R=ge,E=Y;return M(),W(E,{open:e(n),"onUpdate:open":m[1]||(m[1]=D=>B(n)?n.value=D:null),title:"加入縮網址",centered:"",width:"600px","cancel-text":"取消","ok-text":"確定",onOk:p},{default:o(()=>[t(R,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:p},{default:o(()=>[t(y,{gutter:[16,0]},{default:o(()=>[t(f,{span:24},{default:o(()=>[t(l,T({label:""},e(b).link),{default:o(()=>[t(_,{value:e(r).link,"onUpdate:value":m[0]||(m[0]=D=>e(r).link=D),valueModifiers:{trim:!0},placeholder:"請輸入原始長網址，範例: https://www.taiwanmobile.com/"},null,8,["value"])]),_:1},16)]),_:1}),t(d,{class:"hidden","html-type":"submit"})]),_:1})]),_:1})]),_:1},8,["open"])}}}),Ge={class:"flex items-center justify-center"},Qe=g("span",{"w.5":"","h-18px":""},q(""),-1),Xe=g("span",{"w.5":"","h-18px":""},q(""),-1),We=g("span",{"w.5":"","h-18px":""},q(""),-1),Ye={class:"px-24px"},Je={class:"flex justify-between items-center mb-4"},Ze=g("span",{class:"text-base text-sms-grayscale-80"},"選擇下列任一訊息，點擊「確定」。",-1),et=g("div",{class:"text-center px-30px py-20px text-base text-sms-grayscale-80 mx-auto"}," ※ 每次生成 3 則訊息，共收費新台幣 5 元 ",-1),tt=g("div",{class:"text-center px-30px py-20px text-base text-sms-grayscale-80 mx-auto"}," 已生成的訊息將直接刪除 ",-1),nt=g("div",{class:"px-24px text-center"}," 您重新選擇的自訂訊息內容，將會把現在的訊息完全覆蓋。 ",-1),xt=j({__name:"ai-text-generation",props:{content:{type:String,required:!0}},emits:["updateContent"],setup(k,{expose:h,emit:c}){const O=k,v=c,s=w(""),r=w([]),$=[{value:"singRule",label:"單則訊息 (70 字)"},{value:"longRule",label:"長訊息 (335 字)"},{value:"other",label:"其他"}],b=[{value:"notSpecify",label:"不指定"},{value:"promotions",label:"促銷活動"},{value:"promotions",label:"會員專屬"},{value:"newProductRecommendation",label:"新產品推薦"},{value:"eventInvitation",label:"活動邀請"},{value:"customerNotice",label:"客戶通知"},{value:"other",label:"其他"}],x=[{value:"notSpecify",label:"不指定"},{value:"friendly",label:"親切幽默"},{value:"professional",label:"專業正式"},{value:"warm",label:"溫暖感人"},{value:"other",label:"其他"}],n=H(ce({name:"",messageElement:"",count:void 0,countOtherConfig:"",type:"notSpecify",typeOtherConfig:"",tone:"notSpecify",toneOtherConfig:""})),S=H({messageElement:[{async validator(F,a){return X(a)?Promise.reject("請輸入訊息元素"):Promise.resolve()},trigger:"blur"}],count:[{required:!0,message:"請選擇訊息字數",trigger:"blur"}],countOtherConfig:[{async validator(F,a){return n.count!=="other"?Promise.resolve():await Z().shape({countOtherConfig:Be().typeError("請輸入訊息字數").min(1,"請輸入 1~335 之間任一數字").max(335,"請輸入 1~335 之間任一數字")}).validate({countOtherConfig:a})},trigger:"blur"}],typeOtherConfig:[{async validator(F,a){return n.type!=="other"?Promise.resolve():await Z().shape({typeOtherConfig:re().required("請輸入訊息種類")}).validate({typeOtherConfig:a})},trigger:"blur"}],toneOtherConfig:[{async validator(F,a){return n.tone!=="other"?Promise.resolve():await Z().shape({toneOtherConfig:re().required("請輸入訊息語氣")}).validate({toneOtherConfig:a})},trigger:"blur"}]}),{validateInfos:p,validate:C}=pe(n,S),m=w(!1),_=w(!1),l=w(!1);async function f(){m.value=!0}function d(){r.value.length===0?C().then(async()=>{_.value=!0}):D()}function y(){_.value=!1,r.value=[`Hello！親愛的 TAMedia Cafe 會員您好！促銷來囉！
買一送一伯爵鮮奶茶大放送！
只要透過訊息兌換序號，就能立即享受這份優惠！
別忘了帶上您的好友一同來品嚐，嚐一口就愛上的美味鮮奶茶！`,`Hello！親愛的TAMedia Cafe顧客您好！
想和您分享好消息，現在限時促銷！買一送一伯爵鮮奶茶，只需透過訊息兌換序號即可輕鬆獲得！
別忘了告訴您的朋友們，讓大家一同享受這份美味和歡笑！`,`哈囉！TAMedia Cafe 歡迎您！現在限時促銷！
買一送一伯爵鮮奶茶就在這裡！只要您透過訊息兌換序號，即可立即享受這份優惠！
快約上好友，一同來 TAMedia Cafe 享受美味，嘗一口就愛上的鮮奶茶吧！`]}function R(){r.value=[],s.value="",l.value=!1}const E=w(!1);function D(){X(O.content)?L():E.value=!0}function L(){m.value=!1,E.value=!1,v("updateContent",s.value)}return h({show:f}),(F,a)=>{const z=Ee,K=fe,A=me,U=_e,te=Ue,J=Te,ne=ee,oe=ve,ae=ge,xe=Ie,ye=Me,G=Y;return M(),P(Q,null,[t(G,{open:e(m),"onUpdate:open":a[13]||(a[13]=u=>B(m)?m.value=u:null),centered:"",width:"600px","cancel-text":e(r).length===0?"取消":"關閉","ok-text":"確定",onOk:d},{title:o(()=>[g("div",Ge,[t(z,{name:"AI2",width:"32px",class:"me-2"}),I(" "+q(e(r).length===0?"使用 AI 生成訊息內容":"AI 生成訊息結果"),1)])]),default:o(()=>[V(t(ae,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:d},{default:o(()=>[t(oe,{gutter:[16,16]},{default:o(()=>[t(U,{span:24},{default:o(()=>[t(A,T({label:"公司或產品名稱"},e(p).name,{extra:"30 字以內"}),{default:o(()=>[t(K,{value:e(n).name,"onUpdate:value":a[0]||(a[0]=u=>e(n).name=u),placeholder:"請輸入文字",maxlength:30},null,8,["value"])]),_:1},16)]),_:1}),t(U,{span:24},{default:o(()=>[t(A,T({label:"訊息元素"},e(p).messageElement,{extra:"給予 AI 生成文案的文字素材，150 字以內",required:""}),{default:o(()=>[t(te,{value:e(n).messageElement,"onUpdate:value":a[1]||(a[1]=u=>e(n).messageElement=u),rows:4,placeholder:`請輸入必要訊息元素，
必要訊息元素為您希望在訊息內容中一定要出現的資訊，
例如：顧客來店消費即可享有見面禮、提供消費者 DM 資訊`,"max-length":150},null,8,["value"])]),_:1},16)]),_:1}),t(U,{span:e(n).count!=="other"?24:12},{default:o(()=>[t(A,T({label:"訊息字數"},e(p).count,{required:""}),{default:o(()=>[t(J,{value:e(n).count,"onUpdate:value":a[2]||(a[2]=u=>e(n).count=u),options:$,placeholder:"請選擇訊息字數",onChange:a[3]||(a[3]=()=>{e(n).count==="other"&&(e(n).countOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),V(t(U,{span:12},{default:o(()=>[t(A,T(e(p).countOtherConfig,{extra:"可輸入 1~335 之間任一數字"}),{label:o(()=>[Qe]),default:o(()=>[t(K,{value:e(n).countOtherConfig,"onUpdate:value":a[4]||(a[4]=u=>e(n).countOtherConfig=u),type:"number",placeholder:"請輸入訊息字數",controls:!1},null,8,["value"])]),_:1},16)]),_:1},512),[[N,e(n).count==="other"]]),t(U,{span:e(n).type!=="other"?24:12},{default:o(()=>[t(A,T({label:"訊息種類"},e(p).type),{default:o(()=>[t(J,{value:e(n).type,"onUpdate:value":a[5]||(a[5]=u=>e(n).type=u),options:b,placeholder:"請選擇訊息種類",onChange:a[6]||(a[6]=()=>{e(n).type==="other"&&(e(n).typeOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),V(t(U,{span:12},{default:o(()=>[t(A,T(e(p).typeOtherConfig,{extra:"15 字以內"}),{label:o(()=>[Xe]),default:o(()=>[t(K,{value:e(n).typeOtherConfig,"onUpdate:value":a[7]||(a[7]=u=>e(n).typeOtherConfig=u),"max-length":15,placeholder:"請輸入訊息種類"},null,8,["value"])]),_:1},16)]),_:1},512),[[N,e(n).type==="other"]]),t(U,{span:e(n).tone!=="other"?24:12},{default:o(()=>[t(A,T({label:"訊息語氣"},e(p).tone),{default:o(()=>[t(J,{value:e(n).tone,"onUpdate:value":a[8]||(a[8]=u=>e(n).tone=u),options:x,placeholder:"請選擇訊息語氣",onChange:a[9]||(a[9]=()=>{e(n).tone==="other"&&(e(n).toneOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),V(t(U,{span:12},{default:o(()=>[t(A,T(e(p).toneOtherConfig,{extra:"15 字以內"}),{label:o(()=>[We]),default:o(()=>[t(K,{value:e(n).toneOtherConfig,"onUpdate:value":a[10]||(a[10]=u=>e(n).toneOtherConfig=u),maxlength:15,placeholder:"請輸入訊息語氣"},null,8,["value"])]),_:1},16)]),_:1},512),[[N,e(n).tone==="other"]]),t(U,{span:24,class:"text-center text-sm text-sms-grayscale-60"},{default:o(()=>[I(" ※ 每次生成 3 則訊息，共收費新台幣 5 元 ")]),_:1}),t(ne,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512),[[N,e(r).length===0]]),V(g("div",Ye,[g("div",Je,[Ze,t(ne,{status:"small2",onClick:a[11]||(a[11]=u=>l.value=!0)},{default:o(()=>[I(" 重新生成 ")]),_:1})]),t(ae,{layout:"vertical",autocomplete:"off"},{default:o(()=>[t(ye,{value:e(s),"onUpdate:value":a[12]||(a[12]=u=>B(s)?s.value=u:null)},{default:o(()=>[t(oe,{gutter:[16,16]},{default:o(()=>[(M(!0),P(Q,null,$e(e(r),(u,he)=>(M(),W(U,{key:u,span:24,class:"flex"},{default:o(()=>[t(xe,{value:u},null,8,["value"]),t(A,{label:`訊息 Template${he+1}`,class:Se(["flex-1",{selected:e(s)===u}])},{default:o(()=>[t(te,{value:u,"auto-size":!0,readonly:"",onClick:st=>s.value=u},null,8,["value","onClick"])]),_:2},1032,["label","class"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1})],512),[[N,e(r).length>0]])]),_:1},8,["open","cancel-text"]),t(G,{open:e(_),"onUpdate:open":a[14]||(a[14]=u=>B(_)?_.value=u:null),title:"是否確定使用 AI 生成訊息？",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:y},{default:o(()=>[et]),_:1},8,["open"]),t(G,{open:e(l),"onUpdate:open":a[15]||(a[15]=u=>B(l)?l.value=u:null),title:"是否確定重新生成？",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:R},{default:o(()=>[tt]),_:1},8,["open"]),t(G,{open:e(E),"onUpdate:open":a[16]||(a[16]=u=>B(E)?E.value=u:null),title:"是否覆蓋現有的自訂訊息內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:L},{default:o(()=>[nt]),_:1},8,["open"])],64)}}}),ot={class:"px-24px"},at={key:0,class:"line-clamp-2"},lt=g("div",{class:"px-24px text-center"}," 您重新選擇的自訂訊息內容，將會把現在的訊息完全覆蓋。 ",-1),yt=j({__name:"import-custom-message",props:{content:{type:String,required:!0}},emits:["updateContent"],setup(k,{expose:h,emit:c}){const O=k,v=c,s=H({selectedRowKeys:[],selectedRows:[],loading:!1}),{customMessages:r,getCustomMessages:$,pagination:b}=He(),x=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"160px"},{title:"訊息名稱",dataIndex:"name",key:"name",sorter:!0,width:"160px"},{title:"訊息內容",dataIndex:"content",key:"content",sorter:!0}],i=w({categoryIds:[],keyword:"",name:"",content:"",sortField:"createTime",sortOrder:"descend"});async function n(d,y,R){console.log("pagination:",d,"sorter:",R),i.value=Object.assign(i.value,{sortField:R.field,sortOrder:R.order}),await S(d.current,d.pageSize)}async function S(d=1,y=10){const R={current:d,pageSize:y,...e(i)};await $(R)}function p(d,y){console.log("selectedRowKeys changed: ",d,y),s.selectedRowKeys=d,s.selectedRows=y}const C=w(!1);async function m(){s.selectedRowKeys=[],s.selectedRows=[],S(),C.value=!0}const _=w(!1);function l(){X(O.content)?f():_.value=!0}function f(){var d;C.value=!1,_.value=!1,v("updateContent",(d=s.selectedRows[0])==null?void 0:d.content)}return h({show:m}),(d,y)=>{const R=Fe,E=De,D=Y;return M(),P(Q,null,[t(D,{open:e(C),"onUpdate:open":y[1]||(y[1]=L=>B(C)?C.value=L:null),title:"選擇欲載入自訂訊息內容",centered:"","cancel-text":"取消","ok-text":"確定",width:"960px","ok-button-props":{disabled:e(s).selectedRowKeys.length===0},onOk:l},{default:o(()=>[g("div",ot,[t(R,{modelValue:e(i).keyword,"onUpdate:modelValue":y[0]||(y[0]=L=>e(i).keyword=L),"show-filter-btn":!1,placeholder:"搜尋訊息類別、名稱、內容",class:"mb-2"},null,8,["modelValue"]),t(E,{class:"modal-table","data-source":e(r),columns:x,"show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(s).selectedRowKeys,onChange:p,type:"radio"},pagination:{...e(b)},"custom-header-row":()=>({class:"modal-table"}),onChange:n},{bodyCell:o(({column:L,text:F})=>[L.dataIndex==="content"?(M(),P("div",at,q(F),1)):de("",!0)]),_:1},8,["data-source","row-selection","pagination"])])]),_:1},8,["open","ok-button-props"]),t(D,{open:e(_),"onUpdate:open":y[2]||(y[2]=L=>B(_)?_.value=L:null),title:"是否覆蓋現有的自訂訊息內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:f},{default:o(()=>[lt]),_:1},8,["open"])],64)}}});function ht(){const k=Re(),h=w(!1),c=()=>h.value=!0,O=()=>h.value=!1,v=Ae();k.beforeResolve((r,$,b)=>{e(h)?v.confirm({closable:!0,width:"440px",icon:()=>"",title:"是否放棄目前編輯的內容？",content:Le("div",{class:"text-center !w-full !max-w-full py-20px text-base mx-auto",innerHTML:"您將離開現在的頁面，且編輯的內容不會存檔"}),okText:"確定",cancelText:"取消",centered:!0,onOk:()=>{O(),b()},onCancel:()=>{b(!1)}}):b()});const s=r=>{e(h)&&(r.preventDefault(),r.returnValue=!0)};return ie(()=>{window.addEventListener("beforeunload",s)}),{setShowAlert:c,setHideAlert:O}}export{yt as _,vt as a,gt as b,xt as c,_t as d,ht as u};

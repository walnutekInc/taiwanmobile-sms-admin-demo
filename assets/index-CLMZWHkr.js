import{_ as ne}from"./index.vuevuetypescriptsetuptruelang-CBHlBuia.js";import{i as ae,_ as oe}from"./isSameOrBefore-CEUI6AK9.js";import{l as re,j as le,_ as ie}from"./index-DPDfwRPd.js";import{u as ce,_ as me}from"./request-v8LTZy6R.js";import{_ as pe}from"./index.vuevuetypescriptsetuptruelang-DtpB6Cde.js";import{_ as ue}from"./index-BmcuXzj-.js";import{i as de}from"./isToday-C81MXPQm.js";import{Y as _e,c as fe,E as a,q as Ye,p as ge,I as ye,G as he,s as De,F as Me,H as xe,J as ke}from"./antd-C_UvAipJ.js";import{g as ve,b as G}from"./tools-DuR4KSGu.js";import{d as be,ad as we,f as v,D as Te,u as e,ag as Ce,w as Ee,b as Se,W as _,_ as Re,$ as t,k as r,Y as o,G as D,X as f,F as C,a9 as N,a5 as E,a3 as y,a4 as He,y as Le}from"./vue-Cot4Dobd.js";import"./context-C20i1qPi.js";var Ne={exports:{}};(function(Y,M){(function(p,h){Y.exports=h(_e)})(fe,function(p){function h(c){return c&&typeof c=="object"&&"default"in c?c:{default:c}}var x=h(p),k={name:"zh-tw",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"週日_週一_週二_週三_週四_週五_週六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(c,m){return m==="W"?c+"週":c+"日"},formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日 HH:mm",LLLL:"YYYY年M月D日dddd HH:mm",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s內",past:"%s前",s:"幾秒",m:"1 分鐘",mm:"%d 分鐘",h:"1 小時",hh:"%d 小時",d:"1 天",dd:"%d 天",M:"1 個月",MM:"%d 個月",y:"1 年",yy:"%d 年"},meridiem:function(c,m){var u=100*c+m;return u<600?"凌晨":u<900?"早上":u<1100?"上午":u<1300?"中午":u<1800?"下午":"晚上"}};return x.default.locale(k,null,!0),k})})(Ne);a.locale("zh-tw");var B=(Y=>(Y.READ="已讀",Y.UNREAD="未讀",Y))(B||{});const Be=[{key:"1",phone:"0963-123-123",content:"您好，我想索取試用品DM和序號",unreadCount:0,createTime:a().format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"2",phone:"0928-391-699",content:"請問活動截止日期到什麼時候 ?",unreadCount:2,createTime:a().format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"3",phone:"0938-127-498",content:`請問上個月的抽獎結果什麼時候會公佈？
網路上已經看到外洩的名單，但官方似乎沒有正式公告，希望主辦單位可以即時通知我們網路上已經看到外洩的名單，但官方似乎沒有正式公告，希望主辦單位可以即時通知我們網路上已經看到外洩的名單，但官方似乎沒有正式公告，希望主辦單位可以即時通知我們網路上已經看到外洩的名單，但官方似乎沒有正式公告，希望主辦單位可以即時通知我們網路上已經看到外洩的名單，但官方似乎沒有正式公告，希望主辦單位可以即時通知我們`,unreadCount:5,createTime:a().subtract(2,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"4",phone:"0958-128-815",content:`黃茵茵
huangyiyi@gmail.com`,unreadCount:0,createTime:a().subtract(3,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"5",phone:"0963-123-123",content:"您好，我想索取試用品DM和序號",unreadCount:0,createTime:a().subtract(4,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"6",phone:"0937-129-488",content:"我要參加活動，請通知下一步",unreadCount:0,createTime:a().subtract(5,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"7",phone:"0937-129-488",content:"我要參加活動，請通知下一步",unreadCount:0,createTime:a().subtract(5,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"8",phone:"0937-129-488",content:"我要參加活動，請通知下一步",unreadCount:0,createTime:a().subtract(5,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"9",phone:"0937-129-488",content:"我要參加活動，請通知下一步",unreadCount:0,createTime:a().subtract(5,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"10",phone:"0937-129-488",content:"我要參加活動，請通知下一步",unreadCount:0,createTime:a().subtract(5,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")},{key:"11",phone:"0937-129-488",content:"我要參加活動，請通知下一步",unreadCount:0,createTime:a().subtract(5,"d").format("YYYY/MM/DD"),updateTime:a().format("YYYY/MM/DD")}],Ue={[a().format("YYYY/MM/DD (dd)")]:[{key:"1",phone:"0961-238-888",type:"SENT",message:`親愛的會員您好，邀請您參加活動，若想參加請回覆 12:00pm
親愛的會員您好，邀請您參加活動，若想參加請回覆 12:00pm`},{key:"2",phone:"",type:"GET",message:"是的，我想參加活動"},{key:"3",phone:"",type:"GET",message:`何小偉 
 kkk@gmail.com`},{key:"4",phone:"0961-238-888",type:"SENT",message:"您好，請回覆您的姓名與Email"}],今天:[{key:"1",phone:"0961-238-888",type:"SENT",message:`親愛的會員您好，邀請您參加活動，若想參加請回覆 12:00pm
親愛的會員您好，邀請您參加活動，若想參加請回覆 12:00pm`},{key:"2",phone:"",type:"GET",message:"是的，我想參加活動"},{key:"3",phone:"",type:"GET",message:`何小偉 
 kkk@gmail.com`},{key:"4",phone:"0961-238-888",type:"SENT",message:"您好，請回覆您的姓名與Email"}]};function je(){const Y=re(),{list:M,pagination:p,setResponseList:h}=ce();return{getChatMessages:async m=>{h({total:11,pages:1,current:1,pageSize:10,records:Be})},chatMessages:M,pagination:p,getChatMessageHistory:async m=>(console.log(m),Ue),updateChatMessageUnRead:async m=>{m.unreadCount>0&&(Y.updateUnReadCount(0),M.value=M.value.map(u=>({...u,...u.key===m.key&&{unreadCount:0}})))}}}const Ge=o("span",{"text-24px":"","line-height-28px":"","mr-12px":"","mb-0":"","font-700":"","text-sms-grayscale-100":""},"雙向訊息",-1),ze=o("span",{"text-sm":"","text-sms-primary-blue-80":"","font-400":""},"※不區分帳號是否使用共用門號，只認發送門號全部顯示",-1),$e={class:"pt-4 flex items-center pb-3"},Ve=["onClick"],Ae={class:"flex flex-col gap-4"},Fe={class:"flex justify-between items-center mb-2"},Ie={class:"font-600 text-sm pe-2"},Oe={key:0,class:"text-xs bg-sms-green-30 px-2 py-1 rounded-2 text-sms-green-80"},qe={key:1,class:"text-xs bg-sms-light-red-20 px-2 py-1 rounded-2 text-sms-light-red-70"},We={class:"text-sms-grayscale-60 font-500 text-xs"},Ke={class:"font-400 text-sm text-sms-grayscale-80 tracking-[0.02em] whitespace-pre-wrap line-clamp-2"},Pe={class:"text-end py-4"},Je=o("br",null,null,-1),Xe={class:"flex justify-between items-center border-b-solid border-b-1 border-b-sms-light-gray-60 pb-4"},Qe={class:"flex flex-col"},Ze=o("span",{class:"font-400 text-sm tracking-[0.02em] pe-2 text-sms-grayscale-80"},"接收門號",-1),et={href:"javascript:;"},tt=o("span",null,"檢視三個月內，與該門號的所有雙向訊息",-1),st={class:"font-inter font-400 text-base"},nt={href:"javascript:;"},at=o("span",null,"下載三年內，與該門號的雙向訊息紀錄",-1),ot={key:0,id:"chat-message-content",class:"pt-4"},rt={class:"text-center mb-4"},lt={class:"text-sm tracking-[0.02em] text-sms-grayscale-0 bg-sms-grayscale-40 rounded-38px px-2 py-1.5"},it={class:"text-sms-grayscale-60 text-sm font-400 font-inter text-sm text-right"},ct=o("span",{class:"text-xs font-500 text-sms-grayscale-40"},"08:00",-1),mt={class:"text-end"},xt=be({__name:"index",setup(Y){a.extend(de),a.extend(ae);const M=we(),p=v(),h=v(),x=v(),k=[{value:"READ",label:B.READ},{value:"UNREAD",label:B.UNREAD}],{getChatMessages:c,pagination:m,chatMessages:u,getChatMessageHistory:z,updateChatMessageUnRead:$}=je(),S=v(),i=v({keyword:"",status:void 0,phone:"",sendDate:void 0});Te(()=>{R()});async function R(l=1,s=10){const H={current:l,pageSize:s,...e(i)};await c(H)}function V(l,s){R(l,s??10)}function A(){var l;R(1),(l=x.value)==null||l.hide()}async function F(l){p.value=l,await $(l),S.value=await z(l.key),await Le();const s=document.getElementById("message-content");s&&(s.scrollTop=s.scrollHeight)}function I(l){const s=a().subtract(3,"month");return l.isBefore(s)||l>=a()}const O=v(["10","20","30","50"]),q=le(),{data:W,close:K}=Ce({name:"in-chat-message-page"});Ee(W,async l=>{console.log(l),q.success({message:"訊息回覆成功",placement:"top"})}),Se(()=>{K()});function U(l){const s=M.resolve({name:"MessageSendingGeneralCreate",query:{isRe:"true",...l&&{rePhone:l}}});window.open(s.href,"_blank")}return(l,s)=>{const H=Ye,L=ue,T=ge,P=ye,J=he,b=pe,X=De,Q=Me,Z=me,w=ie,ee=xe,j=ke,te=oe,se=ne;return _(),Re(se,{title:"雙向訊息"},{title:t(()=>[Ge,ze]),default:t(()=>[r(te,{"show-right-empty":!e(p)},{leftTop:t(()=>[o("div",$e,[r(Z,{ref_key:"filterKeywordInputRef",ref:x,modelValue:e(i).keyword,"onUpdate:modelValue":s[4]||(s[4]=n=>e(i).keyword=n),height:"40px",class:"flex-1 me-2",placeholder:"搜尋訊息內容",onClearFilter:s[5]||(s[5]=()=>{i.value={...e(i),phone:"",status:void 0,sendDate:void 0,keyword:""}})},{filterForm:t(()=>[r(Q,{ref_key:"formRef",ref:h,layout:"vertical",model:e(i),autocomplete:"off"},{default:t(()=>[r(X,{gutter:[16,12]},{default:t(()=>[r(T,{span:24},{default:t(()=>[r(L,{label:"訊息狀態",valueed:e(ve)(e(i).status,k)},{default:t(()=>[r(H,{value:e(i).status,"onUpdate:value":s[0]||(s[0]=n=>e(i).status=n),options:k,"max-tag-count":2,"show-arrow":!0,"show-search":!1,class:"w-full"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),r(T,{span:24},{default:t(()=>[r(L,{label:"接收門號",valueed:e(i).phone},{default:t(()=>[r(P,{value:e(i).phone,"onUpdate:value":s[1]||(s[1]=n=>e(i).phone=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),r(T,{span:24},{default:t(()=>[r(L,{label:"訊息發送日期",valueed:e(i).sendDate},{default:t(()=>[r(J,{value:e(i).sendDate,"onUpdate:value":s[2]||(s[2]=n=>e(i).sendDate=n),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD","disabled-date":I},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),r(T,{span:24,class:"text-center"},{default:t(()=>[r(b,{status:"small2",class:"me-5",onClick:s[3]||(s[3]=n=>{var d;return(d=e(x))==null?void 0:d.hide()})},{default:t(()=>[D(" 取消 ")]),_:1}),r(b,{status:"small1",onClick:A},{default:t(()=>[D(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),r(b,{status:"small1",onClick:s[6]||(s[6]=n=>U())},{icon:t(()=>[r(w,{name:"plus",width:"16px"})]),default:t(()=>[D(" 新增訊息 ")]),_:1})])]),left:t(()=>[o("ul",null,[(_(!0),f(C,null,N(e(u),n=>{var d;return _(),f("li",{key:n.key,class:E(["p-4 border-b-solid border-b-1 border-b-sms-light-gray-60 last:mb-2 cursor-pointer",{"bg-sms-bg-light-mode-gray":n.key===((d=e(p))==null?void 0:d.key)}]),onClick:g=>F(n)},[o("div",Ae,[o("div",Fe,[o("div",null,[o("span",Ie,y(n.phone),1),n.unreadCount===0?(_(),f("span",Oe,"已讀")):(_(),f("span",qe,"未讀 "+y(n.unreadCount),1))]),o("span",We,y(e(a)(n.createTime).isToday()?"今天":e(a)(n.createTime).format("YYYY/MM/DD")),1)]),o("div",Ke,y(n.content),1)])],10,Ve)}),128))])]),leftBottom:t(()=>[o("div",Pe,[r(ee,{current:e(m).current,"onUpdate:current":s[7]||(s[7]=n=>e(m).current=n),total:e(m).total,"show-quick-jumper":"","page-size-options":e(O),"show-size-changer":"","show-less-items":"","show-total":n=>`共 ${n} 筆`,onChange:V},null,8,["current","total","page-size-options","show-total"])])]),rightEmptyMessage:t(()=>[D(" 點擊左側接收門號列表"),Je,D("檢視雙向訊息 ")]),rightTop:t(()=>{var n;return[o("div",Xe,[o("div",Qe,[o("div",null,[Ze,r(j,{placement:"top","get-popup-container":e(G)},{title:t(()=>[tt]),default:t(()=>[o("a",et,[r(w,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),o("div",st,y((n=e(p))==null?void 0:n.phone),1)]),o("div",null,[r(b,{status:"small2",class:"me-2"},{icon:t(()=>[r(w,{name:"download",width:"16px"})]),default:t(()=>[D(" 下載CSV ")]),_:1}),r(j,{placement:"topRight","get-popup-container":e(G),"merged-arrow":!0},{title:t(()=>[at]),default:t(()=>[o("a",nt,[r(w,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])])])]}),right:t(()=>[e(S)?(_(),f("div",ot,[(_(!0),f(C,null,N(Object.entries(e(S)),([n,d])=>(_(),f(C,{key:n},[o("div",rt,[o("span",lt,y(n),1)]),(_(!0),f(C,null,N(d,g=>(_(),f("div",{key:g.key,class:E(["flex flex-col mb-4",{"me-20 ":g.type==="GET","ms-20 ":g.type==="SENT"}])},[o("div",it,y(g.phone),1),o("div",{class:E(["flex w-full items-end justify-end gap-2",{"flex-row-reverse ":g.type==="GET"}])},[ct,o("div",{class:E(["bg-sms-grayscale-20 py-3 px-3 rounded-2 whitespace-pre-wrap text-17px",{"bg-sms-primary-blue-20":g.type==="SENT"}])},y(g.message),3)],2)],2))),128))],64))),128))])):He("",!0)]),rightBottom:t(()=>[o("div",mt,[r(b,{status:"small1",onClick:s[8]||(s[8]=n=>{var d;return U((d=e(p))==null?void 0:d.phone)})},{icon:t(()=>[r(w,{name:"edit",width:"16px"})]),default:t(()=>[D(" 回覆訊息 ")]),_:1})])]),_:1},8,["show-right-empty"])]),_:1})}}});export{xt as default};

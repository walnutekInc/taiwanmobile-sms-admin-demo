import{_ as xe}from"./index.vuevuetypestyleindex0lang-B6Nhna9q.js";import{_ as we}from"./index-BxrlgKxz.js";import{_ as he,a as Ce}from"./index.vuevuetypescriptsetuptruelang-CCK1QI6A.js";import{_ as Z}from"./index.vuevuetypescriptsetuptruelang-CGx5Uo-M.js";import{k as ee,_ as Le}from"./index-NTWfkyjL.js";import{d as te,r as S,f as k,W as d,_ as A,$ as o,k as t,ab as Re,u as e,H as ae,D as Te,o as Ye,a0 as De,X as y,G as m,E as Fe,a4 as O,Y as _,F as z,a3 as C,m as Ie,A as Me}from"./vue-Ckfa8DnP.js";import{Q as ne,K as H,U as $e,I as oe,n as Ke,o as se,r as le,F as ie,N as re,p as Oe,G as Se,J as Ue}from"./antd-CCbBcq8G.js";import{u as ue}from"./group-label-CKB1-NQJ.js";import{b as Ve}from"./tools-a0gbWjD6.js";import{F as Ge}from"./request-CH5HkvW7.js";const Pe=te({__name:"group-label-create",props:{saveCallbck:{type:Function,required:!0}},setup(J,{expose:U}){const w=J,V=ee(),{checkGroupLabelExist:G,createGroupLabel:P}=ue(),L={name:""},g=S(ne(L)),R=S({name:[{async validator(F,n){if(H(n))return Promise.reject("請輸入群組標籤");const b=await G(n);return console.log(b),b?Promise.reject(`系統中已有「${n}」，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:r,resetFields:T,validate:Y}=$e(g,R),v=k(!1);async function c(){T(L),v.value=!0}function D(){Y().then(async()=>{var n;((n=(await P(g.name)).data)==null?void 0:n.status)==="success"&&(V.success({message:"群組標籤新增成功",placement:"top"}),w.saveCallbck(),v.value=!1)})}return U({show:c}),(F,n)=>{const b=oe,x=Ke,j=se,I=Z,E=le,h=ie,N=re;return d(),A(N,{open:e(v),"onUpdate:open":n[1]||(n[1]=p=>ae(v)?v.value=p:null),title:"新增群組標籤",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:D},{default:o(()=>[t(h,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:D},{default:o(()=>[t(E,{gutter:[16,0]},{default:o(()=>[t(j,{span:24},{default:o(()=>[t(x,Re({label:"群組標籤名稱"},e(r).name,{required:"",extra:"15字以內"}),{default:o(()=>[t(b,{value:e(g).name,"onUpdate:value":n[0]||(n[0]=p=>e(g).name=p),placeholder:"請輸入群組標籤名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),t(I,{class:"hidden","html-type":"submit"})]),_:1})]),_:1})]),_:1},8,["open"])}}}),je={class:"flex justify-between px-2 items-center mb-2"},Ee={class:"me-1"},Ne={href:"javascript:;"},Be=_("span",null,"全域黑名單功能: 主帳號將特定手機門號加入黑名單，主帳號和子帳號皆無法發送該門號任何訊息",-1),qe={key:1},ze={key:1},Ae={key:0},He={class:"editable-cell-wrapper"},Je={class:"text-sms-status-alert-red text-xs"},Qe={key:1,class:"editable-cell-wrapper"},We=_("div",{class:"text-center px-24px py-20px w-376px text-base mx-auto"},[m(" 您選擇的群組標籤將永久刪除。"),_("br"),m(" 屬於該群組標籤的聯絡人，若沒有隸屬於其他群組標籤，將貼上「未分類」標籤。 ")],-1),rt=te({__name:"group-label",setup(J){const{getGroupLabels:U,groupLabels:w,pagination:V,updateGroupLabel:G,deleteGroupLabel:P,checkGroupLabelExist:L,getGroupLabelOption:g,groupOptions:R}=ue(),r=S({}),T=k(!1);Te(async()=>{x(),g()}),Ye(()=>{T.value=!0});const Y=ee(),v=[{title:"群組標籤名稱",dataIndex:"name",key:"name",sorter:!0,width:"180px"},{title:"門號數量",dataIndex:"phoneCount",key:"phoneCount",sorter:!0,width:"140px",align:"right"},{title:"黑名單數量",dataIndex:"blackListCount",key:"blackListCount",sorter:!0,width:"151px",align:"right"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"160px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0}],c=S({selectedRowKeys:[],selectedRows:[],loading:!1});function D(s,a){console.log("selectedRowKeys changed: ",s,a),c.selectedRowKeys=s,c.selectedRows=a}function F(s){return{disabled:s.key==="0"}}const n=k({sortField:"createTime",sortOrder:"descend",createTime:void 0,updateTime:void 0,keyword:"",keys:[]}),b=k();async function x(s=1,a=10){const u={current:s,pageSize:a,...e(n)};await U(u)}function j(s){r[s]={...ne(w.value.filter(a=>s===a.key)[0]),msg:""}}async function I(s){var f;const a=r[s];if(H(a.name)){r[s].msg="請輸入群組標籤";return}await L(a.name,a.key)?r[s].msg=`系統中已有「${r[s].name}」，請勿重複新增`:((f=(await G(a.key,a.name)).data)==null?void 0:f.status)==="success"&&(Object.assign(w.value.filter(B=>s===B.key)[0],a),delete r[s],Y.success({message:"群組標籤編輯成功",placement:"top"}))}async function E(s,a,u){console.log("pagination:",s,"sorter:",u),n.value=Object.assign(n.value,{sortField:u.field,sortOrder:u.order}),await x(s.current,s.pageSize)}const h=k(null);function N(){var s;x(1),(s=h.value)==null||s.hide()}const p=k(!1);function ce(){p.value=!0}async function de(){var a;((a=(await P(c.selectedRowKeys)).data)==null?void 0:a.status)==="success"&&(Y.success({message:"群組標籤刪除成功",placement:"top"}),p.value=!1,c.selectedRowKeys=[],c.selectedRows=[])}function pe(){return document.body}const Q=k(null);return(s,a)=>{const u=Le,f=Z,W=he,B=Ce,me=Oe,q=we,M=se,X=Se,_e=le,fe=ie,ve=Ue,ye=De("RouterLink"),ke=oe,ge=xe,be=re;return d(),y(z,null,[e(T)?(d(),A(Fe,{key:0,to:"#extraContent"},[t(f,{status:"small1",onClick:a[0]||(a[0]=l=>{var i;return(i=e(Q))==null?void 0:i.show()})},{icon:o(()=>[t(u,{name:"plus",width:"16px"})]),default:o(()=>[m(" 新增群組標籤 ")]),_:1})])):O("",!0),_("div",je,[_("div",null,[t(f,{status:"small2",class:"me-2",disabled:e(c).selectedRowKeys.length===0},{icon:o(()=>[t(u,{name:"download",width:"16px"})]),default:o(()=>[m(" 匯出CSV ")]),_:1},8,["disabled"]),t(f,{status:"small2",class:"me-2",disabled:e(c).selectedRowKeys.length===0,onClick:ce},{icon:o(()=>[t(u,{name:"delete",width:"16px"})]),default:o(()=>[m(" 刪除 ")]),_:1},8,["disabled"])]),t(Ge,{ref_key:"filterKeywordInputRef",ref:h,modelValue:e(n).keyword,"onUpdate:modelValue":a[6]||(a[6]=l=>e(n).keyword=l),class:"w-440px h-40px",placeholder:"搜尋群組標籤名稱",onClearFilter:a[7]||(a[7]=()=>{n.value={...e(n),keyword:"",keys:[],createTime:void 0,updateTime:void 0}})},{filterForm:o(()=>[t(fe,{ref_key:"formRef",ref:b,layout:"vertical",model:e(n),autocomplete:"off"},{default:o(()=>[t(_e,{gutter:[16,12]},{default:o(()=>[t(M,{span:24},{default:o(()=>[t(q,{label:"群組標籤",valueed:e(Ve)(e(n).keys)},{default:o(()=>[t(me,{value:e(n).keys,"onUpdate:value":a[2]||(a[2]=l=>e(n).keys=l),options:e(R),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full"},{dropdownRender:o(({menuNode:l})=>[t(W,{modelValue:e(n).keys,"onUpdate:modelValue":a[1]||(a[1]=i=>e(n).keys=i),menu:l,options:e(R)},null,8,["modelValue","menu","options"])]),option:o(({value:l,label:i})=>[t(B,{values:e(n).keys,value:l,label:i},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),t(M,{span:24},{default:o(()=>[t(q,{label:"建立時間",valueed:e(n).createTime},{default:o(()=>[t(X,{value:e(n).createTime,"onUpdate:value":a[3]||(a[3]=l=>e(n).createTime=l),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(M,{span:24},{default:o(()=>[t(q,{label:"修改時間",valueed:e(n).updateTime},{default:o(()=>[t(X,{value:e(n).updateTime,"onUpdate:value":a[4]||(a[4]=l=>e(n).updateTime=l),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(M,{span:24,class:"text-center"},{default:o(()=>[t(f,{status:"small2",class:"me-5",onClick:a[5]||(a[5]=l=>{var i;return(i=e(h))==null?void 0:i.hide()})},{default:o(()=>[m(" 取消 ")]),_:1}),t(f,{status:"small1",onClick:N},{default:o(()=>[m(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(ge,{"data-source":e(w),columns:v,size:"small","show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(c).selectedRowKeys,onChange:D,getCheckboxProps:F},pagination:{...e(V)},onChange:E},{headerCell:o(({column:l})=>[l.key==="blackListCount"?(d(),y(z,{key:0},[_("span",Ee,C(l.title),1),t(ve,{placement:"top","get-popup-container":pe},{title:o(()=>[Be]),default:o(()=>[_("a",Ne,[t(u,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1})],64)):O("",!0)]),bodyCell:o(({column:l,record:i,text:$})=>[l.dataIndex==="phoneCount"||l.dataIndex==="blackListCount"?(d(),y(z,{key:0},[$>0?(d(),A(ye,{key:0,href:"javascript:;",class:"text-sm text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80 font-400",hover:"text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80",to:{name:"ListManagement",query:{tabActived:"contactPerson",group:[i.key],...l.dataIndex==="blackListCount"&&{blackList:"true"}}}},{default:o(()=>[m(C($),1)]),_:2},1032,["to"])):(d(),y("span",qe,C($),1))],64)):O("",!0),l.dataIndex==="name"?(d(),y("div",ze,[e(r)[i.key]?(d(),y("div",Ae,[_("div",He,[t(ke,{value:e(r)[i.key].name,"onUpdate:value":K=>e(r)[i.key].name=K,"max-length":15,status:e(r)[i.key].msg&&!e(H)(e(r)[i.key].msg)?"error":"",onPressEnter:K=>I(i.key)},null,8,["value","onUpdate:value","status","onPressEnter"]),t(u,{name:"save",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:K=>I(i.key)},null,8,["onClick"])]),_("span",Je,C(e(r)[i.key].msg),1)])):(d(),y("div",Qe,[m(C($||" ")+" ",1),Ie(t(u,{name:"edit",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:K=>j(i.key)},null,8,["onClick"]),[[Me,i.key!=="0"]])]))])):O("",!0)]),_:1},8,["data-source","row-selection","pagination"]),t(Pe,{ref_key:"groupLabelCreateRef",ref:Q,"save-callbck":()=>x(1)},null,8,["save-callbck"]),t(be,{open:e(p),"onUpdate:open":a[8]||(a[8]=l=>ae(p)?p.value=l:null),title:"是否刪除選取的群組標籤？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:de},{default:o(()=>[We]),_:1},8,["open"])],64)}}});export{rt as _};

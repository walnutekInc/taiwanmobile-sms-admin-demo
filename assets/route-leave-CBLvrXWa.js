import{d as j,ak as le,al as be,o as ie,j as Ce,r as P,f as k,w as se,y as we,am as ke,W as E,X as F,_ as Q,ab as I,u as e,a8 as Oe,Q as ue,a4 as ce,Y as v,F as W,$ as o,k as t,G as M,H as B,a3 as q,m as N,A as V,a9 as $e,a5 as Se,ad as Re,l as Le}from"./vue-BvWPEeCa.js";import{_ as ee}from"./index.vuevuetypescriptsetuptruelang-CICFdqya.js";import{z as X,K as de,N as J,P as pe,I as fe,o as me,p as _e,s as ve,F as ge,W as Te,q as Ue,x as Ie,J as Me}from"./antd-Dpsol0oo.js";import{_ as Ee,k as Ae}from"./index-D5CWLnaZ.js";import{c as Z,a as Be,b as re}from"./index.esm-CgYeVutO.js";import{_ as De}from"./index.vuevuetypestyleindex0lang-Dl2df6kz.js";import{_ as Pe}from"./request-BZM3Cngs.js";import{u as Fe}from"./custom-message-DoPeYD_t.js";const He={key:0,class:"form-textarea-multimedia"},Ne={class:"form-textarea-tools py-2"},Ve="div",_t=j({__name:"index",props:le({contenteditable:{type:[Boolean,String],default:!0},noHtml:{type:Boolean,default:!1},noNl:{type:Boolean,default:!1},maxLen:{type:Number},contentLen:{type:Number},placeholder:String},{modelValue:{required:!0},modelModifiers:{}}),emits:le({returned:String},["update:modelValue"]),setup(O,{emit:C}){const d=O,$=C;function m(l,f,w){return l.split(f).join(w)}const s=be(O,"modelValue");ie(()=>{document.addEventListener("selectionchange",g)}),Ce(()=>{document.removeEventListener("selectionchange",g)});function r(){return`r${new Date().getTime()}d${Math.ceil(Math.random()*1e3)}`}const S=P({contentId:`content${r()}`,isLocked:!1,currentTagId:null,savedRange:{}});function g(){var f;const l=window.getSelection();if(l){const w=l.rangeCount>0?l.getRangeAt(0):null;w&&((f=w.commonAncestorContainer.ownerDocument)!=null&&f.activeElement)&&w.commonAncestorContainer.ownerDocument.activeElement.id===S.contentId&&(S.savedRange=w)}}const x=k();function i(){return d.noHtml?x.value.textContent:x.value.innerHTML}function n(l){d.noHtml?x.value.textContent=e(l):x.value.innerHTML=e(l)}function L(){s.value=i()}function c(l){l.preventDefault();let f=(l.originalEvent||l).clipboardData.getData("text/plain");if(d.noNl&&(f=m(f,`\r
`," "),f=m(f,`
`," "),f=m(f,"\r"," ")),d.contentLen&&d.maxLen&&d.contentLen+f.length>=d.maxLen)return l.keyCode===8,void 0;console.log("paste"),window.document.execCommand("insertText",!1,f)}function T(l){l.key==="Enter"&&d.noNl&&(l.preventDefault(),$("returned",i()))}se(s,async l=>{await we(),l!==i()&&n(l??"")}),se(()=>d.noHtml,()=>{n(s.value??"")});function p(l){if(d.contentLen&&d.maxLen&&d.contentLen>=d.maxLen){if(l.keyCode===8)return;l.preventDefault()}}const y=ke();return(l,f)=>(E(),F(W,null,[(E(),Q(Oe(Ve),I({id:e(S).contentId,ref_key:"element",ref:x,class:"tag-textarea"},l.$attrs,{contenteditable:O.contenteditable,"data-placeholder":O.placeholder,style:{scrollPaddingBottom:`${e(y).multimediaBlock?148:50}px`,paddingBottom:`${e(y).multimediaBlock?148:50}px`},onInput:L,onBlur:L,onPaste:c,onKeypress:T,onKeydown:p}),null,16,["id","contenteditable","data-placeholder","style"])),e(y).multimediaBlock?(E(),F("div",He,[ue(l.$slots,"multimediaBlock")])):ce("",!0),v("div",Ne,[ue(l.$slots,"default")])],64))}}),je={class:"px-24px"},qe=v("p",{class:"text-center"}," 選擇想加入的參數後，再點擊確定即可。 ",-1),ze={class:"flex justify-between gap-x-2"},Ke=v("p",{class:"text-sms-grayscale-60 text-sm mt-10"},[M(" 加入參數功能說明："),v("br"),M(" 此為自訂訊息的插入參數功能，參數訊息發送功能位置為【訊息行銷活動】和【參數訊息】。訊息內容可自由插入參數，至多使用 5 個參數，依照上傳參數檔案而組成訊息內容。 ")],-1),vt=j({__name:"add-field",emits:["addFieldToContent"],setup(O,{expose:C,emit:d}){const $=d,m=k(!1),s=k([]);function r(x){s.value.includes(x)?s.value=s.value.filter(i=>i!==x):s.value.push(x)}async function S(){s.value=[],m.value=!0}function g(){m.value=!1,$("addFieldToContent",s.value)}return C({show:S}),(x,i)=>{const n=ee,L=X;return E(),Q(L,{open:e(m),"onUpdate:open":i[5]||(i[5]=c=>B(m)?m.value=c:null),title:"加入參數",centered:"","cancel-text":"取消","ok-text":"確定",width:"600px",onOk:g},{default:o(()=>[v("div",je,[qe,v("div",ze,[t(n,{status:e(s).includes("%field1%")?"small1":"small2",onClick:i[0]||(i[0]=c=>r("%field1%"))},{default:o(()=>[M(" %field1% ")]),_:1},8,["status"]),t(n,{status:e(s).includes("%field2%")?"small1":"small2",onClick:i[1]||(i[1]=c=>r("%field2%"))},{default:o(()=>[M(" %field2% ")]),_:1},8,["status"]),t(n,{status:e(s).includes("%field3%")?"small1":"small2",onClick:i[2]||(i[2]=c=>r("%field3%"))},{default:o(()=>[M(" %field3% ")]),_:1},8,["status"]),t(n,{status:e(s).includes("%field4%")?"small1":"small2",onClick:i[3]||(i[3]=c=>r("%field4%"))},{default:o(()=>[M(" %field4% ")]),_:1},8,["status"]),t(n,{status:e(s).includes("%field5%")?"small1":"small2",onClick:i[4]||(i[4]=c=>r("%field5%"))},{default:o(()=>[M(" %field5% ")]),_:1},8,["status"])]),Ke])]),_:1},8,["open"])}}}),gt=j({__name:"add-link",emits:["addLinkToContent"],setup(O,{expose:C,emit:d}){const $=d,m={link:""};function s(T){const p="^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$",y=new RegExp(p,"i");return T.length<2083&&y.test(T)}const r=P(de(m)),S=P({link:[{async validator(T,p){return J(p)?Promise.reject("請輸入縮網址"):s(p)?Promise.resolve():Promise.reject("請輸入有效網址")},trigger:"blur"}]}),{validateInfos:g,resetFields:x,validate:i}=pe(r,S),n=k(!1);async function L(){x(m),n.value=!0}function c(){i().then(async()=>{$("addLinkToContent",r.link),n.value=!1})}return C({show:L}),(T,p)=>{const y=fe,l=me,f=_e,w=ee,h=ve,_=ge,b=X;return E(),Q(b,{open:e(n),"onUpdate:open":p[1]||(p[1]=D=>B(n)?n.value=D:null),title:"加入縮網址",centered:"",width:"600px","cancel-text":"取消","ok-text":"確定",onOk:c},{default:o(()=>[t(_,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:c},{default:o(()=>[t(h,{gutter:[16,0]},{default:o(()=>[t(f,{span:24},{default:o(()=>[t(l,I({label:""},e(g).link),{default:o(()=>[t(y,{value:e(r).link,"onUpdate:value":p[0]||(p[0]=D=>e(r).link=D),valueModifiers:{trim:!0},placeholder:"請輸入原始長網址，範例: https://www.taiwanmobile.com/"},null,8,["value"])]),_:1},16)]),_:1}),t(w,{class:"hidden","html-type":"submit"})]),_:1})]),_:1})]),_:1},8,["open"])}}}),Ge={class:"flex items-center justify-center"},We=v("span",{"w.5":"","h-18px":""},q(""),-1),Je=v("span",{"w.5":"","h-18px":""},q(""),-1),Qe=v("span",{"w.5":"","h-18px":""},q(""),-1),Xe={class:"px-24px"},Ye={class:"flex justify-between items-center mb-4"},Ze=v("span",{class:"text-base text-sms-grayscale-80"},"選擇下列任一訊息，點擊「確定」。",-1),et=v("div",{class:"text-center px-30px py-20px text-base text-sms-grayscale-80 mx-auto"}," ※ 每次生成 3 則訊息，共收費新台幣 5 元 ",-1),tt=v("div",{class:"text-center px-30px py-20px text-base text-sms-grayscale-80 mx-auto"}," 已生成的訊息將直接刪除 ",-1),nt=v("div",{class:"px-24px text-center"}," 您重新選擇的自訂訊息內容，將會把現在的訊息完全覆蓋。 ",-1),xt=j({__name:"ai-text-generation",props:{content:{type:String,required:!0}},emits:["updateContent"],setup(O,{expose:C,emit:d}){const $=O,m=d,s=k(""),r=k([]),S=[{value:"singRule",label:"單則訊息 (70 字)"},{value:"longRule",label:"長訊息 (335 字)"},{value:"other",label:"其他"}],g=[{value:"notSpecify",label:"不指定"},{value:"promotions",label:"促銷活動"},{value:"promotions",label:"會員專屬"},{value:"newProductRecommendation",label:"新產品推薦"},{value:"eventInvitation",label:"活動邀請"},{value:"customerNotice",label:"客戶通知"},{value:"other",label:"其他"}],x=[{value:"notSpecify",label:"不指定"},{value:"friendly",label:"親切幽默"},{value:"professional",label:"專業正式"},{value:"warm",label:"溫暖感人"},{value:"other",label:"其他"}],n=P(de({name:"",messageElement:"",count:void 0,countOtherConfig:"",type:"notSpecify",typeOtherConfig:"",tone:"notSpecify",toneOtherConfig:""})),L=P({messageElement:[{async validator(R,a){return J(a)?Promise.reject("請輸入訊息元素"):Promise.resolve()},trigger:"blur"}],count:[{required:!0,message:"請選擇訊息字數",trigger:"blur"}],countOtherConfig:[{async validator(R,a){return n.count!=="other"?Promise.resolve():await Z().shape({countOtherConfig:Be().typeError("請輸入訊息字數").min(1,"請輸入 1~335 之間任一數字").max(335,"請輸入 1~335 之間任一數字")}).validate({countOtherConfig:a})},trigger:"blur"}],typeOtherConfig:[{async validator(R,a){return n.type!=="other"?Promise.resolve():await Z().shape({typeOtherConfig:re().required("請輸入訊息種類")}).validate({typeOtherConfig:a})},trigger:"blur"}],toneOtherConfig:[{async validator(R,a){return n.tone!=="other"?Promise.resolve():await Z().shape({toneOtherConfig:re().required("請輸入訊息語氣")}).validate({toneOtherConfig:a})},trigger:"blur"}]}),{validateInfos:c,validate:T}=pe(n,L),p=k(!1),y=k(!1),l=k(!1);async function f(){p.value=!0}function w(){r.value.length===0?T().then(async()=>{y.value=!0}):D()}function h(){y.value=!1,r.value=[`Hello！親愛的 TAMedia Cafe 會員您好！促銷來囉！
買一送一伯爵鮮奶茶大放送！
只要透過訊息兌換序號，就能立即享受這份優惠！
別忘了帶上您的好友一同來品嚐，嚐一口就愛上的美味鮮奶茶！`,`Hello！親愛的TAMedia Cafe顧客您好！
想和您分享好消息，現在限時促銷！買一送一伯爵鮮奶茶，只需透過訊息兌換序號即可輕鬆獲得！
別忘了告訴您的朋友們，讓大家一同享受這份美味和歡笑！`,`哈囉！TAMedia Cafe 歡迎您！現在限時促銷！
買一送一伯爵鮮奶茶就在這裡！只要您透過訊息兌換序號，即可立即享受這份優惠！
快約上好友，一同來 TAMedia Cafe 享受美味，嘗一口就愛上的鮮奶茶吧！`]}function _(){r.value=[],s.value="",l.value=!1}const b=k(!1);function D(){J($.content)?H():b.value=!0}function H(){p.value=!1,b.value=!1,m("updateContent",s.value)}return C({show:f}),(R,a)=>{const z=Ee,K=fe,A=me,U=_e,te=Te,Y=Ue,ne=ee,oe=ve,ae=ge,xe=Ie,ye=Me,G=X;return E(),F(W,null,[t(G,{open:e(p),"onUpdate:open":a[13]||(a[13]=u=>B(p)?p.value=u:null),centered:"",width:"600px","cancel-text":e(r).length===0?"取消":"關閉","ok-text":"確定",onOk:w},{title:o(()=>[v("div",Ge,[t(z,{name:"AI2",width:"32px",class:"me-2"}),M(" "+q(e(r).length===0?"使用 AI 生成訊息內容":"AI 生成訊息結果"),1)])]),default:o(()=>[N(t(ae,{class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:w},{default:o(()=>[t(oe,{gutter:[16,16]},{default:o(()=>[t(U,{span:24},{default:o(()=>[t(A,I({label:"公司或產品名稱"},e(c).name,{extra:"30 字以內"}),{default:o(()=>[t(K,{value:e(n).name,"onUpdate:value":a[0]||(a[0]=u=>e(n).name=u),placeholder:"請輸入文字",maxlength:30},null,8,["value"])]),_:1},16)]),_:1}),t(U,{span:24},{default:o(()=>[t(A,I({label:"訊息元素"},e(c).messageElement,{extra:"給予 AI 生成文案的文字素材，150 字以內",required:""}),{default:o(()=>[t(te,{value:e(n).messageElement,"onUpdate:value":a[1]||(a[1]=u=>e(n).messageElement=u),rows:4,placeholder:`請輸入必要訊息元素，
必要訊息元素為您希望在訊息內容中一定要出現的資訊，
例如：顧客來店消費即可享有見面禮、提供消費者 DM 資訊`,"max-length":150},null,8,["value"])]),_:1},16)]),_:1}),t(U,{span:e(n).count!=="other"?24:12},{default:o(()=>[t(A,I({label:"訊息字數"},e(c).count,{required:""}),{default:o(()=>[t(Y,{value:e(n).count,"onUpdate:value":a[2]||(a[2]=u=>e(n).count=u),options:S,placeholder:"請選擇訊息字數",onChange:a[3]||(a[3]=()=>{e(n).count==="other"&&(e(n).countOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),N(t(U,{span:12},{default:o(()=>[t(A,I(e(c).countOtherConfig,{extra:"可輸入 1~335 之間任一數字"}),{label:o(()=>[We]),default:o(()=>[t(K,{value:e(n).countOtherConfig,"onUpdate:value":a[4]||(a[4]=u=>e(n).countOtherConfig=u),type:"number",placeholder:"請輸入訊息字數",controls:!1},null,8,["value"])]),_:1},16)]),_:1},512),[[V,e(n).count==="other"]]),t(U,{span:e(n).type!=="other"?24:12},{default:o(()=>[t(A,I({label:"訊息種類"},e(c).type),{default:o(()=>[t(Y,{value:e(n).type,"onUpdate:value":a[5]||(a[5]=u=>e(n).type=u),options:g,placeholder:"請選擇訊息種類",onChange:a[6]||(a[6]=()=>{e(n).type==="other"&&(e(n).typeOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),N(t(U,{span:12},{default:o(()=>[t(A,I(e(c).typeOtherConfig,{extra:"15 字以內"}),{label:o(()=>[Je]),default:o(()=>[t(K,{value:e(n).typeOtherConfig,"onUpdate:value":a[7]||(a[7]=u=>e(n).typeOtherConfig=u),"max-length":15,placeholder:"請輸入訊息種類"},null,8,["value"])]),_:1},16)]),_:1},512),[[V,e(n).type==="other"]]),t(U,{span:e(n).tone!=="other"?24:12},{default:o(()=>[t(A,I({label:"訊息語氣"},e(c).tone),{default:o(()=>[t(Y,{value:e(n).tone,"onUpdate:value":a[8]||(a[8]=u=>e(n).tone=u),options:x,placeholder:"請選擇訊息語氣",onChange:a[9]||(a[9]=()=>{e(n).tone==="other"&&(e(n).toneOtherConfig="")})},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),N(t(U,{span:12},{default:o(()=>[t(A,I(e(c).toneOtherConfig,{extra:"15 字以內"}),{label:o(()=>[Qe]),default:o(()=>[t(K,{value:e(n).toneOtherConfig,"onUpdate:value":a[10]||(a[10]=u=>e(n).toneOtherConfig=u),maxlength:15,placeholder:"請輸入訊息語氣"},null,8,["value"])]),_:1},16)]),_:1},512),[[V,e(n).tone==="other"]]),t(U,{span:24,class:"text-center text-sm text-sms-grayscale-60"},{default:o(()=>[M(" ※ 每次生成 3 則訊息，共收費新台幣 5 元 ")]),_:1}),t(ne,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512),[[V,e(r).length===0]]),N(v("div",Xe,[v("div",Ye,[Ze,t(ne,{status:"small2",onClick:a[11]||(a[11]=u=>l.value=!0)},{default:o(()=>[M(" 重新生成 ")]),_:1})]),t(ae,{layout:"vertical",autocomplete:"off"},{default:o(()=>[t(ye,{value:e(s),"onUpdate:value":a[12]||(a[12]=u=>B(s)?s.value=u:null)},{default:o(()=>[t(oe,{gutter:[16,16]},{default:o(()=>[(E(!0),F(W,null,$e(e(r),(u,he)=>(E(),Q(U,{key:u,span:24,class:"flex"},{default:o(()=>[t(xe,{value:u},null,8,["value"]),t(A,{label:`訊息 Template${he+1}`,class:Se(["flex-1",{selected:e(s)===u}])},{default:o(()=>[t(te,{value:u,"auto-size":!0,readonly:"",onClick:st=>s.value=u},null,8,["value","onClick"])]),_:2},1032,["label","class"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1})],512),[[V,e(r).length>0]])]),_:1},8,["open","cancel-text"]),t(G,{open:e(y),"onUpdate:open":a[14]||(a[14]=u=>B(y)?y.value=u:null),title:"是否確定使用 AI 生成訊息？",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:h},{default:o(()=>[et]),_:1},8,["open"]),t(G,{open:e(l),"onUpdate:open":a[15]||(a[15]=u=>B(l)?l.value=u:null),title:"是否確定重新生成？",centered:"",width:"440px","cancel-text":"取消","ok-text":"確定",onOk:_},{default:o(()=>[tt]),_:1},8,["open"]),t(G,{open:e(b),"onUpdate:open":a[16]||(a[16]=u=>B(b)?b.value=u:null),title:"是否覆蓋現有的自訂訊息內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:H},{default:o(()=>[nt]),_:1},8,["open"])],64)}}}),ot={class:"px-24px"},at={key:0,class:"line-clamp-2"},lt=v("div",{class:"px-24px text-center"}," 您重新選擇的自訂訊息內容，將會把現在的訊息完全覆蓋。 ",-1),yt=j({__name:"import-custom-message",props:{content:{type:String,required:!0}},emits:["updateContent"],setup(O,{expose:C,emit:d}){const $=O,m=d,s=P({selectedRowKeys:[],selectedRows:[],loading:!1}),{customMessages:r,getCustomMessages:S,pagination:g}=Fe(),x=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"160px"},{title:"訊息名稱",dataIndex:"name",key:"name",sorter:!0,width:"160px"},{title:"訊息內容",dataIndex:"content",key:"content",sorter:!0}],i=k({categoryIds:[],keyword:"",name:"",content:"",sortField:"createTime",sortOrder:"descend"});async function n(h,_,b){console.log("sorter:",b),i.value=Object.assign(i.value,{sortField:b.field,sortOrder:b.order}),await c(g.value.current,g.value.pageSize)}async function L(h,_){await c(h,_)}async function c(h=1,_=10){const b={current:h,pageSize:_,...e(i)};await S(b)}function T(h,_){console.log("selectedRowKeys changed: ",h,_),s.selectedRowKeys=h,s.selectedRows=_}const p=k(!1);async function y(){s.selectedRowKeys=[],s.selectedRows=[],c(),p.value=!0}const l=k(!1);function f(){J($.content)?w():l.value=!0}function w(){var h;p.value=!1,l.value=!1,m("updateContent",(h=s.selectedRows[0])==null?void 0:h.content)}return C({show:y}),(h,_)=>{const b=Pe,D=De,H=X;return E(),F(W,null,[t(H,{open:e(p),"onUpdate:open":_[1]||(_[1]=R=>B(p)?p.value=R:null),title:"選擇欲載入自訂訊息內容",centered:"","cancel-text":"取消","ok-text":"確定",width:"960px","ok-button-props":{disabled:e(s).selectedRowKeys.length===0},onOk:f},{default:o(()=>[v("div",ot,[t(b,{modelValue:e(i).keyword,"onUpdate:modelValue":_[0]||(_[0]=R=>e(i).keyword=R),"show-filter-btn":!1,placeholder:"搜尋訊息類別、名稱、內容",class:"mb-2"},null,8,["modelValue"]),t(D,{class:"modal-table","data-source":e(r),columns:x,"show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(s).selectedRowKeys,onChange:T,type:"radio"},pagination:{...e(g)},"custom-header-row":()=>({class:"modal-table"}),onChange:n,onChangePagination:L},{bodyCell:o(({column:R,text:a})=>[R.dataIndex==="content"?(E(),F("div",at,q(a),1)):ce("",!0)]),_:1},8,["data-source","row-selection","pagination"])])]),_:1},8,["open","ok-button-props"]),t(H,{open:e(l),"onUpdate:open":_[2]||(_[2]=R=>B(l)?l.value=R:null),title:"是否覆蓋現有的自訂訊息內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:w},{default:o(()=>[lt]),_:1},8,["open"])],64)}}});function ht(){const O=Re(),C=k(!1),d=()=>C.value=!0,$=()=>C.value=!1,m=Ae();O.beforeResolve((r,S,g)=>{e(C)?m.confirm({closable:!0,width:"440px",icon:()=>"",title:"是否放棄目前編輯的內容？",content:Le("div",{class:"text-center !w-full !max-w-full py-20px text-base mx-auto",innerHTML:"您將離開現在的頁面，且編輯的內容不會存檔"}),okText:"確定",cancelText:"取消",centered:!0,onOk:()=>{$(),g()},onCancel:()=>{g(!1)}}):g()});const s=r=>{e(C)&&(r.preventDefault(),r.returnValue=!0)};return ie(()=>{window.addEventListener("beforeunload",s)}),{setShowAlert:d,setHideAlert:$}}export{yt as _,vt as a,gt as b,xt as c,_t as d,ht as u};

import{F as ge,_ as be}from"./request-74a2fc5c.js";import{_ as xe}from"./index-6b61ddc5.js";import{_ as Z}from"./index.vuevuetypescriptsetuptruelang-df03164d.js";import{k as ee,_ as we}from"./index-858981d5.js";import{d as te,r as O,f as g,W as m,_ as z,$ as s,k as a,ab as he,u as e,H as ae,D as Ce,o as Te,a0 as Le,X as k,G as p,E as Re,a4 as S,Y as _,a3 as y,F as A,m as Fe,A as Ie}from"./vue-b9a22f97.js";import{g as Ye}from"./tools-a2ffc173.js";import{u as se}from"./group-label-312c08ef.js";import{H as oe,E as H,J as De,I as ne,q as Me,r as le,u as re,F as ie,G as ue,C as Se,s as Oe,Q as $e,N as Ge}from"./antd-f7215ad7.js";const Ke=te({__name:"group-label-create",props:{saveCallbck:{type:Function,required:!0}},setup(J,{expose:$}){const w=ee(),{checkGroupLabelExist:G,createGroupLabel:K}=se(),P=J,T={name:""},b=O(oe(T)),U=O({name:[{validator:async function(R,i){if(H(i))return Promise.reject("請輸入群組標籤");const x=await G(i);return console.log(x),x?Promise.reject(`系統中已有「${i}」，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:u,resetFields:L,validate:E}=De(b,U),c=g(!1),j=async()=>{L(T),c.value=!0},n=()=>{E().then(async()=>{var i;((i=(await K(b.name)).data)==null?void 0:i.status)==="success"&&(w.success({message:"群組標籤新增成功",placement:"top"}),P.saveCallbck(),c.value=!1)})};return $({show:j}),(R,i)=>{const x=ne,F=Me,V=le,h=Z,N=re,I=ie,f=ue;return m(),z(f,{open:e(c),"onUpdate:open":i[1]||(i[1]=C=>ae(c)?c.value=C:null),title:"新增群組標籤",centered:"",width:"440px",cancelText:"取消",okText:"確定",onOk:n},{default:s(()=>[a(I,{ref:"formRef",class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:n},{default:s(()=>[a(N,{gutter:[16,0]},{default:s(()=>[a(V,{span:24},{default:s(()=>[a(F,he({label:"群組標籤名稱"},e(u).name,{required:"",extra:"15字以內"}),{default:s(()=>[a(x,{value:e(b).name,"onUpdate:value":i[0]||(i[0]=C=>e(b).name=C),placeholder:"請輸入群組標籤名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),a(h,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512)]),_:1},8,["open"])}}}),Pe={class:"flex justify-between px-2 items-center mb-2"},Ue={class:"me-1"},Ee={href:"javascript:;"},je=_("span",null,"全域黑名單功能: 主帳號將特定手機門號加入黑名單，主帳號和子帳號皆無法發送該門號任何訊息",-1),Ve={key:1},Ne={key:1},Be={key:0},qe={class:"editable-cell-wrapper"},Ae={class:"text-sms-status-alert-red text-xs"},ze={key:1,class:"editable-cell-wrapper"},He=_("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"},[p(" 您選擇的訊息類別將永久刪除。"),_("br"),p(" 原本屬於該訊息類別的自訂訊息，"),_("br"),p(" 將改為未分類狀態。 ")],-1),st=te({__name:"group-label",setup(J){const{getGroupLabels:$,groupLabels:w,pagination:G,updateGroupLabel:K,deleteGroupLabel:P,checkGroupLabelExist:T,getGroupLabelOption:b,groupOptions:U}=se(),u=O({}),L=g(!1);Ce(async()=>{i(),b()}),Te(()=>{L.value=!0});const E=[{title:"群組標籤名稱",dataIndex:"name",key:"name",sorter:!0,width:"180px"},{title:"門號數量",dataIndex:"phoneCount",key:"phoneCount",sorter:!0,width:"140px",align:"right"},{title:"黑名單數量",dataIndex:"blackListCount",key:"blackListCount",sorter:!0,width:"151px",align:"right"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"160px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0}],c=O({selectedRowKeys:[],selectedRows:[],loading:!1}),j=(o,t)=>{console.log("selectedRowKeys changed: ",o,t),c.selectedRowKeys=o,c.selectedRows=t},n=g({sortField:"createTime",sortOrder:"descend",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:"",keys:[]}),R=g(),i=async(o=1,t=10)=>{let d={current:o,pageSize:t,...e(n)};await $(d)},x=o=>{u[o]={...oe(w.value.filter(t=>o===t.key)[0]),msg:""}},F=async o=>{var v;const t=u[o];if(H(t.name)){u[o].msg="請輸入群組標籤";return}await T(t.name,t.key)?u[o].msg=`系統中已有「${u[o].name}」，請勿重複新增`:((v=(await K(t.key,t.name)).data)==null?void 0:v.status)==="success"&&(Object.assign(w.value.filter(B=>o===B.key)[0],t),delete u[o],I.success({message:"群組標籤編輯成功",placement:"top"}))},V=async(o,t,d)=>{console.log("pagination:",o,"sorter:",d),n.value=Object.assign(n.value,{sortField:d.field,sortOrder:d.order}),await i(o.current,o.pageSize)},h=g(null),N=()=>{var o;i(1),(o=h.value)==null||o.hide()},I=ee(),f=g(!1),C=()=>{f.value=!0},ce=async()=>{var t;((t=(await P(c.selectedRowKeys)).data)==null?void 0:t.status)==="success"&&(I.success({message:"群組標籤刪除成功",placement:"top"}),f.value=!1,c.selectedRowKeys=[],c.selectedRows=[])},de=()=>document.body,Q=g(null);return(o,t)=>{const d=we,v=Z,W=Se,B=Oe,q=xe,Y=le,X=$e,pe=re,me=ie,_e=Ge,fe=Le("RouterLink"),ve=ne,ke=be,ye=ue;return m(),k(A,null,[e(L)?(m(),z(Re,{key:0,to:"#extraContent"},[a(v,{status:"small1",onClick:t[0]||(t[0]=l=>{var r;return(r=e(Q))==null?void 0:r.show()})},{icon:s(()=>[a(d,{name:"plus",width:"16px"})]),default:s(()=>[p("新增群組標籤 ")]),_:1})])):S("",!0),_("div",Pe,[_("div",null,[a(v,{status:"small2",class:"me-2",onClick:C,disabled:e(c).selectedRowKeys.length===0},{icon:s(()=>[a(d,{name:"delete",width:"16px"})]),default:s(()=>[p("刪除 ")]),_:1},8,["disabled"])]),a(ge,{ref_key:"filterKeywordInputRef",ref:h,class:"w-440px h-40px",modelValue:e(n).keyword,"onUpdate:modelValue":t[5]||(t[5]=l=>e(n).keyword=l),placeholder:"搜尋群組標籤名稱",onClearFilter:t[6]||(t[6]=()=>{n.value={...e(n),keyword:"",createTime:[void 0,void 0],updateTime:[void 0,void 0]}})},{filterForm:s(()=>[a(me,{ref_key:"formRef",ref:R,layout:"vertical",model:e(n),autocomplete:"off"},{default:s(()=>[a(pe,{gutter:[16,12]},{default:s(()=>[a(Y,{span:24},{default:s(()=>[a(q,{label:"群組標籤",valueed:e(Ye)(e(n).keys)},{default:s(()=>[a(B,{options:e(U),maxTagCount:2,showArrow:!0,showSearch:!1,mode:"multiple",value:e(n).keys,"onUpdate:value":t[1]||(t[1]=l=>e(n).keys=l),class:"w-full"},{option:s(({value:l,label:r})=>[a(W,{checked:e(n).keys.includes(l)},null,8,["checked"]),p(" "+y(r),1)]),menuItemSelectedIcon:s(()=>[p(y(""))]),_:1},8,["options","value"])]),_:1},8,["valueed"])]),_:1}),a(Y,{span:24},{default:s(()=>[a(q,{label:"建立時間",valueed:e(n).createTime},{default:s(()=>[a(X,{class:"w-full",value:e(n).createTime,"onUpdate:value":t[2]||(t[2]=l=>e(n).createTime=l),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(Y,{span:24},{default:s(()=>[a(q,{label:"修改時間",valueed:e(n).updateTime},{default:s(()=>[a(X,{class:"w-full",value:e(n).updateTime,"onUpdate:value":t[3]||(t[3]=l=>e(n).updateTime=l),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(Y,{span:24,class:"text-center"},{default:s(()=>[a(v,{status:"small2",class:"me-5",onClick:t[4]||(t[4]=l=>{var r;return(r=e(h))==null?void 0:r.hide()})},{default:s(()=>[p("取消")]),_:1}),a(v,{status:"small1",onClick:N},{default:s(()=>[p("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(ke,{dataSource:e(w),columns:E,size:"small",showSorterTooltip:!1,"row-selection":{selectedRowKeys:e(c).selectedRowKeys,onChange:j},onChange:V,pagination:{...e(G)}},{headerCell:s(({column:l})=>[l.key==="blackListCount"?(m(),k(A,{key:0},[_("span",Ue,y(l.title),1),a(_e,{placement:"top","get-popup-container":de},{title:s(()=>[je]),default:s(()=>[_("a",Ee,[a(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1})],64)):S("",!0)]),bodyCell:s(({column:l,record:r,text:D})=>[l.dataIndex==="phoneCount"||l.dataIndex==="blackListCount"?(m(),k(A,{key:0},[D>0?(m(),z(fe,{key:0,href:"javascript:;",class:"text-sm text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80 font-400",hover:"text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80",to:{name:"ListManagement",query:{tabActived:"contactPerson",group:[r.key],...l.dataIndex==="blackListCount"&&{blackList:"true"}}}},{default:s(()=>[p(y(D),1)]),_:2},1032,["to"])):(m(),k("span",Ve,y(D),1))],64)):S("",!0),l.dataIndex==="name"?(m(),k("div",Ne,[e(u)[r.key]?(m(),k("div",Be,[_("div",qe,[a(ve,{value:e(u)[r.key].name,"onUpdate:value":M=>e(u)[r.key].name=M,onPressEnter:M=>F(r.key),maxLength:15,status:e(u)[r.key].msg&&!e(H)(e(u)[r.key].msg)?"error":""},null,8,["value","onUpdate:value","onPressEnter","status"]),a(d,{name:"save",onClick:M=>F(r.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"])]),_("span",Ae,y(e(u)[r.key].msg),1)])):(m(),k("div",ze,[p(y(D||" ")+" ",1),Fe(a(d,{name:"edit",onClick:M=>x(r.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"]),[[Ie,r.key!=0]])]))])):S("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),a(Ke,{ref_key:"groupLabelCreateRef",ref:Q,"save-callbck":()=>i(1)},null,8,["save-callbck"]),a(ye,{open:e(f),"onUpdate:open":t[7]||(t[7]=l=>ae(f)?f.value=l:null),title:"是否刪除選取的訊息類別？",centered:"",cancelText:"取消",okText:"確定",onOk:ce,width:"440px"},{default:s(()=>[He]),_:1},8,["open"])],64)}}});export{st as _};

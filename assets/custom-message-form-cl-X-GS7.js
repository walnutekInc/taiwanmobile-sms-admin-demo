import{_ as pe}from"./index.vuevuetypescriptsetuptruelang-X7vKDVly.js";import{u as _e,_ as fe,a as ge,b as ve,c as xe,d as we}from"./route-leave-DcINz4So.js";import{_ as ye}from"./index.vuevuetypescriptsetuptruelang-CICFdqya.js";import{h as be,j as Ce,_ as ke}from"./index-BZ4UblcJ.js";import{d as he,ad as Se,ac as Me,c as N,r as P,D as $e,f as c,w as Fe,W as H,_ as j,$ as a,k as s,ab as y,u as t,Y as d,B as Re,G as m,a4 as Te,m as D,A as E}from"./vue-BvWPEeCa.js";import{K as Ae,N as b,P as Ie,U as qe,B as Le,q as Ve,o as Be,p as Ue,I as Ne,H as Pe,s as He,F as je}from"./antd-Dpsol0oo.js";import{u as De,r as M,a as Ee}from"./custom-message-Bha7YMcY.js";import{u as Ge}from"./sms-category-CTQr1TP5.js";import"./context-B4eUFe0C.js";import"./index.esm-CgYeVutO.js";import"./index.vuevuetypestyleindex0lang-DYx2f2Iu.js";import"./request-ClUnCzY6.js";const We="/taiwanmobile-sms-admin-demo/assets/phone-DdWahJd9.png",Ke={class:"flex justify-between w-full items-center"},Oe=d("span",{class:""},"訊息類別",-1),Je=d("span",null,"新增訊息類別",-1),Ye=["src"],ze={class:"max-h-450px overflow-auto absolute top-[150px] left-[30px] w-[calc(100%-50px)]"},Qe=["innerHTML"],ct=he({__name:"custom-message-form",setup(Xe){const{setHideAlert:$,setShowAlert:G}=_e(),W=Se(),K=be(),C=Me(),O=Ce(),{getSmsCategoryOption:J,smsCategoryOption:Y,checkSmsCategoryExist:z}=Ge(),{customMeesage:k,getCustomMessage:Q,updateCustomMessage:X,createCustomMessage:Z,replaceFieldToHtml:F}=De(),f=N(()=>C.name==="CustomMessageCreate");let g={categoryId:void 0,newSmsCategory:"",name:"",content:""};const n=P(Ae(g)),ee=P({name:[{required:!0,message:"請輸入訊息名稱",trigger:"blur"}],content:[{required:!0,message:"請輸入訊息內容",trigger:"blur"},{async validator(o,e){var l;return!b(e)&&((l=n.content)==null?void 0:l.replace(M,"").length)>1e3?Promise.reject("限制輸入 1,000 字以內"):Promise.resolve()},trigger:"blur"}],newSmsCategory:[{async validator(o,e){return!b(e)&&await z(e)?Promise.reject(`系統中已有「${e}」 ，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:v,validate:te,clearValidate:se,resetFields:ae,initialModel:ne}=Ie(n,ee);$e(async()=>{var o,e,l;f.value||(await Q(C.params.id),g={categoryId:(o=k.value)==null?void 0:o.categoryId,newSmsCategory:"",name:((e=k.value)==null?void 0:e.name)??"",content:F((l=k.value)==null?void 0:l.content)},ae(g)),K.handleSelectedKeys(["/sms-marketing/custom-message"]),J()});const p=c(!0),R=N(()=>f.value?"新增自訂訊息":"編輯自訂訊息");Fe(()=>n,o=>{qe(o,g)?$():G()},{deep:!0});function oe(){console.log(ne),te().then(async()=>{var l;((l=(await(t(f)?Z:X)(n,C.params.id)).data)==null?void 0:l.status)==="success"&&(O.success({message:t(f)?"自訂訊息新增成功":"自訂訊息編輯成功",placement:"top"}),$(),W.push("/sms-marketing/custom-message?tabActived=customMessage"))}).catch(o=>{console.log(o)})}const T=c(null);function A(o){n.content=F(o)}const h=c(null),I=c(null);function le(o){var e;for(const l of o)(e=h.value)==null||e.insertFun(`<span>${l}</span>`)}const q=c(null);function re(o){var e;(e=h.value)==null||e.insertFun(`<a href="${o}">${o}</a>`)}const L=c(null);return(o,e)=>{const l=ke,ue=Le,ie=Ve,x=Be,i=Ue,S=ye,V=Ne,w=Pe,me=we,B=He,ce=je,de=pe;return H(),j(de,{title:t(R),"custom-breadcrumb":[{title:"訊息行銷活動"},{path:"/sms-marketing/custom-message?tabActived=customMessage",title:"自訂訊息"},{title:t(R)}]},{default:a(()=>[s(B,{class:"bg-sms-grayscale-0 rounded-4 p-10",wrap:!1},{default:a(()=>[s(i,{flex:"auto"},{default:a(()=>[s(ce,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:oe},{default:a(()=>[s(B,{gutter:[16,16]},{default:a(()=>[s(i,{span:24},{default:a(()=>[s(x,y({"html-for":""},t(v).categoryId,{extra:"15 字以內。若無選擇/新增，將自動歸類為「未分類」。","label-col":{style:{width:"100%"}}}),{label:a(()=>[d("div",Ke,[Oe,t(p)?(H(),j(ue,{key:0,type:"link",class:"m-0 p-0",onClick:e[0]||(e[0]=Re(()=>p.value=!1,["prevent"]))},{icon:a(()=>[s(l,{name:"plus"})]),default:a(()=>[m(" 新增訊息類別 ")]),_:1})):Te("",!0)])]),default:a(()=>[s(ie,{value:t(n).categoryId,"onUpdate:value":e[1]||(e[1]=r=>t(n).categoryId=r),options:t(Y),"allow-clear":"",disabled:!t(p),placeholder:"請選擇訊息類別"},null,8,["value","options","disabled"])]),_:1},16)]),_:1}),D(s(i,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-2 !px-3"},{default:a(()=>[s(x,y({"html-for":"",extra:"15 字以內。若同時選擇和新增訊息類別，系統只會紀錄「新增訊息類別」。"},t(v).newSmsCategory,{"label-col":{style:{width:"100%"}}}),{label:a(()=>[Je,s(S,{status:"small3",class:"m-0 p-0 ms-auto",onClick:e[2]||(e[2]=()=>{t(se)("newSmsCategory"),p.value=!0})},{icon:a(()=>[s(l,{name:"close"})]),_:1})]),default:a(()=>[s(V,{value:t(n).newSmsCategory,"onUpdate:value":e[3]||(e[3]=r=>t(n).newSmsCategory=r),placeholder:"請輸入訊息類別",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[E,!t(p)]]),s(i,{span:24},{default:a(()=>[s(x,y({label:"訊息名稱"},t(v).name,{extra:"15 字以內",required:""}),{default:a(()=>[s(V,{value:t(n).name,"onUpdate:value":e[4]||(e[4]=r=>t(n).name=r),placeholder:"請輸入訊息名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),s(i,{span:24},{default:a(()=>{var r;return[s(x,y({label:"訊息內容"},t(v).content,{class:"relative",extra:`MMS 上限 1,000 字，SMS 上限 335 字，目前 ${t(b)(t(n).content)?"--":(r=t(n).content)==null?void 0:r.replace(t(M),"").length} 字(不含參數字數)`,required:""}),{default:a(()=>{var U;return[s(me,{ref_key:"tagTextareaRef",ref:h,modelValue:t(n).content,"onUpdate:modelValue":e[9]||(e[9]=_=>t(n).content=_),contenteditable:"true","content-len":(U=t(n).content)==null?void 0:U.replace(t(M),"").length,"max-len":1e3,placeholder:"請輸入訊息名稱"},{default:a(()=>[s(w,null,{title:a(()=>[m(" 載入現有的自訂訊息 ")]),default:a(()=>[s(l,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[5]||(e[5]=_=>{var u;return(u=t(T))==null?void 0:u.show()})})]),_:1}),s(w,null,{title:a(()=>[m(" 加入參數 ")]),default:a(()=>[s(l,{name:"code",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[6]||(e[6]=_=>{var u;return(u=t(I))==null?void 0:u.show()})})]),_:1}),s(w,null,{title:a(()=>[m(" 增加縮網址 ")]),default:a(()=>[s(l,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[7]||(e[7]=_=>{var u;return(u=t(q))==null?void 0:u.show()})})]),_:1}),s(w,null,{title:a(()=>[m(" AI 文字生成訊息 ")]),default:a(()=>[s(l,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:e[8]||(e[8]=_=>{var u;return(u=t(L))==null?void 0:u.show()})})]),_:1})]),_:1},8,["modelValue","content-len"])]}),_:1},16,["extra"])]}),_:1}),s(i,{span:24,class:"text-end"},{default:a(()=>[s(S,{status:"small2",class:"me-2",onClick:e[10]||(e[10]=r=>o.$router.push("/sms-marketing/custom-message?tabActived=customMessage"))},{default:a(()=>[m(" 取消 ")]),_:1}),s(S,{status:"small1","html-type":"submit"},{default:a(()=>[m(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(i,{flex:"428px",class:"relative"},{default:a(()=>{var r;return[d("img",{src:t(We),class:"w-428px"},null,8,Ye),d("div",ze,[D(d("div",{class:"bg-sms-grayscale-20 p-2 rounded-2 whitespace-pre-wrap max-w-[215px] inline-block break-words",innerHTML:(r=t(n).content)==null?void 0:r.replace(t(Ee),"")},null,8,Qe),[[E,!t(b)(t(n).content)]])])]}),_:1})]),_:1}),s(fe,{ref_key:"importCustomMessageRef",ref:T,content:t(n).content,onUpdateContent:A},null,8,["content"]),s(ge,{ref_key:"addFieldRef",ref:I,onAddFieldToContent:le},null,512),s(ve,{ref_key:"addLinkRef",ref:q,onAddLinkToContent:re},null,512),s(xe,{ref_key:"aiTextGenerationRef",ref:L,content:t(n).content,onUpdateContent:A},null,8,["content"])]),_:1},8,["title","custom-breadcrumb"])}}});export{ct as default};

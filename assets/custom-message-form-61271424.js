import{_ as Be}from"./index.vuevuetypescriptsetuptruelang-a43ef3b9.js";import{d as Z,ag as $e,ah as Pe,o as Oe,j as qe,r as K,f as y,w as fe,y as De,W as P,X as ae,_ as Y,u as e,a8 as Ne,Y as v,Q as Ve,F as ue,k as t,$ as n,a3 as le,a4 as Re,H as V,G as k,ad as Me,l as je,ab as I,m as J,A as Q,a9 as Ge,a5 as Le,ac as Ke,c as Te,D as ze,B as We}from"./vue-b9a22f97.js";import{_ as ie}from"./index.vuevuetypescriptsetuptruelang-374ce0ee.js";import{j as Je,_ as Ie,h as Qe,k as Xe}from"./index-d06b885c.js";import{E as G,G as ce,H as _e,J as ge,I as ve,q as xe,r as ye,u as he,F as we,K as Ye,s as Ue,R as Ze,N as et,O as tt,B as nt,P as ot}from"./antd-16a0cd46.js";import{u as at}from"./sms-category-54a5f190.js";import{F as lt,_ as st}from"./request-068a3637.js";import{u as Ae,r as me,a as rt}from"./custom-message-85380516.js";import{c as pe,a as ut,b as Se}from"./index.esm-61f44d81.js";import"./context-2583c84c.js";const it={class:"form-textarea-tools py-2"},ct=Z({__name:"index",props:$e({contenteditable:{type:[Boolean,String],default:!0},noHtml:{type:Boolean,default:!1},noNl:{type:Boolean,default:!1},maxLen:{type:Number},contentLen:{type:Number},placeholder:String},{modelValue:{required:!0},modelModifiers:{}}),emits:$e({returned:String},["update:modelValue"]),setup(M,{emit:w}){function R(a,d,T){return a.split(d).join(T)}const i=M,p=Pe(M,"modelValue");Oe(()=>{document.addEventListener("selectionchange",$)}),qe(()=>{document.removeEventListener("selectionchange",$)});function c(){return`r${new Date().getTime()}d${Math.ceil(Math.random()*1e3)}`}const f=K({contentId:`content${c()}`,isLocked:!1,currentTagId:null,savedRange:{}}),U=w;function $(){var d;let a=window.getSelection();if(a){let T=a.rangeCount>0?a.getRangeAt(0):null;T&&((d=T.commonAncestorContainer.ownerDocument)!=null&&d.activeElement)&&T.commonAncestorContainer.ownerDocument.activeElement.id===f.contentId&&(f.savedRange=T)}}const h=y();function m(){return i.noHtml?h.value.innerText:h.value.innerHTML}function o(a){i.noHtml?h.value.innerText=e(a):h.value.innerHTML=e(a)}function L(){p.value=m()}function _(a){a.preventDefault();let d=(a.originalEvent||a).clipboardData.getData("text/plain");if(i.noNl&&(d=R(d,`\r
`," "),d=R(d,`
`," "),d=R(d,"\r"," ")),i.contentLen&&i.maxLen&&i.contentLen+d.length>=i.maxLen)return a.keyCode===8,void 0;console.log("paste"),window.document.execCommand("insertText",!1,d)}function C(a){a.key=="Enter"&&i.noNl&&(a.preventDefault(),U("returned",m()))}fe(p,async a=>{await De(),a!=m()&&o(a??"")}),fe(()=>i.noHtml,()=>{o(p??"")});function g(a){if(i.contentLen&&i.maxLen&&i.contentLen>=i.maxLen){if(a.keyCode===8)return;a.preventDefault()}}return(a,d)=>(P(),ae(ue,null,[(P(),Y(Ne("div"),{class:"tag-textarea",id:e(f).contentId,contenteditable:M.contenteditable,onInput:L,onBlur:L,onPaste:_,onKeypress:C,ref_key:"element",ref:h,"data-placeholder":M.placeholder,onKeydown:g},null,40,["id","contenteditable","data-placeholder"])),v("div",it,[Ve(a.$slots,"default")])],64))}});const dt="/taiwanmobile-sms-admin-demo/assets/phone-415905dc.png",mt={class:"px-24px"},pt={key:0,class:"line-clamp-2"},ft=v("div",{class:"px-24px text-center"}," 您重新選擇的自訂訊息內容，將會把現在的訊息完全覆蓋。 ",-1),_t=Z({__name:"import-custom-message",props:{content:{type:String,required:!0}},emits:["updateContent"],setup(M,{expose:w,emit:R}){const i=M,p=R,c=K({selectedRowKeys:[],selectedRows:[],loading:!1}),{customMessages:f,getCustomMessages:U,pagination:$}=Ae(),h=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"160px"},{title:"訊息名稱",dataIndex:"name",key:"name",sorter:!0,width:"160px"},{title:"訊息內容",dataIndex:"content",key:"content",sorter:!0}],m=y({categoryIds:[],keyword:"",name:"",content:"",sortField:"createTime",sortOrder:"descend"}),o=async(s,S,O)=>{console.log("pagination:",s,"sorter:",O),m.value=Object.assign(m.value,{sortField:O.field,sortOrder:O.order}),await L(s.current,s.pageSize)},L=async(s=1,S=10)=>{let O={current:s,pageSize:S,...e(m)};await U(O)},_=(s,S)=>{console.log("selectedRowKeys changed: ",s,S),c.selectedRowKeys=s,c.selectedRows=S},C=y(!1),g=async()=>{c.selectedRowKeys=[],c.selectedRows=[],L(),C.value=!0},a=y(!1),d=()=>{G(i.content)?T():a.value=!0},T=()=>{var s;C.value=!1,a.value=!1,p("updateContent",(s=c.selectedRows[0])==null?void 0:s.content)};return w({show:g}),(s,S)=>{const O=lt,H=st,q=ce;return P(),ae(ue,null,[t(q,{open:e(C),"onUpdate:open":S[0]||(S[0]=D=>V(C)?C.value=D:null),title:"選擇欲載入自訂訊息內容",centered:"",cancelText:"取消",okText:"確定",onOk:d,width:"960px",okButtonProps:{disabled:e(c).selectedRowKeys.length===0}},{default:n(()=>[v("div",mt,[t(O,{showFilterBtn:!1,placeholder:"搜尋訊息類別、名稱、內容",class:"mb-2"}),t(H,{class:"modal-table",dataSource:e(f),columns:h,showSorterTooltip:!1,"row-selection":{selectedRowKeys:e(c).selectedRowKeys,onChange:_,type:"radio"},onChange:o,pagination:{...e($)},customHeaderRow:()=>({class:"modal-table"})},{bodyCell:n(({column:D,text:j})=>[D.dataIndex==="content"?(P(),ae("div",pt,le(j),1)):Re("",!0)]),_:1},8,["dataSource","row-selection","pagination"])])]),_:1},8,["open","okButtonProps"]),t(q,{open:e(a),"onUpdate:open":S[1]||(S[1]=D=>V(a)?a.value=D:null),title:"是否覆蓋現有的自訂訊息內容？",centered:"",cancelText:"取消",okText:"確定",onOk:T,width:"440px"},{default:n(()=>[ft]),_:1},8,["open"])],64)}}}),gt={class:"px-24px"},vt=v("p",{class:"text-center"},"選擇想加入的參數後，再點擊確定即可。",-1),xt={class:"flex justify-between gap-x-2"},yt=v("p",{class:"text-sms-grayscale-60 text-sm mt-10"},[k(" 加入參數功能說明："),v("br"),k(" 此為自訂訊息的插入參數功能，參數訊息發送功能位置為【訊息行銷活動】和【參數訊息】。訊息內容可自由插入參數，至多使用 5 個參數，依照上傳參數檔案而組成訊息內容。")],-1),ht=Z({__name:"add-field",emits:["addFieldToContent"],setup(M,{expose:w,emit:R}){const i=R,p=y(!1),c=y([]),f=h=>{c.value.includes(h)?c.value=c.value.filter(m=>m!==h):c.value.push(h)},U=async()=>{c.value=[],p.value=!0},$=()=>{p.value=!1,i("addFieldToContent",c.value)};return w({show:U}),(h,m)=>{const o=ie,L=ce;return P(),Y(L,{open:e(p),"onUpdate:open":m[5]||(m[5]=_=>V(p)?p.value=_:null),title:"加入參數",centered:"",cancelText:"取消",okText:"確定",onOk:$,width:"600px"},{default:n(()=>[v("div",gt,[vt,v("div",xt,[t(o,{status:e(c).includes("%field1%")?"small1":"small2",onClick:m[0]||(m[0]=_=>f("%field1%"))},{default:n(()=>[k("%field1%")]),_:1},8,["status"]),t(o,{status:e(c).includes("%field2%")?"small1":"small2",onClick:m[1]||(m[1]=_=>f("%field2%"))},{default:n(()=>[k("%field2%")]),_:1},8,["status"]),t(o,{status:e(c).includes("%field3%")?"small1":"small2",onClick:m[2]||(m[2]=_=>f("%field3%"))},{default:n(()=>[k("%field3%")]),_:1},8,["status"]),t(o,{status:e(c).includes("%field4%")?"small1":"small2",onClick:m[3]||(m[3]=_=>f("%field4%"))},{default:n(()=>[k("%field4%")]),_:1},8,["status"]),t(o,{status:e(c).includes("%field5%")?"small1":"small2",onClick:m[4]||(m[4]=_=>f("%field5%"))},{default:n(()=>[k("%field5%")]),_:1},8,["status"])]),yt])]),_:1},8,["open"])}}}),wt=()=>{const M=Me(),w=y(!1),R=()=>w.value=!0,i=()=>w.value=!1,p=Je();M.beforeResolve((f,U,$)=>{e(w)?p.confirm({closable:!0,width:"440px",icon:()=>"",title:"是否放棄目前編輯的內容？",content:je("div",{class:"text-center !w-full !max-w-full py-20px text-base mx-auto",innerHTML:"您將離開現在的頁面，且編輯的內容不會存檔"}),okText:"確定",cancelText:"取消",centered:!0,onOk:()=>{i(),$()},onCancel:()=>{$(!1)}}):$()});const c=f=>{e(w)&&(f.preventDefault(),f.returnValue=!0)};return Oe(()=>{window.addEventListener("beforeunload",c)}),{setShowAlert:R,setHideAlert:i}},Ct=Z({__name:"add-link",emits:["addLinkToContent"],setup(M,{expose:w,emit:R}){const i=R,p={link:""},c=C=>{var g="^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$",a=new RegExp(g,"i");return C.length<2083&&a.test(C)},f=K(_e(p)),U=K({link:[{validator:async function(C,g){return G(g)?Promise.reject("請輸入縮網址"):c(g)?Promise.resolve():Promise.reject("請輸入有效網址")},trigger:"blur"}]}),{validateInfos:$,resetFields:h,validate:m}=ge(f,U),o=y(!1),L=async()=>{h(p),o.value=!0},_=()=>{m().then(async()=>{i("addLinkToContent",f.link),o.value=!1})};return w({show:L}),(C,g)=>{const a=ve,d=xe,T=ye,s=ie,S=he,O=we,H=ce;return P(),Y(H,{open:e(o),"onUpdate:open":g[1]||(g[1]=q=>V(o)?o.value=q:null),title:"加入縮網址",centered:"",width:"600px",cancelText:"取消",okText:"確定",onOk:_},{default:n(()=>[t(O,{ref:"formRef",class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:_},{default:n(()=>[t(S,{gutter:[16,0]},{default:n(()=>[t(T,{span:24},{default:n(()=>[t(d,I({label:""},e($).link),{default:n(()=>[t(a,{value:e(f).link,"onUpdate:value":g[0]||(g[0]=q=>e(f).link=q),valueModifiers:{trim:!0},placeholder:"請輸入原始長網址，範例: https://www.taiwanmobile.com/"},null,8,["value"])]),_:1},16)]),_:1}),t(s,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512)]),_:1},8,["open"])}}}),bt={class:"flex items-center justify-center"},kt=v("span",{"w.5":"","h-18px":""},le(""),-1),$t=v("span",{"w.5":"","h-18px":""},le(""),-1),Tt=v("span",{"w.5":"","h-18px":""},le(""),-1),St={class:"px-24px"},Ot={class:"flex justify-between items-center mb-4"},Rt=v("span",{class:"text-base text-sms-grayscale-80"},"選擇下列任一訊息，點擊「確定」。",-1),Mt=v("div",{class:"text-center px-30px py-20px text-base text-sms-grayscale-80 mx-auto"}," ※ 每次生成 3 則訊息，共收費新台幣 5 元 ",-1),Lt=v("div",{class:"text-center px-30px py-20px text-base text-sms-grayscale-80 mx-auto"}," 已生成的訊息將直接刪除 ",-1),It=v("div",{class:"px-24px text-center"}," 您重新選擇的自訂訊息內容，將會把現在的訊息完全覆蓋。 ",-1),Ut=Z({__name:"ai-text-generation",props:{content:{type:String,required:!0}},emits:["updateContent"],setup(M,{expose:w,emit:R}){const i=y(""),p=y([]),c=M,f=R,U=[{value:"singRule",label:"單則訊息 (70 字)"},{value:"longRule",label:"長訊息 (335 字)"},{value:"other",label:"其他"}],$=[{value:"notSpecify",label:"不指定"},{value:"promotions",label:"促銷活動"},{value:"promotions",label:"會員專屬"},{value:"newProductRecommendation",label:"新產品推薦"},{value:"eventInvitation",label:"活動邀請"},{value:"customerNotice",label:"客戶通知"},{value:"other",label:"其他"}],h=[{value:"notSpecify",label:"不指定"},{value:"friendly",label:"親切幽默"},{value:"professional",label:"專業正式"},{value:"warm",label:"溫暖感人"},{value:"other",label:"其他"}],o=K(_e({name:"",messageElement:"",count:void 0,countOtherConfig:"",type:"notSpecify",typeOtherConfig:"",tone:"notSpecify",toneOtherConfig:""})),L=K({messageElement:[{validator:async function(j,l){return G(l)?Promise.reject("請輸入訊息元素"):Promise.resolve()},trigger:"blur"}],count:[{required:!0,message:"請選擇訊息字數",trigger:"blur"}],countOtherConfig:[{validator:async function(j,l){return o.count!=="other"?Promise.resolve():await pe().shape({countOtherConfig:ut().typeError("請輸入訊息字數").min(1,"請輸入 1~335 之間任一數字").max(335,"請輸入 1~335 之間任一數字")}).validate({countOtherConfig:l})},trigger:"blur"}],typeOtherConfig:[{validator:async function(j,l){return o.type!=="other"?Promise.resolve():await pe().shape({typeOtherConfig:Se().required("請輸入訊息種類")}).validate({typeOtherConfig:l})},trigger:"blur"}],toneOtherConfig:[{validator:async function(j,l){return o.tone!=="other"?Promise.resolve():await pe().shape({toneOtherConfig:Se().required("請輸入訊息語氣")}).validate({toneOtherConfig:l})},trigger:"blur"}]}),{validateInfos:_,validate:C}=ge(o,L),g=y(!1),a=y(!1),d=y(!1),T=async()=>{g.value=!0},s=()=>{p.value.length===0?C().then(async()=>{a.value=!0}):q()},S=()=>{a.value=!1,p.value=[`Hello！親愛的 TAMedia Cafe 會員您好！促銷來囉！
買一送一伯爵鮮奶茶大放送！
只要透過訊息兌換序號，就能立即享受這份優惠！
別忘了帶上您的好友一同來品嚐，嚐一口就愛上的美味鮮奶茶！`,`Hello！親愛的TAMedia Cafe顧客您好！
想和您分享好消息，現在限時促銷！買一送一伯爵鮮奶茶，只需透過訊息兌換序號即可輕鬆獲得！
別忘了告訴您的朋友們，讓大家一同享受這份美味和歡笑！`,`哈囉！TAMedia Cafe 歡迎您！現在限時促銷！
買一送一伯爵鮮奶茶就在這裡！只要您透過訊息兌換序號，即可立即享受這份優惠！
快約上好友，一同來 TAMedia Cafe 享受美味，嘗一口就愛上的鮮奶茶吧！`]},O=()=>{p.value=[],i.value="",d.value=!1},H=y(!1),q=()=>{G(c.content)?D():H.value=!0},D=()=>{g.value=!1,H.value=!1,f("updateContent",i.value)};return w({show:T}),(j,l)=>{const z=Ie,W=ve,A=xe,F=ye,ee=Ye,te=Ue,ne=ie,x=he,r=we,b=Ze,de=et,X=ce;return P(),ae(ue,null,[t(X,{open:e(g),"onUpdate:open":l[13]||(l[13]=u=>V(g)?g.value=u:null),centered:"",width:"600px",cancelText:e(p).length===0?"取消":"關閉",okText:"確定",onOk:s},{title:n(()=>[v("div",bt,[t(z,{name:"AI2",width:"32px",class:"me-2"}),k(" "+le(e(p).length===0?"使用 AI 生成訊息內容":"AI 生成訊息結果"),1)])]),default:n(()=>[J(t(r,{ref:"formRef",class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:s},{default:n(()=>[t(x,{gutter:[16,16]},{default:n(()=>[t(F,{span:24},{default:n(()=>[t(A,I({label:"公司或產品名稱"},e(_).name,{extra:"30 字以內"}),{default:n(()=>[t(W,{value:e(o).name,"onUpdate:value":l[0]||(l[0]=u=>e(o).name=u),placeholder:"請輸入文字",maxLength:30},null,8,["value"])]),_:1},16)]),_:1}),t(F,{span:24},{default:n(()=>[t(A,I({label:"訊息元素"},e(_).messageElement,{extra:"給予 AI 生成文案的文字素材，150 字以內",required:""}),{default:n(()=>[t(ee,{value:e(o).messageElement,"onUpdate:value":l[1]||(l[1]=u=>e(o).messageElement=u),rows:4,placeholder:`請輸入必要訊息元素，
必要訊息元素為您希望在訊息內容中一定要出現的資訊，
例如：顧客來店消費即可享有見面禮、提供消費者 DM 資訊`,maxLength:150},null,8,["value"])]),_:1},16)]),_:1}),t(F,{span:e(o).count!=="other"?24:12},{default:n(()=>[t(A,I({label:"訊息字數"},e(_).count,{required:""}),{default:n(()=>[t(te,{value:e(o).count,"onUpdate:value":l[2]||(l[2]=u=>e(o).count=u),options:U,onChange:l[3]||(l[3]=()=>{e(o).count==="other"&&(e(o).countOtherConfig="")}),placeholder:"請選擇訊息字數"},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),J(t(F,{span:12},{default:n(()=>[t(A,I(e(_).countOtherConfig,{extra:"可輸入 1~335 之間任一數字"}),{label:n(()=>[kt]),default:n(()=>[t(W,{type:"number",value:e(o).countOtherConfig,"onUpdate:value":l[4]||(l[4]=u=>e(o).countOtherConfig=u),placeholder:"請輸入訊息字數",controls:!1},null,8,["value"])]),_:1},16)]),_:1},512),[[Q,e(o).count==="other"]]),t(F,{span:e(o).type!=="other"?24:12},{default:n(()=>[t(A,I({label:"訊息種類"},e(_).type),{default:n(()=>[t(te,{value:e(o).type,"onUpdate:value":l[5]||(l[5]=u=>e(o).type=u),onChange:l[6]||(l[6]=()=>{e(o).type==="other"&&(e(o).typeOtherConfig="")}),options:$,placeholder:"請選擇訊息種類"},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),J(t(F,{span:12},{default:n(()=>[t(A,I(e(_).typeOtherConfig,{extra:"15 字以內"}),{label:n(()=>[$t]),default:n(()=>[t(W,{value:e(o).typeOtherConfig,"onUpdate:value":l[7]||(l[7]=u=>e(o).typeOtherConfig=u),maxLength:15,placeholder:"請輸入訊息種類"},null,8,["value"])]),_:1},16)]),_:1},512),[[Q,e(o).type==="other"]]),t(F,{span:e(o).tone!=="other"?24:12},{default:n(()=>[t(A,I({label:"訊息語氣"},e(_).tone),{default:n(()=>[t(te,{value:e(o).tone,"onUpdate:value":l[8]||(l[8]=u=>e(o).tone=u),onChange:l[9]||(l[9]=()=>{e(o).tone==="other"&&(e(o).toneOtherConfig="")}),options:h,placeholder:"請選擇訊息語氣"},null,8,["value"])]),_:1},16)]),_:1},8,["span"]),J(t(F,{span:12},{default:n(()=>[t(A,I(e(_).toneOtherConfig,{extra:"15 字以內"}),{label:n(()=>[Tt]),default:n(()=>[t(W,{value:e(o).toneOtherConfig,"onUpdate:value":l[10]||(l[10]=u=>e(o).toneOtherConfig=u),maxLength:15,placeholder:"請輸入訊息語氣"},null,8,["value"])]),_:1},16)]),_:1},512),[[Q,e(o).tone==="other"]]),t(F,{span:24,class:"text-center text-sm text-sms-grayscale-60"},{default:n(()=>[k(" ※ 每次生成 3 則訊息，共收費新台幣 5 元 ")]),_:1}),t(ne,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512),[[Q,e(p).length===0]]),J(v("div",St,[v("div",Ot,[Rt,t(ne,{status:"small2",onClick:l[11]||(l[11]=u=>d.value=!0)},{default:n(()=>[k("重新生成")]),_:1})]),t(r,{layout:"vertical",autocomplete:"off"},{default:n(()=>[t(de,{value:e(i),"onUpdate:value":l[12]||(l[12]=u=>V(i)?i.value=u:null)},{default:n(()=>[t(x,{gutter:[16,16]},{default:n(()=>[(P(!0),ae(ue,null,Ge(e(p),(u,N)=>(P(),Y(F,{span:24,class:"flex",key:u},{default:n(()=>[t(b,{value:u},null,8,["value"]),t(A,{label:`訊息 Template${N+1}`,class:Le(["flex-1",{selected:e(i)==u}])},{default:n(()=>[t(ee,{onClick:se=>i.value=u,value:u,autoSize:!0,readonly:""},null,8,["onClick","value"])]),_:2},1032,["label","class"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1})],512),[[Q,e(p).length>0]])]),_:1},8,["open","cancelText"]),t(X,{open:e(a),"onUpdate:open":l[14]||(l[14]=u=>V(a)?a.value=u:null),title:"是否確定使用 AI 生成訊息？",centered:"",width:"440px",cancelText:"取消",okText:"確定",onOk:S},{default:n(()=>[Mt]),_:1},8,["open"]),t(X,{open:e(d),"onUpdate:open":l[15]||(l[15]=u=>V(d)?d.value=u:null),title:"是否確定重新生成？",centered:"",width:"440px",cancelText:"取消",okText:"確定",onOk:O},{default:n(()=>[Lt]),_:1},8,["open"]),t(X,{open:e(H),"onUpdate:open":l[16]||(l[16]=u=>V(H)?H.value=u:null),title:"是否覆蓋現有的自訂訊息內容？",centered:"",cancelText:"取消",okText:"確定",onOk:D,width:"440px"},{default:n(()=>[It]),_:1},8,["open"])],64)}}});const At={class:"flex justify-between w-full items-center"},Ft=v("span",{class:""},"訊息類別",-1),Et=v("span",null,"新增訊息類別",-1),Ht=["src"],Bt={class:"max-h-450px overflow-auto absolute top-[150px] left-[30px] w-[calc(100%-50px)]"},Pt=["innerHTML"],Qt=Z({__name:"custom-message-form",setup(M){const{setHideAlert:w,setShowAlert:R}=wt(),i=Me(),p=Qe(),c=Ke(),f=Xe(),{getSmsCategoryOption:U,smsCategoryOption:$,checkSmsCategoryExist:h}=at(),{customMeesage:m,getCustomMessage:o,updateCustomMessage:L,createCustomMessage:_,replaceFieldToHtml:C}=Ae(),g=Te(()=>c.name=="CustomMessageCreate");let a={categoryId:void 0,newSmsCategory:"",name:"",content:""};ze(async()=>{var x,r,b;g.value||(await o(c.params.id),a={categoryId:(x=m.value)==null?void 0:x.categoryId,newSmsCategory:"",name:((r=m.value)==null?void 0:r.name)??"",content:C((b=m.value)==null?void 0:b.content)},D(a)),p.handleSelectedKeys(["/sms-marketing/custom-message"]),U()});const d=y(!0),T=Te(()=>g.value?"新增自訂訊息":"編輯自訂訊息"),s=K(_e(a));fe(()=>s,x=>{tt(x,a)?w():R()},{deep:!0});const S=K({name:[{required:!0,message:"請輸入訊息名稱",trigger:"blur"}],content:[{required:!0,message:"請輸入訊息內容",trigger:"blur"},{validator:async function(x,r){var b;return!G(r)&&((b=s.content)==null?void 0:b.replace(me,"").length)>1e3?Promise.reject("限制輸入 1,000 字以內"):Promise.resolve()},trigger:"blur"}],newSmsCategory:[{validator:async function(x,r){return!G(r)&&await h(r)?Promise.reject(`系統中已有「${r}」 ，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:O,validate:H,clearValidate:q,resetFields:D,initialModel:j}=ge(s,S),l=()=>{console.log(j),H().then(async()=>{var b;((b=(await(e(g)?_:L)(s,c.params.id)).data)==null?void 0:b.status)==="success"&&(f.success({message:e(g)?"自訂訊息新增成功":"自訂訊息編輯成功",placement:"top"}),w(),i.push("/sms-marketing/custom-message?tabActived=customMessage"))}).catch(x=>{console.log(x)})},z=y(null),W=x=>{s.content=C(x)},A=y(null),F=x=>{for(const r of x)s.content=`${s.content}<span>${r}</span>`},ee=y(null),te=x=>{s.content=`${s.content}<a href="${x}">${x}</a>`},ne=y(null);return(x,r)=>{const b=Ie,de=nt,X=Ue,u=xe,N=ye,se=ie,Ce=ve,re=ot,Fe=ct,be=he,Ee=we,He=Be;return P(),Y(He,{title:e(T),customBreadcrumb:[{title:"訊息行銷活動"},{path:"/sms-marketing/custom-message?tabActived=customMessage",title:"自訂訊息"},{title:e(T)}]},{default:n(()=>[t(be,{class:"bg-sms-grayscale-0 rounded-4 p-10",wrap:!1},{default:n(()=>[t(N,{flex:"auto"},{default:n(()=>[t(Ee,{ref:"formRef",class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:l},{default:n(()=>[t(be,{gutter:[16,16]},{default:n(()=>[t(N,{span:24},{default:n(()=>[t(u,I(e(O).categoryId,{extra:"15 字以內。若無選擇/新增，將自動歸類為「未分類」。",labelCol:{style:{width:"100%"}}}),{label:n(()=>[v("div",At,[Ft,e(d)?(P(),Y(de,{key:0,type:"link",class:"m-0 p-0",onClick:r[0]||(r[0]=We(()=>d.value=!1,["prevent"]))},{icon:n(()=>[t(b,{name:"plus"})]),default:n(()=>[k(" 新增訊息類別 ")]),_:1})):Re("",!0)])]),default:n(()=>[t(X,{value:e(s).categoryId,"onUpdate:value":r[1]||(r[1]=E=>e(s).categoryId=E),options:e($),"allow-clear":"",disabled:!e(d),placeholder:"請選擇訊息類別"},null,8,["value","options","disabled"])]),_:1},16)]),_:1}),J(t(N,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-2 !px-3"},{default:n(()=>[t(u,I({extra:"15 字以內。若同時選擇和新增訊息類別，系統只會紀錄「新增訊息類別」。"},e(O).newSmsCategory,{labelCol:{style:{width:"100%"}}}),{label:n(()=>[Et,t(se,{status:"small3",class:"m-0 p-0 ms-auto",onClick:r[2]||(r[2]=()=>{e(q)("newSmsCategory"),d.value=!0})},{icon:n(()=>[t(b,{name:"close"})]),_:1})]),default:n(()=>[t(Ce,{placeholder:"請輸入訊息類別",maxlength:15,value:e(s).newSmsCategory,"onUpdate:value":r[3]||(r[3]=E=>e(s).newSmsCategory=E)},null,8,["value"])]),_:1},16)]),_:1},512),[[Q,!e(d)]]),t(N,{span:24},{default:n(()=>[t(u,I({label:"訊息名稱"},e(O).name,{extra:"15 字以內",required:""}),{default:n(()=>[t(Ce,{value:e(s).name,"onUpdate:value":r[4]||(r[4]=E=>e(s).name=E),placeholder:"請輸入訊息名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),t(N,{span:24},{default:n(()=>{var E;return[t(u,I({label:"訊息內容"},e(O).content,{class:"relative",extra:`MMS 上限 1,000 字，SMS 上限 335 字，目前 ${e(G)(e(s).content)?"--":(E=e(s).content)==null?void 0:E.replace(e(me),"").length} 字(不含參數字數)`,required:""}),{default:n(()=>{var ke;return[t(Fe,{contenteditable:"true",modelValue:e(s).content,"onUpdate:modelValue":r[9]||(r[9]=oe=>e(s).content=oe),"content-len":(ke=e(s).content)==null?void 0:ke.replace(e(me),"").length,"max-len":1e3,placeholder:"請輸入訊息名稱"},{default:n(()=>[t(re,null,{title:n(()=>[k(" 載入現有的自訂訊息 ")]),default:n(()=>[t(b,{name:"import",onClick:r[5]||(r[5]=oe=>{var B;return(B=e(z))==null?void 0:B.show()}),class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px"})]),_:1}),t(re,null,{title:n(()=>[k(" 加入參數 ")]),default:n(()=>[t(b,{onClick:r[6]||(r[6]=oe=>{var B;return(B=e(A))==null?void 0:B.show()}),name:"code",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px"})]),_:1}),t(re,null,{title:n(()=>[k(" 增加縮網址 ")]),default:n(()=>[t(b,{name:"link",onClick:r[7]||(r[7]=oe=>{var B;return(B=e(ee))==null?void 0:B.show()}),class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px"})]),_:1}),t(re,null,{title:n(()=>[k(" AI 文字生成訊息 ")]),default:n(()=>[t(b,{name:"AI",onClick:r[8]||(r[8]=oe=>{var B;return(B=e(ne))==null?void 0:B.show()}),class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px"})]),_:1})]),_:1},8,["modelValue","content-len"])]}),_:1},16,["extra"])]}),_:1}),t(N,{span:24,class:"text-end"},{default:n(()=>[t(se,{status:"small2",class:"me-2",onClick:r[10]||(r[10]=E=>x.$router.push("/sms-marketing/custom-message?tabActived=customMessage"))},{default:n(()=>[k("取消")]),_:1}),t(se,{status:"small1","html-type":"submit"},{default:n(()=>[k("確定")]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1}),t(N,{flex:"428px",class:"relative"},{default:n(()=>{var E;return[v("img",{src:e(dt),class:Le("w-428px")},null,8,Ht),v("div",Bt,[J(v("div",{class:"bg-sms-grayscale-20 p-2 rounded-2 whitespace-pre-wrap max-w-[215px] inline-block break-words",innerHTML:(E=e(s).content)==null?void 0:E.replace(e(rt),"")},null,8,Pt),[[Q,!e(G)(e(s).content)]])])]}),_:1})]),_:1}),t(_t,{ref_key:"importCustomMessageRef",ref:z,onUpdateContent:W,content:e(s).content},null,8,["content"]),t(ht,{ref_key:"addFieldRef",ref:A,onAddFieldToContent:F},null,512),t(Ct,{ref_key:"addLinkRef",ref:ee,onAddLinkToContent:te},null,512),t(Ut,{ref_key:"aiTextGenerationRef",ref:ne,onUpdateContent:W,content:e(s).content},null,8,["content"])]),_:1},8,["title","customBreadcrumb"])}}});export{Qt as default};

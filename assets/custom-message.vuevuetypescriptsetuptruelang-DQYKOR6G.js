import{_ as J}from"./index.vuevuetypestyleindex0lang-BAtjMpJ7.js";import{_ as Q}from"./index-BxS_4WYd.js";import{_ as Z,a as ee}from"./index.vuevuetypescriptsetuptruelang-C6gXeA0P.js";import{_ as te}from"./index.vuevuetypescriptsetuptruelang-BBQ64wtr.js";import{h as ae,k as oe,_ as se}from"./index-BBYcgvXw.js";import{F as ne}from"./request-BYOfeCit.js";import{u as le}from"./sms-category-lx6Vb9og.js";import{b as ue}from"./tools-a0gbWjD6.js";import{u as de}from"./custom-message-gi8YCxGH.js";import{d as re,f as _,ad as ie,ac as ce,D as me,o as pe,r as fe,u as e,W as w,X as Y,_ as _e,k as a,$ as s,G as g,E as ge,a4 as K,Y as x,a3 as ye,H as ve,F as we}from"./vue-B4jB9Tcu.js";import{p as xe,o as ke,I as Ce,H as Re,r as Ie,F as Me,O as be}from"./antd-DY4CO-8O.js";const Te={class:"flex justify-between px-2 items-center mb-2"},he={key:0,class:"line-clamp-2"},Ye=x("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 您選擇的自訂訊息將永久刪除。 ",-1),je=re({__name:"custom-message",setup(Ke){var b;const{getSmsCategoryOption:D,smsCategoryOption:k}=le(),{customMessages:C,getCustomMessages:O,pagination:c,deleteCustomMessage:F}=de(),R=_(!1),I=ae(),S=ie(),M=ce();me(async()=>{await D(),y(),I.handleOpenKeys(["/sms-marketing"]),I.handleSelectedKeys(["/sms-marketing/custom-message"])}),pe(()=>{R.value=!0});const V=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"160px"},{title:"訊息名稱",dataIndex:"name",key:"name",sorter:!0,width:"160px"},{title:"訊息內容",dataIndex:"content",key:"content",sorter:!0,width:"265px"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"180px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0,width:"180px"}],u=fe({selectedRowKeys:[],selectedRows:[],loading:!1});function N(l,t){console.log("selectedRowKeys changed: ",l,t),u.selectedRowKeys=l,u.selectedRows=t}const o=_({categoryIds:(b=M.query)!=null&&b.categoryId?M.query.categoryId:[],keyword:"",name:"",content:"",createTime:void 0,updateTime:void 0,sortField:"createTime",sortOrder:"descend"}),U=_();async function y(l=1,t=10){const d={current:l,pageSize:t,...e(o)};await O(d)}async function $(l,t,d){console.log("pagination:",l,"sorter:",d),o.value=Object.assign(o.value,{sortField:d.field,sortOrder:d.order}),await y(l.current,l.pageSize)}function B(){S.push({name:"CustomMessageEdit",params:{id:u.selectedRowKeys[0]}})}const v=_(null);function L(){var l;y(1),(l=v.value)==null||l.hide()}const E=oe(),m=_(!1);function j(){m.value=!0}async function q(){var t;((t=(await F(u.selectedRowKeys)).data)==null?void 0:t.status)==="success"&&(E.success({message:"自訂訊息刪除成功",placement:"top"}),y(c.value.current===1||C.value.length-u.selectedRowKeys.length>1?c.value.current:c.value.current-1,c.value.pageSize),m.value=!1,u.selectedRowKeys=[],u.selectedRows=[])}return(l,t)=>{const d=se,p=te,z=Z,H=ee,G=xe,f=Q,i=ke,T=Ce,h=Re,P=Ie,W=Me,X=J,A=be;return w(),Y(we,null,[e(R)?(w(),_e(ge,{key:0,to:"#extraContent"},[a(p,{status:"small1",onClick:t[0]||(t[0]=()=>l.$router.push({name:"CustomMessageCreate"}))},{icon:s(()=>[a(d,{name:"plus",width:"16px"})]),default:s(()=>[g(" 新增自訂訊息 ")]),_:1})])):K("",!0),x("div",Te,[x("div",null,[a(p,{status:"small2",class:"me-2",disabled:e(u).selectedRowKeys.length===0||e(u).selectedRowKeys.length>1,onClick:B},{icon:s(()=>[a(d,{name:"edit",width:"16px"})]),default:s(()=>[g(" 編輯 ")]),_:1},8,["disabled"]),a(p,{status:"small2",class:"me-2",disabled:e(u).selectedRowKeys.length===0,onClick:j},{icon:s(()=>[a(d,{name:"delete",width:"16px"})]),default:s(()=>[g(" 刪除 ")]),_:1},8,["disabled"])]),a(ne,{ref_key:"filterKeywordInputRef",ref:v,modelValue:e(o).keyword,"onUpdate:modelValue":t[8]||(t[8]=n=>e(o).keyword=n),class:"w-440px h-40px",placeholder:"搜尋訊息類別、名稱和內容",onClearFilter:t[9]||(t[9]=()=>{o.value={...e(o),categoryIds:[],keyword:"",name:"",content:"",createTime:void 0,updateTime:void 0}})},{filterForm:s(()=>[a(W,{ref_key:"formRef",ref:U,layout:"vertical",model:e(o),autocomplete:"off"},{default:s(()=>[a(P,{gutter:[16,12]},{default:s(()=>[a(i,{span:24},{default:s(()=>[a(f,{id:"group",label:"訊息類別",valueed:e(ue)(e(o).categoryIds)},{default:s(()=>[a(G,{value:e(o).categoryIds,"onUpdate:value":t[2]||(t[2]=n=>e(o).categoryIds=n),options:e(k),"max-tag-count":2,"show-arrow":!0,mode:"multiple",class:"w-full","option-filter-prop":"label"},{dropdownRender:s(({menuNode:n})=>[a(z,{modelValue:e(o).categoryIds,"onUpdate:modelValue":t[1]||(t[1]=r=>e(o).categoryIds=r),menu:n,options:e(k)},null,8,["modelValue","menu","options"])]),option:s(({value:n,label:r})=>[a(H,{values:e(o).categoryIds,value:n,label:r},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24},{default:s(()=>[a(f,{label:"訊息名稱",valueed:e(o).name},{default:s(()=>[a(T,{value:e(o).name,"onUpdate:value":t[3]||(t[3]=n=>e(o).name=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24},{default:s(()=>[a(f,{label:"訊息內容",valueed:e(o).content},{default:s(()=>[a(T,{value:e(o).content,"onUpdate:value":t[4]||(t[4]=n=>e(o).content=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24},{default:s(()=>[a(f,{label:"建立時間",valueed:e(o).createTime},{default:s(()=>[a(h,{value:e(o).createTime,"onUpdate:value":t[5]||(t[5]=n=>e(o).createTime=n),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24},{default:s(()=>[a(f,{label:"修改時間",valueed:e(o).updateTime},{default:s(()=>[a(h,{value:e(o).updateTime,"onUpdate:value":t[6]||(t[6]=n=>e(o).updateTime=n),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(i,{span:24,class:"text-center"},{default:s(()=>[a(p,{status:"small2",class:"me-5",onClick:t[7]||(t[7]=n=>{var r;return(r=e(v))==null?void 0:r.hide()})},{default:s(()=>[g(" 取消 ")]),_:1}),a(p,{status:"small1",onClick:L},{default:s(()=>[g(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(X,{"data-source":e(C),columns:V,"show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(u).selectedRowKeys,onChange:N},pagination:{...e(c)},onChange:$},{bodyCell:s(({column:n,text:r})=>[n.dataIndex==="content"?(w(),Y("div",he,ye(r),1)):K("",!0)]),_:1},8,["data-source","row-selection","pagination"]),a(A,{open:e(m),"onUpdate:open":t[10]||(t[10]=n=>ve(m)?m.value=n:null),title:"是否刪除選取的自訂訊息？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:q},{default:s(()=>[Ye]),_:1},8,["open"])],64)}}});export{je as _};

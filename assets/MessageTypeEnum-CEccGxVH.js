import{_ as le}from"./index.vuevuetypescriptsetuptruelang-VFk3n9QQ.js";import{d as V,K as oe,c as W,u as t,W as g,_ as T,a7 as X,a9 as ie,$ as d,Q as ce,ai as pe,aj as re,ab as de,f as j,X as O,Y as s,G as y,a3 as N,k as c,F as A,a4 as w,r as M,m as E,A as G,H}from"./vue-BMMYOVpY.js";import{$ as Q,N as ue,a0 as me,y as fe,T as ge,z as _e}from"./antd-DcYYAuBl.js";import{_ as Y}from"./index.vuevuetypescriptsetuptruelang-CxDHX7AS.js";import{_ as q}from"./index-R-qz9I0f.js";const xe=V({name:"TLiteTable",extends:Q,inheritAttrs:!1,__name:"index",setup(a){const _=oe(),x=W(()=>({...t(_)}));return(k,v)=>(g(),T(t(Q),de({class:"t-lite-table"},{...k.$props,...t(x),pagination:!1}),X({_:2},[ie(Object.keys(k.$slots),m=>({name:m,fn:d(l=>[ce(k.$slots,m,pe(re(l||{})))])}))]),1040))}}),ve=s("span",{class:"text-red-500"},"*",-1),ye=["accept"],he={for:"fileInput",class:"flex flex-col items-center justify-center h-full text-sms-grayscale-80 text-sm"},be=s("p",{class:""}," 拖曳圖片至此 ",-1),ke=s("p",{class:""}," 拖曳影音至此 ",-1),we=V({name:"DropFile",__name:"index",props:{uploadType:{type:String,default:"image"}},emits:["changeFile"],setup(a,{emit:_}){const x=a,k=_,v=[".jpg",".jpeg",".png",".gif"],m=[".mp4",".mp3"],l=j(),$=j(!1);function p(f){const b=f.target.files;b&&b.length>0&&l.value&&(k("changeFile",b),l.value.value="")}function i(f){f.preventDefault(),$.value=!0}function z(){$.value=!1}function S(f){var h,b;if(f.preventDefault(),l.value&&((h=f==null?void 0:f.dataTransfer)!=null&&h.files)){const C=[];for(const I of f.dataTransfer.files){const o=(b=I.name)==null?void 0:b.split(".").pop();x.uploadType==="image"?v.includes(`.${o}`)&&C.push(I):m.includes(`.${o}`)&&C.push(I)}C.length>0&&k("changeFile",C)}$.value=!1}return(f,h)=>{const b=q,C=Y;return g(),O(A,null,[s("label",null,[y(N(a.uploadType==="image"?"上傳檔案":"上傳影音")+" ",1),ve]),s("div",{class:"dropzone-container",onDragover:i,onDragleave:z,onDrop:S},[s("input",{id:"fileInput",ref_key:"file",ref:l,type:"file",name:"file",class:"hidden",accept:a.uploadType==="image"?v.join(","):m.join(","),onChange:p},null,40,ye),s("div",he,[c(b,{name:"upload-circle",width:"40px",class:"block mb-4",color:"var(--grayscale-40)"}),a.uploadType==="image"?(g(),O(A,{key:0},[be,s("p",null,[y(" 或點擊"),c(C,{class:"mx-2",onClick:h[0]||(h[0]=I=>{var o;return(o=t(l))==null?void 0:o.click()})},{default:d(()=>[y(" 開啟資料夾 ")]),_:1}),y("選擇圖片 ")])],64)):w("",!0),a.uploadType==="video"?(g(),O(A,{key:1},[ke,s("p",null,[y(" 或點擊"),c(C,{class:"mx-2",onClick:h[1]||(h[1]=I=>{var o;return(o=t(l))==null?void 0:o.click()})},{default:d(()=>[y(" 開啟資料夾 ")]),_:1}),y("選擇影音 ")])],64)):w("",!0)])],32)],64)}}});function Ce(a){let _,x;return v=>({draggable:!0,ondrag(){_=v},ondrop(){x=v},ondragend(){if(_&&x&&_!==x){const m=a.indexOf(_),l=a.indexOf(x);[a[m],a[l]]=[a[l],a[m]],_=void 0,x=void 0}},ondragover(){return!1}})}const $e={class:"px-20px pb-24px"},Ie={class:"text-sms-grayscale-80 font-400 text-base text-center"},Fe=s("br",null,null,-1),ze={class:"text-sms-primary-blue-80 font-700"},De={class:"text-sms-primary-blue-80 font-700"},Te={class:"text-sms-primary-blue-80 font-700"},je={class:"text-sms-status-alert-red text-sm font-400 text-center mt-4"},Oe=s("p",{class:"text-sms-grayscale-80 font-400 text-base"}," 可上傳 2 張圖片，格式為 jpg、png、gif ",-1),Se=s("p",{class:"text-sms-grayscale-80 font-400 text-base"}," 可上傳 1 個影音，格式為 mp4、mp3 ",-1),Me={key:1,class:"h-auto"},Ne=s("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 刪除的檔案將無法復原 ",-1),Ae={key:0,class:"text-center py-40px w-523px h-auto text-base mx-auto"},Pe=V({__name:"multimedia-upload-modal",emits:["updateMultimediaFile"],setup(a,{expose:_,emit:x}){const k=x;function v(n){return n===0?"0KB":`${Number.parseFloat((n/1024**1).toFixed(0))}KB`}const m=j("image"),l=j(!1),$=j([]),p=M([]),i=M([]),z=j(!1),S=W(()=>{let n=i.reduce((e,r)=>e+(r==null?void 0:r.size),0);return n=p.reduce((e,r)=>e+(r==null?void 0:r.size),n),n});function f(n){for(const e of n)i.push({key:i.length+1,fileName:e.name,size:e.size,fileSize:v(e.size),file:e,type:"image",url:URL.createObjectURL(e)})}function h(n){if(n.length>0){const e=n[0];p.push({key:p.length+1,fileName:e.name,size:e.size,fileSize:v(e.size),file:e,type:"video",url:URL.createObjectURL(e)})}}function b(n){$.value=n,i.length=0;const e=Object.assign([],n.filter(F=>F.type==="image"));i.push(...e),p.length=0;const r=Object.assign([],n.filter(F=>F.type==="video"));p.push(...r),l.value=!0}const I=[{title:"拖曳順序",dataIndex:"drop",key:"drop",width:"80px",customCell:Ce(i)},{title:"檔案名稱",dataIndex:"fileName",key:"fileName",width:"200px",ellipsis:!0},{title:"檔案大小",dataIndex:"fileSize",key:"fileSize",width:"80px"},{title:"預覽",dataIndex:"preview",key:"preview",width:"60px"},{title:"刪除",dataIndex:"del",key:"del",width:"60px"}],o=M({open:!1,type:"image",index:0,delAll:!1});function B(n,e,r){Object.assign(o,{open:!0,type:e,delAll:n,index:r})}function J(){o.delAll?(i.length=0,p.length=0,L()):o.type==="image"?i.splice(o.index,1):p.splice(o.index,1),o.open=!1}function Z(n){n.stopImmediatePropagation(),i.length>0||p.length>0?B(!0):l.value=!1}function L(){if(z.value=!1,Number.parseInt(v(S.value).replace("KB",""))>300){z.value=!0;return}k("updateMultimediaFile",t(i).concat(t(p))),l.value=!1}const D=M({open:!1,file:void 0});return _({show:b}),(n,e)=>{const r=we,F=q,K=Y,ee=xe,R=fe,P=le,te=ge,U=_e;return g(),O(A,null,[c(U,{open:t(l),"onUpdate:open":e[2]||(e[2]=u=>H(l)?l.value=u:null),title:"多媒體附件上傳",centered:"",width:"600px","cancel-text":"取消","ok-text":"確定",onOk:L,onCancel:e[3]||(e[3]=u=>{z.value=!1,$.value=[]})},X({default:d(()=>[s("div",$e,[s("div",Ie,[y(" 請注意，MMS 多媒體附件 (圖片檔/影音檔)，總大小不可超過 300KB "),Fe,y(" 目前已上傳 "),s("span",ze,N(t(i).length),1),y(" 個圖片檔、"),s("span",De,N(t(p).length),1),y(" 個影音檔，共 "),s("span",Te,N(v(t(S))),1)]),E(s("div",je," 超過 300KB 上限，請修正 ",512),[[G,t(z)]])]),c(te,{activeKey:t(m),"onUpdate:activeKey":e[1]||(e[1]=u=>H(m)?m.value=u:null),type:"card","destroy-inactive-tab-pane":!0,class:"full-border-tab last-child-rounded"},{default:d(()=>[c(R,{key:"image",tab:"圖片"},{default:d(()=>[Oe,t(i).length<2?(g(),T(r,{key:0,"upload-type":"image",onChangeFile:f})):w("",!0),E(c(ee,{columns:I,"data-source":t(i)},{bodyCell:d(({column:u,index:ne,record:se})=>[u.dataIndex==="drop"?(g(),T(K,{key:0,status:"small3"},{icon:d(()=>[c(F,{name:"menu",class:"text-sms-grayscale-100",width:"16px"})]),_:1})):w("",!0),u.dataIndex==="preview"?(g(),T(K,{key:1,status:"small3",onClick:ae=>{t(D).file=se,t(D).open=!0}},{icon:d(()=>[c(F,{name:"preview-blue",class:"text-sms-primary-blue-80"})]),_:2},1032,["onClick"])):w("",!0),u.dataIndex==="del"?(g(),T(K,{key:2,status:"small3",onClick:ae=>B(!1,"image",ne)},{icon:d(()=>[c(F,{name:"del-blue",class:"text-sms-primary-blue-80"})]),_:2},1032,["onClick"])):w("",!0)]),_:1},8,["data-source"]),[[G,t(i).length>0]])]),_:1},8,["tab"]),c(R,{key:"video",tab:"影音"},{default:d(()=>[Se,t(p).length<1?(g(),T(r,{key:0,"upload-type":"video",onChangeFile:h})):w("",!0),t(p).length>0?(g(),O("div",Me,[c(P,{source:t(p)[0],onDeleteVideo:e[0]||(e[0]=u=>B(!1,"video",0))},null,8,["source"])])):w("",!0)]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),_:2},[t(ue)(t($))?{name:"closeIcon",fn:d(()=>[c(t(me),{class:"ant-modal-close-icon text-black",onClick:Z})]),key:"0"}:void 0]),1032,["open"]),c(U,{open:t(o).open,"onUpdate:open":e[4]||(e[4]=u=>t(o).open=u),title:t(o).delAll?"是否刪除所有已上傳的檔案？":"是否刪除已上傳的檔案？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onOk:J},{default:d(()=>[Ne]),_:1},8,["open","title"]),c(U,{open:t(D).open,"onUpdate:open":e[5]||(e[5]=u=>t(D).open=u),title:" ",centered:"",footer:null,width:"960px"},{default:d(()=>[t(D).file?(g(),O("div",Ae,[c(P,{source:t(D).file,"show-del-btn":!1,"image-class":"h-auto w-auto max-w-full"},null,8,["source"])])):w("",!0)]),_:1},8,["open"])],64)}}});var Be=(a=>(a.SMS="SMS",a.MMS="MMS",a))(Be||{});export{Be as M,xe as _,Pe as a};

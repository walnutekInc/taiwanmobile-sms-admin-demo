import{_ as z}from"./index.vuevuetypescriptsetuptruelang-BMFucJOA.js";import{_ as K}from"./index.vuevuetypestyleindex0lang-CcFzt3O-.js";import{_ as U}from"./index-8mjf59gM.js";import{_ as Q}from"./index.vuevuetypescriptsetuptruelang-DAISk7I9.js";import{n as S,q as $,p as k,Q as R,X as L,K as W,x as Y,I as J}from"./antd-CeareF1k.js";import{g as h}from"./tools-DInPKiE1.js";import{u as Z}from"./route-leave-BRmEWCXZ.js";import{d as ee,f as te,r as P,o as se,w as ie,W as o,_ as x,$ as p,Y as r,k as l,u as t,X as d,F as g,a6 as v,a4 as _,G as N}from"./vue-BtcszhJV.js";import"./context-CcXFEK-B.js";import"./index.vuevuetypestyleindex0lang-l354ccN2.js";const ae=[{key:"0",serviceName:"SMS",service:"sms",description:"簡訊服務",unit:"1",unitName:"單則",price:1.2},{key:"1",serviceName:"MMS",service:"mms",description:"多媒體訊息服務",unit:"1",unitName:"單則",price:3},{key:"2",serviceName:"AI 文案生成",service:"aiCopywritingGen",description:"-",unit:"2",unitName:"單次",price:5}];function ne(){return{serviceOption:[{label:"SMS",value:"sms"},{label:"MMS",value:"mms"},{label:"AI 文案生成",value:"aiCopywritingGen"},{label:"AI 素材生成",value:"aiMaterialGen"}],getServicesPriceSettingList:async()=>S(ae),unitOption:[{label:"單則",value:"1"},{label:"單次",value:"2"}]}}const oe={class:"px-2 items-center py-4 bg-sms-grayscale-0 rounded-12px"},ce={class:"me-1"},re={href:"javascript:;"},le=r("span",null,"50字以內",-1),pe={class:"me-1"},ue=r("span",{class:"text-sms-status-alert-red"},"*",-1),de={href:"javascript:;"},me=r("span",null,"限制輸入數字，最多 5 位數(含小數後兩位)",-1),_e={key:2,class:"me-1"},ve=r("span",{class:"text-sms-status-alert-red"},"*",-1),ye={key:0,class:"editable-cell-wrapper flex-col !items-start"},ge={class:"text-sms-status-alert-red text-xs"},fe={key:1,class:"editable-cell-wrapper"},ke={key:2,class:"editable-cell-wrapper flex-col !items-start"},he={class:"text-sms-status-alert-red text-xs"},xe={key:3},Ne={class:"text-sms-status-alert-red text-xs"},be={class:"mt-4"},je=ee({__name:"index",setup(j){const{setHideAlert:I,setShowAlert:b}=Z("是否不儲存變更？","離開此頁後未存檔的編輯會直接刪除"),y=te([]),{getServicesPriceSettingList:D,unitOption:E,serviceOption:F}=ne(),A=[{title:"服務內容",dataIndex:"serviceName",key:"serviceName",width:257},{title:"服務說明",dataIndex:"description",key:"description",width:200},{title:"計價單位",dataIndex:"unitName",key:"unitName",width:120},{title:"預設價格",dataIndex:"price",key:"price",width:257,align:"right",customHeaderCell:()=>({class:"[&>*]:!justify-center"})},{title:"操作",dataIndex:"action",key:"action",width:66,fixed:"right"}],e=P({});se(()=>{B()});async function B(){y.value=await D()}const G=P({serviceMsg:"",unitMsg:"",priceMsg:""});function V(i){e[i]=Object.assign(S(y.value.filter(n=>i===n.key)[0]),S(G)),b()}function T(i){let n=!0;L(e[i].service)&&(n=!1,e[i].serviceMsg="請選擇服務內容"),L(e[i].unit)&&(n=!1,e[i].unitMsg="請選擇計價單位");const a=Number.parseFloat(e[i].price);(a===0||Number.isNaN(a))&&(n=!1,e[i].priceMsg="請輸入預設價格"),n&&(Object.assign(y.value.filter(u=>i===u.key)[0],{...e[i],price:Number(e[i].price)}),delete e[i])}function q(){const i=Math.random().toString(36).slice(2),n={serviceMsg:"",unitMsg:"",priceMsg:"",key:i,serviceName:"",service:void 0,description:"",unit:void 0,unitName:"",price:"",isNew:!0};e[i]=n,y.value.push(n)}return ie(()=>e,()=>{let i=!1;for(const[n,a]of Object.entries(e))if(a.isNew){if(!$(a.service)||!$(a.unit)||!k(a.price)){i=!0;break}}else{const u=y.value.find(f=>f.key===n);if(console.log(Number.parseFloat(a.price)),u&&!R({service:a.service,description:a.description,unit:a.unit,price:Number.parseFloat(a.price)},{service:u.service,description:u.description,unit:u.unit,price:u.price})){i=!0;break}}i?b():I()},{deep:!0}),(i,n)=>{const a=U,u=W,f=Y,C=J,M=Q,O=U,H=K,X=z;return o(),x(X,{title:"預期價格管理"},{default:p(()=>[r("div",oe,[l(H,{"data-source":t(y),columns:A,size:"small","show-sorter-tooltip":!1},{headerCell:p(({column:c})=>[c.key==="description"?(o(),d(g,{key:0},[r("span",ce,v(c.title),1),l(u,{placement:"top","get-popup-container":t(h)},{title:p(()=>[le]),default:p(()=>[r("a",re,[l(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])],64)):_("",!0),c.key==="price"?(o(),d(g,{key:1},[r("span",pe,[N(v(c.title)+" ",1),ue]),l(u,{placement:"top","get-popup-container":t(h)},{title:p(()=>[me]),default:p(()=>[r("a",de,[l(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])],64)):_("",!0),c.key==="serviceName"||c.key==="unitName"?(o(),d("span",_e,[N(v(c.title)+" ",1),ve])):_("",!0)]),bodyCell:p(({column:c,record:s,text:w})=>[c.dataIndex==="serviceName"&&t(e)[s.key]?(o(),d("div",ye,[l(f,{value:t(e)[s.key].service,"onUpdate:value":m=>t(e)[s.key].service=m,options:t(F),"get-popup-container":t(h),placeholder:"請選擇",status:t(e)[s.key].serviceMsg&&!t(k)(t(e)[s.key].serviceMsg)?"error":""},null,8,["value","onUpdate:value","options","get-popup-container","status"]),r("span",ge,v(t(e)[s.key].serviceMsg),1)])):_("",!0),c.dataIndex==="description"&&t(e)[s.key]?(o(),d("div",fe,[t(e)[s.key]?(o(),x(C,{key:0,value:t(e)[s.key].description,"onUpdate:value":m=>t(e)[s.key].description=m,placeholder:"請輸入",class:"[&>*>.ant-input]:!text-end"},null,8,["value","onUpdate:value"])):_("",!0)])):_("",!0),c.dataIndex==="unitName"&&t(e)[s.key]?(o(),d("div",ke,[l(f,{value:t(e)[s.key].unit,"onUpdate:value":m=>t(e)[s.key].unit=m,options:t(E),"get-popup-container":t(h),placeholder:"請選擇",status:t(e)[s.key].unitMsg&&!t(k)(t(e)[s.key].unitMsg)?"error":""},null,8,["value","onUpdate:value","options","get-popup-container","status"]),r("span",he,v(t(e)[s.key].unitMsg),1)])):_("",!0),c.dataIndex==="price"?(o(),d("div",xe,[t(e)[s.key]?(o(),d(g,{key:0},[l(C,{value:t(e)[s.key].price,"onUpdate:value":m=>t(e)[s.key].price=m,placeholder:"請輸入",type:"number",class:"[&>*>.ant-input]:!text-end","addon-before":"NT$",status:t(e)[s.key].priceMsg&&!t(k)(t(e)[s.key].priceMsg)?"error":""},null,8,["value","onUpdate:value","status"]),r("span",Ne,v(t(e)[s.key].priceMsg),1)],64)):(o(),d(g,{key:1},[N(" NT$"+v(w==null?void 0:w.toLocaleString(void 0,{minimumFractionDigits:2})),1)],64))])):_("",!0),c.dataIndex==="action"?(o(),d(g,{key:4},[t(e)[s.key]?(o(),x(M,{key:0,status:"small3",class:"!px-0",onClick:m=>T(s.key)},{default:p(()=>[l(a,{name:"save",class:"text-sms-primary-blue-80"})]),_:2},1032,["onClick"])):(o(),x(M,{key:1,status:"small3",class:"!px-0",onClick:m=>V(s.key)},{default:p(()=>[l(O,{class:"text-sms-primary-blue-80",name:"edit"})]),_:2},1032,["onClick"]))],64)):_("",!0)]),_:1},8,["data-source"])]),r("div",be,[l(M,{onClick:n[0]||(n[0]=()=>q())},{icon:p(()=>[l(O,{name:"plus"})]),default:p(()=>[N(" 新增預設價格 ")]),_:1})])]),_:1})}}});export{je as default};

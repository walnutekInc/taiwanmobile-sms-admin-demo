import{_ as be}from"./index.vuevuetypescriptsetuptruelang-Co1Xu5B8.js";import{M as c,u as he,_ as Ce}from"./message-sending-D_xQdZ45.js";import{_ as Te}from"./index.vuevuetypestyleindex0lang-Dl2df6kz.js";import{j as Ne,_ as L}from"./index-D5CWLnaZ.js";import{_ as Pe,a as Re}from"./index.vuevuetypescriptsetuptruelang-rMLMTN1J.js";import{_ as De}from"./index-YVO_qen6.js";import{_ as Ie}from"./index.vuevuetypescriptsetuptruelang-CICFdqya.js";import{Q as Ae,O as Ge,E as h,N as C,K as z,V as W,I as Ye,p as $e,q as Fe,G as Ee,s as Ke,F as Oe,H as Ve,r as je,z as Ue}from"./antd-Dpsol0oo.js";import{i as He}from"./isToday-CxuES7r1.js";import{u as Be,_ as Le}from"./request-BZM3Cngs.js";import{a as ze,b as q}from"./tools-DuR4KSGu.js";import{d as We,f as T,ad as qe,D as Qe,r as Xe,u as e,W as f,_ as Q,$ as l,Y as p,k as s,G as M,X as g,F,a3 as N,a4 as D,H as Je}from"./vue-BvWPEeCa.js";import"./context-fkMRc5e1.js";import"./index.vuevuetypescriptsetuptruelang-BRBDRwqm.js";import"./index.vuevuetypescriptsetuptruelang-mDdRgW1s.js";const X=[{key:"1",sendNumber:"4238179212",name:"促銷活動",reservationTime:"2024/07/10 12:22",messageStatus:"SMS_General",messageStatusName:c.SMS_General,status:"預約中",reservationCount:"218"},{key:"2",sendNumber:"2047534772",name:"生日活動",reservationTime:"2024/07/22 14:30",messageStatus:"MMS_General",messageStatusName:c.MMS_General,status:"預約中",reservationCount:"1,297"},{key:"3",sendNumber:"6734774231",name:"來店體驗",reservationTime:"2024/08/08 09:00",messageStatus:"MMS_Parameter",messageStatusName:c.MMS_Parameter,status:"預約中",reservationCount:"638"},{key:"4",sendNumber:"6473568820",name:"20241028_14:20",reservationTime:"2024/08/12 00:00",messageStatus:"MMS_Parameter",messageStatusName:c.MMS_Parameter,status:"預約中",reservationCount:"88"},{key:"5",sendNumber:"1241629349",name:"週年大慶典週年大慶典週年大慶典週年大慶典週年大慶典週年大慶典",reservationTime:"2024/09/09 10:00",messageStatus:"SMS_General",messageStatusName:c.SMS_General,status:"預約中",reservationCount:"840"},{key:"6",sendNumber:"6794384937",name:"8月生日",reservationTime:"2024/09/23 17:00",messageStatus:"SMS_Parameter",messageStatusName:c.SMS_Parameter,status:"預約中",reservationCount:"243"},{key:"7",sendNumber:"2043574512",name:"6月生日",reservationTime:"2024/10/01 12:00",messageStatus:"MMS_Parameter",messageStatusName:c.MMS_Parameter,status:"預約中",reservationCount:"2,839"},{key:"8",sendNumber:"7840304979",name:"加倍促銷",reservationTime:"2024/10/10 12:00",messageStatus:"MMS_General",messageStatusName:c.MMS_General,status:"預約中",reservationCount:"674"},{key:"9",sendNumber:"6459293927",name:"限時促銷",reservationTime:"2024/10/31 20:30",messageStatus:"MMS_Parameter",messageStatusName:c.MMS_Parameter,status:"預約中",reservationCount:"674"},{key:"10",sendNumber:"4638049869",name:"獨享好禮",reservationTime:"2024/11/11 11:11",messageStatus:"MMS_Parameter",messageStatusName:c.MMS_Parameter,status:"預約中",reservationCount:"43,048"},{key:"11",sendNumber:"5384279741",name:"端午節南北粽戰爭",reservationTime:"2024/11/25 07:30",messageStatus:"MMS_General",messageStatusName:c.MMS_General,status:"預約中",reservationCount:"8,452"}];function Ze(){const{list:E,pagination:I,setResponseList:y}=Be();return{getAppointments:async v=>{y({total:11,pages:1,current:1,pageSize:10,records:X})},appointments:E,pagination:I,checkAppointmentNameExist:async(v,w)=>{const o=Ae(X,{name:v});return o?!(!Ge(w)&&o.key===w):!1},updateAppointmentData:async(v,w)=>({data:{status:"success"}}),deleteAppointment:async v=>({data:{status:"success"}})}}const et={class:"flex justify-between px-2 items-center py-4 bg-sms-grayscale-0 rounded-t-12px"},tt={class:"me-1"},st={href:"javascript:;"},at=p("span",null,"為預約當下的接收門號總數扣除黑名單門號總數，實際發送時會重新計算有效發送筆數",-1),nt={key:0},ot={class:"editable-cell-wrapper"},it={class:"text-sms-status-alert-red text-xs"},lt={key:1,class:"editable-cell-wrapper"},rt={key:0},mt={class:"editable-cell-wrapper"},ut={class:"text-sms-status-alert-red text-xs"},dt={key:1,class:"editable-cell-wrapper"},ct=p("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 您選擇的預約訊息將永久刪除。 ",-1),Nt=We({__name:"index",setup(E){h.extend(He);const{getAppointments:I,appointments:y,pagination:P,checkAppointmentNameExist:K,updateAppointmentData:A,deleteAppointment:O}=Ze(),{renderGeneralMessagePreviewArray:v,renderParameterMessagePreviewArray:w}=he(),o=T(),J=qe();Qe(async()=>{R()});const G=Ne(),Z=[{title:"發送編號",dataIndex:"sendNumber",key:"sendNumber",sorter:!0,width:"91px"},{title:"活動名稱",dataIndex:"name",key:"name",sorter:!0,width:"304px"},{title:"預約時間",dataIndex:"reservationTime",key:"reservationTime",sorter:!0,width:"200px"},{title:"訊息類型",dataIndex:"messageStatusName",key:"messageStatusName",sorter:!0,width:"140px"},{title:"狀態",dataIndex:"status",key:"status",width:"98px"},{title:"預約筆數",dataIndex:"reservationCount",key:"reservationCount",sorter:!0,width:"111px"},{title:"預覽",dataIndex:"preview",key:"preview",width:"72px"}],d=Xe({selectedRowKeys:[],selectedRows:[],loading:!1});function ee(n,t){console.log("selectedRowKeys changed: ",n,t),d.selectedRowKeys=n,d.selectedRows=t}const V=Object.entries(c).map(([n,t])=>({label:t,value:n})),m=T({sortField:"createTime",sortOrder:"descend",messageStatus:[],reservationTimes:void 0,name:"",keyword:""});async function R(n=1,t=10){const a={current:n,pageSize:t,...e(m)};await I(a)}async function te(n,t,a){console.log("sorter:",a),m.value=Object.assign(m.value,{sortField:a.field,sortOrder:a.order}),await R(P.value.current,P.value.pageSize)}async function se(n,t){await R(n,t)}function j(n,t){o.value={...z(y.value.filter(a=>n===a.key)[0]),msg:"",editColumn:t}}async function Y(n){var t,a;if(o.value){const i=e(o);if((i==null?void 0:i.editColumn)==="name"){if(C(i.name)){o.value.msg="請輸入活動名稱";return}await K(i.name,i.key)?o.value.msg=`系統中已有「${i.name}」，請勿重複新增`:((t=(await A(i.key,{name:i.name})).data)==null?void 0:t.status)==="success"&&(Object.assign(y.value.filter(k=>n===k.key)[0],i),o.value=void 0,G.success({message:"訊息編輯成功",placement:"top"}))}else(i==null?void 0:i.editColumn)==="reservationTime"&&(C(i.reservationTime)?o.value.msg="請選擇預約日期":h().diff(h(i.reservationTime),"minute")>0&&(o.value.msg="閒置過久，請重新選擇預約時間"),C(o.value.msg)&&((a=(await A(i.key,{reservationTime:i.reservationTime})).data)==null?void 0:a.status)==="success"&&(Object.assign(y.value.filter(S=>n===S.key)[0],i),o.value=void 0,G.success({message:"訊息編輯成功",placement:"top"})))}}const $=T(null);function ae(){var n;R(1),(n=$.value)==null||n.hide()}function ne(){d.selectedRows.length===1&&J.push({name:d.selectedRows[0].messageStatus==="MMS_General"||d.selectedRows[0].messageStatus==="SMS_General"?"MessageSendingGeneralEdit":"MessageSendingParameterEdit",params:{id:d.selectedRowKeys[0]}})}const x=T(!1);function oe(){x.value=!0}async function ie(){var t;((t=(await O(d.selectedRowKeys)).data)==null?void 0:t.status)==="success"&&(G.success({message:"訊息刪除成功",placement:"top"}),x.value=!1,d.selectedRowKeys=[],d.selectedRows=[])}const U=h();function le(n){const t=U.add(1,"year");return n&&(n<U||n>=t)}function re(n){if(n&&n.isToday()){const t=h().add(5,"minute"),a=t.hour(),i=t.minute();return{disabledHours:()=>W(0,24).slice(0,a),disabledMinutes:()=>W(0,60).slice(0,i)}}return{}}const H=T(null),me={name:"季末大促銷季末大促銷季末大促銷季末大促銷季末大促銷季末大促銷",messageType:"MMS",phone:"0961-238-888",content:"愛戀情人節，獨家驚喜等您發現！ 情人節將至，愛戀之情將再次升華！我們特別為您準備了一場浪漫的情人節限定活動，帶來一系列獨家驚喜等您發現。無論您是想要為您的另一半挑選一份特別的禮物，還是希望一起度過浪漫的夜晚，我們都有豐富的選擇和活動等待著您。讓我們一同創造美好的回憶，共度這個充滿愛意的情人節！",subject:"",sendTimeType:"RESERVATION",effectiveTime:"",reservationTime:""};function ue(n){var i;let t,a={...z(me),name:n.name,reservationTime:n.reservationTime};a&&(n.messageStatus==="MMS_General"?(a={...a,messageType:"MMS",subject:"測試",recipients:{contactPerson:["1","2"],group:[{id:"1",label:"群組A"}],manual:"0912345678,0912345678",file:void 0},multimediaFile:[]},t=v(a)):n.messageStatus==="SMS_General"?(a={...a,messageType:"SMS",recipients:{contactPerson:["1","2"],group:[{id:"1",label:"群組A"}],manual:"0912345678,0912345678",file:void 0},multimediaFile:[]},t=v(a)):(a={...a,messageType:"SMS",file:{fileName:"test.xlsx",url:""},multimediaFile:[],isCommonContent:!0,multimediaFileWithSubject:[],recipients:[{number:"1",phone:"0938118293",field1:"小馬",field2:"9412918",field3:"-",field4:"-",field5:"-"},{number:"2",phone:"0946184761",field1:"安潔",field2:"5439577",field3:"-",field4:"-",field5:"-"},{number:"3",phone:"0966092938",field1:"Lucy",field2:"5634840",field3:"-",field4:"-",field5:"-"},{number:"4",phone:"0956482371",field1:"Sam",field2:"3437402",field3:"-",field4:"-",field5:"-"},{number:"5",phone:"0978049940",field1:"Tim",field2:"8480277",field3:"-",field4:"-",field5:"-"}]},t=w(a))),(i=H.value)==null||i.show(t)}return(n,t)=>{const a=L,i=Ie,b=Ye,S=De,k=$e,de=Pe,ce=Re,pe=Fe,_e=Ee,fe=Ke,ve=Oe,ge=Ve,ye=je,Se=L,ke=Te,Me=Ue,we=Ce,xe=be;return f(),Q(xe,{title:"預約管理"},{default:l(()=>[p("div",et,[p("div",null,[s(i,{status:"small2",class:"me-2",disabled:e(d).selectedRowKeys.length===0||e(d).selectedRowKeys.length>1,onClick:ne},{icon:l(()=>[s(a,{name:"edit",width:"16px"})]),default:l(()=>[M(" 編輯 ")]),_:1},8,["disabled"]),s(i,{status:"small2",class:"me-2",disabled:e(d).selectedRowKeys.length===0,onClick:oe},{icon:l(()=>[s(a,{name:"delete",width:"16px"})]),default:l(()=>[M(" 刪除 ")]),_:1},8,["disabled"])]),s(Le,{ref_key:"filterKeywordInputRef",ref:$,modelValue:e(m).keyword,"onUpdate:modelValue":t[5]||(t[5]=r=>e(m).keyword=r),class:"w-440px h-40px",placeholder:"搜尋活動名稱",onClearFilter:t[6]||(t[6]=()=>{m.value={...e(m),keyword:"",name:"",messageStatus:[],reservationTimes:void 0}})},{filterForm:l(()=>[s(ve,{layout:"vertical",model:e(m),autocomplete:"off"},{default:l(()=>[s(fe,{gutter:[16,12]},{default:l(()=>[s(k,{span:24},{default:l(()=>[s(S,{label:"活動名稱",valueed:e(m).name},{default:l(()=>[s(b,{value:e(m).name,"onUpdate:value":t[0]||(t[0]=r=>e(m).name=r)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),s(k,{span:24},{default:l(()=>[s(S,{label:"訊息類型",valueed:e(ze)(e(m).messageStatus)},{default:l(()=>[s(pe,{value:e(m).messageStatus,"onUpdate:value":t[2]||(t[2]=r=>e(m).messageStatus=r),options:e(V),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full","menu-item-selected-icon":" "},{dropdownRender:l(({menuNode:r})=>[s(de,{modelValue:e(m).messageStatus,"onUpdate:modelValue":t[1]||(t[1]=u=>e(m).messageStatus=u),menu:r,options:e(V)},null,8,["modelValue","menu","options"])]),option:l(({value:r,label:u})=>[s(ce,{values:e(m).messageStatus,value:r,label:u},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),s(k,{span:24},{default:l(()=>[s(S,{label:"預約時間",valueed:e(m).reservationTimes},{default:l(()=>[s(_e,{value:e(m).reservationTimes,"onUpdate:value":t[3]||(t[3]=r=>e(m).reservationTimes=r),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),s(k,{span:24,class:"text-center"},{default:l(()=>[s(i,{status:"small2",class:"me-5",onClick:t[4]||(t[4]=r=>{var u;return(u=e($))==null?void 0:u.hide()})},{default:l(()=>[M(" 取消 ")]),_:1}),s(i,{status:"small1",onClick:ae},{default:l(()=>[M(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),s(ke,{"data-source":e(y),columns:Z,size:"small","show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(d).selectedRowKeys,onChange:ee},pagination:{...e(P)},onChange:te,onChangePagination:se},{headerCell:l(({column:r})=>[r.key==="reservationCount"?(f(),g(F,{key:0},[p("span",tt,N(r.title),1),s(ge,{placement:"top","get-popup-container":e(q)},{title:l(()=>[at]),default:l(()=>[p("a",st,[s(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])],64)):D("",!0)]),bodyCell:l(({column:r,record:u,text:B})=>[r.dataIndex==="name"?(f(),g(F,{key:0},[e(o)&&e(o).editColumn==="name"&&e(o).key===u.key?(f(),g("div",nt,[p("div",ot,[s(b,{value:e(o).name,"onUpdate:value":t[7]||(t[7]=_=>e(o).name=_),maxlength:30,status:e(o).msg&&!e(C)(e(o).msg)?"error":"",onPressEnter:_=>Y(u.key)},null,8,["value","status","onPressEnter"]),s(a,{name:"save",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:_=>Y(u.key)},null,8,["onClick"])]),p("span",it,N(e(o).msg),1)])):(f(),g("div",lt,[M(N(B||" ")+" ",1),s(a,{name:"edit",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:_=>j(u.key,r.dataIndex)},null,8,["onClick"])]))],64)):D("",!0),r.dataIndex==="reservationTime"?(f(),g(F,{key:1},[e(o)&&e(o).editColumn==="reservationTime"&&e(o).key===u.key?(f(),g("div",rt,[p("div",mt,[s(ye,{value:e(o).reservationTime,"onUpdate:value":t[8]||(t[8]=_=>e(o).reservationTime=_),format:"YYYY/MM/DD HH:mm","value-format":"YYYY/MM/DD HH:mm","disabled-date":le,"disabled-time":re,"show-time":!0,"show-now":!1,status:e(o).msg&&!e(C)(e(o).msg)?"error":"","get-popup-container":e(q),placeholder:""},null,8,["value","status","get-popup-container"]),s(a,{name:"save",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:_=>Y(u.key)},null,8,["onClick"])]),p("span",ut,N(e(o).msg),1)])):(f(),g("div",dt,[M(N(B||" ")+" ",1),s(a,{name:"edit",class:"ms-1 text-sms-primary-blue-80 cursor-pointer",onClick:_=>j(u.key,r.dataIndex)},null,8,["onClick"])]))],64)):D("",!0),r.dataIndex==="preview"?(f(),Q(i,{key:2,status:"small3",onClick:_=>ue(u)},{icon:l(()=>[s(Se,{name:"preview-blue"})]),_:2},1032,["onClick"])):D("",!0)]),_:1},8,["data-source","row-selection","pagination"]),s(Me,{open:e(x),"onUpdate:open":t[9]||(t[9]=r=>Je(x)?x.value=r:null),title:"是否刪除選取的預約訊息？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:ie},{default:l(()=>[ct]),_:1},8,["open"]),s(we,{ref_key:"fullPhonePreviewModalRef",ref:H},null,512)]),_:1})}}});export{Nt as default};

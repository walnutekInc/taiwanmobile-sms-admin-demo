import{_ as Ce}from"./index.vuevuetypescriptsetuptruelang-D1-Fqvfd.js";import{i as Ie,_ as Ve}from"./isSameOrBefore-DIA4IhwF.js";import{_ as ae,a as Oe}from"./MessageTypeEnum-DNFQ6lOj.js";import{_ as Ne,a as Ue}from"./request-DwxIs7Uf.js";import{j as $e,_ as Fe}from"./index-D8HSlZzh.js";import{_ as Ye}from"./index.vuevuetypescriptsetuptruelang-CXg0iFgk.js";import{_ as De,a as Pe}from"./index.vuevuetypescriptsetuptruelang-DeIfKSvi.js";import{_ as Ae}from"./index-CPdFQkXy.js";import{i as Be}from"./isToday-DmLvfIEi.js";import{z as de,E as N,q as je,p as Le,I as ze,G as Ge,s as He,F as Xe,H as Ke,x as qe,J as Je,o as We}from"./antd-DfxlYADO.js";import{_ as Qe,a as Ze,u as et,M as tt}from"./create-or-update-form.vuevuetypescriptsetuptruelang-CZ97Bonb.js";import{d as ue,f,ag as ce,W as r,X as g,k as t,$ as s,u as e,_ as j,H as L,F as T,Y as o,D as st,w as at,b as nt,G as c,a9 as ne,a5 as oe,a3 as _,a4 as U,y as le}from"./vue-BvWPEeCa.js";import{g as ot,a as ie,b as B}from"./tools-DuR4KSGu.js";import"./context-COdmm3L5.js";import"./index.vuevuetypescriptsetuptruelang-mDdRgW1s.js";import"./route-leave-z6MgRuNA.js";import"./index.esm-BQhGdABo.js";import"./index.vuevuetypestyleindex0lang-B-PEREiJ.js";import"./custom-message-DbOlgFhm.js";import"./contact-person-DpzIAIDc.js";import"./group-label-DSbp8rro.js";const lt=o("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 編輯的內容將不會儲存 ",-1),it=ue({__name:"message-sending-edit-modal",setup(v,{expose:l}){const x=f(!1),b=f(),V=f(!1);function $(y,m){b.value=y,V.value=m,x.value=!0}const{post:F}=ce({name:"in-message-sending-page"}),h=f(!1);function O(y,m){y?(x.value=!1,m&&F(m)):h.value=!0}return l({show:$}),(y,m)=>{const i=de;return r(),g(T,null,[t(i,{open:e(x),"onUpdate:open":m[0]||(m[0]=M=>L(x)?x.value=M:null),title:"編輯訊息行銷活動",width:"960px","destroy-on-close":!0,footer:null,"mask-closable":!1},{default:s(()=>[e(V)?(r(),j(Ze,{key:1,id:e(b),"is-create":!1,"edit-callback":O,"show-preview":!1},null,8,["id"])):(r(),j(Qe,{key:0,id:e(b),"is-create":!1,"edit-callback":O,"show-preview":!1},null,8,["id"]))]),_:1},8,["open"]),t(i,{open:e(h),"onUpdate:open":m[1]||(m[1]=M=>L(h)?h.value=M:null),title:"是否取消編輯？",width:"400px",centered:"","z-index":2e3,onOk:m[2]||(m[2]=()=>{x.value=!1,h.value=!1})},{default:s(()=>[lt]),_:1},8,["open"])],64)}}});var z=(v=>(v.RESERVATION="預約中",v.EXECUTING="執行中",v.IS_SENT="已發送",v.RESERVATION_FAILED="預約失敗",v))(z||{});const dt={class:"pt-4 flex items-center pb-3"},ut=["onClick"],ct={class:"flex flex-col gap-4"},rt={class:"flex justify-between items-center mb-2"},mt={class:"font-600 text-sm pe-2"},pt={class:"flex flex-col gap-1 justify-end items-end"},_t={class:"text-sms-grayscale-60 font-500 text-xs"},ft={class:"font-400 text-sm text-sms-grayscale-80 tracking-[0.02em] whitespace-pre-wrap line-clamp-2"},gt={class:"text-end py-4"},xt=o("br",null,null,-1),vt={key:0,class:"flex items-center pb-4"},bt={key:0,id:"chat-message-content"},ht=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 活動名稱 ",-1),yt={class:"text-base font-400 text-sms-grayscale-100"},wt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 帳號 ",-1),kt={class:"text-base font-400 text-sms-grayscale-100 break-words"},St=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送時間 ",-1),Tt={class:"text-base font-400 text-sms-grayscale-100"},Mt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送編號 ",-1),Et={class:"text-base font-400 text-sms-grayscale-100 break-words"},Rt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息類型 ",-1),Ct={class:"text-base font-400 text-sms-grayscale-100"},It=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送門號 ",-1),Vt={class:"text-base font-400 text-sms-grayscale-100"},Ot=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 接收門號明細 ",-1),Nt={class:"flex flex-col"},Ut={class:"border-t-solid border-t border-t-sms-border-light-mode-light-gary p-4 mb-2"},$t=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息內容 ",-1),Ft=["innerHTML"],Yt={key:0,class:"px-4 pb-0 h-full"},Dt=o("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 多媒體檔案 ",-1),Pt={class:"flex gap-2"},At={class:"max-h-60px mb-2"},Bt={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},jt={class:"mt-4 p-4 border-t-solid border-t border-t-sms-border-light-mode-light-gary"},Lt={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},zt={href:"javascript:;"},Gt=o("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 刪除的訊息將無法復原 ",-1),Ht={class:"px-30px py-20px w-328px text-base mx-auto"},Xt=o("span",{class:"me-2"},"訊息類型",-1),Kt={href:"javascript:;"},qt=o("br",null,null,-1),xs=ue({__name:"index",setup(v){N.extend(Be),N.extend(Ie);const l=f(),x=f(),b=f(),V=$e(),{getMessageSendings:$,messageSendings:F,pagination:h,getActiveStatusLabel:O,getMessageSending:y,messageSending:m}=et(),i=f({keyword:"",name:"",phone:void 0,sendStatus:[],messageStatus:[],sendTime:void 0});async function M(d){l.value=d,await le();const a=document.getElementById("message-content");a&&(a.scrollTop=0)}st(()=>{Y()});async function Y(d=1,a=10){const C={current:d,pageSize:a,...e(i)};await $(C)}function re(d,a){Y(d,a??10)}function me(){var d;Y(1),(d=b.value)==null||d.hide()}const pe={RESERVATION:"text-sms-yellow-60 bg-#F7F2E8",EXECUTING:"text-sms-primary-blue-80 bg-sms-primary-blue-30",IS_SENT:"text-sms-green-80 bg-sms-green-30",RESERVATION_FAILED:"text-sms-status-alert-red bg-sms-light-red-40"},E=f([]);async function _e(d,a){await le(),E.value&&E.value[a]&&(d?E.value[a].playVideo():E.value[a].pauseVideo())}const R=f(!1);function fe(){R.value=!0}function ge(){l.value=void 0,R.value=!1,V.success({message:"訊息刪除成功",placement:"top"})}const G=[{label:"0935-111-111",value:"0935-111-111"},{label:"0947-127-998",value:"0947-127-998"},{label:"0958-892-006",value:"0958-892-006"}],H=Object.entries(z).map(([d,a])=>({label:a,value:d})),X=Object.entries(tt).map(([d,a])=>({label:a,value:d})),w=f({open:!1,isParameter:!1}),K=f(null);function xe(){var d;l.value&&((d=K.value)==null||d.show(l.value.key,l.value.isParameter))}const{data:ve,close:be}=ce({name:"in-message-sending-page"});return at(ve,async d=>{await y(d),l.value=m.value}),nt(()=>{be()}),(d,a)=>{const C=je,I=Ae,p=Le,q=De,J=Pe,he=ze,ye=Ge,k=Ye,W=He,Q=Xe,we=Ne,S=Fe,ke=Ue,D=Ke,Se=Oe,Te=Ve,Z=de,ee=qe,Me=Je,Ee=We,Re=Ce;return r(),j(Re,{title:"訊息發送"},{default:s(()=>[t(Te,{"show-right-empty":!e(l)},{leftTop:s(()=>[o("div",dt,[t(we,{ref_key:"filterKeywordInputRef",ref:b,modelValue:e(i).keyword,"onUpdate:modelValue":a[8]||(a[8]=n=>e(i).keyword=n),height:"40px",class:"flex-1 me-2",placeholder:"搜尋活動名稱、訊息內容",onClearFilter:a[9]||(a[9]=()=>{i.value={...e(i),keyword:"",name:"",phone:void 0,sendStatus:[],messageStatus:[],sendTime:void 0}})},{filterForm:s(()=>[t(Q,{ref_key:"formRef",ref:x,layout:"vertical",model:e(i),autocomplete:"off"},{default:s(()=>[t(W,{gutter:[16,12]},{default:s(()=>[t(p,{span:24},{default:s(()=>[t(I,{label:"發送門號",valueed:e(ot)(e(i).phone,G)},{default:s(()=>[t(C,{value:e(i).phone,"onUpdate:value":a[0]||(a[0]=n=>e(i).phone=n),options:G,"allow-clear":"",class:"w-full"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24},{default:s(()=>[t(I,{label:"活動狀態",valueed:e(ie)(e(i).sendStatus)},{default:s(()=>[t(C,{value:e(i).sendStatus,"onUpdate:value":a[2]||(a[2]=n=>e(i).sendStatus=n),options:e(H),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full","menu-item-selected-icon":" "},{dropdownRender:s(({menuNode:n})=>[t(q,{modelValue:e(i).sendStatus,"onUpdate:modelValue":a[1]||(a[1]=u=>e(i).sendStatus=u),menu:n,options:e(H)},null,8,["modelValue","menu","options"])]),option:s(({value:n,label:u})=>[t(J,{values:e(i).sendStatus,value:n,label:u},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24},{default:s(()=>[t(I,{label:"活動名稱",valueed:e(i).name},{default:s(()=>[t(he,{value:e(i).name,"onUpdate:value":a[3]||(a[3]=n=>e(i).name=n)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24},{default:s(()=>[t(I,{label:"訊息類型",valueed:e(ie)(e(i).messageStatus)},{default:s(()=>[t(C,{value:e(i).messageStatus,"onUpdate:value":a[5]||(a[5]=n=>e(i).messageStatus=n),options:e(X),"max-tag-count":2,"show-arrow":!0,"show-search":!1,mode:"multiple",class:"w-full","menu-item-selected-icon":" "},{dropdownRender:s(({menuNode:n})=>[t(q,{modelValue:e(i).messageStatus,"onUpdate:modelValue":a[4]||(a[4]=u=>e(i).messageStatus=u),menu:n,options:e(X)},null,8,["modelValue","menu","options"])]),option:s(({value:n,label:u})=>[t(J,{values:e(i).messageStatus,value:n,label:u},null,8,["values","value","label"])]),_:1},8,["value","options"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24},{default:s(()=>[t(I,{label:"發送時間",valueed:e(i).sendTime},{default:s(()=>[t(ye,{value:e(i).sendTime,"onUpdate:value":a[6]||(a[6]=n=>e(i).sendTime=n),class:"w-full",placement:"topLeft",format:"YYYY-MM-DD","value-format":"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),t(p,{span:24,class:"text-center"},{default:s(()=>[t(k,{status:"small2",class:"me-5",onClick:a[7]||(a[7]=n=>{var u;return(u=e(b))==null?void 0:u.hide()})},{default:s(()=>[c(" 取消 ")]),_:1}),t(k,{status:"small1",onClick:me},{default:s(()=>[c(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(k,{status:"small1",onClick:a[10]||(a[10]=()=>{w.value={open:!0,isParameter:!1}})},{icon:s(()=>[t(S,{name:"plus",width:"16px"})]),default:s(()=>[c(" 新增訊息行銷活動 ")]),_:1})])]),left:s(()=>[o("ul",null,[(r(!0),g(T,null,ne(e(F),n=>{var u;return r(),g("li",{key:n.key,class:oe(["p-4 border-b-solid border-b-1 border-b-sms-light-gray-60 last:mb-2 cursor-pointer",{"bg-sms-bg-light-mode-gray":n.key===((u=e(l))==null?void 0:u.key)}]),onClick:P=>M(n)},[o("div",ct,[o("div",rt,[o("span",mt,_(n.name),1),o("div",pt,[o("span",{class:oe(["rounded-2 text-center py-1 px-2 text-xs font-500",{[pe[n.sendStatus]]:!0}])},_(e(z)[n.sendStatus]),3),o("span",_t,_(e(N)(n.sendTime).isToday()?"今天":e(N)(n.sendTime).format("YYYY/MM/DD")),1)])]),o("div",ft,_(n.content),1)])],10,ut)}),128))])]),leftBottom:s(()=>[o("div",gt,[t(ke,{pagination:e(h),onChange:re},null,8,["pagination"])])]),rightEmptyMessage:s(()=>[c(" 點擊左側行銷活動"),xt,c("檢視行銷活動資訊 ")]),rightTop:s(()=>[e(l)?(r(),g("div",vt,[t(k,{status:"small2",class:"me-2",disabled:e(l).sendStatus!=="RESERVATION",onClick:xe},{icon:s(()=>[t(S,{name:"edit",width:"16px"})]),default:s(()=>[c(" 編輯 ")]),_:1},8,["disabled"]),t(k,{status:"small2",class:"me-2",disabled:e(l).sendStatus!=="RESERVATION",onClick:fe},{icon:s(()=>[t(S,{name:"delete",width:"16px"})]),default:s(()=>[c(" 刪除預約 ")]),_:1},8,["disabled"])])):U("",!0)]),right:s(()=>[e(l)?(r(),g("div",bt,[t(W,{gutter:[16,16],class:"mb-4 px-4"},{default:s(()=>[t(p,{span:24},{default:s(()=>[ht,o("div",yt,_(e(l).name),1)]),_:1}),t(p,{span:8},{default:s(()=>[wt,o("div",kt,_(e(l).account),1)]),_:1}),t(p,{span:8},{default:s(()=>[St,o("div",Tt,_(e(l).sendTime),1)]),_:1}),t(p,{span:8},{default:s(()=>[Mt,o("div",Et,_(e(l).sendNumber),1)]),_:1}),t(p,{span:8},{default:s(()=>[Rt,o("div",Ct,_(e(O)(e(l).messageType,e(l).isParameter)),1)]),_:1}),t(p,{span:8},{default:s(()=>[It,o("div",Vt,_(e(l).phone),1)]),_:1}),t(p,{span:8},{default:s(()=>[Ot,o("div",null,[t(k,{status:"small2",class:"me-2"},{icon:s(()=>[t(S,{name:"download",width:"16px"})]),default:s(()=>[c(" 匯出 ")]),_:1})])]),_:1})]),_:1}),o("div",Nt,[o("div",Ut,[$t,o("div",{class:"break-words text-base",innerHTML:e(l).content},null,8,Ft)]),e(l).multimediaFile&&e(l).messageType==="MMS"&&e(l).multimediaFile.length>0?(r(),g("div",Yt,[Dt,o("div",Pt,[(r(!0),g(T,null,ne(e(l).multimediaFile,(n,u)=>{var P,te,se;return r(),g("div",{key:n.url,class:"w-120px"},[t(D,{placement:(P=e(l))!=null&&P.multimediaFile&&u===((se=(te=e(l))==null?void 0:te.multimediaFile)==null?void 0:se.length)-1?"topRight":"top","get-popup-container":e(B),"overlay-inner-style":{width:"384px",height:"304px"},arrow:"center",onOpenChange:A=>_e(A,u)},{title:s(()=>[t(ae,{ref_for:!0,ref:A=>e(E)[u]=A,source:n,size:"small","show-del-btn":!1,"show-file-name":!1,"image-class":"object-cover w-80% h-full mx-auto block"},null,8,["source"])]),default:s(()=>[o("div",At,[t(ae,{source:n,size:"small","show-del-btn":!1,"can-play":!1,"show-file-name":!1,"image-class":"object-cover w-80% h-full mx-auto block"},null,8,["source"])]),o("div",Bt,_(n.fileName),1)]),_:2},1032,["placement","get-popup-container","onOpenChange"])])}),128))])])):U("",!0),o("div",jt,[o("div",Lt,[c(" 發送統計 "),t(D,{placement:"top","get-popup-container":e(B)},{title:s(()=>[c(" 發送失敗的接收門號和原因，可參考報表細節或匯出明細，發送中和發送成功以外皆為發送失敗，例如: 發送過期、主帳號有設定黑名單等狀況 ")]),default:s(()=>[o("a",zt,[t(S,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),t(Se,{columns:[{title:"發送總數",dataIndex:"total",key:"total",width:"89px",align:"center"},{title:"發送中",dataIndex:"sending",key:"sending",width:"89px",align:"center"},{title:"發送成功",dataIndex:"success",key:"success",width:"89px",align:"center"},{title:"發送失敗",dataIndex:"fail",key:"fail",width:"89px",align:"center"},{title:"成功率",dataIndex:"successRate",key:"successRate",width:"89px",align:"center"}],"data-source":[e(l).statistics]},{bodyCell:s(({column:n,text:u})=>[e(l).sendStatus==="RESERVATION"&&n.dataIndex!=="total"?(r(),g(T,{key:0},[c(" - ")],64)):(r(),g(T,{key:1},[n.dataIndex==="successRate"?(r(),g(T,{key:0},[c(_(u)+"% ",1)],64)):U("",!0)],64))]),_:1},8,["data-source"])])])])):U("",!0)]),_:1},8,["show-right-empty"]),t(Z,{open:e(R),"onUpdate:open":a[11]||(a[11]=n=>L(R)?R.value=n:null),title:"是否刪除已預約的訊息？",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:ge},{default:s(()=>[Gt]),_:1},8,["open"]),t(Z,{open:e(w).open,"onUpdate:open":a[13]||(a[13]=n=>e(w).open=n),title:"選擇訊息類型",centered:"","cancel-text":"取消","ok-text":"確定",width:"440px",onOk:a[14]||(a[14]=()=>{d.$router.push({name:e(w).isParameter?"MessageSendingParameterCreate":"MessageSendingGeneralCreate"})})},{default:s(()=>[o("div",Ht,[t(Q,{layout:"vertical",autocomplete:"off"},{default:s(()=>[t(Ee,{"html-for":""},{label:s(()=>[Xt,t(D,{placement:"top","get-popup-container":e(B)},{title:s(()=>[c(" 一般訊息支援 SMS 和 MMS，"),qt,c(" 若想批次使用參數發送訊息，請選擇參數訊息 ")]),default:s(()=>[o("a",Kt,[t(S,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(Me,{value:e(w).isParameter,"onUpdate:value":a[12]||(a[12]=n=>e(w).isParameter=n)},{default:s(()=>[t(ee,{value:!1},{default:s(()=>[c(" 一般訊息 ")]),_:1}),t(ee,{value:!0},{default:s(()=>[c(" 參數訊息 ")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1})])]),_:1},8,["open"]),t(it,{ref_key:"messageSendingEditModal",ref:K},null,512)]),_:1})}}});export{xs as default};

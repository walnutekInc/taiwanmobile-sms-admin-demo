import{_ as de}from"./index.vuevuetypescriptsetuptruelang-D0bWLTM0.js";import{u as pe,_ as _e,a as fe,b as ge,c as ve,d as we}from"./route-leave-DSt1F7kY.js";import{_ as xe}from"./index.vuevuetypescriptsetuptruelang-DtpB6Cde.js";import{h as ye,j as be,_ as Ce}from"./index-C1AvcV_o.js";import{d as he,ad as ke,ac as Se,c as U,r as P,D as Me,f as _,w as $e,W as N,_ as j,$ as n,k as s,ab as y,u as e,Y as c,B as Fe,G as m,a4 as Re,m as D,A as H}from"./vue-Cot4Dobd.js";import{P as Ae,Q as b,U as Ie,V as Te,B as Ve,q as qe,o as Le,p as Be,I as Ue,J as Pe,s as Ne,F as je}from"./antd-C_UvAipJ.js";import{u as De,r as S,a as He}from"./custom-message-CA02Aez8.js";import{u as Ee}from"./sms-category-D1Fg8eCj.js";import"./context-e8fZyaZG.js";import"./index.esm-BZKKJbd0.js";import"./index.vuevuetypestyleindex0lang-DRI_kzvm.js";import"./request-Cht3mzI3.js";const Ge="/taiwanmobile-sms-admin-demo/assets/phone-DdWahJd9.png",We={class:"flex justify-between w-full items-center"},Je=c("span",{class:""},"訊息類別",-1),Oe=c("span",null,"新增訊息類別",-1),Ke=["src"],Qe={class:"max-h-450px overflow-auto absolute top-[150px] left-[30px] w-[calc(100%-50px)]"},Ye=["innerHTML"],mt=he({__name:"custom-message-form",setup(ze){const{setHideAlert:M,setShowAlert:E}=pe(),G=ke(),W=ye(),C=Se(),J=be(),{getSmsCategoryOption:O,smsCategoryOption:K,checkSmsCategoryExist:Q}=Ee(),{customMeesage:h,getCustomMessage:Y,updateCustomMessage:z,createCustomMessage:X,replaceFieldToHtml:$}=De(),f=U(()=>C.name==="CustomMessageCreate");let g={categoryId:void 0,newSmsCategory:"",name:"",content:""};const o=P(Ae(g)),Z=P({name:[{required:!0,message:"請輸入訊息名稱",trigger:"blur"}],content:[{required:!0,message:"請輸入訊息內容",trigger:"blur"},{async validator(a,t){var l;return!b(t)&&((l=o.content)==null?void 0:l.replace(S,"").length)>1e3?Promise.reject("限制輸入 1,000 字以內"):Promise.resolve()},trigger:"blur"}],newSmsCategory:[{async validator(a,t){return!b(t)&&await Q(t)?Promise.reject(`系統中已有「${t}」 ，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:v,validate:ee,clearValidate:te,resetFields:se,initialModel:ne}=Ie(o,Z);Me(async()=>{var a,t,l;f.value||(await Y(C.params.id),g={categoryId:(a=h.value)==null?void 0:a.categoryId,newSmsCategory:"",name:((t=h.value)==null?void 0:t.name)??"",content:$((l=h.value)==null?void 0:l.content)},se(g)),W.handleSelectedKeys(["/sms-marketing/custom-message"]),O()});const d=_(!0),F=U(()=>f.value?"新增自訂訊息":"編輯自訂訊息");$e(()=>o,a=>{Te(a,g)?M():E()},{deep:!0});function oe(){console.log(ne),ee().then(async()=>{var l;((l=(await(e(f)?X:z)(o,C.params.id)).data)==null?void 0:l.status)==="success"&&(J.success({message:e(f)?"自訂訊息新增成功":"自訂訊息編輯成功",placement:"top"}),M(),G.push("/sms-marketing/custom-message?tabActived=customMessage"))}).catch(a=>{console.log(a)})}const R=_(null);function A(a){o.content=$(a)}const I=_(null);function ae(a){for(const t of a)o.content=`${o.content}<span>${t}</span>`}const T=_(null);function le(a){o.content=`${o.content}<a href="${a}">${a}</a>`}const V=_(null);return(a,t)=>{const l=Ce,re=Ve,ue=qe,w=Le,i=Be,k=xe,q=Ue,x=Pe,ie=we,L=Ne,me=je,ce=de;return N(),j(ce,{title:e(F),"custom-breadcrumb":[{title:"訊息行銷活動"},{path:"/sms-marketing/custom-message?tabActived=customMessage",title:"自訂訊息"},{title:e(F)}]},{default:n(()=>[s(L,{class:"bg-sms-grayscale-0 rounded-4 p-10",wrap:!1},{default:n(()=>[s(i,{flex:"auto"},{default:n(()=>[s(me,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:oe},{default:n(()=>[s(L,{gutter:[16,16]},{default:n(()=>[s(i,{span:24},{default:n(()=>[s(w,y({"html-for":""},e(v).categoryId,{extra:"15 字以內。若無選擇/新增，將自動歸類為「未分類」。","label-col":{style:{width:"100%"}}}),{label:n(()=>[c("div",We,[Je,e(d)?(N(),j(re,{key:0,type:"link",class:"m-0 p-0",onClick:t[0]||(t[0]=Fe(()=>d.value=!1,["prevent"]))},{icon:n(()=>[s(l,{name:"plus"})]),default:n(()=>[m(" 新增訊息類別 ")]),_:1})):Re("",!0)])]),default:n(()=>[s(ue,{value:e(o).categoryId,"onUpdate:value":t[1]||(t[1]=r=>e(o).categoryId=r),options:e(K),"allow-clear":"",disabled:!e(d),placeholder:"請選擇訊息類別"},null,8,["value","options","disabled"])]),_:1},16)]),_:1}),D(s(i,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-2 !px-3"},{default:n(()=>[s(w,y({"html-for":"",extra:"15 字以內。若同時選擇和新增訊息類別，系統只會紀錄「新增訊息類別」。"},e(v).newSmsCategory,{"label-col":{style:{width:"100%"}}}),{label:n(()=>[Oe,s(k,{status:"small3",class:"m-0 p-0 ms-auto",onClick:t[2]||(t[2]=()=>{e(te)("newSmsCategory"),d.value=!0})},{icon:n(()=>[s(l,{name:"close"})]),_:1})]),default:n(()=>[s(q,{value:e(o).newSmsCategory,"onUpdate:value":t[3]||(t[3]=r=>e(o).newSmsCategory=r),placeholder:"請輸入訊息類別",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[H,!e(d)]]),s(i,{span:24},{default:n(()=>[s(w,y({label:"訊息名稱"},e(v).name,{extra:"15 字以內",required:""}),{default:n(()=>[s(q,{value:e(o).name,"onUpdate:value":t[4]||(t[4]=r=>e(o).name=r),placeholder:"請輸入訊息名稱",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),s(i,{span:24},{default:n(()=>{var r;return[s(w,y({label:"訊息內容"},e(v).content,{class:"relative",extra:`MMS 上限 1,000 字，SMS 上限 335 字，目前 ${e(b)(e(o).content)?"--":(r=e(o).content)==null?void 0:r.replace(e(S),"").length} 字(不含參數字數)`,required:""}),{default:n(()=>{var B;return[s(ie,{modelValue:e(o).content,"onUpdate:modelValue":t[9]||(t[9]=p=>e(o).content=p),contenteditable:"true","content-len":(B=e(o).content)==null?void 0:B.replace(e(S),"").length,"max-len":1e3,placeholder:"請輸入訊息名稱"},{default:n(()=>[s(x,null,{title:n(()=>[m(" 載入現有的自訂訊息 ")]),default:n(()=>[s(l,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:t[5]||(t[5]=p=>{var u;return(u=e(R))==null?void 0:u.show()})})]),_:1}),s(x,null,{title:n(()=>[m(" 加入參數 ")]),default:n(()=>[s(l,{name:"code",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:t[6]||(t[6]=p=>{var u;return(u=e(I))==null?void 0:u.show()})})]),_:1}),s(x,null,{title:n(()=>[m(" 增加縮網址 ")]),default:n(()=>[s(l,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:t[7]||(t[7]=p=>{var u;return(u=e(T))==null?void 0:u.show()})})]),_:1}),s(x,null,{title:n(()=>[m(" AI 文字生成訊息 ")]),default:n(()=>[s(l,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:t[8]||(t[8]=p=>{var u;return(u=e(V))==null?void 0:u.show()})})]),_:1})]),_:1},8,["modelValue","content-len"])]}),_:1},16,["extra"])]}),_:1}),s(i,{span:24,class:"text-end"},{default:n(()=>[s(k,{status:"small2",class:"me-2",onClick:t[10]||(t[10]=r=>a.$router.push("/sms-marketing/custom-message?tabActived=customMessage"))},{default:n(()=>[m(" 取消 ")]),_:1}),s(k,{status:"small1","html-type":"submit"},{default:n(()=>[m(" 確定 ")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(i,{flex:"428px",class:"relative"},{default:n(()=>{var r;return[c("img",{src:e(Ge),class:"w-428px"},null,8,Ke),c("div",Qe,[D(c("div",{class:"bg-sms-grayscale-20 p-2 rounded-2 whitespace-pre-wrap max-w-[215px] inline-block break-words",innerHTML:(r=e(o).content)==null?void 0:r.replace(e(He),"")},null,8,Ye),[[H,!e(b)(e(o).content)]])])]}),_:1})]),_:1}),s(_e,{ref_key:"importCustomMessageRef",ref:R,content:e(o).content,onUpdateContent:A},null,8,["content"]),s(fe,{ref_key:"addFieldRef",ref:I,onAddFieldToContent:ae},null,512),s(ge,{ref_key:"addLinkRef",ref:T,onAddLinkToContent:le},null,512),s(ve,{ref_key:"aiTextGenerationRef",ref:V,content:e(o).content,onUpdateContent:A},null,8,["content"])]),_:1},8,["title","custom-breadcrumb"])}}});export{mt as default};

import{_ as bt,a as wt}from"./index.vuevuetypescriptsetuptruelang-BzsqEdM3.js";import{u as kt,_ as Ct,a as Mt,b as Tt,c as St,d as $t}from"./route-leave-DGgikv_0.js";import{_ as vt}from"./index.vuevuetypescriptsetuptruelang-CICFdqya.js";import{j as Rt,k as Ft,_ as nt}from"./index-DcAH1y4t.js";import{d as Oe,f as _,W as p,_ as B,$ as s,u as e,H as Le,Y as n,r as Ue,c as Ce,k as t,ah as Pt,X as b,F as V,G as l,a3 as f,a4 as X,ac as os,ad as jt,z as at,o as It,w as Dt,m as ee,ab as G,B as ls,a9 as me,A as te,a7 as Lt,a5 as le,y as xt,ag as gt,l as Ut}from"./vue-BvWPEeCa.js";import{z as Ae,E as Q,K as st,N as M,O as Ot,P as At,Q as is,U as ot,V as lt,H as Et,I as Nt,o as Bt,p as Vt,q as Yt,y as rs,W as cs,T as ds,x as Kt,J as Ht,r as qt,s as Gt,F as zt,X as yt,B as us}from"./antd-Dpsol0oo.js";import{i as Wt}from"./isToday-CxuES7r1.js";import{M as ps,a as Xt,_ as Jt}from"./MessageTypeEnum-D6waKsHJ.js";import{_ as Qt}from"./index.vuevuetypestyleindex0lang-CZ6lBge9.js";import{_ as Zt}from"./request-DbdPek_5.js";import{u as ms}from"./contact-person-D1ZO44CA.js";import{u as es}from"./group-label-CqPHaacF.js";import{u as ts,r as De}from"./custom-message-DoVt2btv.js";import{u as ss,_ as fs}from"./message-sending-CfpFM2SU.js";import{b as N}from"./tools-DuR4KSGu.js";const _s=n("div",{class:"text-center px-24px py-20px w-328px text-base mx-auto"}," 刪除的檔案將無法復原 ",-1),ns=Oe({name:"DelMultimediaFileModal",__name:"del-multimedia-file-modal",setup(E,{expose:j}){const O=_(!1),z=_();function J(I){z.value=I,O.value=!0}function T(){var I;(I=z.value)==null||I.call(z),O.value=!1}return j({show:J}),(I,P)=>{const m=Ae;return p(),B(m,{open:e(O),"onUpdate:open":P[0]||(P[0]=L=>Le(O)?O.value=L:null),title:"是否刪除已上傳的檔案？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onOk:T},{default:s(()=>[_s]),_:1},8,["open"])}}}),xs={class:"px-24px"},gs=Oe({__name:"select-contact",props:{formState:{}},emits:["updateFormState"],setup(E,{expose:j,emit:O}){const z=E,J=O,T=Ue({selectedRowKeys:[],selectedRows:[],loading:!1}),{contactPerson:I,getAllContactPerson:P,pagination:m}=ms(),L=[{title:"手機門號",dataIndex:"phone",key:"phone",width:"110px"},{title:"姓名",dataIndex:"name",key:"name",width:"110px"},{title:"黑名單",dataIndex:"isBlackList",key:"isBlackList",width:"110px"},{title:"備註",dataIndex:"note",key:"note",width:"110px"}],k=_({keyword:"",sortField:"createTime",sortOrder:"descend"}),A=Ce(()=>{const C=(m.value.current-1)*m.value.pageSize;return I.value.slice(C,m.value.current*m.value.pageSize)});async function fe(C,S){m.value={...m.value,current:C,pageSize:S}}async function ie(C=1,S=10){const q={current:C,pageSize:S,...e(k)};await P(q,T.selectedRowKeys)}function _e(C){console.log("selectedRowKeys changed: ",C),T.selectedRowKeys=C}const H=_(!1);async function xe(C){T.selectedRowKeys=C,ie(),H.value=!0}function ge(){H.value=!1,J("updateFormState",{recipients:{...z.formState.recipients,contactPerson:T.selectedRowKeys}})}return j({show:xe}),(C,S)=>{const q=Zt,re=Qt,U=Ae;return p(),B(U,{open:e(H),"onUpdate:open":S[2]||(S[2]=w=>Le(H)?H.value=w:null),title:"選擇聯絡人",centered:"","cancel-text":"取消","ok-text":"確定",width:"600px",onOk:ge},{default:s(()=>[n("div",xs,[t(q,{modelValue:e(k).keyword,"onUpdate:modelValue":S[0]||(S[0]=w=>e(k).keyword=w),"show-filter-btn":!1,placeholder:"搜尋聯絡人",class:"mb-2",onKeydown:S[1]||(S[1]=Pt(w=>ie(1,e(m).pageSize),["enter"]))},null,8,["modelValue"]),t(re,{class:"modal-table","data-source":e(A),columns:L,"show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(T).selectedRowKeys,onChange:_e,preserveSelectedRowKeys:!0},pagination:{...e(m)},onChangePagination:fe},{bodyCell:s(({column:w,text:Me})=>[w.dataIndex==="isBlackList"?(p(),b(V,{key:0},[l(f(Me?"黑名單":""),1)],64)):X("",!0)]),_:1},8,["data-source","row-selection","pagination"])])]),_:1},8,["open"])}}}),vs={class:"px-24px"},hs=Oe({__name:"select-group",props:{formState:{}},emits:["updateFormState"],setup(E,{expose:j,emit:O}){const z=E,J=O,T=Ue({selectedRowKeys:[],selectedRows:[],loading:!1}),{groupLabels:I,getAllGroupLabel:P,pagination:m}=es(),L=[{title:"群組標籤名稱",dataIndex:"name",key:"name",width:"145px"},{title:"門號數量",dataIndex:"phoneCount",key:"phoneCount",width:"145px"},{title:"黑名單數量",dataIndex:"blackListCount",key:"blackListCount",width:"145px"}],k=_({keyword:"",sortField:"createTime",sortOrder:"descend"}),A=Ce(()=>{const C=(m.value.current-1)*m.value.pageSize;return I.value.slice(C,m.value.current*m.value.pageSize)});async function fe(C,S){m.value={...m.value,current:C,pageSize:S}}async function ie(C=1,S=10){const q={current:C,pageSize:S,...e(k)};await P(q,T.selectedRowKeys)}function _e(C,S){console.log("selectedRowKeys changed: ",C),T.selectedRowKeys=C,T.selectedRows=S}const H=_(!1);async function xe(C){T.selectedRowKeys=C.map(S=>S.id),ie(),H.value=!0}function ge(){H.value=!1,J("updateFormState",{recipients:{...z.formState.recipients,group:T.selectedRows.map(C=>({id:C.key,label:C.name}))}})}return j({show:xe}),(C,S)=>{const q=Zt,re=Qt,U=Ae;return p(),B(U,{open:e(H),"onUpdate:open":S[2]||(S[2]=w=>Le(H)?H.value=w:null),title:"選擇群組標籤",centered:"","cancel-text":"取消","ok-text":"確定",width:"600px",onOk:ge},{default:s(()=>[n("div",vs,[t(q,{modelValue:e(k).keyword,"onUpdate:modelValue":S[0]||(S[0]=w=>e(k).keyword=w),"show-filter-btn":!1,placeholder:"搜尋群組標籤",class:"mb-2",onKeydown:S[1]||(S[1]=Pt(w=>ie(1,e(m).pageSize),["enter"]))},null,8,["modelValue"]),t(re,{class:"modal-table","data-source":e(A),columns:L,"show-sorter-tooltip":!1,"row-selection":{selectedRowKeys:e(T).selectedRowKeys,onChange:_e,preserveSelectedRowKeys:!0},pagination:{...e(m)},onChangePagination:fe},null,8,["data-source","row-selection","pagination"])])]),_:1},8,["open"])}}});var ht=(E=>(E.NOW="現在",E.RESERVATION="預約",E))(ht||{});const ys=n("span",{class:"pe-.5"},"活動名稱",-1),bs=n("span",{class:"text-red-500 pe-2"},"*",-1),ws={href:"javascript:;"},ks=n("span",{class:"pe-.5"},"接收門號",-1),Cs=n("span",{class:"text-red-500 pe-2"},"*",-1),Ms={href:"javascript:;"},Ts=n("br",null,null,-1),Ss=n("br",null,null,-1),$s=n("br",null,null,-1),Rs=n("br",null,null,-1),Fs=n("br",null,null,-1),Ps={class:"text-sm text-sms-secondary-dark-blue-100 font-400"},js=n("div",{class:"ant-form-item-extra"}," 若有多筆門號，使用 “ , ” 隔開，例如：0911111222,0922123456,0933987654 ",-1),Is={href:"javascript:;",class:"underline underline-offset-2 text-sms-primary-blue-80 text-sm line-height-14px py-1"},Ds={href:"javascript:;",class:"underline underline-offset-2 text-sms-primary-blue-80 text-sm line-height-14px py-1"},Ls=n("span",{class:"pe-.5"},"訊息類型",-1),Us=n("span",{class:"text-red-500 pe-2"},"*",-1),Os={href:"javascript:;"},As=n("br",null,null,-1),Es=n("span",{class:"pe-.5"},"訊息內容",-1),Ns=n("span",{class:"text-red-500"},"*",-1),Bs={class:"flex gap-2 overflow-y-auto h-95px"},Vs={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},Ys=n("span",{class:"pe-.5"},"發送時間",-1),Ks=n("span",{class:"text-red-500 pe-2"},"*",-1),Hs={href:"javascript:;"},qs=n("span",{class:"pe-.5"},"有效時間",-1),Gs=n("span",{class:"text-red-500 pe-2"},"*",-1),zs={href:"javascript:;"},Ws={key:0,id:"confirmDetail",class:"px-32px"},Xs=n("div",{class:"mb-4"},[n("h2",{class:"font-500 text-22px text-sms-secondary-dark-blue-100"}," 內容確認 "),n("p",{class:"text-sm text-sms-grayscale-80"}," 若有使用縮網址功能，請在發送訊息前再次確認短網址有效性，平台不會檢驗短網址有效性 ")],-1),Js={class:"border border-solid border-sms-light-gray-60 p-16px pb-24px rounded-12px mb-2"},Qs=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 活動名稱 ",-1),Zs={class:"text-base font-400 text-sms-grayscale-100"},en=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送時間 ",-1),tn={key:0,class:"text-base font-400 text-sms-grayscale-100"},sn=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息類型 ",-1),nn={class:"text-base font-400 text-sms-grayscale-100"},an=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送門號 ",-1),on={class:"text-base font-400 text-sms-grayscale-100"},ln=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息總數 (長訊息) ",-1),rn={class:"text-base font-400 text-sms-grayscale-100"},cn=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 單價 ",-1),dn={class:"text-base font-400 text-sms-grayscale-100"},un={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},pn={href:"javascript:;"},mn={class:"text-base font-400 text-sms-grayscale-100"},fn=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),_n={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},xn={href:"javascript:;"},gn={class:"text-base font-400 text-sms-grayscale-100"},vn=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),hn={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},yn={href:"javascript:;"},bn=n("br",null,null,-1),wn={class:"text-base font-400 text-sms-grayscale-100"},kn={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},Cn={href:"javascript:;"},Mn=n("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"},[l(" 您編輯過的內容將全部清空 "),n("br"),n("p",null,[l(" 提醒您，SMS支援的字數較MMS少，"),n("br"),l(" 且不能上傳多媒體附件 ")])],-1),Tn={class:"text-center px-30px py-20px w-328px text-base mx-auto"},Sn={class:"text-base text-center text-sms-gary-80"},$n=["href"],To=Oe({__name:"create-or-update-form",props:{isCreate:{type:Boolean,default:!1},id:{},editCallback:{},showPreview:{type:Boolean,default:!0}},setup(E){const j=E;Q.extend(Wt);const{setHideAlert:O,setShowAlert:z}=kt(),J=Rt(),T=os(),I=jt(),P=at(j,"isCreate"),m=at(j,"id"),{replaceFieldToHtml:L}=ts(),k=_(),{updateGeneralMessageSending:A,getGeneralMessageSendingById:fe,createGeneralMessageSending:ie,uploadBatchRecipientsExcel:_e,effectiveTimeOption:H,getActiveStatusLabel:xe,checkMessageSendingDetail:ge,checkMessageSendingNameExist:C,renderGeneralMessagePreviewArray:S}=ss(),{getGroupLabelOption:q,groupOptions:re}=es(),U=_("");let w={name:"",phone:void 0,recipients:{contactPerson:[],group:[],manual:"",file:void 0},messageType:"SMS",subject:"",multimediaFile:[],sendTimeType:"NOW",content:"",effectiveTime:"",reservationTime:""};const Me=[{label:"0935-111-111",value:"0935-111-111"},{label:"0947-127-998",value:"0947-127-998"},{label:"0958-892-006",value:"0958-892-006"}],se=_("ContactPerson"),i=_(!1),c=Ue(st(w)),Te=Ce(()=>c.messageType==="SMS"?335:1e3),Z=Ue({name:[{async validator(o,a){return M(a)?Promise.reject("請輸入活動名稱"):await C(a,m.value)?Promise.reject("此活動名稱已存在，請重新命名 "):Promise.resolve()},trigger:"blur"}],phone:[{required:!0,message:"請選擇發送門號",trigger:"blur"}],subject:[{async validator(o,a){return c.messageType==="MMS"&&M(a)?Promise.reject("請輸入訊息主旨"):Promise.resolve()},trigger:"blur"}],recipients:[{async validator(o){if(M(c.recipients.contactPerson)&&M(c.recipients.group)&&M(c.recipients.manual)&&Ot(c.recipients.file))return Promise.reject("至少 1 個接收門號");if(M(c.recipients.manual)){const a=c.recipients.manual.split(",").length,d=c.recipients.contactPerson.length,g=c.recipients.group.length;if(a+d+g>5e4)return Promise.reject("總接收門號數不可超過 5萬筆")}else if(!/^09[0-9]{8}(,09[0-9]{8})*$/.test(c.recipients.manual))return se.value="ManualInput",Promise.reject("格式錯誤");return Promise.resolve()},trigger:"blur"}],content:[{async validator(o,a){var d;return M(a)?Promise.reject("請輸入訊息內容"):!M(a)&&((d=c.content)==null?void 0:d.replace(De,"").length)>Te.value?Promise.reject(`限制輸入 ${Te.value} 字以內`):Promise.resolve()},trigger:"blur"}],reservationTime:[{async validator(o,a){if(c.sendTimeType==="RESERVATION"){if(M(a))return Promise.reject("請選擇預約日期或現在發送");if(Q().diff(Q(a),"minute")>0)return Promise.reject("閒置過久，請重新選擇預約時間")}return Promise.resolve()},trigger:"blur"}]}),{validateInfos:ne,validate:it,resetFields:$}=At(c,Z);It(async()=>{var o,a,d,g,F,x,y,K,Y,ae,W,be,de,we,Pe,je,ue,pe,Ie,ke;if(await q(),U.value=Q().format("YYYY/MM/DD_HH:mm"),!P.value&&m.value){const oe=await fe(m.value);oe.data&&(k.value=oe.data,w={name:((o=k.value)==null?void 0:o.name)??e(U),phone:((a=k.value)==null?void 0:a.phone)??void 0,recipients:{contactPerson:((g=(d=k.value)==null?void 0:d.recipients)==null?void 0:g.contactPerson)??[],group:((x=(F=k.value)==null?void 0:F.recipients)==null?void 0:x.group)??[],manual:((K=(y=k.value)==null?void 0:y.recipients)==null?void 0:K.manual)??"",file:((ae=(Y=k.value)==null?void 0:Y.recipients)==null?void 0:ae.file)??void 0},messageType:((W=k.value)==null?void 0:W.messageType)??"SMS",subject:((be=k.value)==null?void 0:be.subject)??"",multimediaFile:((de=k.value)==null?void 0:de.multimediaFile)??[],sendTimeType:((we=k.value)==null?void 0:we.sendTimeType)??"NOW",content:((Pe=k.value)==null?void 0:Pe.content)??"",effectiveTime:((je=k.value)==null?void 0:je.effectiveTime)??"",reservationTime:((ue=k.value)==null?void 0:ue.reservationTime)??""})}else{if((pe=T.query)!=null&&pe.isRe){U.value=`RE_${U.value}`;const oe=(Ie=T.query)!=null&&Ie.rePhone?T.query.rePhone:void 0,r=(ke=T.query)!=null&&ke.recipientsPhone?T.query.recipientsPhone:void 0;oe&&(w.phone=oe),r&&(is(Me,{value:r})?w.recipients.contactPerson=[r]:(se.value="ManualInput",w.recipients.manual=r))}w.name=e(U)}$(w)}),Dt(()=>c,o=>{const a=ot(o,w);P.value&&!m.value&&(a?O():z())},{deep:!0});const D=_(null);function rt(){it().then(async()=>{const o=await ge(c);if(o.data){D.value=o.data,i.value=!0,await xt();const a=document.getElementById("app");a&&(a.scrollTop=0)}}).catch(o=>{console.log(o)})}async function qe(){var d,g,F,x;const a=await(e(P)?ie:A)(c,m.value);if(((d=a.data)==null?void 0:d.status)==="success")if(P.value&&!m.value)if(O(),(g=T.query)!=null&&g.isRe&&((F=T.query)!=null&&F.rePhone)&&((x=T.query)!=null&&x.recipientsPhone)){const{post:y,close:K}=gt({name:"in-chat-message-page"});y(a.data.id),K(),window.close()}else J.success({message:"訊息新增成功",placement:"top"}),I.push("/sms-marketing/message-sending").then(()=>{setTimeout(()=>{var Y;const{post:y,close:K}=gt({name:"in-message-sending-page"});y((Y=a.data)==null?void 0:Y.id),K()},800)});else j.editCallback&&j.editCallback(!0,m.value),J.success({message:"訊息編輯成功",placement:"top"}),j.editCallback||I.push("/sms-marketing/appointment")}const Ee=_(null);function Se(o){c.content=L(o)}const $e=_(null),ct=_(null);function Ge(o){var a;for(const d of o)(a=$e.value)==null||a.insertFun(`${c.content}<span>${d}</span>`)}const ze=_(null);function We(o){var a;(a=$e.value)==null||a.insertFun(`<a href="${o}">${o}</a>`)}const Xe=_(null),Ne=Ce(()=>S(c)),Be=_(null);function Je(o){c.multimediaFile=o}const Qe=_(null);function Ve(o){c.multimediaFile=c.multimediaFile.filter(a=>a.url!==o.url)}const ve=_(!1);function dt(){c.messageType==="SMS"?!M(c.content)||!M(c.multimediaFile)?ve.value=!0:c.messageType="SMS":c.messageType="MMS"}const Ye=_(null),Ze=_(null);function et(o){Object.assign(c,o)}const he=_({open:!1,url:""}),Re=_();async function ce(o){const d=o.target.files;try{if(d.length>0){const g=await _e(d[0]);c.recipients.file=g.data,he.value={open:!0,url:""}}}catch(g){console.log(g)}finally{Re.value&&(Re.value.value="")}}const ut=Ft();function tt(){ut.confirm({title:"是否取消上傳檔案？",icon:t("span"),content:Ut("div",{innerHTML:"該檔案將取消上傳",class:"text-center px-30px py-20px w-328px text-base mx-auto"}),width:"400px",centered:!0,closable:!0,async onOk(){c.recipients.file=void 0}})}const ye=Q();function Fe(o){const a=ye.add(1,"year");return o&&(o<ye||o>=a)}function pt(o){if(o&&o.isToday()){const a=Q().add(5,"minute"),d=a.hour(),g=a.minute();return{disabledHours:()=>lt(0,24).slice(0,d),disabledMinutes:()=>lt(0,60).slice(0,g)}}return{}}function mt(){const o=ot(c,w);j.editCallback&&j.editCallback(o)}function ft(){P.value&&!m.value?I.push("/sms-marketing/message-sending"):mt()}const Ke=_("responsive");function _t(o){c.recipients.group=c.recipients.group.filter(a=>a.id!==o)}async function u(o){const g=o.target.value.replace(/[^\d|,]/g,"");await xt(),c.recipients.manual=g}return(o,a)=>{const d=nt,g=Et,F=Nt,x=Bt,y=Vt,K=Yt,Y=vt,ae=rs,W=cs,be=ds,de=Kt,we=Ht,Pe=bt,je=$t,ue=qt,pe=Gt,Ie=zt,ke=wt,oe=Ae;return p(),b(V,null,[t(pe,{class:le(["bg-sms-grayscale-0 rounded-4",{"p-10 pl-1":o.showPreview}]),wrap:!1},{default:s(()=>[t(y,{flex:"auto"},{default:s(()=>[ee(t(Ie,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:rt},{default:s(()=>[t(pe,{gutter:[16,14]},{default:s(()=>[t(y,{span:24},{default:s(()=>[t(x,G(e(ne).name,{"html-for":""}),{label:s(()=>[ys,bs,t(g,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 活動名稱可使用系統預設或自行輸入，但不可重複 ")]),default:s(()=>[n("a",ws,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(F,{value:e(c).name,"onUpdate:value":a[0]||(a[0]=r=>e(c).name=r),placeholder:"請輸入文字",maxlength:30,onFocus:a[1]||(a[1]=()=>{e(c).name===e(U)&&(e(c).name="")}),onBlur:a[2]||(a[2]=()=>{e(c).name===""&&(e(c).name=e(U))})},null,8,["value"])]),_:1},16)]),_:1}),t(y,{span:24},{default:s(()=>[t(x,G(e(ne).phone,{label:"發送門號",required:""}),{default:s(()=>[t(K,{value:e(c).phone,"onUpdate:value":a[3]||(a[3]=r=>e(c).phone=r),options:Me,"allow-clear":"",placeholder:"請選擇發送門號"},null,8,["value"])]),_:1},16)]),_:1}),t(y,{span:24},{default:s(()=>[t(x,G({"html-for":""},e(ne).recipients),{label:s(()=>[ks,Cs,t(g,{"overlay-inner-style":{width:"315px"},placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 4 種方式增加接收門號 ，且可混合使用(總上限5萬筆)："),Ts,l(" 1. 從名單管理匯入聯絡人"),Ss,l(" 2. 從名單管理匯入群組標籤"),$s,l(" 3. 直接輸入接收門號"),Rs,l(" 4. Excel 快速上傳門號"),Fs]),default:s(()=>[n("a",Ms,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(be,{activeKey:e(se),"onUpdate:activeKey":a[10]||(a[10]=r=>Le(se)?se.value=r:null),size:"small",class:"full-border-tab",type:"card","destroy-inactive-tab-pane":!0},{default:s(()=>[t(ae,{key:"ContactPerson",tab:"聯絡人"},{default:s(()=>[t(Y,{status:"small2",class:"me-2",onClick:a[4]||(a[4]=r=>{var h,v;return(v=e(Ye))==null?void 0:v.show(((h=e(c).recipients)==null?void 0:h.contactPerson)??[])})},{icon:s(()=>[t(d,{name:"plus",width:"16px"})]),default:s(()=>[l(" 選擇聯絡人 ")]),_:1}),n("span",Ps,"已選擇 "+f(e(c).recipients.contactPerson.length.toLocaleString())+" 筆",1)]),_:1},8,["tab"]),t(ae,{key:"GroupLabel",tab:"群組標籤"},{default:s(()=>[e(c).recipients.group.length>0?(p(),B(K,{key:0,class:"mb-2",open:!1,options:e(re),value:e(c).recipients.group.map(r=>r.id),mode:"tags","max-tag-count":e(Ke),onDeselect:_t,onBlur:a[6]||(a[6]=r=>Ke.value="responsive")},{maxTagPlaceholder:s(r=>[n("span",{href:"javascript:;",onClick:a[5]||(a[5]=ls(h=>Ke.value=void 0,["prevent"]))},[t(d,{name:"plus",width:"12px"}),l(f(r.length)+"...",1)])]),_:1},8,["options","value","max-tag-count"])):X("",!0),t(Y,{status:"small2",class:"me-2",onClick:a[7]||(a[7]=r=>{var h;return(h=e(Ze))==null?void 0:h.show(e(c).recipients.group??[])})},{icon:s(()=>[t(d,{name:"plus",width:"16px"})]),default:s(()=>[l(" 選擇群組標籤 ")]),_:1})]),_:1},8,["tab"]),t(ae,{key:"ManualInput",tab:"手動輸入"},{default:s(()=>[t(W,{value:e(c).recipients.manual,"onUpdate:value":a[8]||(a[8]=r=>e(c).recipients.manual=r),placeholder:"請輸入接收門號",rows:6,onInput:u},null,8,["value"]),js]),_:1},8,["tab"]),t(ae,{key:"FileUpload",tab:"上傳檔案"},{default:s(()=>[e(c).recipients.file?(p(),b(V,{key:1},[n("a",Ds,f(e(c).recipients.file.fileName),1),t(d,{name:"download-circle",width:"16px",class:"mx-2 cursor-pointer"}),t(d,{name:"delete-circle",width:"16px",class:"cursor-pointer",onClick:tt})],64)):(p(),b(V,{key:0},[n("input",{ref_key:"uploadBatchRecipientsFile",ref:Re,type:"file",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",class:"!hidden",onChange:ce},null,544),t(Y,{status:"small2",class:"me-2",onClick:a[9]||(a[9]=r=>{var h;return(h=e(Re))==null?void 0:h.click()})},{icon:s(()=>[t(d,{name:"plus",width:"16px"})]),default:s(()=>[l(" 上傳EXCEL ")]),_:1}),n("a",Is,[t(d,{name:"download",width:"16px"}),l(" 匯出範例 ")])],64))]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),_:1},16)]),_:1}),t(y,{span:24},{default:s(()=>[t(x,G({"html-for":""},e(ne).messageType),{label:s(()=>[Ls,Us,t(g,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" SMS：上限 335 字"),As,l(" MMS：上限 1,000 字，可上傳多媒體 ")]),default:s(()=>[n("a",Os,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(we,{value:e(c).messageType,"onUpdate:value":a[11]||(a[11]=r=>e(c).messageType=r),onChange:dt},{default:s(()=>[(p(!0),b(V,null,me(Object.entries(e(ps)),([r,h])=>(p(),B(de,{key:r,value:r},{default:s(()=>[l(f(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},16)]),_:1}),ee(t(y,{span:24},{default:s(()=>[t(x,G({label:"訊息主旨"},e(ne).subject,{required:"",extra:"15 字以內"}),{default:s(()=>[t(F,{value:e(c).subject,"onUpdate:value":a[12]||(a[12]=r=>e(c).subject=r),placeholder:"請輸入訊息主旨",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[te,e(c).messageType==="MMS"]]),t(y,{span:24},{default:s(()=>{var r;return[t(x,G({"html-for":""},e(ne).content,{class:"relative",extra:`${e(c).messageType} 上限 ${e(Te).toLocaleString()} 字，目前 ${e(M)(e(c).content)?"--":(r=e(c).content)==null?void 0:r.replace(e(De),"").length} 字`}),{label:s(()=>[Es,Ns]),default:s(()=>{var h;return[t(je,{ref_key:"tagTextareaRef",ref:$e,modelValue:e(c).content,"onUpdate:modelValue":a[17]||(a[17]=v=>e(c).content=v),contenteditable:"true",style:{height:"292px"},"content-len":(h=e(c).content)==null?void 0:h.replace(e(De),"").length,"max-len":e(Te),placeholder:"請輸入文字"},Lt({default:s(()=>[t(g,null,{title:s(()=>[l(" 載入現有的自訂訊息 ")]),default:s(()=>[t(d,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:a[13]||(a[13]=v=>{var R;return(R=e(Ee))==null?void 0:R.show()})})]),_:1}),t(g,null,{title:s(()=>[l(" 增加縮網址 ")]),default:s(()=>[t(d,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:a[14]||(a[14]=v=>{var R;return(R=e(ze))==null?void 0:R.show()})})]),_:1}),t(g,null,{title:s(()=>[l(" 多媒體附件上傳 ")]),default:s(()=>[ee(t(d,{name:"cloud-upload",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:a[15]||(a[15]=v=>{var R;return(R=e(Be))==null?void 0:R.show(e(c).multimediaFile)})},null,512),[[te,e(c).messageType==="MMS"]])]),_:1}),t(g,null,{title:s(()=>[l(" AI 文字生成訊息 ")]),default:s(()=>[t(d,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:a[16]||(a[16]=v=>{var R;return(R=e(Xe))==null?void 0:R.show()})})]),_:1})]),_:2},[e(c).multimediaFile.length>0?{name:"multimediaBlock",fn:s(()=>[n("div",Bs,[(p(!0),b(V,null,me(e(c).multimediaFile,v=>(p(),b("div",{key:v.url,class:"w-90px max-h-60px"},[t(Pe,{source:{url:v.url,type:v.type},"show-file-name":!1,"can-play":!1,size:"small","image-class":"object-cover w-full h-full",onDeleteVideo:R=>{var He;return(He=e(Qe))==null?void 0:He.show(()=>Ve(v))}},null,8,["source","onDeleteVideo"]),n("div",Vs,f(v.fileName),1)]))),128))])]),key:"0"}:void 0]),1032,["modelValue","content-len","max-len"])]}),_:1},16,["extra"])]}),_:1}),t(y,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-20px"},{default:s(()=>[t(x,G(e(ne).reservationTime,{"html-for":"",class:"mb-4"}),{label:s(()=>[Ys,Ks,t(g,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 最快可預約5分鐘之後以及系統當下 1 年內時間，惟實際發送時間以系統排程為主 ")]),default:s(()=>[n("a",Hs,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(we,{value:e(c).sendTimeType,"onUpdate:value":a[18]||(a[18]=r=>e(c).sendTimeType=r)},{default:s(()=>[(p(!0),b(V,null,me(Object.entries(e(ht)),([r,h])=>(p(),B(de,{key:r,value:r},{default:s(()=>[l(f(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),ee(t(ue,{value:e(c).reservationTime,"onUpdate:value":a[19]||(a[19]=r=>e(c).reservationTime=r),format:"YYYY/MM/DD HH:mm","value-format":"YYYY/MM/DD HH:mm","disabled-date":Fe,"disabled-time":pt,"show-time":!0,"show-now":!1},null,8,["value"]),[[te,e(c).sendTimeType==="RESERVATION"]])]),_:1},16),t(x,G(e(ne).sendTimeType,{"html-for":""}),{label:s(()=>[qs,Gs,t(g,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 因接收門號而無法成功送達訊息，會在此設定有效時間內重複嘗試發送 ")]),default:s(()=>[n("a",zs,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(K,{value:e(c).effectiveTime,"onUpdate:value":a[20]||(a[20]=r=>e(c).effectiveTime=r),options:e(H),"list-height":300,placeholder:"請選擇有效時間"},null,8,["value","options"])]),_:1},16)]),_:1}),t(y,{span:24,class:le({"text-end":e(P)&&!e(m),"text-center py-6 ":!e(P)&&e(m)})},{default:s(()=>[t(Y,{status:"small2",class:"me-2",onClick:ft},{default:s(()=>[l(" 取消 ")]),_:1}),t(Y,{status:"small1","html-type":"submit"},{default:s(()=>[l(" 確定 ")]),_:1})]),_:1},8,["class"])]),_:1})]),_:1},512),[[te,!e(i)]]),e(i)&&e(D)?(p(),b("div",Ws,[Xs,n("div",Js,[t(pe,{gutter:[16,16]},{default:s(()=>[t(y,{span:24,class:"mb-"},{default:s(()=>[Qs,n("div",Zs,f(e(D).name),1)]),_:1}),t(y,{span:8},{default:s(()=>[en,e(D).sendTimeType==="RESERVATION"?(p(),b("div",tn,f(e(D).reservationTime),1)):(p(),b("div",{key:1,class:le(["text-base font-400 text-sms-grayscale-100",{"text-sms-status-alert-red":Math.sign(e(D).estimatedRemainingAmount)===-1}])}," 現在 ",2))]),_:1}),t(y,{span:8},{default:s(()=>[sn,n("div",nn,f(e(xe)(e(D).messageType,e(D).isParameter)),1)]),_:1}),t(y,{span:8},{default:s(()=>[an,n("div",on,f(e(D).phone),1)]),_:1}),e(D).messageType==="SMS"?(p(),B(y,{key:0,span:8},{default:s(()=>[ln,n("div",rn,f(e(D).totalLongMessages),1)]),_:1})):X("",!0),t(y,{span:8},{default:s(()=>[cn,n("div",dn," NT$ "+f(e(D).price),1)]),_:1}),t(y,{span:8},{default:s(()=>[n("div",un,[l(" 接收門號總數 "),t(g,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 未過濾所有黑名單，發送時會再檢核，最終接收門號數量可能變動 ")]),default:s(()=>[n("a",pn,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",mn,[l(f(e(D).recipientsCount.toLocaleString())+" ",1),fn])]),_:1}),t(y,{span:8},{default:s(()=>[n("div",_n,[l(" 黑名單門號總數 "),t(g,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 目前已篩選掉該黑名單數量，發送時會再檢核最新黑名單，最終黑名單門號總數可能變動 ")]),default:s(()=>[n("a",xn,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",gn,[l(f(e(D).isBlackListCount.toLocaleString())+" ",1),vn])]),_:1}),t(y,{span:8},{default:s(()=>[n("div",hn,[l(" 預估發送總金額 "),t(g,{placement:"top","get-popup-container":e(N),"overlay-inner-style":{width:"397px"}},{title:s(()=>[l(" 發送總金額 = 訊息總數 x ( 接收門號總數 - 黑名單門號總數 ) x 單價"),bn,l(" 參數訊息之訊息總數以一則計算，實際計價以發送字數等於幾則來計價 ")]),default:s(()=>[n("a",yn,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",wn," NT$ "+f(e(D).estimatedTotalAmount.toLocaleString()),1)]),_:1}),t(y,{span:8},{default:s(()=>[n("div",kn,[l(" 預估剩餘金額 "),t(g,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 餘額不足仍可預約，請注意於預約時間前進行儲值才可成功發送訊息 ")]),default:s(()=>[n("a",Cn,[t(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",{class:le(["text-base font-400 text-sms-grayscale-100",{"text-sms-status-alert-red":Math.sign(e(D).estimatedRemainingAmount)===-1}])}," NT$ "+f(e(D).estimatedRemainingAmount.toLocaleString()),3)]),_:1})]),_:1})]),n("div",{class:le(["flex items-center justify-end",{"py-4":!e(P)&&e(m)}])},[ee(n("div",{class:"text-sms-status-alert-red text-base me-4"},f(e(D).sendTimeType==="RESERVATION"?"可預約，請於發送時間之前儲值完畢，以免發送失敗":"剩餘金額不足，建議回上一步改成預約發送後再盡快儲值"),513),[[te,Math.sign(e(D).estimatedRemainingAmount)===-1]]),t(Y,{status:"small2",class:"me-2",onClick:a[21]||(a[21]=()=>{i.value=!1,D.value=null})},{default:s(()=>[l(" 上一步 ")]),_:1}),t(Y,{onClick:qe},{default:s(()=>[l(" 確定 ")]),_:1})],2)])):X("",!0)]),_:1}),o.showPreview?(p(),B(y,{key:0,flex:"428px",class:"relative"},{default:s(()=>[t(ke,{message:e(Ne)},null,8,["message"])]),_:1})):X("",!0)]),_:1},8,["class"]),t(Ct,{ref_key:"importCustomMessageRef",ref:Ee,content:e(c).content,onUpdateContent:Se},null,8,["content"]),t(Mt,{ref_key:"addFieldRef",ref:ct,onAddFieldToContent:Ge},null,512),t(Tt,{ref_key:"addLinkRef",ref:ze,onAddLinkToContent:We},null,512),t(St,{ref_key:"aiTextGenerationRef",ref:Xe,content:e(c).content,onUpdateContent:Se},null,8,["content"]),t(Xt,{ref_key:"multimediaUploadRef",ref:Be,onUpdateMultimediaFile:Je},null,512),t(ns,{ref_key:"delMultimediaFileRef",ref:Qe},null,512),t(oe,{open:e(ve),"onUpdate:open":a[22]||(a[22]=r=>Le(ve)?ve.value=r:null),title:"是否放棄目前編輯的內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onCancel:a[23]||(a[23]=r=>e(c).messageType="MMS"),onOk:a[24]||(a[24]=()=>{e(c).content="",e(c).multimediaFile=[],e(c).subject="",ve.value=!1})},{default:s(()=>[Mn]),_:1},8,["open"]),t(gs,{ref_key:"selectContactRef",ref:Ye,"form-state":e(c),onUpdateFormState:et},null,8,["form-state"]),t(hs,{ref_key:"selectGroupRef",ref:Ze,"form-state":e(c),onUpdateFormState:et},null,8,["form-state"]),t(oe,{open:e(he).open,"onUpdate:open":a[26]||(a[26]=r=>e(he).open=r),title:"資料格式有誤，請重新確認上傳",width:"400px",centered:""},{footer:s(()=>[t(Y,{onClick:a[25]||(a[25]=r=>e(he).open=!1)},{default:s(()=>[l(" 確定 ")]),_:1})]),default:s(()=>[n("div",Tn,[n("p",Sn,[l(" 正確的格式範例 "),n("a",{class:"text-sms-primary-blue-80 ms-1 underline underline-offset-2",href:e(he).url,download:""},"點擊此處下載",8,$n)])])]),_:1},8,["open"])],64)}}}),Rn={class:"px-20px pb-24px font-400 text-base text-sms-grayscale-80"},Fn=n("p",{class:"mb-4"},[l(" SMS：上限 335 字"),n("br"),l(" MMS：上限 1,000 字，可上傳多媒體 ")],-1),Pn=n("p",{class:"font-700 mb-4"}," 方式一：接收門號不同，且訊息內容不同 (支援SMS/MMS) ",-1),jn={class:"list-decimal pl-20px m-0"},In=n("li",null,"若選擇 MMS 訊息，必須輸入訊息主旨與上傳多媒體檔案，請留意多媒體組別",-1),Dn=n("li",null," 系統將直接發送訊息內容到相應的手機號碼，請確保欄位為有效門號和訊息內容，不允許有空白欄位 ",-1),Ln=n("p",{class:"font-700 mb-4"}," 方式二：接收門號不同，訊息內容可使用 5 個參數 (支援SMS/MMS) ",-1),Un={class:"list-decimal pl-20px m-0"},On=n("li",null,"承上，請注意每個參數欄位上限 50 字",-1),An=n("li",null,"上傳檔案進行發送參數訊息，系統將自動將訊息內容中的參數替換為參數檔案門號列",-1),En={class:"text-xs"},Nn=n("li",{class:"mb-4"},[l(" 訊息內容輸入： "),n("div",{class:"py-12.5px px-12px mt-4 rounded-12px border-sms-border-light-mode-light-gary border-solid -ms-20px"},[l(" %field1% 您好，您所填入的資料如下"),n("br"),l(" 會員編號： %field2% "),n("br"),l(" 性別： %field3% "),n("br"),l(" 生日： %field4% "),n("br"),l(" 年齡： %field5% ")])],-1),Bn=n("li",null,[l(" 兩門號收到的訊息分別如下： "),n("div",{class:"py-12.5px px-12px mt-4 rounded-12px border-sms-border-light-mode-light-gary border-solid -ms-20px"},[l(" 珊珊您好，您所填入的資料如下"),n("br"),l(" 會員編號： 9412918"),n("br"),l(" 性別： 女"),n("br"),l(" 生日： 08/22"),n("br"),l(" 年齡： 25"),n("br")]),n("div",{class:"py-12.5px px-12px mt-4 rounded-12px border-sms-border-light-mode-light-gary border-solid -ms-20px"},[l(" 馬可您好，您所填入的資料如下"),n("br"),l(" 會員編號： 5439577"),n("br"),l(" 性別： 男"),n("br"),l(" 生日： 08/29"),n("br"),l(" 年齡： 17"),n("br")])],-1),Vn=Oe({__name:"instructions-modal",setup(E,{expose:j}){const O=_(!1);function z(){O.value=!0}return j({show:z}),(J,T)=>{const I=nt,P=vt,m=Jt,L=Ae;return p(),B(L,{open:e(O),"onUpdate:open":T[0]||(T[0]=k=>Le(O)?O.value=k:null),"ok-text":"確定","cancel-text":"取消",title:"操作說明",width:"600px"},{default:s(()=>[n("div",Rn,[Fn,Pn,n("ul",jn,[n("li",null,[l(" 請下載Excel範例並填寫後上傳 "),t(P,{status:"small3",class:"!px-0 !py-0 !text-sms-primary-blue-80"},{icon:s(()=>[t(I,{name:"download"})]),default:s(()=>[l(" SMS匯出範例 ")]),_:1}),t(P,{status:"small3",class:"!pl-2 !py-0 !text-sms-primary-blue-80"},{icon:s(()=>[t(I,{name:"download"})]),default:s(()=>[l(" MMS匯出範例 ")]),_:1})]),In,Dn,n("li",null,[l(" SMS 範例如下，兩個門號將收到不同內容的訊息： "),t(m,{class:"!-ms-20px mb-4",columns:[{key:"phone",dataIndex:"phone",title:"接收門號"},{key:"content",dataIndex:"content",title:"訊息內容"}],"data-source":[{phone:"0922333111",content:"VIP會員你好，邀請你參加會員專屬活動"},{phone:"0908111111",content:"你好，歡迎加入 ooo 專屬品牌會員"}]})]),n("li",null,[l(" MMS 範例如下，每個門號將收到不同文字內容和多媒體的訊息： "),t(m,{class:"!-ms-20px mb-4",columns:[{key:"phone",dataIndex:"phone",title:"接收門號"},{key:"content",dataIndex:"content",title:"訊息內容"},{key:"group",dataIndex:"group",title:"對應組別"}],"data-source":[{phone:"0922333111",content:"VIP會員你好，邀請你參加會員專屬活動...",group:"第一組"},{phone:"0908111111",content:"邀請你參加會員專屬活動，點擊下方連結...",group:"第二組"},{phone:"0908111111",content:"邀請你參加會員專屬活動，點擊下方連結...",group:"第二組"}]})])]),Ln,n("ul",Un,[n("li",null,[l(" 請下載Excel範例並填寫後上傳 "),t(P,{status:"small3",class:"!px-0 !py-0 !text-sms-primary-blue-80"},{icon:s(()=>[t(I,{name:"download"})]),default:s(()=>[l(" SMS匯出範例 ")]),_:1}),t(P,{status:"small3",class:"!pl-2 !py-0 !text-sms-primary-blue-80"},{icon:s(()=>[t(I,{name:"download"})]),default:s(()=>[l(" MMS匯出範例 ")]),_:1})]),On,n("li",null,[l("訊息輸入內容中使用 "),t(I,{name:"link"}),l(" 插入參數（%field1% 至 %field5%），系統將自動替換為檔案中的欄位參數內容")]),An,n("li",null,[l(" 若上傳檔案的內容如下： "),t(m,{class:"!-ms-20px mb-4 max-w-none instruction-table2",columns:[{key:"phone",dataIndex:"phone",title:"接收門號",width:"104px"},{key:"field1",dataIndex:"field1",title:"參數1",width:"74px"},{key:"field2",dataIndex:"field2",title:"參數2",width:"74px"},{key:"field3",dataIndex:"field3",title:"參數3",width:"74px"},{key:"field4",dataIndex:"field4",title:"參數4",width:"74px"},{key:"field5",dataIndex:"field5",title:"參數5",width:"74px"}],"data-source":[{phone:"0922333111",field1:"珊珊",field2:"9412918",field3:"女",field4:"08/22",field5:"25"},{phone:"0946184761",field1:"馬克",field2:"5439577",field3:"男",field4:"08/29",field5:"17"}]},{headerCell:s(({column:k})=>[k.key!=="phone"?(p(),b(V,{key:0},[l(f(k.title)+" ",1),n("span",En,"(%"+f(k.key)+"%)",1)],64)):(p(),b(V,{key:1},[l(f(k.title),1)],64))]),_:1})]),Nn,Bn])])]),_:1},8,["open"])}}}),Yn=n("span",{class:"pe-.5"},"活動名稱",-1),Kn=n("span",{class:"text-red-500 pe-2"},"*",-1),Hn={href:"javascript:;"},qn=n("span",{class:"pe-.5"},"參數訊息類型",-1),Gn=n("span",{class:"text-red-500"},"*",-1),zn=n("span",{class:"pe-.5"},"訊息主旨與上傳多媒體",-1),Wn=n("span",{class:"text-red-500 pe-2"},"*",-1),Xn={href:"javascript:;"},Jn={key:0,class:"text-red-500 ps-2"},Qn={class:"mb-2"},Zn=n("div",null,"訊息主旨",-1),ea={key:0,class:"flex gap-2 overflow-y-auto h-95px my-2"},ta={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},sa=n("span",{class:"pe-.5"},"上傳參數檔案",-1),na=n("span",{class:"text-red-500 pe-2"},"*",-1),aa={href:"javascript:;"},oa=n("br",null,null,-1),la={href:"javascript:;",class:"underline underline-offset-2 text-sms-primary-blue-80 text-sm line-height-14px py-1"},ia=n("span",{class:"pe-.5"},"預覽參數檔案",-1),ra=n("span",{class:"text-red-500"},"*",-1),ca={key:0,class:"bg-sms-bg-light-mode-gray rounded-12px border border-solid border-sms-grayscale-40 flex flex-col justify-center items-center h-106px"},da=n("span",{class:"text-sms-grayscale-60"},"請先上傳參數檔案",-1),ua={class:"text-xs"},pa=n("span",{class:"pe-.5"},"訊息內容",-1),ma=n("span",{class:"text-red-500"},"*",-1),fa={class:"flex gap-2 overflow-y-auto h-95px"},_a={class:"text-sms-grayscale-60 text-xs font-500 font-sans text-center break-words"},xa=n("span",{class:"pe-.5"},"發送時間",-1),ga=n("span",{class:"text-red-500 pe-2"},"*",-1),va={href:"javascript:;"},ha=n("span",{class:"pe-.5"},"有效時間",-1),ya=n("span",{class:"text-red-500 pe-2"},"*",-1),ba={href:"javascript:;"},wa={key:0,id:"confirmDetail",class:"px-32px"},ka={class:"mb-4"},Ca=n("h2",{class:"font-500 text-22px text-sms-secondary-dark-blue-100"}," 內容確認 ",-1),Ma={key:0,class:"text-sm text-sms-grayscale-80"},Ta={key:1,class:"list-disc m-0 text-sm pl-20px"},Sa=n("li",null,"若有使用縮網址功能，請在發送訊息前再次確認短網址有效性，平台不會檢驗短網址有效性",-1),$a={key:0},Ra={class:"border border-solid border-sms-light-gray-60 p-16px pb-24px rounded-12px mb-2"},Fa=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 活動名稱 ",-1),Pa={class:"text-base font-400 text-sms-grayscale-100"},ja=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送時間 ",-1),Ia={key:0,class:"text-base font-400 text-sms-grayscale-100"},Da=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息類型 ",-1),La={class:"text-base font-400 text-sms-grayscale-100"},Ua=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 發送門號 ",-1),Oa={class:"text-base font-400 text-sms-grayscale-100"},Aa=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 訊息總數 (長訊息) ",-1),Ea={class:"text-base font-400 text-sms-grayscale-100"},Na={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},Ba={href:"javascript:;"},Va={class:"text-base font-400 text-sms-grayscale-100"},Ya=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),Ka=n("div",{class:"text-sm font-400 text-sms-grayscale-80 mb-1"}," 單價 ",-1),Ha={class:"text-base font-400 text-sms-grayscale-100"},qa={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},Ga={href:"javascript:;"},za={class:"text-base font-400 text-sms-grayscale-100"},Wa=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),Xa={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},Ja={href:"javascript:;"},Qa={class:"text-base font-400 text-sms-grayscale-100"},Za=n("span",{class:"text-sms-grayscale-60 text-sm"}," (非最終數量)",-1),eo={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},to={href:"javascript:;"},so=n("br",null,null,-1),no={class:"text-base font-400 text-sms-grayscale-100"},ao={class:"text-sm font-400 text-sms-grayscale-80 mb-1"},oo={href:"javascript:;"},lo=n("div",{class:"text-center px-24px py-20px w-328px text-base mx-auto"},[l(" 您編輯過的訊息內容將全部清空 "),n("br"),n("br"),n("p",{class:"mb-0"}," 提醒您，您已上傳的檔案也會全部清除 ")],-1),io={class:"text-center px-30px py-20px w-328px text-base mx-auto"},ro={class:"text-base text-center text-sms-gary-80"},co=["href"];var as=(E=>(E.smsDiffContent="接收門號不同，且訊息內容不同 (SMS)",E.mmsDiffContent="接收門號不同，且訊息內容不同 (MMS)",E.smsCommonContent="接收門號不同，訊息內容可使用 5 個參數 (SMS)",E.mmsCommonContent="接收門號不同，訊息內容可使用 5 個參數 (MMS)",E))(as||{});const So=Oe({__name:"create-or-update-form",props:{isCreate:{type:Boolean,default:!1},id:{},editCallback:{},showPreview:{type:Boolean,default:!0}},setup(E){const j=E;Q.extend(Wt);const{setHideAlert:O,setShowAlert:z}=kt(),J=_(null),T=_(null),I=Rt(),P=jt(),m=at(j,"isCreate"),L=at(j,"id"),{replaceFieldToHtml:k}=ts(),A=_(),{updateParameterMessageSending:fe,getParameterMessageSendingById:ie,createParameterMessageSending:_e,effectiveTimeOption:H,getActiveStatusLabel:xe,checkMessageSendingNameExist:ge,checkMessageSendingDetail:C,renderParameterMessagePreviewArray:S}=ss(),q=_(""),re=[{key:"第一組",subject:"",multimediaFile:[]},{key:"第二組",subject:"",multimediaFile:[]},{key:"第三組",subject:"",multimediaFile:[]}],U=_("smsDiffContent");let w={name:"",phone:void 0,isCommonContent:!1,messageType:"SMS",subject:"",multimediaFile:[],sendTimeType:"NOW",content:"",effectiveTime:"",reservationTime:"",multimediaFileWithSubject:st(re),recipients:[]};const Me=[{label:"0935-111-111",value:"0935-111-111"},{label:"0947-127-998",value:"0947-127-998"},{label:"0958-892-006",value:"0958-892-006"}],se=_(!1),i=Ue(st(w)),c=Ce(()=>i.messageType==="SMS"?335:1e3),Te=Ue({name:[{async validator(u,o){return M(o)?Promise.reject("請輸入活動名稱"):await ge(o,L.value)?Promise.reject("此活動名稱已存在，請重新命名 "):Promise.resolve()},trigger:"blur"}],phone:[{required:!0,message:"請選擇發送門號",trigger:"blur"}],subject:[{async validator(u,o){return i.messageType==="MMS"&&i.isCommonContent&&M(o)?Promise.reject("請輸入訊息主旨"):Promise.resolve()},trigger:"blur"}],file:[{async validator(u,o){return yt(o)||Ot(o)?Promise.reject("請上傳參數檔案"):Promise.resolve()},trigger:"blur"}],content:[{async validator(u,o){var a;if(i.isCommonContent){if(M(o))return Promise.reject("請輸入訊息內容");if(!M(o)&&((a=i.content)==null?void 0:a.replace(De,"").length)>c.value)return Promise.reject(`限制輸入 ${c.value} 字以內`)}return Promise.resolve()},trigger:"blur"}],reservationTime:[{async validator(u,o){if(i.sendTimeType==="RESERVATION"){if(M(o))return Promise.reject("請選擇預約日期或現在發送");if(Q().diff(Q(o),"minute")>0)return Promise.reject("閒置過久，請重新選擇預約時間")}return Promise.resolve()},trigger:"blur"}],multimediaFileWithSubject:[{async validator(u,o){if(U.value==="mmsDiffContent"){if(M(o))return Promise.reject("MMS 參數訊息請至少上傳一組訊息主旨與多媒體");if(o.filter(d=>M(d.multimediaFile)||M(d.subject)).length===3)return Promise.reject("MMS 參數訊息請至少上傳一組訊息主旨與多媒體")}return Promise.resolve()},trigger:"blur"}]}),{validateInfos:Z,validate:ne,resetFields:it}=At(i,Te);It(async()=>{var u,o,a,d,g,F,x,y;if(q.value=Q().format("YYYY/MM/DD_HH:mm"),!m.value&&L.value){const K=await ie(L.value);K.data&&(A.value=K.data,w={name:((u=A.value)==null?void 0:u.name)??e(q),phone:((o=A.value)==null?void 0:o.phone)??void 0,isCommonContent:((a=A.value)==null?void 0:a.isCommonContent)??!1,messageType:((d=A.value)==null?void 0:d.messageType)??"SMS",subject:((g=A.value)==null?void 0:g.subject)??"",multimediaFile:((F=A.value)==null?void 0:F.multimediaFile)??[],sendTimeType:((x=A.value)==null?void 0:x.sendTimeType)??"NOW",content:A.value.content??"",effectiveTime:A.value.effectiveTime??"",reservationTime:A.value.reservationTime??"",recipients:A.value.recipients??[],multimediaFileWithSubject:((y=A.value)==null?void 0:y.multimediaFileWithSubject)??[],file:A.value.file??void 0}),w.messageType==="MMS"?w.isCommonContent?U.value="mmsCommonContent":U.value="mmsDiffContent":w.isCommonContent?U.value="smsCommonContent":U.value="smsDiffContent"}else w.name=e(q),w.file=void 0;it(w)}),Dt(()=>i,u=>{const o=ot(u,w);m.value&&!L.value&&(o?O():z())},{deep:!0});const $=_(null);function D(){ne().then(async()=>{const u=await C(i,!0);if(u.data){$.value=u.data,se.value=!0,await xt();const o=document.getElementById("app");o&&(o.scrollTop=0)}}).catch(u=>{console.log(u)})}async function rt(){var a;const o=await(e(m)?_e:fe)(i,L.value);((a=o.data)==null?void 0:a.status)==="success"&&(m.value&&!L.value?(O(),I.success({message:"訊息新增成功",placement:"top"}),P.push("/sms-marketing/message-sending").then(()=>{setTimeout(()=>{var F;const{post:d,close:g}=gt({name:"in-message-sending-page"});d((F=o.data)==null?void 0:F.id),g()},800)})):(j.editCallback&&j.editCallback(!0,L.value),I.success({message:"訊息編輯成功",placement:"top"}),j.editCallback||P.push("/sms-marketing/appointment")))}const qe=_(null);function Ee(u){i.content=k(u)}const Se=_(null),$e=_(null);function ct(u){var o;for(const a of u)(o=Se.value)==null||o.insertFun(`${i.content}<span>${a}</span>`)}const Ge=_(null);function ze(u){var o;(o=Se.value)==null||o.insertFun(`<a href="${u}">${u}</a>`)}const We=_(null),Xe=Ce(()=>S(i)),Ne=_(null),Be=_(null);function Je(u,o=null){var a;(a=Be.value)==null||a.show(u),Ne.value=o}function Qe(u){yt(Ne.value)?i.multimediaFile=u:i.multimediaFileWithSubject[Ne.value].multimediaFile=u}const Ve=_(null);function ve(u){i.multimediaFile=i.multimediaFile.filter(o=>o.url!==u.url)}function dt(u,o){i.multimediaFileWithSubject[u].multimediaFile=i.multimediaFileWithSubject[u].multimediaFile.filter(a=>a.url!==o.url)}const Ye=Q();function Ze(u){const o=Ye.add(1,"year");return u&&(u<Ye||u>=o)}function et(u){if(u&&u.isToday()){const o=Q().add(5,"minute"),a=o.hour(),d=o.minute();return{disabledHours:()=>lt(0,24).slice(0,a),disabledMinutes:()=>lt(0,60).slice(0,d)}}return{}}function he(){const u=ot(i,w);j.editCallback&&j.editCallback(u)}function Re(){m.value&&!L.value?P.push("/sms-marketing/message-sending"):he()}const ce=_({open:!1,parameterMessageType:"smsCommonContent"});function ut(u){const o=i.multimediaFileWithSubject.filter(a=>!M(a.multimediaFile)||!M(a.subject));i.file||!M(i.recipients)||!M(i.content)||!M(i.subject)||!M(i.multimediaFile)||!M(o)?ce.value={open:!0,parameterMessageType:u.target.value}:tt(u.target.value)}function tt(u){switch(U.value=u,e(u)){case"smsCommonContent":i.messageType="SMS",i.isCommonContent=!0;break;case"mmsCommonContent":i.messageType="MMS",i.isCommonContent=!0;break;case"mmsDiffContent":i.messageType="MMS",i.isCommonContent=!1;break;default:i.messageType="SMS",i.isCommonContent=!1;break}i.file&&(i.file=void 0),ce.value.open&&(ce.value.open=!1,i.content="",i.subject="",i.recipients=[],i.multimediaFile=[],i.multimediaFileWithSubject=st(re))}const ye=_({open:!1,url:""}),Fe=_(null);function pt(u){const a=u.target.files;if(a&&a.length>0&&Fe.value){switch(e(U)){case"smsDiffContent":i.recipients=[{number:"1",phone:"0937118365",content:"親愛的黃先生您好，邀請您參加季末促銷活動！在這個特別的時刻"},{number:"2",phone:"0934837779",content:"親愛的邱會員，感謝您一直以來對我們的支持！為了回饋您的"},{number:"3",phone:"0973789398",content:"哈囉！您的專屬會員優惠已經準備就緒，等待您的立即領取！"},{number:"4",phone:"0911848298",content:"黃金會員專屬優惠啟動！您的獨享超級禮遇即將開始，千萬別"},{number:"5",phone:"0948393711",content:"親愛的會員，您是我們最珍貴的財富！為了感謝您長久以來的"}];break;case"mmsDiffContent":i.recipients=[{number:"1",phone:"0937118365",content:"親愛的黃先生您好，邀請您參加季末促銷活動！在這個特別的時刻",group:"第二組"},{number:"2",phone:"0934837779",content:"親愛的邱會員，感謝您一直以來對我們的支持！為了回饋您的",group:"第二組"},{number:"3",phone:"0973789398",content:"哈囉！您的專屬會員優惠已經準備就緒，等待您的立即領取！",group:"第二組"},{number:"4",phone:"0911848298",content:"黃金會員專屬優惠啟動！您的獨享超級禮遇即將開始，千萬別",group:"第一組"},{number:"5",phone:"0948393711",content:"親愛的會員，您是我們最珍貴的財富！為了感謝您長久以來的",group:"第一組"}];break;case"smsCommonContent":case"mmsCommonContent":i.recipients=[{number:"1",phone:"0938118293",field1:"小馬",field2:"9412918",field3:"-",field4:"-",field5:"-"},{number:"2",phone:"0946184761",field1:"安潔",field2:"5439577",field3:"-",field4:"-",field5:"-"},{number:"3",phone:"0966092938",field1:"Lucy",field2:"5634840",field3:"-",field4:"-",field5:"-"},{number:"4",phone:"0956482371",field1:"Sam",field2:"3437402",field3:"-",field4:"-",field5:"-"},{number:"5",phone:"0978049940",field1:"Tim",field2:"8480277",field3:"-",field4:"-",field5:"-"}];break}i.file={fileName:a[0].name,url:window.URL.createObjectURL(a[0])},Fe.value.value=""}}const mt=Ce(()=>{let u=[];switch(e(U)){case"mmsDiffContent":u=[{title:"編號",key:"number",dataIndex:"number",width:"57px",align:"center"},{title:"接收門號",key:"phone",dataIndex:"phone",width:"100px"},{title:"訊息內容",key:"content",dataIndex:"content",width:"278.5px",ellipsis:!0},{title:"對應組別",key:"group",dataIndex:"group",width:"107.5px"}];break;case"smsDiffContent":u=[{title:"編號",key:"number",dataIndex:"number",width:"57px",align:"center"},{title:"接收門號",key:"phone",dataIndex:"phone",width:"100px"},{title:"訊息內容",key:"content",dataIndex:"content",width:"278.5px",ellipsis:!0}];break;case"smsCommonContent":case"mmsCommonContent":u=[{title:"編號",key:"number",dataIndex:"number",width:"57px",align:"center"},{title:"接收門號",key:"phone",dataIndex:"phone",width:"100px"},{key:"field1",dataIndex:"field1",title:"參數1",width:"74px"},{key:"field2",dataIndex:"field2",title:"參數2",width:"74px"},{key:"field3",dataIndex:"field3",title:"參數3",width:"74px"},{key:"field4",dataIndex:"field4",title:"參數4",width:"74px"},{key:"field5",dataIndex:"field5",title:"參數5",width:"74px"}];break;default:u=[];break}return u}),ft=Ft();function Ke(){ft.confirm({title:"是否取消上傳檔案？",icon:t("span"),content:Ut("div",{innerHTML:"該檔案將取消上傳",class:"text-center px-30px py-20px w-328px text-base mx-auto"}),width:"400px",centered:!0,closable:!0,async onOk(){i.file=void 0,i.recipients=[]}})}function _t(u){var a;const o=[];if(M(u.subject)||o.push({phone:"",content:"",subject:u.subject,messageType:"SENT",contentType:"text"}),!M(u.multimediaFile))for(const d of u.multimediaFile)o.push({phone:"",content:d.url,messageType:"SENT",contentType:d.type});(a=J.value)==null||a.show(o)}return(u,o)=>{const a=nt,d=Et,g=Nt,F=Bt,x=Vt,y=Yt,K=us,Y=Kt,ae=Ht,W=vt,be=bt,de=nt,we=Jt,Pe=$t,je=qt,ue=Gt,pe=zt,Ie=wt,ke=Ae,oe=fs;return p(),b(V,null,[t(ue,{class:le(["bg-sms-grayscale-0 rounded-4",{"p-10 pl-1":u.showPreview}]),wrap:!1},{default:s(()=>[t(x,{flex:"auto"},{default:s(()=>[ee(t(pe,{class:"px-32px",layout:"vertical",autocomplete:"off",onSubmit:D},{default:s(()=>[t(ue,{gutter:[16,14]},{default:s(()=>[t(x,{span:24},{default:s(()=>[t(F,G(e(Z).name,{"html-for":""}),{label:s(()=>[Yn,Kn,t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 活動名稱可使用系統預設或自行輸入，但不可重複 ")]),default:s(()=>[n("a",Hn,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(g,{value:e(i).name,"onUpdate:value":o[0]||(o[0]=r=>e(i).name=r),placeholder:"請輸入文字",maxlength:30,onFocus:o[1]||(o[1]=()=>{e(i).name===e(q)&&(e(i).name="")}),onBlur:o[2]||(o[2]=()=>{e(i).name===""&&(e(i).name=e(q))})},null,8,["value"])]),_:1},16)]),_:1}),t(x,{span:24},{default:s(()=>[t(F,G(e(Z).phone,{label:"發送門號",required:""}),{default:s(()=>[t(y,{value:e(i).phone,"onUpdate:value":o[3]||(o[3]=r=>e(i).phone=r),options:Me,"allow-clear":"",placeholder:"請選擇發送門號"},null,8,["value"])]),_:1},16)]),_:1}),t(x,{span:24},{default:s(()=>[t(F,{"html-for":""},{label:s(()=>[qn,Gn,t(K,{type:"link",status:"small3",onClick:o[4]||(o[4]=r=>{var h;return(h=e(T))==null?void 0:h.show()})},{icon:s(()=>[t(a,{name:"doc",width:"16px"})]),default:s(()=>[l(" 操作說明 ")]),_:1})]),default:s(()=>[t(ae,{value:e(U),onChange:ut},{default:s(()=>[(p(!0),b(V,null,me(Object.entries(as),([r,h])=>(p(),B(Y,{key:r,style:{display:"flex",alignItems:"center",marginBottom:"10.5px"},value:r},{default:s(()=>[l(f(h)+" ",1),t(K,{type:"link",class:"!py-4px !px-0"},{icon:s(()=>[t(a,{name:"download"})]),default:s(()=>[l(" 匯出範例 ")]),_:1})]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1})]),_:1}),!e(i).isCommonContent&&e(i).messageType==="MMS"?(p(),B(x,{key:0,span:24},{default:s(()=>[t(F,{"html-for":""},{label:s(()=>{var r;return[zn,Wn,t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 多上傳三組多媒體檔案，並請依匯出範例欄位填入對應多媒體組別 ")]),default:s(()=>[n("a",Xn,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"]),e(Z).multimediaFileWithSubject.validateStatus==="error"?(p(),b("span",Jn,f((r=e(Z).multimediaFileWithSubject)==null?void 0:r.help.join(" ")),1)):X("",!0)]}),default:s(()=>[(p(!0),b(V,null,me(e(i).multimediaFileWithSubject,(r,h)=>(p(),B(x,{key:r.key,span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-20px mb-2"},{default:s(()=>[n("div",Qn,[l(f(r.key)+" ",1),t(W,{class:"text-sms-primary-blue-80 !px-0",status:"small3",onClick:v=>_t(r)},{icon:s(()=>[t(a,{name:"preview-blue",width:"16px"})]),_:2},1032,["onClick"])]),t(F,{"html-for":"",name:["multimediaFileWithSubject",h,"subject"],extra:"15 字以內"},{label:s(()=>[Zn]),default:s(()=>[t(g,{value:r.subject,"onUpdate:value":v=>r.subject=v,placeholder:"請輸入訊息主旨",maxlength:15},null,8,["value","onUpdate:value"])]),_:2},1032,["name"]),r.multimediaFile.length>0?(p(),b("div",ea,[(p(!0),b(V,null,me(r.multimediaFile,v=>(p(),b("div",{key:v.url,class:"w-90px max-h-60px"},[t(be,{source:{url:v.url,type:v.type},"show-file-name":!1,"can-play":!1,size:"small","image-class":"object-cover w-full h-full",onDeleteVideo:()=>{var R;return(R=e(Ve))==null?void 0:R.show(()=>dt(h,v))}},null,8,["source","onDeleteVideo"]),n("div",ta,f(v.fileName),1)]))),128))])):X("",!0),t(W,{status:"small2",onClick:v=>Je(r.multimediaFile,h)},{icon:s(()=>[t(a,{name:"upload"})]),default:s(()=>[l(" 上傳多媒體 ")]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1})):X("",!0),t(x,{span:24},{default:s(()=>[t(F,G({"html-for":""},e(Z).file),{label:s(()=>[sa,na,t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 1.每則訊息字數(含參數)不能超過限制。SMS 上限 335 字，MMS 上限1,000 字。"),oa,l(" 2.每個參數欄位上限 50 字 ")]),default:s(()=>[n("a",aa,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[n("input",{ref_key:"uploadFileRef",ref:Fe,type:"file",class:"!hidden",accept:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",onChange:pt},null,544),e(i).file?(p(),b(V,{key:1},[n("a",la,f(e(i).file.fileName),1),t(a,{name:"download-circle",width:"16px",class:"mx-2 cursor-pointer"}),t(a,{name:"delete-circle",width:"16px",class:"cursor-pointer",onClick:Ke})],64)):(p(),B(W,{key:0,status:"small2",onClick:o[5]||(o[5]=r=>{var h;return(h=e(Fe))==null?void 0:h.click()})},{icon:s(()=>[t(de,{name:"upload"})]),default:s(()=>[l(" 上傳EXCEL ")]),_:1}))]),_:1},16)]),_:1}),t(x,{span:24},{default:s(()=>[t(F,{"html-for":""},{label:s(()=>[ia,ra]),default:s(()=>[e(i).file?(p(),B(we,{key:1,columns:e(mt),"data-source":e(i).recipients},{headerCell:s(({column:r})=>[r.key.includes("field")?(p(),b(V,{key:0},[l(f(r.title)+" ",1),n("span",ua,"(%"+f(r.key)+"%)",1)],64)):(p(),b(V,{key:1},[l(f(r.title),1)],64))]),_:1},8,["columns","data-source"])):(p(),b("div",ca,[t(de,{name:"upload-circle-2",width:"40px",class:"text-sms-grayscale-40 mb-2"}),da]))]),_:1})]),_:1}),ee(t(x,{span:24},{default:s(()=>[t(F,G({label:"訊息主旨"},e(Z).subject,{extra:"15 字以內",required:""}),{default:s(()=>[t(g,{value:e(i).subject,"onUpdate:value":o[6]||(o[6]=r=>e(i).subject=r),placeholder:"請輸入訊息主旨",maxlength:15},null,8,["value"])]),_:1},16)]),_:1},512),[[te,e(i).messageType==="MMS"&&e(i).isCommonContent]]),ee(t(x,{span:24},{default:s(()=>{var r;return[t(F,G({"html-for":""},e(Z).content,{class:"relative",extra:`${e(i).messageType} 上限 ${e(c).toLocaleString()} 字，目前 ${e(M)(e(i).content)?"--":(r=e(i).content)==null?void 0:r.replace(e(De),"").length} 字`}),{label:s(()=>[pa,ma]),default:s(()=>{var h;return[t(Pe,{ref_key:"tagTextareaRef",ref:Se,modelValue:e(i).content,"onUpdate:modelValue":o[12]||(o[12]=v=>e(i).content=v),contenteditable:"true",style:{height:"292px"},"content-len":(h=e(i).content)==null?void 0:h.replace(e(De),"").length,"max-len":e(c),placeholder:"請輸入文字"},Lt({default:s(()=>[t(d,null,{title:s(()=>[l(" 載入現有的自訂訊息 ")]),default:s(()=>[t(a,{name:"import",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[7]||(o[7]=v=>{var R;return(R=e(qe))==null?void 0:R.show()})})]),_:1}),t(d,null,{title:s(()=>[l(" 加入參數 ")]),default:s(()=>[t(a,{name:"code",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[8]||(o[8]=v=>{var R;return(R=e($e))==null?void 0:R.show()})})]),_:1}),t(d,null,{title:s(()=>[l(" 增加縮網址 ")]),default:s(()=>[t(a,{name:"link",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[9]||(o[9]=v=>{var R;return(R=e(Ge))==null?void 0:R.show()})})]),_:1}),t(d,null,{title:s(()=>[l(" 多媒體附件上傳 ")]),default:s(()=>[ee(t(a,{name:"cloud-upload",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[10]||(o[10]=v=>Je(e(i).multimediaFile))},null,512),[[te,e(i).messageType==="MMS"]])]),_:1}),t(d,null,{title:s(()=>[l(" AI 文字生成訊息 ")]),default:s(()=>[t(a,{name:"AI",class:"text-sms-bg-dark-mode cursor-pointer me-4",width:"24px",onClick:o[11]||(o[11]=v=>{var R;return(R=e(We))==null?void 0:R.show()})})]),_:1})]),_:2},[e(i).multimediaFile.length>0?{name:"multimediaBlock",fn:s(()=>[n("div",fa,[(p(!0),b(V,null,me(e(i).multimediaFile,v=>(p(),b("div",{key:v.url,class:"w-90px max-h-60px"},[t(be,{source:{url:v.url,type:v.type},"show-file-name":!1,"can-play":!1,size:"small","image-class":"object-cover w-full h-full",onDeleteVideo:R=>{var He;return(He=e(Ve))==null?void 0:He.show(()=>ve(v))}},null,8,["source","onDeleteVideo"]),n("div",_a,f(v.fileName),1)]))),128))])]),key:"0"}:void 0]),1032,["modelValue","content-len","max-len"])]}),_:1},16,["extra"])]}),_:1},512),[[te,e(i).isCommonContent]]),t(x,{span:24,class:"bg-sms-bg-light-mode-gray rounded-md !p-20px"},{default:s(()=>[t(F,G(e(Z).reservationTime,{"html-for":"",class:"mb-4"}),{label:s(()=>[xa,ga,t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 最快可預約5分鐘之後以及系統當下 1 年內時間，惟實際發送時間以系統排程為主 ")]),default:s(()=>[n("a",va,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(ae,{value:e(i).sendTimeType,"onUpdate:value":o[13]||(o[13]=r=>e(i).sendTimeType=r)},{default:s(()=>[(p(!0),b(V,null,me(Object.entries(e(ht)),([r,h])=>(p(),B(Y,{key:r,value:r},{default:s(()=>[l(f(h),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),ee(t(je,{value:e(i).reservationTime,"onUpdate:value":o[14]||(o[14]=r=>e(i).reservationTime=r),format:"YYYY/MM/DD HH:mm","value-format":"YYYY/MM/DD HH:mm","disabled-date":Ze,"disabled-time":et,"show-time":!0,"show-now":!1},null,8,["value"]),[[te,e(i).sendTimeType==="RESERVATION"]])]),_:1},16),t(F,G(e(Z).sendTimeType,{"html-for":""}),{label:s(()=>[ha,ya,t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 因接收門號而無法成功送達訊息，會在此設定有效時間內重複嘗試發送 ")]),default:s(()=>[n("a",ba,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),default:s(()=>[t(y,{value:e(i).effectiveTime,"onUpdate:value":o[15]||(o[15]=r=>e(i).effectiveTime=r),options:e(H),"list-height":300,placeholder:"請選擇有效時間"},null,8,["value","options"])]),_:1},16)]),_:1}),t(x,{span:24,class:le({"text-end":e(m)&&!e(L),"text-center py-6 ":!e(m)&&e(L)})},{default:s(()=>[t(W,{status:"small2",class:"me-2",onClick:Re},{default:s(()=>[l(" 取消 ")]),_:1}),t(W,{status:"small1","html-type":"submit"},{default:s(()=>[l(" 確定 ")]),_:1})]),_:1},8,["class"])]),_:1})]),_:1},512),[[te,!e(se)]]),e(se)&&e($)?(p(),b("div",wa,[n("div",ka,[Ca,e($).isParameter?(p(),b("ul",Ta,[Sa,e($).messageType==="SMS"?(p(),b("li",$a," 當參數檔案中的欄位字數不一致時，每個參數都會單獨計算字數。若任何一個參數訊息超過70字，將會以長簡訊方式發送。 ")):X("",!0)])):(p(),b("p",Ma," 若有使用縮網址功能，請在發送訊息前再次確認短網址有效性，平台不會檢驗短網址有效性 "))]),n("div",Ra,[t(ue,{gutter:[16,16]},{default:s(()=>[t(x,{span:24,class:"mb-"},{default:s(()=>[Fa,n("div",Pa,f(e($).name),1)]),_:1}),t(x,{span:8},{default:s(()=>[ja,e($).sendTimeType==="RESERVATION"?(p(),b("div",Ia,f(e($).reservationTime),1)):(p(),b("div",{key:1,class:le(["text-base font-400 text-sms-grayscale-100",{"text-sms-status-alert-red":Math.sign(e($).estimatedRemainingAmount)===-1}])}," 現在 ",2))]),_:1}),t(x,{span:8},{default:s(()=>[Da,n("div",La,f(e(xe)(e($).messageType,e($).isParameter)),1)]),_:1}),t(x,{span:8},{default:s(()=>[Ua,n("div",Oa,f(e($).phone),1)]),_:1}),e($).messageType==="SMS"&&!e($).isParameter?(p(),B(x,{key:0,span:8},{default:s(()=>[Aa,n("div",Ea,f(e($).totalLongMessages),1)]),_:1})):X("",!0),e($).messageType==="SMS"&&e($).isParameter?(p(),B(x,{key:1,span:8},{default:s(()=>[n("div",Na,[l(" 預估訊息總數 "),t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 參數訊息類型一的字數以「一則訊息」估算。參數訊息類型二以「訊息內容字數進行估算(不含參數字數)」，惟實際發送時依參數檔案欄位字數計算 ")]),default:s(()=>[n("a",Ba,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",Va,[l(f(e($).estimatedTotalMessages)+" ",1),Ya])]),_:1})):X("",!0),t(x,{span:8},{default:s(()=>[Ka,n("div",Ha," NT$ "+f(e($).price),1)]),_:1}),t(x,{span:8},{default:s(()=>[n("div",qa,[l(" 接收門號總數 "),t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 未過濾所有黑名單，發送時會再檢核，最終接收門號數量可能變動 ")]),default:s(()=>[n("a",Ga,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",za,[l(f(e($).recipientsCount.toLocaleString())+" ",1),Wa])]),_:1}),t(x,{span:8},{default:s(()=>[n("div",Xa,[l(" 黑名單門號總數 "),t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 目前已篩選掉該黑名單數量，發送時會再檢核最新黑名單，最終黑名單門號總數可能變動 ")]),default:s(()=>[n("a",Ja,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",Qa,[l(f(e($).isBlackListCount.toLocaleString())+" ",1),Za])]),_:1}),t(x,{span:8},{default:s(()=>[n("div",eo,[l(" 預估發送總金額 "),t(d,{placement:"top","get-popup-container":e(N),"overlay-inner-style":{width:"397px"}},{title:s(()=>[l(" 發送總金額 = 訊息總數 x ( 接收門號總數 - 黑名單門號總數 ) x 單價"),so,l(" 參數訊息之訊息總數以一則計算，實際計價以發送字數等於幾則來計價 ")]),default:s(()=>[n("a",to,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",no," NT$ "+f(e($).estimatedTotalAmount.toLocaleString()),1)]),_:1}),t(x,{span:8},{default:s(()=>[n("div",ao,[l(" 預估剩餘金額 "),t(d,{placement:"top","get-popup-container":e(N)},{title:s(()=>[l(" 餘額不足仍可預約，請注意於預約時間前進行儲值才可成功發送訊息 ")]),default:s(()=>[n("a",oo,[t(a,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1},8,["get-popup-container"])]),n("div",{class:le(["text-base font-400 text-sms-grayscale-100",{"text-sms-status-alert-red":Math.sign(e($).estimatedRemainingAmount)===-1}])}," NT$ "+f(e($).estimatedRemainingAmount.toLocaleString()),3)]),_:1})]),_:1})]),n("div",{class:le(["flex items-center justify-end",{"py-4":!e(m)&&e(L)}])},[ee(n("div",{class:"text-sms-status-alert-red text-base me-4"},f(e($).sendTimeType==="RESERVATION"?"可預約，請於發送時間之前儲值完畢，以免發送失敗":"剩餘金額不足，建議回上一步改成預約發送後再盡快儲值"),513),[[te,Math.sign(e($).estimatedRemainingAmount)===-1]]),t(W,{status:"small2",class:"me-2",onClick:o[16]||(o[16]=()=>{se.value=!1,$.value=null})},{default:s(()=>[l(" 上一步 ")]),_:1}),t(W,{onClick:rt},{default:s(()=>[l(" 確定 ")]),_:1})],2)])):X("",!0)]),_:1}),u.showPreview?(p(),B(x,{key:0,flex:"428px",class:"relative"},{default:s(()=>[t(Ie,{message:e(Xe)},null,8,["message"])]),_:1})):X("",!0)]),_:1},8,["class"]),t(Ct,{ref_key:"importCustomMessageRef",ref:qe,content:e(i).content,onUpdateContent:Ee},null,8,["content"]),t(Mt,{ref_key:"addFieldRef",ref:$e,onAddFieldToContent:ct},null,512),t(Tt,{ref_key:"addLinkRef",ref:Ge,onAddLinkToContent:ze},null,512),t(St,{ref_key:"aiTextGenerationRef",ref:We,content:e(i).content,onUpdateContent:Ee},null,8,["content"]),t(Xt,{ref_key:"multimediaUploadRef",ref:Be,onUpdateMultimediaFile:Qe},null,512),t(ns,{ref_key:"delMultimediaFileRef",ref:Ve},null,512),t(ke,{open:e(ce).open,"onUpdate:open":o[17]||(o[17]=r=>e(ce).open=r),title:"是否放棄目前編輯的訊息內容？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onOk:o[18]||(o[18]=r=>tt(e(ce).parameterMessageType))},{default:s(()=>[lo]),_:1},8,["open"]),t(ke,{open:e(ye).open,"onUpdate:open":o[20]||(o[20]=r=>e(ye).open=r),title:"資料格式有誤，請重新確認上傳",width:"400px",centered:""},{footer:s(()=>[t(W,{onClick:o[19]||(o[19]=r=>e(ye).open=!1)},{default:s(()=>[l(" 確定 ")]),_:1})]),default:s(()=>[n("div",io,[n("p",ro,[l(" 正確的格式範例 "),n("a",{class:"text-sms-primary-blue-80 ms-1 underline underline-offset-2",href:e(ye).url,download:""},"點擊此處下載",8,co)])])]),_:1},8,["open"]),t(Vn,{ref_key:"instructionsModalRef",ref:T},null,512),t(oe,{ref_key:"previewGroupMultimediaRef",ref:J},null,512)],64)}}});export{To as _,So as a};

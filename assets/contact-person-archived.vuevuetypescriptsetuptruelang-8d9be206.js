import{F as se,_ as de}from"./request-3552e6c3.js";import{u as ue,G as re,_ as ie}from"./GenderEnum-eefb98a3.js";import{g as pe,a as ce,_ as me,b as _e}from"./index.vuevuetypescriptsetuptruelang-8068f11a.js";import{_ as fe}from"./index-4b80b22a.js";import{_ as ve}from"./index.vuevuetypescriptsetuptruelang-374ce0ee.js";import{k as xe,_ as ye}from"./index-b55f1cdf.js";import{u as ge}from"./group-label-31b72c82.js";import{E as we,I as ke,r as he,s as be,U as Ce,u as Ie,F as Te,P as Re,G as Ye}from"./antd-16a0cd46.js";import{d as Le,f as x,D as Me,o as Se,r as Ue,u as e,W as v,X as y,Y as m,k as a,$ as n,G as i,a3 as c,F as g,a4 as w,_ as De,H as K}from"./vue-b9a22f97.js";const Fe={class:"flex justify-between px-2 items-center mb-2"},Ke={class:"me-1"},Pe={href:"javascript:;"},Ve=m("span",null,"全域黑名單功能: 主帳號將特定手機門號加入黑名單，主帳號和子帳號皆無法發送該門號任何訊息",-1),Oe=m("div",{class:"h-59px px-20px py-24px"},[m("p",{class:"text-center text-sms-grayscale-80"},"您選擇的聯絡人將直接永久刪除。")],-1),Be=m("div",{class:"h-59px px-20px py-24px"},[m("p",{class:"text-center text-sms-grayscale-80"},"聯絡人列表中，已經存在相同的聯絡人。")],-1),We=Le({__name:"contact-person-archived",props:{toContactPerson:{type:Function,required:!0}},setup(P){const V=P,Y=x([{value:!0,label:"是"},{value:!1,label:"否"}]),{contactPerson:L,pagination:h,getContactPersonArchived:O,deleteContactPerson:B,unArchivedContactPerson:$}=ue(),{getGroupLabelOption:E,groupOptions:M}=ge(),S=xe(),A=x(!1);Me(async()=>{C(),await E()}),Se(()=>{A.value=!0});const G=[{title:"手機門號",dataIndex:"phone",key:"phone",sorter:!0,fixed:"left",width:"130px"},{title:"姓名",dataIndex:"name",key:"name",sorter:!0,fixed:"left",width:"80px"},{title:"群組標籤",dataIndex:"group",key:"group",fixed:"left",width:"250px"},{title:"性別",dataIndex:"gender",key:"gender",sorter:!0,width:"70px"},{title:"黑名單",dataIndex:"isBlackList",key:"isBlackList",sorter:!0,width:"100px"},{title:"聯絡電話",dataIndex:"contact",key:"contact",sorter:!0,width:"110px"},{title:"公司名稱",dataIndex:"company",key:"company",sorter:!0,ellipsis:!0,width:"121px"},{title:"Email",dataIndex:"email",key:"email",sorter:!0,ellipsis:!0,width:"184px"},{title:"生日",dataIndex:"birth",key:"birth",sorter:!0,width:"95px"},{title:"通訊地址",dataIndex:"address",key:"address",sorter:!0,ellipsis:!0,width:"108px"},{title:"備註",dataIndex:"note",key:"note",sorter:!0,width:"108px"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"140px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0,width:"140px"}],r=Ue({selectedRowKeys:[],selectedRows:[],loading:!1}),N=(s,t)=>{console.log("selectedRowKeys changed: ",s,t),r.selectedRowKeys=s,r.selectedRows=t},l=x({sortField:"createTime",sortOrder:"descend",phone:"",name:"",group:[],company:"",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:"",blackList:void 0}),j=x(),C=async(s=1,t=10)=>{var _,k;let d={current:s,pageSize:t,...e(l),group:((k=(_=l.value)==null?void 0:_.group)==null?void 0:k.map(p=>p.id))??[]};await O(d)},z=async(s,t,d)=>{console.log("pagination:",s,"sorter:",d),l.value=Object.assign(l.value,{sortField:d.field,sortOrder:d.order}),await C(s.current,s.pageSize)},R=x(null),q=()=>{var s;C(1),(s=R.value)==null||s.hide()},b=x(!1),H=async()=>{var t;((t=(await B(r.selectedRows.map(d=>d.key))).data)==null?void 0:t.status)==="success"&&(C(h.value.current===1||L.value.length-r.selectedRowKeys.length>1?h.value.current:h.value.current-1,h.value.pageSize),r.selectedRowKeys=[],r.selectedRows=[],b.value=!1,S.success({message:"聯絡人刪除成功",placement:"top"}))},I=x(!1),W=()=>{I.value=!0},X=async()=>{var t;((t=(await $(r.selectedRowKeys)).data)==null?void 0:t.status)==="success"&&(S.success({message:"聯絡人回復成功",placement:"top"}),V.toContactPerson())},J=()=>{X()},Q=()=>document.body;return(s,t)=>{const d=ye,_=ve,k=ke,p=fe,f=he,Z=me,ee=_e,U=be,D=Ce,te=Ie,ae=Te,oe=Re,ne=ie,le=de,F=Ye;return v(),y(g,null,[m("div",Fe,[m("div",null,[a(_,{status:"small2",class:"me-2",disabled:e(r).selectedRowKeys.length===0,onClick:W},{icon:n(()=>[a(d,{name:"change",width:"16px"})]),default:n(()=>[i("回復聯絡人 ")]),_:1},8,["disabled"]),a(_,{status:"small2",class:"me-2",disabled:e(r).selectedRowKeys.length===0},{icon:n(()=>[a(d,{name:"download",width:"16px"})]),default:n(()=>[i("匯出CSV ")]),_:1},8,["disabled"]),a(_,{status:"small2",class:"me-2",onClick:t[0]||(t[0]=o=>b.value=!0),disabled:e(r).selectedRowKeys.length===0},{icon:n(()=>[a(d,{name:"delete",width:"16px"})]),default:n(()=>[i("永久刪除 ")]),_:1},8,["disabled"])]),a(se,{ref_key:"filterKeywordInputRef",ref:R,class:"w-440px h-40px",modelValue:e(l).keyword,"onUpdate:modelValue":t[10]||(t[10]=o=>e(l).keyword=o),placeholder:"搜尋門號、姓名、公司、通訊地址、Email、備註",onClearFilter:t[11]||(t[11]=()=>{l.value={...e(l),phone:"",name:"",group:[],company:"",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:"",blackList:void 0}})},{filterForm:n(()=>[a(ae,{ref_key:"formRef",ref:j,layout:"vertical",model:e(l),autocomplete:"off"},{default:n(()=>[a(te,{gutter:[16,12]},{default:n(()=>[a(f,{span:24},{default:n(()=>[a(p,{label:"手機門號",valueed:e(l).phone},{default:n(()=>[a(k,{value:e(l).phone,"onUpdate:value":t[1]||(t[1]=o=>e(l).phone=o)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(f,{span:24},{default:n(()=>[a(p,{label:"姓名",valueed:e(l).name},{default:n(()=>[a(k,{value:e(l).name,"onUpdate:value":t[2]||(t[2]=o=>e(l).name=o)},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(f,{span:24},{default:n(()=>[a(p,{id:"group",label:"群組標籤",valueed:e(pe)(e(l).group)},{default:n(()=>[a(U,{options:e(M),maxTagCount:2,showArrow:!0,showSearch:!1,mode:"multiple",value:e(l).group,"onUpdate:value":t[4]||(t[4]=o=>e(l).group=o),class:"w-full"},{dropdownRender:n(({menuNode:o})=>[a(Z,{menu:o,modelValue:e(l).group,"onUpdate:modelValue":t[3]||(t[3]=u=>e(l).group=u),options:e(M)},null,8,["menu","modelValue","options"])]),option:n(({value:o,label:u})=>[a(ee,{values:e(l).group,value:o,label:u},null,8,["values","value","label"])]),menuItemSelectedIcon:n(()=>[i(c(""))]),_:1},8,["options","value"])]),_:1},8,["valueed"])]),_:1}),a(f,{span:24},{default:n(()=>[a(p,{label:"黑名單",valueed:e(ce)(e(l).blackList,e(Y))},{default:n(()=>[a(U,{options:e(Y),maxTagCount:2,showArrow:!0,showSearch:!1,value:e(l).blackList,"onUpdate:value":t[5]||(t[5]=o=>e(l).blackList=o),class:"w-full"},null,8,["options","value"])]),_:1},8,["valueed"])]),_:1}),a(f,{span:24},{default:n(()=>[a(p,{label:"公司名稱",valueed:e(l).company},{default:n(()=>[a(k,{value:e(l).company,"onUpdate:value":t[6]||(t[6]=o=>e(l).company=o),name:"company"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(f,{span:24},{default:n(()=>[a(p,{label:"建立時間",valueed:e(l).createTime},{default:n(()=>[a(D,{class:"w-full",value:e(l).createTime,"onUpdate:value":t[7]||(t[7]=o=>e(l).createTime=o),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(f,{span:24},{default:n(()=>[a(p,{label:"修改時間",valueed:e(l).updateTime},{default:n(()=>[a(D,{class:"w-full",value:e(l).updateTime,"onUpdate:value":t[8]||(t[8]=o=>e(l).updateTime=o),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(f,{span:24,class:"text-center"},{default:n(()=>[a(_,{status:"small2",class:"me-5",onClick:t[9]||(t[9]=o=>{var u;return(u=e(R))==null?void 0:u.hide()})},{default:n(()=>[i("取消")]),_:1}),a(_,{status:"small1",onClick:q},{default:n(()=>[i("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(le,{dataSource:e(L),columns:G,scroll:{x:1500},size:"small",showSorterTooltip:!1,"row-selection":{selectedRowKeys:e(r).selectedRowKeys,onChange:N},onChange:z,pagination:{...e(h)}},{headerCell:n(({column:o})=>[o.key==="isBlackList"?(v(),y(g,{key:0},[m("span",Ke,c(o.title),1),a(oe,{placement:"top","get-popup-container":Q},{title:n(()=>[Ve]),default:n(()=>[m("a",Pe,[a(d,{name:"union",width:"16px",class:"text-sms-grayscale-60"})])]),_:1})],64)):w("",!0)]),bodyCell:n(({column:o,record:u,text:T})=>[o.dataIndex==="group"?(v(),De(ne,{key:0,chips:u.group,"max-count":3},null,8,["chips"])):w("",!0),o.dataIndex==="phone"?(v(),y(g,{key:1},[i(c(u.countryCode)+c(u.phone),1)],64)):w("",!0),o.dataIndex==="contact"?(v(),y(g,{key:2},[i(c(u.areaCode)+c(u.contact),1)],64)):w("",!0),o.dataIndex==="gender"?(v(),y(g,{key:3},[i(c(e(re)[T]),1)],64)):w("",!0),o.dataIndex==="isBlackList"?(v(),y(g,{key:4},[i(c(T?"黑名單":""),1)],64)):w("",!0),o.dataIndex==="note"?(v(),y(g,{key:5},[i(c(e(we)(T)?"-":T),1)],64)):w("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),a(F,{open:e(b),"onUpdate:open":t[12]||(t[12]=o=>K(b)?b.value=o:null),centered:"",title:"是否永久刪除選取的聯絡人？",width:"440px",cancelText:"取消",okText:"確定",onOk:H},{default:n(()=>[Oe]),_:1},8,["open"]),a(F,{open:e(I),"onUpdate:open":t[13]||(t[13]=o=>K(I)?I.value=o:null),centered:"",title:"是否覆蓋現有的聯絡人？",width:"440px",cancelText:"取消",okText:"確定",onOk:J},{default:n(()=>[Be]),_:1},8,["open"])],64)}}});export{We as _};

import{u as me,_ as ie}from"./request-cdb76966.js";import{_ as q}from"./index.vuevuetypescriptsetuptruelang-6d8252fd.js";import{k as z,_ as ue}from"./index-0d92b428.js";import{Y as de,N as G,O as pe,I as H,q as W,r as X,u as _e,F as A,K as J,G as ye,H as fe}from"./antd-cd9a43bc.js";import{d as Q,r as Y,f as g,W as T,_ as Z,$ as s,k as t,ab as ge,u as e,H as ee,D as ke,o as ve,a0 as Ce,X as $,G as y,E as xe,a4 as P,Y as k,a3 as B,F as Te}from"./vue-8aa546f0.js";const j=[{key:"1",categoryName:"新年優惠",smsCount:32,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"2",categoryName:"情人節優惠",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"3",categoryName:"聖誕祝福",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"4",categoryName:"12月壽星",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"5",categoryName:"11月壽星",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"6",categoryName:"10月壽星",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"7",categoryName:"9月壽星",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"8",categoryName:"8月壽星",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"9",categoryName:"7月壽星",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"10",categoryName:"6月壽星",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"},{key:"11",categoryName:"5月壽星",smsCount:34,createTime:"2012/02/10 09:20",updateTime:"2016/07/26 19:32"}],te=()=>{const{list:N,pagination:w,setResponseList:p}=me();return{getSmsCategory:async _=>{p({total:11,pages:1,current:1,pageSize:10,records:j})},smsCategory:N,pagination:w,checkSmsCategoryExist:async _=>!!de(j,{categoryName:_})}},we=Q({__name:"sms-category-create",props:{saveCallbck:{type:Function,required:!0}},setup(N,{expose:w}){const p=z(),{checkSmsCategoryExist:S}=te(),n=N,_={categoryName:""},v=Y(G(_)),C=Y({categoryName:[{validator:async function(I,d){const x=await S(d);return console.log(x),x?Promise.reject(`系統中已有「${d}」，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:M,resetFields:l,validate:F}=pe(v,C),u=g(!1),E=async()=>{l(_),u.value=!0},b=()=>{F().then(()=>{p.success({message:"訊息類別新增成功",placement:"top"}),n.saveCallbck(),u.value=!1})};return w({show:E}),(I,d)=>{const x=H,U=W,V=X,f=q,K=_e,L=A,R=J;return T(),Z(R,{open:e(u),"onUpdate:open":d[1]||(d[1]=a=>ee(u)?u.value=a:null),title:"新增訊息類別",centered:"",width:"440px",cancelText:"取消",okText:"確定",onOk:b},{default:s(()=>[t(L,{ref:"formRef",class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:b},{default:s(()=>[t(K,{gutter:[16,0]},{default:s(()=>[t(V,{span:24},{default:s(()=>[t(U,ge({label:"訊息類別"},e(M).categoryName,{required:"",extra:"15字以內"}),{default:s(()=>[t(x,{value:e(v).categoryName,"onUpdate:value":d[0]||(d[0]=a=>e(v).categoryName=a),placeholder:"請輸入訊息類別"},null,8,["value"])]),_:1},16)]),_:1}),t(f,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512)]),_:1},8,["open"])}}}),be={class:"flex justify-between px-2 items-center mb-2"},he={key:0},Ne={key:0},Se={class:"editable-cell-wrapper"},Fe={class:"text-sms-status-alert-red text-xs"},Re={key:1,class:"editable-cell-wrapper"},De=k("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"},[y(" 您選擇的訊息類別將永久刪除。"),k("br"),y(" 原本屬於該訊息類別的自訂訊息，"),k("br"),y(" 將改為未分類狀態。 ")],-1),Ie=Q({__name:"sms-category",setup(N){const{getSmsCategory:w,smsCategory:p,pagination:S}=te(),n=Y({}),_=g(!1);ke(async()=>{u()}),ve(()=>{_.value=!0});const v=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"320px"},{title:"訊息數量",dataIndex:"smsCount",key:"smsCount",sorter:!0,width:"160px",align:"right"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"160px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0}],C=Y({selectedRowKeys:[],selectedRows:[],loading:!1}),M=(a,o)=>{console.log("selectedRowKeys changed: ",a,o),C.selectedRowKeys=a,C.selectedRows=o},l=g({sortField:"createTime",sortOrder:"descend",phone:"",name:"",group:[],company:"",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:""}),F=g(),u=async(a=1,o=10)=>{var c,h;let i={current:a,pageSize:o,...e(l),group:((h=(c=l.value)==null?void 0:c.group)==null?void 0:h.map(D=>D.id))??[]};await w(i)},E=a=>{n[a]={...G(p.value.filter(o=>a===o.key)[0]),msg:""}},b=a=>{const o=n[a];p.value.find(c=>o.categoryName===c.categoryName&&o.key!==c.key)?n[a].msg=`系統中已有「${n[a].categoryName}」，請勿重複新增`:(Object.assign(p.value.filter(c=>a===c.key)[0],n[a]),delete n[a])},I=async(a,o,i)=>{console.log("pagination:",a,"sorter:",i),l.value=Object.assign({sortField:i.field,sortOrder:i.order}),await u(a.current,a.pageSize)},d=g(!1),x=()=>{d.value=!0},U=()=>{d.value=!1,u(1)},V=z(),f=g(!1),K=()=>{f.value=!0},L=()=>{V.success({message:"訊息類別刪除成功",placement:"top"}),f.value=!1},R=g(null);return(a,o)=>{const i=ue,c=q,h=fe,D=W,ae=X,oe=A,se=Ce("search-input"),ne=H,le=ie,re=J;return T(),$(Te,null,[e(_)?(T(),Z(xe,{key:0,to:"#extraContent"},[t(c,{status:"small1",onClick:o[0]||(o[0]=r=>{var m;return(m=e(R))==null?void 0:m.show()})},{icon:s(()=>[t(i,{name:"plus",width:"16px"})]),default:s(()=>[y("新增類別訊息 ")]),_:1})])):P("",!0),k("div",be,[k("div",null,[t(c,{status:"small2",class:"me-2",onClick:K,disabled:e(C).selectedRowKeys.length===0},{icon:s(()=>[t(i,{name:"delete",width:"16px"})]),default:s(()=>[y("刪除 ")]),_:1},8,["disabled"])]),t(se,{class:"w-440px h-40px",modelValue:e(l).keyword,"onUpdate:modelValue":o[3]||(o[3]=r=>e(l).keyword=r),onClick:x,placeholder:"搜尋訊息類別",onClearFilter:o[4]||(o[4]=()=>{var r;e(l).keyword="",(r=e(F))==null||r.resetFields()})},{filterForm:s(()=>[t(oe,{ref_key:"formRef",ref:F,layout:"vertical",model:e(l),wrapperCol:{span:24},autocomplete:"off"},{default:s(()=>[t(D,{name:"createTime",label:"建立時間",class:"mb-2"},{default:s(()=>[t(h,{class:"w-full",placeholder:["建立時間","建立時間"],value:e(l).createTime,"onUpdate:value":o[1]||(o[1]=r=>e(l).createTime=r),placement:"topLeft",format:"YYYY-MM-DD"},null,8,["value"])]),_:1}),t(D,{name:"updateTime",label:"修改時間",class:"mb-2"},{default:s(()=>[t(h,{class:"w-full",placeholder:["修改時間","修改時間"],value:e(l).updateTime,"onUpdate:value":o[2]||(o[2]=r=>e(l).updateTime=r),placement:"topLeft",format:"YYYY-MM-DD"},null,8,["value"])]),_:1}),t(ae,{class:"text-center"},{default:s(()=>[t(c,{status:"small2",class:"me-5"},{default:s(()=>[y("取消")]),_:1}),t(c,{status:"small1",onClick:U},{default:s(()=>[y("確定")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),t(le,{dataSource:e(p),columns:v,size:"small",showSorterTooltip:!1,"row-selection":{selectedRowKeys:e(C).selectedRowKeys,onChange:M},onChange:I,pagination:{...e(S)}},{bodyCell:s(({column:r,record:m,text:ce})=>[r.dataIndex==="categoryName"?(T(),$("div",he,[e(n)[m.key]?(T(),$("div",Ne,[k("div",Se,[t(ne,{value:e(n)[m.key].categoryName,"onUpdate:value":O=>e(n)[m.key].categoryName=O,onPressEnter:O=>b(m.key),maxLength:15,status:e(n)[m.key].msg&&!e(ye)(e(n)[m.key].msg)?"error":""},null,8,["value","onUpdate:value","onPressEnter","status"]),t(i,{name:"save",onClick:O=>b(m.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"])]),k("span",Fe,B(e(n)[m.key].msg),1)])):(T(),$("div",Re,[y(B(ce||" ")+" ",1),t(i,{name:"edit",onClick:O=>E(m.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"])]))])):P("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),t(we,{ref_key:"smsCategoryCreateRef",ref:R,"save-callbck":()=>u(1)},null,8,["save-callbck"]),t(re,{open:e(f),"onUpdate:open":o[5]||(o[5]=r=>ee(f)?f.value=r:null),title:"是否刪除選取的訊息類別？",centered:"",cancelText:"取消",okText:"確定",onOk:L,width:"440px"},{default:s(()=>[De]),_:1},8,["open"])],64)}}});export{Ie as _};

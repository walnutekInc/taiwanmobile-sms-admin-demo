import{F as de,_ as pe}from"./request-74a2fc5c.js";import{_ as _e}from"./index-6b61ddc5.js";import{_ as J}from"./index.vuevuetypescriptsetuptruelang-df03164d.js";import{k as Q,_ as fe}from"./index-858981d5.js";import{u as W}from"./sms-category-6121055d.js";import{H as X,E as z,J as ye,I as Z,q as ge,r as ee,u as te,F as ae,G as se,Q as ve}from"./antd-f7215ad7.js";import{d as oe,r as I,f as k,W as d,_ as G,$ as o,k as a,ab as ke,u as t,H as ne,D as xe,o as we,a0 as Ce,X as h,G as p,E as be,a4 as q,Y as x,F as A,a3 as M}from"./vue-b9a22f97.js";const he=oe({__name:"sms-category-create",props:{saveCallbck:{type:Function,required:!0}},setup(H,{expose:$}){const w=Q(),{checkSmsCategoryExist:K,createSmsCategory:O}=W(),U=H,r={categoryName:""},f=I(X(r)),E=I({categoryName:[{validator:async function(T,c){if(z(c))return Promise.reject("請輸入訊息類別");const _=await K(c);return console.log(_),_?Promise.reject(`系統中已有「${c}」，請勿重複新增`):Promise.resolve()},trigger:"blur"}]}),{validateInfos:m,resetFields:P,validate:n}=ye(f,E),y=k(!1),C=async()=>{P(r),y.value=!0},N=()=>{n().then(async()=>{var c;((c=(await O(f.categoryName)).data)==null?void 0:c.status)==="success"&&(w.success({message:"訊息類別新增成功",placement:"top"}),U.saveCallbck(),y.value=!1)})};return $({show:C}),(T,c)=>{const _=Z,V=ge,R=ee,g=J,j=te,L=ae,F=se;return d(),G(F,{open:t(y),"onUpdate:open":c[1]||(c[1]=s=>ne(y)?y.value=s:null),title:"新增訊息類別",centered:"",width:"440px",cancelText:"取消",okText:"確定",onOk:N},{default:o(()=>[a(L,{ref:"formRef",class:"px-24px",layout:"vertical",autocomplete:"off",onSubmit:N},{default:o(()=>[a(j,{gutter:[16,0]},{default:o(()=>[a(R,{span:24},{default:o(()=>[a(V,ke({label:"訊息類別"},t(m).categoryName,{required:"",extra:"15字以內"}),{default:o(()=>[a(_,{value:t(f).categoryName,"onUpdate:value":c[0]||(c[0]=s=>t(f).categoryName=s),placeholder:"請輸入訊息類別",maxlength:15},null,8,["value"])]),_:1},16)]),_:1}),a(g,{class:"hidden","html-type":"submit"})]),_:1})]),_:1},512)]),_:1},8,["open"])}}}),Te={class:"flex justify-between px-2 items-center mb-2"},Ne={key:1},Re={key:1},Fe={key:0},Ye={class:"editable-cell-wrapper"},Se={class:"text-sms-status-alert-red text-xs"},De={key:1,class:"editable-cell-wrapper"},Me=x("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"},[p(" 您選擇的訊息類別將永久刪除。"),x("br"),p(" 原本屬於該訊息類別的自訂訊息，"),x("br"),p(" 將改為未分類狀態。 ")],-1),Ve=oe({__name:"sms-category",setup(H){const{getSmsCategory:$,smsCategory:w,pagination:K,updateSmsCategory:O,deleteSmsCategory:U}=W(),r=I({}),f=k(!1);xe(async()=>{C()}),we(()=>{f.value=!0});const E=[{title:"訊息類別",dataIndex:"categoryName",key:"categoryName",sorter:!0,width:"320px"},{title:"訊息數量",dataIndex:"smsCount",key:"smsCount",sorter:!0,width:"160px",align:"right"},{title:"建立時間",dataIndex:"createTime",key:"createTime",defaultSortOrder:"descend",sorter:!0,width:"160px"},{title:"修改時間",dataIndex:"updateTime",key:"updateTime",sorter:!0}],m=I({selectedRowKeys:[],selectedRows:[],loading:!1}),P=(s,e)=>{console.log("selectedRowKeys changed: ",s,e),m.selectedRowKeys=s,m.selectedRows=e},n=k({sortField:"createTime",sortOrder:"descend",createTime:[void 0,void 0],updateTime:[void 0,void 0],keyword:""}),y=k(),C=async(s=1,e=10)=>{let u={current:s,pageSize:e,...t(n)};await $(u)},N=s=>{r[s]={...X(w.value.filter(e=>s===e.key)[0]),msg:""}},T=async s=>{var v;const e=r[s];if(z(e.categoryName)){r[s].msg="請輸入訊息類別";return}w.value.find(b=>e.categoryName===b.categoryName&&e.key!==b.key)?r[s].msg=`系統中已有「${r[s].categoryName}」，請勿重複新增`:((v=(await O(e.key,e.categoryName)).data)==null?void 0:v.status)==="success"&&(Object.assign(w.value.filter(Y=>s===Y.key)[0],e),delete r[s],R.success({message:"訊息類別編輯成功",placement:"top"}))},c=async(s,e,u)=>{console.log("pagination:",s,"sorter:",u),n.value=Object.assign(n.value,{sortField:u.field,sortOrder:u.order}),await C(s.current,s.pageSize)},_=k(null),V=()=>{var s;C(1),(s=_.value)==null||s.hide()},R=Q(),g=k(!1),j=()=>{g.value=!0},L=async()=>{var e;((e=(await U(m.selectedRowKeys)).data)==null?void 0:e.status)==="success"&&(R.success({message:"訊息類別刪除成功",placement:"top"}),g.value=!1,m.selectedRowKeys=[],m.selectedRows=[])},F=k(null);return(s,e)=>{const u=fe,v=J,b=ve,Y=_e,B=ee,le=te,re=ae,ce=Ce("RouterLink"),ie=Z,ue=pe,me=se;return d(),h(A,null,[t(f)?(d(),G(be,{key:0,to:"#extraContent"},[a(v,{status:"small1",onClick:e[0]||(e[0]=i=>{var l;return(l=t(F))==null?void 0:l.show()})},{icon:o(()=>[a(u,{name:"plus",width:"16px"})]),default:o(()=>[p("新增類別訊息 ")]),_:1})])):q("",!0),x("div",Te,[x("div",null,[a(v,{status:"small2",class:"me-2",onClick:j,disabled:t(m).selectedRowKeys.length===0},{icon:o(()=>[a(u,{name:"delete",width:"16px"})]),default:o(()=>[p("刪除 ")]),_:1},8,["disabled"])]),a(de,{ref_key:"filterKeywordInputRef",ref:_,class:"w-440px h-40px",modelValue:t(n).keyword,"onUpdate:modelValue":e[4]||(e[4]=i=>t(n).keyword=i),placeholder:"搜尋訊息類別",onClearFilter:e[5]||(e[5]=()=>{n.value={...t(n),keyword:"",createTime:[void 0,void 0],updateTime:[void 0,void 0]}})},{filterForm:o(()=>[a(re,{ref_key:"formRef",ref:y,layout:"vertical",model:t(n),autocomplete:"off"},{default:o(()=>[a(le,{gutter:[16,12]},{default:o(()=>[a(B,{span:24},{default:o(()=>[a(Y,{label:"建立時間",valueed:t(n).createTime},{default:o(()=>[a(b,{class:"w-full",value:t(n).createTime,"onUpdate:value":e[1]||(e[1]=i=>t(n).createTime=i),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(B,{span:24},{default:o(()=>[a(Y,{label:"修改時間",valueed:t(n).updateTime},{default:o(()=>[a(b,{class:"w-full",value:t(n).updateTime,"onUpdate:value":e[2]||(e[2]=i=>t(n).updateTime=i),placement:"topLeft",format:"YYYY-MM-DD",valueFormat:"YYYY/MM/DD"},null,8,["value"])]),_:1},8,["valueed"])]),_:1}),a(B,{span:24,class:"text-center"},{default:o(()=>[a(v,{status:"small2",class:"me-5",onClick:e[3]||(e[3]=i=>{var l;return(l=t(_))==null?void 0:l.hide()})},{default:o(()=>[p("取消")]),_:1}),a(v,{status:"small1",onClick:V},{default:o(()=>[p("確定")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])]),a(ue,{dataSource:t(w),columns:E,size:"small",showSorterTooltip:!1,"row-selection":{selectedRowKeys:t(m).selectedRowKeys,onChange:P},onChange:c,pagination:{...t(K)}},{bodyCell:o(({column:i,record:l,text:S})=>[i.dataIndex==="smsCount"?(d(),h(A,{key:0},[S>0?(d(),G(ce,{key:0,href:"javascript:;",class:"text-sm text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80 font-400",hover:"text-sms-primary-blue-80 underline underline-2 underline-sms-primary-blue-80",to:{name:"CustomMessage",query:{tabActived:"customMessage",categoryId:l.key}}},{default:o(()=>[p(M(S),1)]),_:2},1032,["to"])):(d(),h("span",Ne,M(S),1))],64)):q("",!0),i.dataIndex==="categoryName"?(d(),h("div",Re,[t(r)[l.key]?(d(),h("div",Fe,[x("div",Ye,[a(ie,{value:t(r)[l.key].categoryName,"onUpdate:value":D=>t(r)[l.key].categoryName=D,onPressEnter:D=>T(l.key),maxLength:15,status:t(r)[l.key].msg&&!t(z)(t(r)[l.key].msg)?"error":""},null,8,["value","onUpdate:value","onPressEnter","status"]),a(u,{name:"save",onClick:D=>T(l.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"])]),x("span",Se,M(t(r)[l.key].msg),1)])):(d(),h("div",De,[p(M(S||" ")+" ",1),a(u,{name:"edit",onClick:D=>N(l.key),class:"ms-1 text-sms-primary-blue-80 cursor-pointer"},null,8,["onClick"])]))])):q("",!0)]),_:1},8,["dataSource","row-selection","pagination"]),a(he,{ref_key:"smsCategoryCreateRef",ref:F,"save-callbck":()=>C(1)},null,8,["save-callbck"]),a(me,{open:t(g),"onUpdate:open":e[6]||(e[6]=i=>ne(g)?g.value=i:null),title:"是否刪除選取的訊息類別？",centered:"",cancelText:"取消",okText:"確定",onOk:L,width:"440px"},{default:o(()=>[Me]),_:1},8,["open"])],64)}}});export{Ve as _};

import{_ as ne}from"./index.vuevuetypescriptsetuptruelang-BwNhP4Dj.js";import{_ as se}from"./index.vuevuetypestyleindex0lang-Bo9-5UcB.js";import{_ as G}from"./index.vuevuetypescriptsetuptruelang-B72BLR5Z.js";import{_ as H}from"./index-Ce45V-Uu.js";import{d as W,f as D,W as f,X as M,Y as s,G as g,a3 as N,k as c,F as B,$ as u,u as t,a4 as k,r as T,c as le,a7 as ae,m as P,A as E,H as Y,_ as S}from"./vue-7WeWijCE.js";import{n as oe,Y as ie,P as ce,T as pe,p as de}from"./antd-D-4v7PI_.js";const re=s("span",{class:"text-red-500"},"*",-1),ue=["accept"],me={for:"fileInput",class:"flex flex-col items-center justify-center h-full text-sms-grayscale-80 text-sm"},fe=s("p",{class:""}," 拖曳圖片至此 ",-1),ge=s("p",{class:""}," 拖曳影音至此 ",-1),_e=W({name:"DropFile",__name:"index",props:{uploadType:{type:String,default:"image"}},emits:["changeFile"],setup(a,{emit:y}){const h=a,O=y,_=[".jpg",".jpeg",".png",".gif"],b=[".mp4",".mp3"],o=D(),C=D(!1);function p(m){const v=m.target.files;v&&v.length>0&&o.value&&(O("changeFile",v),o.value.value="")}function i(m){m.preventDefault(),C.value=!0}function $(){C.value=!1}function j(m){var x,v;if(m.preventDefault(),o.value&&((x=m==null?void 0:m.dataTransfer)!=null&&x.files)){const w=[];for(const I of m.dataTransfer.files){const l=(v=I.name)==null?void 0:v.split(".").pop();h.uploadType==="image"?_.includes(`.${l}`)&&w.push(I):b.includes(`.${l}`)&&w.push(I)}w.length>0&&O("changeFile",w)}C.value=!1}return(m,x)=>{const v=H,w=G;return f(),M(B,null,[s("label",null,[g(N(a.uploadType==="image"?"上傳檔案":"上傳影音")+" ",1),re]),s("div",{class:"dropzone-container",onDragover:i,onDragleave:$,onDrop:j},[s("input",{id:"fileInput",ref_key:"file",ref:o,type:"file",name:"file",class:"hidden",accept:a.uploadType==="image"?_.join(","):b.join(","),onChange:p},null,40,ue),s("div",me,[c(v,{name:"upload-circle",width:"40px",class:"block mb-4",color:"var(--grayscale-40)"}),a.uploadType==="image"?(f(),M(B,{key:0},[fe,s("p",null,[g(" 或點擊"),c(w,{class:"mx-2",onClick:x[0]||(x[0]=I=>{var l;return(l=t(o))==null?void 0:l.click()})},{default:u(()=>[g(" 開啟資料夾 ")]),_:1}),g("選擇圖片 ")])],64)):k("",!0),a.uploadType==="video"?(f(),M(B,{key:1},[ge,s("p",null,[g(" 或點擊"),c(w,{class:"mx-2",onClick:x[1]||(x[1]=I=>{var l;return(l=t(o))==null?void 0:l.click()})},{default:u(()=>[g(" 開啟資料夾 ")]),_:1}),g("選擇影音 ")])],64)):k("",!0)])],32)],64)}}});function xe(a){let y,h;return _=>({draggable:!0,ondrag(){y=_},ondrop(){h=_},ondragend(){if(y&&h&&y!==h){const b=a.indexOf(y),o=a.indexOf(h);[a[b],a[o]]=[a[o],a[b]],y=void 0,h=void 0}},ondragover(){return!1}})}const ve={class:"px-20px pb-24px"},ye={class:"text-sms-grayscale-80 font-400 text-base text-center"},he=s("br",null,null,-1),be={class:"text-sms-primary-blue-80 font-700"},ke={class:"text-sms-primary-blue-80 font-700"},we={class:"text-sms-primary-blue-80 font-700"},Ce={class:"text-sms-status-alert-red text-sm font-400 text-center mt-4"},Ie=s("p",{class:"text-sms-grayscale-80 font-400 text-base"}," 可上傳 2 張圖片，格式為 jpg、png、gif ",-1),Fe=s("p",{class:"text-sms-grayscale-80 font-400 text-base"}," 可上傳 1 個影音，格式為 mp4、mp3 ",-1),$e={key:1,class:"h-auto"},ze=s("div",{class:"text-center px-30px py-20px w-328px text-base mx-auto"}," 刪除的檔案將無法復原 ",-1),De={key:0,class:"text-center py-40px w-523px h-auto text-base mx-auto"},Ae=W({__name:"multimedia-upload-modal",emits:["updateMultimediaFile"],setup(a,{expose:y,emit:h}){const O=h;function _(n){return n===0?"0KB":`${Number.parseFloat((n/1024**1).toFixed(0))}KB`}const b=D("image"),o=D(!1),C=D([]),p=T([]),i=T([]),$=D(!1),j=le(()=>{let n=i.reduce((e,d)=>e+(d==null?void 0:d.size),0);return n=p.reduce((e,d)=>e+(d==null?void 0:d.size),n),n});function m(n){for(const e of n)i.push({key:i.length+1,fileName:e.name,size:e.size,fileSize:_(e.size),file:e,type:"image",url:URL.createObjectURL(e)})}function x(n){if(n.length>0){const e=n[0];p.push({key:p.length+1,fileName:e.name,size:e.size,fileSize:_(e.size),file:e,type:"video",url:URL.createObjectURL(e)})}}function v(n){C.value=n,i.length=0;const e=Object.assign([],n.filter(F=>F.type==="image"));i.push(...e),p.length=0;const d=Object.assign([],n.filter(F=>F.type==="video"));p.push(...d),o.value=!0}const I=[{title:"拖曳順序",dataIndex:"drop",key:"drop",width:"80px",customCell:xe(i)},{title:"檔案名稱",dataIndex:"fileName",key:"fileName",width:"200px",ellipsis:!0},{title:"檔案大小",dataIndex:"fileSize",key:"fileSize",width:"80px"},{title:"預覽",dataIndex:"preview",key:"preview",width:"60px"},{title:"刪除",dataIndex:"del",key:"del",width:"60px"}],l=T({open:!1,type:"image",index:0,delAll:!1});function A(n,e,d){Object.assign(l,{open:!0,type:e,delAll:n,index:d})}function X(){l.delAll?(i.length=0,p.length=0,V()):l.type==="image"?i.splice(l.index,1):p.splice(l.index,1),l.open=!1}function q(n){n.stopImmediatePropagation(),i.length>0||p.length>0?A(!0):o.value=!1}function V(){if($.value=!1,Number.parseInt(_(j.value).replace("KB",""))>300){$.value=!0;return}O("updateMultimediaFile",t(i).concat(t(p))),o.value=!1}const z=T({open:!1,file:void 0});return y({show:v}),(n,e)=>{const d=_e,F=H,K=G,J=se,R=ce,L=ne,Q=pe,U=de;return f(),M(B,null,[c(U,{open:t(o),"onUpdate:open":e[2]||(e[2]=r=>Y(o)?o.value=r:null),title:"多媒體附件上傳",centered:"",width:"600px","cancel-text":"取消","ok-text":"確定",onOk:V,onCancel:e[3]||(e[3]=r=>{$.value=!1,C.value=[]})},ae({default:u(()=>[s("div",ve,[s("div",ye,[g(" 請注意，MMS 多媒體附件 (圖片檔/影音檔)，總大小不可超過 300KB "),he,g(" 目前已上傳 "),s("span",be,N(t(i).length),1),g(" 個圖片檔、"),s("span",ke,N(t(p).length),1),g(" 個影音檔，共 "),s("span",we,N(_(t(j))),1)]),P(s("div",Ce," 超過 300KB 上限，請修正 ",512),[[E,t($)]])]),c(Q,{activeKey:t(b),"onUpdate:activeKey":e[1]||(e[1]=r=>Y(b)?b.value=r:null),type:"card","destroy-inactive-tab-pane":!0,class:"full-border-tab last-child-rounded"},{default:u(()=>[c(R,{key:"image",tab:"圖片"},{default:u(()=>[Ie,t(i).length<2?(f(),S(d,{key:0,"upload-type":"image",onChangeFile:m})):k("",!0),P(c(J,{columns:I,"data-source":t(i)},{bodyCell:u(({column:r,index:Z,record:ee})=>[r.dataIndex==="drop"?(f(),S(K,{key:0,status:"small3"},{icon:u(()=>[c(F,{name:"menu",class:"text-sms-grayscale-100",width:"16px"})]),_:1})):k("",!0),r.dataIndex==="preview"?(f(),S(K,{key:1,status:"small3",onClick:te=>{t(z).file=ee,t(z).open=!0}},{icon:u(()=>[c(F,{name:"preview-blue",class:"text-sms-primary-blue-80"})]),_:2},1032,["onClick"])):k("",!0),r.dataIndex==="del"?(f(),S(K,{key:2,status:"small3",onClick:te=>A(!1,"image",Z)},{icon:u(()=>[c(F,{name:"del-blue",class:"text-sms-primary-blue-80"})]),_:2},1032,["onClick"])):k("",!0)]),_:1},8,["data-source"]),[[E,t(i).length>0]])]),_:1},8,["tab"]),c(R,{key:"video",tab:"影音"},{default:u(()=>[Fe,t(p).length<1?(f(),S(d,{key:0,"upload-type":"video",onChangeFile:x})):k("",!0),t(p).length>0?(f(),M("div",$e,[c(L,{source:t(p)[0],onDeleteVideo:e[0]||(e[0]=r=>A(!1,"video",0))},null,8,["source"])])):k("",!0)]),_:1},8,["tab"])]),_:1},8,["activeKey"])]),_:2},[t(oe)(t(C))?{name:"closeIcon",fn:u(()=>[c(t(ie),{class:"ant-modal-close-icon text-black",onClick:q})]),key:"0"}:void 0]),1032,["open"]),c(U,{open:t(l).open,"onUpdate:open":e[4]||(e[4]=r=>t(l).open=r),title:t(l).delAll?"是否刪除所有已上傳的檔案？":"是否刪除已上傳的檔案？",centered:"","cancel-text":"取消","ok-text":"確定",width:"400px",onOk:X},{default:u(()=>[ze]),_:1},8,["open","title"]),c(U,{open:t(z).open,"onUpdate:open":e[5]||(e[5]=r=>t(z).open=r),title:" ",centered:"",footer:null,width:"960px"},{default:u(()=>[t(z).file?(f(),M("div",De,[c(L,{source:t(z).file,"show-del-btn":!1,"image-class":"h-auto w-auto max-w-full"},null,8,["source"])])):k("",!0)]),_:1},8,["open"])],64)}}});var Me=(a=>(a.SMS="SMS",a.MMS="MMS",a))(Me||{});export{Me as M,Ae as _};
